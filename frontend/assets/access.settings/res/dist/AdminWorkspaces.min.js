(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")},880:e=>{e.exports=require("pydio/http/api")},590:e=>{e.exports=require("pydio/lang/observable")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{DataSource:()=>ht,DataSourceEditor:()=>Ln,DataSourcesBoard:()=>Nr,MetadataBoard:()=>Wr,TemplatePath:()=>it,TemplatePathEditor:()=>Et,VirtualNodes:()=>Tt,Workspace:()=>C,WsAutoComplete:()=>J,WsDashboard:()=>et});const e=require("react");var t=n.n(e);const o=require("create-react-class");var a=n.n(o);const i=require("prop-types");var l=n.n(i);const s=require("pydio");var c=n.n(s);const u=require("material-ui"),d=require("pydio/util/xml");var p=n.n(d),f=n(173),m=n(880),y=n.n(m);const h=require("pydio/util/lang");var g=n.n(h),b=n(590),v=n.n(b);const S=require("cells-sdk");function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},O(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(l,e);var t,n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=k(o);if(a){var i=k(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==E(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this)).internalAttributes={},t.dirty=!1,e?t.initModel(e):(t.create=!0,t.model=new S.IdmWorkspace,t.model.Scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.model.RootNodes={},t.internalAttributes={DEFAULT_RIGHTS:""},t.model.PoliciesContextEditable=!0,t.model.Attributes=JSON.stringify(t.internalAttributes)),t.observableModel=t.buildProxy(t.model),t}return t=l,r=[{key:"rootIsTemplatePath",value:function(e){return!(!e.MetaStore||!e.MetaStore.resolution)}},{key:"listWorkspaces",value:function(){var e=new S.WorkspaceServiceApi(y().getRestClient()),t=new S.RestSearchWorkspaceRequest,n=new S.IdmWorkspaceSingleQuery;return n.scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.Queries=[n],e.searchWorkspaces(t)}}],(n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;return"Slug"===n?o=g().computeStringSlug(o):"Label"===n&&t.create&&(e.Slug=g().computeStringSlug(o)),e[n]=o,t.dirty=!0,t.notify("update"),!0},get:function(e,n){var r=e[n];return"Attributes"===n&&(r=t.internalAttributes),r instanceof Array?r:r instanceof Object?t.buildProxy(r):r}})}},{key:"initModel",value:function(e){if(this.create=!1,this.dirty=!1,this.model=e,this.snapshot=JSON.parse(JSON.stringify(e)),e.Attributes){var t=JSON.parse(e.Attributes);"object"===E(t)&&Object.keys(t).length&&(this.internalAttributes=t)}else this.internalAttributes={};e.RootNodes||(e.RootNodes={})}},{key:"getModel",value:function(){return this.observableModel}},{key:"hasTemplatePath",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"hasFolderRoots",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return!l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"save",value:function(){var e=this;return this.model.Attributes=JSON.stringify(this.internalAttributes),new S.WorkspaceServiceApi(y().getRestClient()).putWorkspace(this.model.Slug,this.model).then((function(t){return e.initModel(t),e.observableModel=e.buildProxy(e.model),t}))}},{key:"remove",value:function(){return new S.WorkspaceServiceApi(y().getRestClient()).deleteWorkspace(this.model.Slug)}},{key:"revert",value:function(){var e=S.IdmWorkspace.constructFromObject(this.snapshot||{});this.initModel(e),this.observableModel=this.buildProxy(this.model)}},{key:"isValid",value:function(){return this.model.Slug&&this.model.Label&&Object.keys(this.model.RootNodes).length>0}},{key:"isDirty",value:function(){return this.dirty}}])&&w(t.prototype,n),r&&w(t,r),l}(v());const P=require("lodash.debounce");var x=n.n(P);const j=require("pydio/util/path");var R=n.n(j),T=["muiTheme","children"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function V(){return V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}var K=c().requireLib("hoc"),W=K.ModernAutoComplete,U=K.ModernTextField,q=K.ThemedModernStyles,H=K.ModernSelectField,z=(0,f.muiThemeable)()((function(e){var n=e.muiTheme,r=e.children,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,T),a=q(n);return t().createElement("div",V({style:a.fillBlockV2Right},o),r)})),J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(s,e);var n,r,o,a,i,l=(a=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=F(a);if(i){var o=F(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==_(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.value,r=void 0===n?"":n;return t.debounced=x()((function(){var e=t.state.value;t.loadValues(e)}),300),t.state={nodes:[],value:r},t}return n=s,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.validateOnLoad,n=this.state.value;this.loadValues(n,(function(){var n=e.state,r=n.nodes,o=n.value;r.filter((function(e){return e.Path===o&&(!e.Type||"COLLECTION"===e.Type&&!e.MetaStore&&!e.MetaStore.resolution)})).map((function(t){e.loadValues(o+"/")})),t&&e.handleNewRequest(o)}))}},{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({value:e}),e||(0,this.props.onDelete)()}},{key:"handleNewRequest",value:function(e){var t,n,r=this.state.nodes,o=this.props,a=o.onChange,i=void 0===a?function(){}:a,l=o.onDelete,s=void 0===l?function(){}:l,c=o.onError,u=void 0===c?function(){}:c;if("string"==typeof e){if(""===e)return void s();t=e,(n=r.filter((function(t){return t.Path===e}))[0])||(n=r.filter((function(t){return 0===t.Path.indexOf(e)}))[0])}else"object"===_(e)&&(t=e.key,n=e.node);if(!n)return u();this.setState({value:t}),i(t,n)}},{key:"loadValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e.lastIndexOf("/"),o=e.substr(0,r);if(null===this.lastSearch||this.lastSearch!==o){this.lastSearch=o,this.setState({loading:!0});var a=new S.AdminTreeServiceApi(y().getRestClient()),i=new S.TreeListNodesRequest,l=new S.TreeNode;l.Path=o+"/",i.Node=l,a.listAdminTree(i).then((function(e){t.setState({nodes:e.Children||[],loading:!1},(function(){return n()}))})).catch((function(){t.setState({loading:!1},(function(){return n()}))}))}}},{key:"render",value:function(){var e=this,n=this.state,r=n.value,o=n.nodes,a=n.loading,i=this.props,l=i.pydio,c=i.onDelete,d=i.onChange,p=i.isTemplatePath,f=i.skipTemplates,m=i.label,y=i.zDepth,h=void 0===y?0:y,b=function(e){return l.MessageHash["ajxp_admin."+e]||e},v=[];if(o){var S={};if(o.forEach((function(e){if(!(e.MetaStore&&e.MetaStore.resolution&&"cells"===e.Uuid||R().getBasename(e.Path).startsWith("."))){var t=s.renderNode(e,b);S[t.categ]||(S[t.categ]=[]),S[t.categ].push(t)}})),Object.keys(S).length>1){v.push({key:"h1",text:"",value:t().createElement(u.MenuItem,{primaryText:b("ws.complete.datasources"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var E=S[Object.keys(S)[0]];if(E.sort(g().arraySorter("text")),v.push.apply(v,D(E)),!f){v.push({key:"h2",text:"",value:t().createElement(u.MenuItem,{primaryText:b("ws.complete.templates"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var w=S[Object.keys(S)[1]];w.sort(g().arraySorter("text")),v.push.apply(v,D(w))}}else 1===Object.keys(S).length&&v.push.apply(v,D(S[Object.keys(S)[0]]))}var O=!0,k=t().createElement(W,{fullWidth:!0,searchText:r,onUpdateInput:function(t){return e.handleUpdateInput(t)},onNewRequest:function(t){return e.handleNewRequest(t)},onClose:function(){return e.handleNewRequest(r)},dataSource:v,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},floatingLabelText:m||b("ws.complete.label"),openOnFocus:!0,menuProps:{maxHeight:200,desktop:!0},hasRightBlock:!0});if(r&&"/"!==r){if(p){var C=p.MetaStore.resolution.split("\n").pop(),P=r+" - "+b("ws.complete.resolves")+' "'+C+'"';k=t().createElement(U,{floatingLabelText:m||b("ws.complete.label"),variant:"v2",fullWidth:!0,value:P,inputStyle:{color:"inherit"},disabled:!0})}}else k=t().createElement(H,{floatingLabelText:m||b("ws.complete.label"),variant:"v2",fullWidth:!0,maxHeight:300,onChange:function(e,t,n){d(n.Path,n)}},v.map((function(e){return e.value}))),O=!1;return t().createElement(u.Paper,{zDepth:h,style:A({display:"flex",alignItems:"center",margin:"2px 0"},this.props.style)},t().createElement("div",{style:{position:"relative",flex:1,height:60}},t().createElement("div",{style:{position:"absolute",right:0,top:30,width:30}},t().createElement(u.RefreshIndicator,{size:30,left:0,top:0,status:a?"loading":"hide"})),k),O&&t().createElement(z,null,t().createElement(u.IconButton,{style:{marginTop:2},iconStyle:{color:c?"#9e9e9e":"#eee"},iconClassName:"mdi mdi-delete",onClick:c,disabled:!c})))}}],o=[{key:"renderNode",value:function(e,n){var r=t().createElement("span",null,e.Path),o="mdi mdi-folder",a="folder";if(e.MetaStore&&e.MetaStore.resolution){o="mdi mdi-file-tree",a="templatePath";var i=e.MetaStore.resolution.split("\n").pop();r=t().createElement("span",null,e.Path," ",t().createElement("i",{style:{color:"#9e9e9e"}},"- ",n("ws.complete.resolves")," ",i))}else"LEAF"===e.Type&&(o="mdi mdi-file");return{key:e.Path,text:e.Path,node:e,categ:a,value:t().createElement(u.MenuItem,{value:e},t().createElement(u.FontIcon,{className:o,color:"#607d8b",style:{float:"left",marginRight:8,fontSize:20}})," ",r)}}}],r&&I(n.prototype,r),o&&I(n,o),s}(t().Component);function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"loadNamespaces",value:function(){return new S.UserMetaServiceApi(y().getRestClient()).listUserMetaNamespace()}},{key:"putNS",value:function(t){var n=new S.UserMetaServiceApi(y().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("PUT"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"deleteNS",value:function(t){var n=new S.UserMetaServiceApi(y().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("DELETE"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"clearLocalCache",value:function(){try{window.ReactMeta&&ReactMeta.Renderer.getClient().clearConfigs()}catch(e){}}}],null&&Y(t.prototype,null),n&&Y(t,n),e}();G.MetaTypes={string:"Text",textarea:"Long Text",integer:"Number",boolean:"Boolean",date:"Date",choice:"Selection",tags:"Extensible Tags",stars_rate:"Stars Rating",css_label:"Color Labels",json:"JSON"};const Q=require("pydio/util/func");var $=n.n(Q);const X=require("pydio/http/resources-manager");var Z=n.n(X);function ee(e,t){if(e){if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(e,t):void 0}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(){return ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ae.apply(this,arguments)}function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t,n){return t&&le(e.prototype,t),n&&le(e,n),e}function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,a=pe(e);if(t){var i=pe(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return r=this,!(o=n)||"object"!==fe(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r):o}}function pe(e){return pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pe(e)}function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}var me=c().requireLib("hoc"),ye=me.ModernTextField,he=me.ModernAutoComplete,ge=me.ThemedModernStyles;function be(e){try{return JSON.parse(e.JsonDefinition).groupName||""}catch(e){return""}}function ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var n=e.split("."),r=n.shift(),o=n.join(".");return Z().loadClass(r).then((function(n){var a=$().getFunctionByName(o,n);if(!a){if("object"===fe(n)&&n[r]){var i=$().getFunctionByName(o,n[r]);if(i)return i}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return a})).catch((function(n){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw n}))}var Se=function(n){ce(o,n);var r=de(o);function o(e){return ie(this,o),r.call(this,e)}return se(o,[{key:"togglePolicies",value:function(e,t){var n=this.props,r=n.policies,o=void 0===r?[]:r,a=n.onChangePolicies,i=o.filter((function(t){return t.Action!==e}));i.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),"READ"===e&&t&&(i=i.filter((function(e){return"WRITE"!==e.Action}))).push(S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Effect:"allow",Subject:"profile:admin"})),a(i)}},{key:"render",value:function(){var n,r,o=this,a=this.props,i=a.readonly,l=a.policies,s=a.pydio,c=a.muiTheme,d=function(e){return s.MessageHash["ajxp_admin.metadata."+e]||e},p=ge(c);return l&&l.map((function(e){"profile:admin"===e.Subject&&"READ"===e.Action&&(n=!0),"profile:admin"===e.Subject&&"WRITE"===e.Action&&(r=!0)})),t().createElement(e.Fragment,null,t().createElement("div",null,t().createElement(u.Toggle,ae({label:d("toggle.read"),disabled:i,labelPosition:"left",toggled:n,onToggle:function(e,t){o.togglePolicies("READ",t)}},p.toggleFieldV2))),t().createElement("div",null,t().createElement(u.Toggle,ae({label:d("toggle.write"),labelPosition:"left",disabled:n||i,toggled:r,onToggle:function(e,t){o.togglePolicies("WRITE",t)}},p.toggleFieldV2))))}}]),o}(t().Component);Se=(0,f.muiThemeable)()(Se);var Ee=function(e){ce(r,e);var n=de(r);function r(e){var t;return ie(this,r),(t=n.call(this,e)).state={namespace:t.cloneNs(e.namespace),m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t},selectorNewKey:"",selectorNewValue:"",PoliciesBuilder:Se},Z().loadClass("ReactMeta").then((function(e){t.setState({metaModule:e});var n=t.props.policiesBuilder;n&&ve(n,Se).then((function(e){return t.setState({PoliciesBuilder:e})}))})),t}return se(r,[{key:"cloneNs",value:function(e){return S.IdmUserMetaNamespace.constructFromObject(JSON.parse(JSON.stringify(e)))}},{key:"componentWillReceiveProps",value:function(e){if(e.open!==this.props.open){var t=e.create,n=e.namespaces,r=this.cloneNs(e.namespace);t&&n.length&&(r.Order=n.map((function(e){return e.Order||0})).reduce((function(e,t){return Math.max(e,t)}),0)+1),this.setState({namespace:r})}}},{key:"save",value:function(){var e=this,t=this.state.namespace;G.putNS(t).then((function(){e.props.onRequestClose(),e.props.reloadList()}))}},{key:"getHideValue",value:function(){var e=this.state.namespace;try{return JSON.parse(e.JsonDefinition).hide}catch(e){return!1}}},{key:"setHideValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(re(re({},n),{},{hide:e})),this.setState({namespace:t})}},{key:"setGroupValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(re(re({},n),{},{groupName:e})),this.setState({namespace:t})}},{key:"getAdditionalData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.state.namespace;try{var n=JSON.parse(t.JsonDefinition).data||e;if(e.items&&n.split){var r=n.split(",").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}}(e,t)||ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split("|"),2);return{key:t[0],value:t[1]}}));return{items:r}}return n}catch(e){}return e}},{key:"setAdditionalDataKey",value:function(e,t){var n=this.state.namespace,r=JSON.parse(n.JsonDefinition),o=oe({},e,t);r.data=re(re({},r.data),o),n.JsonDefinition=JSON.stringify(r),this.setState({namespace:n})}},{key:"togglePolicies",value:function(e,t){var n=this,r=this.state.namespace,o=(r.Policies||[]).filter((function(t){return t.Action!==e}));o.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),r.Policies=o,this.setState({namespace:r},(function(){"READ"===e&&t&&n.togglePolicies("WRITE",!0)}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.create,o=n.namespaces,a=n.pydio,i=n.readonly,l=n.muiTheme,s=this.state,d=s.namespace,p=s.m,f=s.PoliciesBuilder,m=s.metaModule,h=ge(l);if(!m)return null;var g,b=m.TypeEditor;g=d.Label?d.Label:p("editor.title.create");var v="string";d.JsonDefinition&&(v=JSON.parse(d.JsonDefinition).type);var E,w,O=!1;if(d.Label?d.Namespace&&"usermeta-"!==d.Namespace||(O=!0,E=p("editor.ns.error")):(O=!0,w=p("editor.label.error")),r&&o.filter((function(e){return e.Namespace===d.Namespace})).length&&(O=!0,E=p("editor.ns.exists")),"choice"===v){var k=this.getAdditionalData({items:[]}).items;k&&k.length||(O=!0)}var C,P=function(e){if(Array.isArray(e))return te(e)}(C=new Set(o.map((function(e){return be(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(C)||ee(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();d.Policies&&d.Policies.map((function(e){"profile:admin"===e.Subject&&e.Action,"profile:admin"===e.Subject&&e.Action}));var x=[t().createElement(u.FlatButton,{primary:!0,label:a.MessageHash[54],onClick:this.props.onRequestClose}),t().createElement(u.FlatButton,{primary:!0,disabled:O||i,label:a.MessageHash[53],onClick:function(){e.save()}})];"tags"!==v||i||x.unshift(t().createElement(u.FlatButton,{primary:!1,label:p("editor.tags.reset"),onClick:function(){new S.UserMetaServiceApi(y().getRestClient()).deleteUserMetaTags(d.Namespace,"*").then((function(){a.UI.displayMessage("SUCCESS",p("editor.tags.cleared").replace("%s",d.Namespace))})).catch((function(e){a.UI.displayMessage("ERROR",e.message)}))}}));var j={section:{marginTop:10,fontWeight:500,fontSize:12}};return t().createElement(u.Dialog,{title:g,actions:x,modal:!1,contentStyle:{width:520},open:this.props.open,onRequestClose:this.props.onRequestClose,autoScrollBodyContent:!0,bodyStyle:{padding:20}},t().createElement(b,{m:p,pydio:a,namespace:d,forcePrefix:"usermeta-",onChange:function(t){return e.setState({namespace:t})},readonly:i,create:r,labelError:w,nameError:E,styles:j}),t().createElement("div",{style:j.section},c().getInstance().MessageHash[310]),t().createElement(u.Toggle,ae({label:p("toggle.list-visibility"),disabled:i,labelPosition:"left",toggled:!this.getHideValue(),onToggle:function(t,n){e.setHideValue(!n)}},h.toggleFieldV2)),t().createElement(u.Toggle,ae({label:p("toggle.index"),disabled:i,labelPosition:"left",toggled:d.Indexable,onToggle:function(t,n){d.Indexable=n,e.setState({namespace:d})}},h.toggleFieldV2)),f&&t().createElement(f,{policies:d.Policies,readonly:i,onChangePolicies:function(t){return e.setState({namespace:re(re({},d),{},{Policies:t})})},pydio:a}),t().createElement("div",{style:j.section},p("order")),t().createElement(ye,{floatingLabelText:p("order"),value:d.Order?d.Order:"0",onChange:function(t,n){d.Order=parseInt(n),e.setState({namespace:d})},fullWidth:!0,type:"number",readOnly:i,variant:"v2"}),t().createElement(he,{floatingLabelFixed:!0,fullWidth:!0,floatingLabelText:p("group-field"),filter:function(e,t){return!e.indexOf||0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,dataSource:P,searchText:be(d)||"",onNewRequest:function(t,n){e.setGroupValue(t)},onUpdateInput:function(t){e.setGroupValue(t)},menuProps:{maxHeight:300,overflowY:"auto"}}))}}]),r}(t().Component);(Ee=(0,f.muiThemeable)()(Ee)).PropTypes={namespace:l().instanceOf(S.IdmUserMetaNamespace).isRequired,namespaces:l().arrayOf(S.IdmUserMetaNamespace),create:l().bool,reloadList:l().func,onRequestClose:l().func};const we=Ee;function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){Ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pe={display:"flex",alignItems:"center",padding:"0 20px 0 8px",position:"absolute",height:64,zIndex:10,top:64,left:0,right:0,backgroundColor:"rgb(246 246 248)",boxShadow:"rgba(0, 0, 0, .1) 0px 1px 2px"};function xe(e,n,r,o,a,i,l){var s=Object.keys(e),c=0===s.indexOf(n),d=o||s.indexOf(n)===s.length-1,p=t().createElement("div",{style:Pe},t().createElement("div",{style:{flex:1}},t().createElement(u.Stepper,{activeStep:s.indexOf(n)},s.map((function(n){return t().createElement(u.Step,null,t().createElement(u.StepLabel,null,e[n]))}))))),f=t().createElement("div",{style:ke(ke({},Pe),{},{top:null,bottom:0,backgroundColor:"white",boxShadow:"rgba(0, 0, 0, .1) 0px -1px 2px"})},t().createElement("span",{style:{flex:1}}),t().createElement(u.FlatButton,{primary:!0,label:l.back,onClick:function(){var e=s.indexOf(n);e>0&&r(s[e-1])},disabled:c}),t().createElement(u.FlatButton,{primary:!0,label:l.next,onClick:function(){var e=s.indexOf(n);e<s.length-1&&r(s[e+1])},disabled:d}),t().createElement("div",{style:{width:1,height:40,backgroundColor:"#efefef",margin:"0 5px"}}),t().createElement(u.FlatButton,{primary:!0,label:l.save,onClick:a,disabled:!i()}));return{Steps:p,Buttons:f}}function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Re(){return Re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Re.apply(this,arguments)}function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t){return De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},De(e,t)}function Le(e){return Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Le(e)}var _e=c().requireLib("hoc"),Ie=_e.ModernTextField,Be=_e.ModernSelectField,Fe=_e.ThemedModernStyles,Ve=c().requireLib("form").InputIntegerBytes,Ke=AdminComponents,We=Ke.PaperEditorLayout,Ue=Ke.AdminStyles,qe=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(s,n);var r,o,a,i,l=(a=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Le(a);if(i){var o=Le(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==je(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.presetModel||new C(e.workspace);n.observe("update",(function(){t.forceUpdate()})),t.state={workspace:n.getModel(),container:n,newFolderKey:Math.random(),showDialog:!1};var r=t.props.policiesBuilder;return r&&ve(r,null).then((function(e){return t.setState({PoliciesBuilder:e})})).catch((function(e){})),t}return r=s,(o=[{key:"enableSync",value:function(e){e?this.setState({showDialog:"enableSync",dialogTargetValue:e}):this.setState({showDialog:"disableSync",dialogTargetValue:e})}},{key:"confirmSync",value:function(e){this.state.workspace.Attributes.ALLOW_SYNC=e,this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"revert",value:function(){var e=this,t=this.state.container;t.revert(),this.setState({workspace:t.getModel()},(function(){e.forceUpdate()}))}},{key:"save",value:function(){var e=this,t=this.state.container,n=this.props,r=n.reloadList,o=n.closeEditor;this.setState({saving:!0});var a=t.create;t.save().then((function(){r(),e.setState({workspace:t.getModel(),saving:!1},(function(){e.forceUpdate()})),a&&o()})).catch((function(){e.setState({saving:!1})}))}},{key:"remove",value:function(){var e=this.state.container,t=this.props,n=t.closeEditor,r=t.reloadList,o=t.pydio;o.UI.openConfirmDialog({message:o.MessageHash["settings.35"],destructive:[e.getModel().Label],validCallback:function(){e.remove().then((function(){r(),n()}))}})}},{key:"render",value:function(){var n=this,r=this.props,o=r.closeEditor,a=r.pydio,i=r.advanced,l=r.muiTheme,s=this.state,c=s.workspace,d=s.container,p=s.newFolderKey,f=s.saving,m=s.showDialog,y=s.dialogTargetValue,h=s.PoliciesBuilder,g=s.policiesEdit,b=Fe(l),v=function(e){return a.MessageHash["ajxp_admin."+e]||e},S=function(e){return a.MessageHash["settings."+e]||e},E=function(e){return a.MessageHash["advanced_settings."+e]||e},w=!c.PoliciesContextEditable,O=[];d.create||w||O.push(We.actionButton(v("plugins.6"),"mdi mdi-undo",(function(){n.revert()}),!d.isDirty())),w||O.push(We.actionButton(a.MessageHash[53],"mdi mdi-content-save",(function(){n.save()}),f||!(d.isDirty()&&d.isValid())));var k=Ue(this.props.muiTheme.palette),P={title:Ne(Ne({},k.body.block.headerFull),{},{margin:"0 -20px"}),legend:{padding:"16px 4px 8px"},section:Ne({padding:"0 20px 20px",margin:10,backgroundColor:"white"},k.body.block.container),toggleDiv:{},divider:{margin:"24px -20px 0px",height:1,border:"none",backgroundColor:"rgb(236 239 241)"}},x=c.RootNodes,j=Object.keys(x).map((function(e){var r=C.rootIsTemplatePath(x[e]),o=v(r?"ws.editor.path.template":"ws.complete.folders");return t().createElement(J,{key:x[e].Uuid,pydio:a,label:o,value:x[e].Path,isTemplatePath:r?x[e]:null,onDelete:function(){delete x[e],n.forceUpdate()},onChange:function(t,n){console.log(x,t,n),delete x[e],""!==t&&(x[n.Uuid]=n)},skipTemplates:d.hasFolderRoots()})}));if(!d.hasTemplatePath()){var T=this.state.newRoot,N=void 0!==T&&T;!Object.keys(x).length||N?j.push(t().createElement(J,{key:p,pydio:a,value:"",onChange:function(e,t){t&&(x[t.Uuid]=t,n.setState({newFolderKey:Math.random(),newRoot:!1}))},skipTemplates:d.hasFolderRoots()})):j.push(t().createElement(u.FlatButton,{label:"+ "+v("ws.complete.additional"),onClick:function(){return n.setState({newRoot:!0})},primary:!0}))}var A,M,D=function(e,t){return e};if(d.create){var L,_=this.state.currentPane,I=void 0===_?"data":_,B={data:v("ws.editor.data.title"),main:v("ws.30"),other:v("ws.editor.other")};D=function(e,t){return t===I?Ne(Ne({},e),{},{marginTop:80}):{display:"none"}},"data"===I&&0===Object.keys(x).length&&(L=!0);var F=xe(B,I,(function(e){"data"!==I||"main"!==e||1!==Object.keys(x).length||c.Label||(c.Label=R().getBasename(x[Object.keys(x)[0]].Path)),n.setState({currentPane:e})}),L,(function(){return n.save()}),(function(){return d.isValid()}),{back:v("ds.editor.tab.button-back"),next:v("ds.editor.tab.button-next"),save:v("ds.editor.tab.button-create")});A=F.Steps,M=F.Buttons}var V,K=t().createElement(u.Dialog,{open:m,title:v("ws.editor.sync.warning"),onRequestClose:function(){n.confirmSync(!y)},actions:[t().createElement(u.FlatButton,{label:a.MessageHash[54],onClick:function(){n.confirmSync(!y)}}),t().createElement(u.FlatButton,{label:v("ws.editor.sync.warning.validate"),onClick:function(){n.confirmSync(y)}})]},"enableSync"===m&&t().createElement("div",null,v("ws.editor.sync.warning.enable")),"disableSync"===m&&t().createElement("div",null,v("ws.editor.sync.warning.disable"))),W=t().createElement(u.Paper,{zDepth:0,style:D(P.section,"main")},t().createElement("div",{style:P.title},v("ws.30")),t().createElement("div",{style:P.legend},v("ws.editor.options.legend")),t().createElement(Ie,{fullWidth:!0,errorText:c.Label?"":v("ws.editor.label.legend"),floatingLabelText:S("8"),value:c.Label,onChange:function(e,t){c.Label=t},variant:"v2"}),t().createElement(Ie,{fullWidth:!0,errorText:c.Label&&!c.Slug?v("ws.editor.slug.legend"):"",floatingLabelText:v("ws.5"),value:c.Slug,onChange:function(e,t){c.Slug=t},variant:"v2"}),t().createElement(Ie,{fullWidth:!0,floatingLabelText:v("ws.editor.description"),value:c.Description,onChange:function(e,t){c.Description=t},variant:"v2"})),U=t().createElement(u.Paper,{zDepth:0,style:D(P.section,"data")},t().createElement("div",{style:P.title},v("ws.editor.data.title")),t().createElement("div",{style:P.legend},v("ws.editor.data.legend")),j,t().createElement("div",{style:P.legend},v("ws.editor.default_rights")),t().createElement(Be,{fullWidth:!0,value:c.Attributes.DEFAULT_RIGHTS||"",onChange:function(e,t,n){c.Attributes.DEFAULT_RIGHTS=n},floatingLabelText:v("ws.editor.default_rights.hint"),variant:"v2"},t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.none"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.read"),value:"r"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.readwrite"),value:"rw"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.write"),value:"w"}))),q=t().createElement(u.Paper,{zDepth:0,style:D(P.section,"other")},t().createElement("div",{style:P.title},v("ws.editor.other")),t().createElement("div",{style:Ne({},P.legend)},v("ws.editor.other.skiprecycle.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,Re({label:v("ws.editor.other.skiprecycle"),labelPosition:"right",checked:c.Attributes.SKIP_RECYCLE,onCheck:function(e,t){c.Attributes.SKIP_RECYCLE=t}},b.toggleFieldV2))),i&&t().createElement(e.Fragment,null,t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Ne({},P.legend)},v("ws.editor.other.sync.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,Re({label:v("ws.editor.other.sync"),labelPosition:"right",checked:c.Attributes.ALLOW_SYNC,onCheck:function(e,t){!d.hasTemplatePath()&&t?n.enableSync(t):t?c.Attributes.ALLOW_SYNC=t:n.enableSync(t)}},b.toggleFieldV2))),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Ne({},P.legend)},v("ws.editor.other.quota")),t().createElement(Ve,{variant:"v2",attributes:{label:"Quota"},value:c.Attributes.QUOTA||0,onChange:function(e){e>0?c.Attributes.QUOTA=e+"":(c.Attributes.QUOTA="0",delete c.Attributes.QUOTA)}}),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Ne({},P.legend)},v("ws.editor.other.layout")),t().createElement(Be,{fullWidth:!0,floatingLabelText:v("ws.editor.other.layout"),variant:"v2",value:c.Attributes.META_LAYOUT||"",onChange:function(e,t,n){c.Attributes.META_LAYOUT=n}},t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.default"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.easy"),value:"meta.layout_sendfile"}))));return h&&(V=t().createElement(u.Paper,{zDepth:0,style:D(P.section,"policies")},t().createElement("div",{style:P.title},E("editor.visibility.workspace")),t().createElement("div",{style:Ne({},P.legend)},E("editor.visibility.warning"),!g&&t().createElement("span",{style:{fontWeight:500,cursor:"pointer"},onClick:function(){return n.setState({policiesEdit:!0})}}," - ",E("editor.visibility.edit"))),t().createElement(h,{pydio:a,policies:c.Policies,onChangePolicies:function(e){return c.Policies=e},readonly:!g,showHeader:!1,forceCustom:!0,advancedLegend:t().createElement("span",null),advancedContainerStyle:g?{paddingBottom:300}:{},allowedActions:{READ:E("policies.builder.action.read"),WRITE:E("policies.builder.action.write")}}))),t().createElement(We,{title:c.Label||S("90"),titleLeftIcon:"mdi mdi-folder-open",titleActionBar:O,closeAction:o,className:"workspace-editor",contentFill:!1},A,K,W,U,q,V,M)}}])&&Me(r.prototype,o),s}(e.Component);qe=(0,f.muiThemeable)()(qe);const He=require("pydio/model/data-model");var ze=n.n(He);const Je=require("pydio/model/node");var Ye=n.n(Je),Ge=c().requireLib("components").MaterialTable;const Qe=a()({displayName:"WorkspaceList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(ze()).isRequired,rootNode:l().instanceOf(Ye()).isRequired,currentNode:l().instanceOf(Ye()).isRequired,openSelection:l().func,advanced:l().boolean},getInitialState:function(){return{workspaces:[],loading:!1}},startLoad:function(){this.props.onLoadState&&this.props.onLoadState(!0),this.setState({loading:!0})},endLoad:function(){this.props.onLoadState&&this.props.onLoadState(!1),this.setState({loading:!1})},reload:function(){var e=this,t=localStorage.getItem("admin.workspace.autoload");localStorage.removeItem("admin.workspace.autoload"),this.startLoad(),C.listWorkspaces().then((function(n){if(e.endLoad(),e.setState({workspaces:n.Workspaces||[]}),t){var r=n.Workspaces.filter((function(e){return e.UUID===t}));1===r.length&&e.props.openSelection(r[0])}})).catch((function(t){e.endLoad()}))},componentDidMount:function(){this.reload()},openTableRows:function(e){e.length&&this.props.openSelection(e[0].workspace)},deleteAction:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.35"],destructive:[e.Label],validCallback:function(){new C(e).remove().then((function(){t.reload()}))}})},computeTableData:function(){var e=[],t=this.props.filterString;return this.state.workspaces.map((function(n){var r="";n.RootNodes&&(r=Object.keys(n.RootNodes).map((function(e){return g().trimRight(n.RootNodes[e].Path,"/")})).join(", "));var o=!1;if(n.Attributes)try{var a=JSON.parse(n.Attributes);!0!==a.ALLOW_SYNC&&"true"!==a.ALLOW_SYNC||(o=!0)}catch(e){}if(t){var i=t.toLowerCase(),l=n.Label&&n.Label.toLowerCase().indexOf(i)>=0,s=n.Description&&n.Description.toLowerCase().indexOf(i)>=0,c=r&&r.toLowerCase().indexOf(i)>=0;if(!(l||s||c))return}e.push({workspace:n,label:n.Label,description:n.Description,slug:n.Slug,summary:r,syncable:o})})),e.sort(g().arraySorter("label",!1,!0)),e},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,a=n.editable,i=n.tableStyles,l=n.openSelection,s=function(e){return r.MessageHash["ajxp_admin."+e]},c=function(e){return r.MessageHash["settings."+e]},u=[{name:"label",label:c("8"),style:{width:"20%",fontSize:15},headerStyle:{width:"20%"},sorter:{type:"string",default:"true"}},{name:"description",label:c("103"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"summary",label:s("ws.board.summary"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}}];o&&u.push({name:"syncable",label:s("ws.board.syncable"),style:{width:"10%",textAlign:"center"},headerStyle:{width:"10%",textAlign:"center"},sorter:{type:"number",sortValue:function(e){return e.syncable?1:0}},renderCell:function(e){return t().createElement("span",{className:"mdi mdi-check",style:{fontSize:18,opacity:e.syncable?1:0}})}}),u.push({name:"slug",label:s("ws.5"),style:{width:"20%"},headerStyle:{width:"20%"},sorter:{type:"string"}});var d=this.state.loading,p=this.computeTableData(),f=[];a&&f.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit Workspace",onClick:function(e){l(e.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}});var m=r.user.getRepositoriesList();return f.push({iconClassName:"mdi mdi-open-in-new",tooltip:"Open this workspace...",onClick:function(e){r.triggerRepositoryChange(e.workspace.UUID)},disable:function(e){return!m.has(e.workspace.UUID)}}),a&&f.push({iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteAction(t.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}}),t().createElement(Ge,{data:p,columns:u,actions:f,onSelectRows:a?this.openTableRows.bind(this):null,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:s(d?"loading":"ws.board.empty"),masterStyles:i,paginate:[10,25,50,100],defaultPageSize:25,storageKey:"console.workspaces.list"})}});function $e(){return $e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$e.apply(this,arguments)}var Xe=c().requireLib("hoc").ModernTextField,Ze=a()({displayName:"WsDashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(ze()).isRequired,rootNode:l().instanceOf(Ye()).isRequired,currentNode:l().instanceOf(Ye()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,accessByName:l().func.isRequired,advanced:l().boolean},getInitialState:function(){return{selectedNode:null,searchString:""}},dirtyEditor:function(){var e=this.props.pydio;return!(!this.refs.editor||!this.refs.editor.isDirty()||confirm(e.MessageHash["role_editor.19"]))},openWorkspace:function(e){var t=this;if(!this.dirtyEditor()){var n=qe,r=p().XPathSelectSingleNode(this.props.pydio.getXmlRegistry(),'//client_configs/component_config[@component="AdminWorkspaces.Dashboard"]/editor');r&&(n=r.getAttribute("namespace")+"."+r.getAttribute("component"));var o=this.props,a=o.pydio,i=o.advanced,l=(o.accessByName,o.policiesBuilder),s={COMPONENT:n,PROPS:{ref:"editor",pydio:a,workspace:e,closeEditor:this.closeWorkspace,advanced:i,policiesBuilder:l,reloadList:function(){t.refs.workspacesList.reload()}}};return this.props.openRightPane(s),!0}},closeWorkspace:function(){this.dirtyEditor()||this.props.closeRightPane()},showWorkspaceCreator:function(e){var t=this,n=this.props,r=n.pydio,o=n.advanced,a={COMPONENT:qe,PROPS:{ref:"editor",type:e,pydio:r,advanced:o,closeEditor:this.closeWorkspace,reloadList:function(){t.refs.workspacesList.reload()}}};this.props.openRightPane(a)},reloadWorkspaceList:function(){this.refs.workspacesList.reload()},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,a=n.currentNode,i=n.accessByName,l=n.muiTheme,s=this.state,c=s.searchString,d=s.loading,p=AdminComponents.AdminStyles(l.palette),f=[];i("Create")&&f.push(t().createElement(u.FlatButton,$e({primary:!0,label:this.context.getMessage("ws.3"),onClick:this.showWorkspaceCreator},p.props.header.flatButton)));var m=t().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},t().createElement("div",{style:{maxWidth:420,flex:1,paddingLeft:8}},t().createElement(Xe,{fullWidth:!0,hintText:this.context.getMessage("ws.filter.workspaces"),value:c,onChange:function(t,n){return e.setState({searchString:n})},variant:"compact"})));return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout workspaces-board"},t().createElement(AdminComponents.Header,{title:a.getLabel(),icon:"mdi mdi-folder-open",actions:f,centerContent:m,reloadAction:this.reloadWorkspaceList,loading:d}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("ws.dashboard","ajxp_admin")}),t().createElement(u.Paper,$e({},p.body.block.props,{style:p.body.block.container}),t().createElement(Qe,{ref:"workspacesList",pydio:r,openSelection:this.openWorkspace,advanced:o,editable:i("Create"),onLoadState:function(t){e.setState({loading:t})},tableStyles:p.body.tableMaster,filterString:c}))))}});const et=(0,f.muiThemeable)()(Ze);function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t){return rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},rt(e,t)}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e){return at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},at(e)}var it=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(l,e);var t,n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=at(o);if(a){var i=at(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==tt(n)&&"function"!=typeof n?ot(t):n});function l(e){var t,n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),o=void 0,(r="data")in(n=ot(t=i.call(this)))?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e?t.data=e:(t.data=new S.TreeNode,t.data.Type=S.TreeNodeType.constructFromObject("COLLECTION"),t.data.MetaStore={name:"",resolution:"",onDelete:"",contentType:"text/javascript"}),t}return t=l,r=[{key:"loadNodes",value:function(e){var t=new S.ConfigServiceApi(y().getRestClient());c().startLoading(),t.listVirtualNodes().then((function(t){c().endLoading();var n=[];t.Children&&t.Children.map((function(e){n.push(new l(e))})),e(n)})).catch((function(){c().endLoading()}))}}],(n=[{key:"getName",value:function(){return this.data.MetaStore.name}},{key:"setName",value:function(e){this.data.MetaStore.name=e;var t=g().computeStringSlug(e);this.data.Uuid=t,this.data.Path=t,this.notify("update")}},{key:"getValue",value:function(){return this.data.MetaStore.resolution}},{key:"setValue",value:function(e){this.data.MetaStore.resolution=e,this.notify("update")}},{key:"getOnDelete",value:function(){return this.data.MetaStore.onDelete}},{key:"setOnDelete",value:function(e){this.data.MetaStore.onDelete=e,this.notify("update")}},{key:"save",value:function(e){var t=this;Z().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(y().getRestClient()).putVirtualNode(t.data.Uuid,t.data).then((function(){e()}))}))}},{key:"remove",value:function(e){var t=this;Z().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(y().getRestClient()).deleteVirtualNode(t.data.Uuid).then((function(){e()}))}))}}])&&nt(t.prototype,n),r&&nt(t,r),l}(v());function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(Object(n),!0).forEach((function(t){ut(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pt(e,t){return pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pt(e,t)}function ft(e){return ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ft(e)}var mt=n(590),yt=n(880),ht=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(l,e);var t,n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=ft(o);if(a){var i=ft(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==lt(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flat";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this)).internalInvalid=!1,t.nameInvalid=!1,t.existingNames=n,e)t.model=e,e.StorageConfiguration||(e.StorageConfiguration={}),t.snapshot=JSON.parse(JSON.stringify(e));else switch(t.model=new S.ObjectDataSource,t.model.EncryptionMode=S.ObjectEncryptionMode.constructFromObject("CLEAR"),t.model.StorageType=S.ObjectStorageType.constructFromObject("LOCAL"),r){case"flat":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!0;break;case"structured":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!1;break;case"internal":t.model.StorageConfiguration={folder:"",normalize:"false",cellsInternal:"true"},t.model.FlatStorage=!0}return t.observableModel=t.buildProxy(t.model),t}return t=l,n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;if("StorageType"===n){var a=e.StorageConfiguration&&"true"===e.StorageConfiguration.cellsInternal;e.StorageConfiguration=a?{cellsInternal:"true"}:{},"LOCAL"===o?e.StorageConfiguration=ct({folder:"",normalize:"false"},e.StorageConfiguration):"S3"===o?e.StorageConfiguration=ct({customEndpoint:""},e.StorageConfiguration):"GCS"===o&&(e.StorageConfiguration=ct({jsonCredentials:""},e.StorageConfiguration)),t.internalInvalid=!1,e.ApiKey=e.ApiSecret=""}else if("Name"===n)o=g().computeStringSlug(o).replace("-","").substr(0,33),t.existingNames&&t.existingNames.indexOf(o)>-1?t.nameInvalid=!0:t.nameInvalid=!1;else if("folder"===n)"/"!==o[0]&&(o="/"+o);else{if("invalid"===n)return t.internalInvalid=r,t.notify("update"),!0;"PeerAddress"===n&&"ANY"===r&&(o="")}return e[n]=o,t.notify("update"),!0},get:function(e,n){var r=e[n];return r instanceof Array?r:r instanceof Object?t.buildProxy(r):"StorageType"===n?r||"LOCAL":"PeerAddress"===n?r||"ANY":r}})}},{key:"getModel",value:function(){return this.observableModel}},{key:"isValid",value:function(){return!this.internalInvalid&&!this.nameInvalid&&("S3"===this.model.StorageType||"AZURE"===this.model.StorageType?this.model.ApiKey&&this.model.ApiSecret&&this.model.Name&&(this.model.ObjectsBucket||this.model.StorageConfiguration.bucketsRegexp):"GCS"===this.model.StorageType?this.model.Name&&this.model.ObjectsBucket&&this.model.StorageConfiguration&&this.model.StorageConfiguration.jsonCredentials:this.model.Name&&this.model.StorageConfiguration&&this.model.StorageConfiguration.folder)}},{key:"getNameError",value:function(e){return this.nameInvalid?e("name.inuse"):null}},{key:"deleteSource",value:function(){return new S.ConfigServiceApi(yt.getRestClient()).deleteDataSource(this.model.Name)}},{key:"resyncSource",value:function(){var e=new S.JobsServiceApi(yt.getRestClient()),t=new S.RestUserJobRequest;return t.JobName="datasource-resync",t.JsonParameters=JSON.stringify({dsName:this.model.Name}),e.userCreateJob("datasource-resync",t)}},{key:"revert",value:function(){return this.model=this.snapshot,this.observableModel=this.buildProxy(this.model),this.snapshot=JSON.parse(JSON.stringify(this.model)),this.observableModel}},{key:"saveSource",value:function(){var e=this;return new S.ConfigServiceApi(yt.getRestClient()).putDataSource(this.model.Name,this.model).then((function(t){e.snapshot=JSON.parse(JSON.stringify(e.model)),e.notify("update")}))}},{key:"stripPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return e;var n={};return Object.keys(e).map((function(r){n[r.replace(t,"")]=e[r]})),n}},{key:"getDataWithPrefix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.model;var n={};return Object.keys(this.model).forEach((function(r){n[t+r]=e.model[r],"EncryptionMode"!==r||e.model[r]||(n[t+r]="CLEAR")})),n}}],r=[{key:"loadDatasources",value:function(){return new S.ConfigServiceApi(yt.getRestClient()).listDataSources()}},{key:"loadVersioningPolicies",value:function(){return new S.ConfigServiceApi(yt.getRestClient()).listVersioningPolicies()}},{key:"loadStatuses",value:function(){return new S.ConfigServiceApi(yt.getRestClient()).listServices("STARTED")}},{key:"loadEncryptionKeys",value:function(){return new S.ConfigServiceApi(yt.getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest)}},{key:"loadBuckets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new S.ConfigServiceApi(yt.getRestClient()),r=new S.RestListStorageBucketsRequest;return r.DataSource=e,t&&(r.BucketsRegexp=t),n.listStorageBuckets(r)}},{key:"createBucket",value:function(e,t){var n=new S.ConfigServiceApi(yt.getRestClient()),r=new S.RestCreateStorageBucketRequest;return r.DataSource=e,n.createStorageBucket(t,r)}}],n&&dt(t.prototype,n),r&&dt(t,r),l}(mt);function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vt(e,t){return vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},vt(e,t)}function St(e){return St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},St(e)}var Et=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vt(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=St(o);if(a){var i=St(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==gt(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=i.call(this,e);var n=e.node.getValue(),r=!1;return n||(n='// Compute the Path variable that this node must resolve to. \n// Use Ctrl+Space to see the objects available for completion.\nPath = "";',r=!0),t.state={value:n,cleanOnDelete:"rename-uuid"===e.node.getOnDelete(),dirty:r},t}return n=l,(r=[{key:"onChange",value:function(e,t){this.setState({value:t,dirty:!0})}},{key:"save",value:function(){var e=this,t=this.props,n=t.node,r=t.onSave,o=void 0===r?function(){}:r,a=this.state,i=a.value,l=a.cleanOnDelete;n.setValue(i),l?n.setOnDelete("rename-uuid"):n.setOnDelete(""),n.save((function(){e.setState({dirty:!1},o)}))}},{key:"remove",value:function(){var e=this;this.props.node.remove((function(){e.props.reloadList()}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.pydio,o=n.dataSources,a=n.readonly,i=n.oneLiner,l=n.onClose,s=void 0===l?function(){}:l,c=this.state,d=c.value,p=c.dirty,f=c.cleanOnDelete,m=function(e){return r.MessageHash["ajxp_admin.virtual."+e]||e},y={};o&&o.map((function(e){y[e.Name]=e.Name}));var h={Path:"",DataSources:y,User:{Name:"",Uuid:"",GroupPath:"",GroupFlat:"",Profile:"",DisplayName:"",Email:"",AuthSource:"",Roles:[]}},g=t().createElement(AdminComponents.CodeMirrorField,{mode:"javascript",globalScope:h,value:d,onChange:this.onChange.bind(this),readOnly:a}),b=m("card.cleanOnDelete"),v=d&&d.indexOf("User.Name")>=0;return v?f||(b=t().createElement("span",null,b," ",t().createElement("span",{className:"mdi mdi-alert"})," ",m("card.cleanOnDelete-legend-on"))):b=t().createElement("span",null,b," ",t().createElement("span",{className:"mdi mdi-alert"})," ",m("card.cleanOnDelete-legend-off")),i?t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1,lineHeight:"40px"}},g),t().createElement("div",{style:{display:"flex"}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-content-save",onClick:this.save.bind(this),disabled:!p,tooltip:"Save"}),t().createElement(u.IconButton,{iconClassName:"mdi mdi-close",onClick:function(){return s()},tooltip:"Close"}))):t().createElement("div",{style:{backgroundColor:"#f5f5f5",paddingBottom:12}},t().createElement("div",{style:{padding:a?"16px 24px 8px":"10px 24px 0",fontWeight:500,display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1}},m("card.title")),!a&&t().createElement(u.FlatButton,{onClick:this.save.bind(this),primary:!0,disabled:!p,label:m("save")})),t().createElement("div",{style:{margin:"6px 24px 0 24px",border:"1px solid #e0e0e0"}},g),t().createElement("div",{style:{margin:"12px 24px",opacity:v?1:.4}},t().createElement(u.Checkbox,{disabled:a,checked:f,onCheck:function(t,n){e.setState({cleanOnDelete:n,dirty:!0})},label:b})))}}])&&bt(n.prototype,r),l}(t().Component);function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function Ot(){return Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ot.apply(this,arguments)}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t){return Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Pt(e,t)}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}var jt=c().requireLib("hoc").ModernTextField,Rt=c().requireLib("components").MaterialTable,Tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pt(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=xt(o);if(a){var i=xt(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==wt(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).state={nodesLoaded:!1,nodes:[],dataSourcesLoaded:!1,dataSources:[]},it.loadNodes((function(e){t.setState({nodes:e,nodesLoaded:!0})})),ht.loadDatasources().then((function(e){t.setState({dataSources:e.DataSources,dataSourcesLoaded:!0})})),t}return n=l,(r=[{key:"reload",value:function(){var e=this;this.setState({nodesLoaded:!1}),it.loadNodes((function(t){e.setState({nodes:t,nodesLoaded:!0})}))}},{key:"createNode",value:function(){this.handleRequestClose();var e,t=this.state,n=t.newName,r=t.nodes,o=new it;o.setName(n),this.setState({nodes:[].concat((e=r,function(e){if(Array.isArray(e))return kt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[o]),selectedNode:n,newName:null})}},{key:"setNewName",value:function(e){var t,n=this.props.pydio,r=this.state.dataSources;this.setState({newName:e}),r.filter((function(t){return t.Name===e})).length?this.setState({newNameError:(t="create.error",n.MessageHash["ajxp_admin.virtual."+t]||t)}):this.setState({newNameError:null})}},{key:"handleTouchTap",value:function(e){var t=this;e.preventDefault(),this.setState({newName:"",open:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newNode&&t.refs.newNode.focus()}),300)}))}},{key:"handleRequestClose",value:function(){this.setState({open:!1,newName:"",newNameError:null})}},{key:"render",value:function(){var e=this,n=this.props,r=n.readonly,o=n.pydio,a=n.muiTheme,i=n.accessByName,l=this.state,s=l.nodes,c=l.dataSources,d=l.nodesLoaded,p=l.dataSourcesLoaded,f=l.selectedNode,m=l.newName,y=l.newNameError,h=function(e){return o.MessageHash["ajxp_admin.virtual."+e]||e},g=AdminComponents.AdminStyles(a.palette),b=s.map((function(n){return n.getName()===f?{node:n,expandedRow:t().createElement(Et,{pydio:o,dataSources:c,node:n,reloadList:e.reload.bind(e),readonly:r||!i("Create"),adminStyles:g,onSave:e.reload.bind(e)})}:{node:n}})),v=[];!r&&i("Create")&&v.push(t().createElement(u.FlatButton,Ot({primary:!0,label:h("create"),onClick:this.handleTouchTap.bind(this),disabled:!p},g.props.header.flatButton)));var S=[{name:"id",label:h("col.id"),style:{width:"25%",fontSize:15},headerStyle:{width:"25%"},renderCell:function(e){return e.node.getName()},sorter:{type:"string"}},{name:"code",label:h("col.code"),renderCell:function(e){return t().createElement("pre",null,e.node.getValue().split("\n").pop())}}],E=[];return r?E.push({iconClassName:"mdi mdi-eye",tooltip:h("code.display"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}):(E.push({iconClassName:"mdi mdi-pencil",tooltip:h("code.edit"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}),E.push({iconClassName:"mdi mdi-delete",tooltip:h("delete"),onClick:function(t){o.UI.openConfirmDialog({message:h("delete.confirm"),destructive:[t.node.getName()],validCallback:function(){t.node.remove((function(){e.reload()}))}})},disable:function(e){return"cells"===e.node.getName()||"my-files"===e.node.getName()}})),t().createElement("div",{className:"vertical-layout workspaces-list layout-fill",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:h("title"),icon:"mdi mdi-help-network",actions:v,reloadAction:this.reload.bind(this),loading:!(d&&p)}),t().createElement(u.Popover,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{margin:"10px 20px 0",width:320}},t().createElement(jt,{ref:"newNode",variant:"v2",fullWidth:!0,floatingLabelText:h("create"),value:m,onChange:function(t,n){e.setNewName(n)},hintText:h("label.new"),errorText:y})),t().createElement("div",{style:{textAlign:"right",padding:"5px 20px 20px"}},t().createElement(u.FlatButton,Ot({label:o.MessageHash[54],onClick:this.handleRequestClose.bind(this)},g.props.header.flatButton)),t().createElement(u.FlatButton,Ot({primary:!0,label:h("create.button"),onClick:this.createNode.bind(this)},g.props.header.flatButton,{disabled:!!y||!m})))),t().createElement("div",{className:"layout-fill",style:{overflowY:"auto"}},t().createElement("div",{style:{padding:20,paddingBottom:0}},h("legend.1")),d&&p&&t().createElement(u.Paper,Ot({},g.body.block.props,{style:g.body.block.container}),t().createElement(Rt,{columns:S,data:b,actions:E,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:g.body.tableMaster,storageKey:"console.templatepaths.list"})),(!d||!p)&&t().createElement("div",{style:{margin:16,textAlign:"center",padding:20}},o.MessageHash["ajxp_admin.loading"]),!r&&i("Create")&&t().createElement("div",{style:{padding:"0 24px",opacity:".5"}},h("legend.2"))))}}])&&Ct(n.prototype,r),l}(t().Component);function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){Dt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lt(e){return function(e){if(Array.isArray(e))return _t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function It(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e,t,n){return t&&Bt(e.prototype,t),n&&Bt(e,n),e}function Vt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}function Kt(e,t){return Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Kt(e,t)}function Wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,a=qt(e);if(t){var i=qt(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return r=this,!(o=n)||"object"!==Nt(o)&&"function"!=typeof o?Ut(r):o}}function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qt(e){return qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},qt(e)}Tt=(0,f.muiThemeable)()(Tt);var Ht=c().requireLib("hoc"),zt=Ht.ModernTextField,Jt=Ht.ModernSelectField,Yt=Ht.ModernAutoComplete,Gt=function(e){Vt(r,e);var n=Wt(r);function r(e){var t;return It(this,r),(t=n.call(this,e)).debounced=x()(t.loadValues.bind(Ut(t)),300),t.state={searchText:e.value,value:e.value},t}return Ft(r,[{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({searchText:e})}},{key:"handleNewRequest",value:function(e){var t,n=this.state.nodes,r=!1;if(void 0===e.key){t="/"+g().trim(e,"/");var o=!1;n.map((function(e){e.Path!==t&&0!==e.Path.indexOf(t+"/")||(o=!0)})),o&&(r=!0)}else t=e.key,r=!0;this.setState({value:t,exist:r}),this.props.onChange(t,r),this.loadValues(t)}},{key:"componentWillMount",value:function(){this.lastSearch=null;var e="";this.props.value&&(e=this.props.value),this.loadValues(e)}},{key:"componentWillReceiveProps",value:function(e){e.value&&e.value!==this.state.value&&this.setState({value:e.value,exist:!0})}},{key:"loadValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props.peerAddress,r=this.state.searchText,o=t;if(!t&&r){var a=r.lastIndexOf("/");o=r.substr(0,a)}if(null!==this.lastSearch&&this.lastSearch===o)return Promise.resolve();this.lastSearch=o;var i=new S.ConfigServiceApi(y().getRestClient()),l=new S.RestListPeerFoldersRequest;return l.PeerAddress="ANY"===n?"":n,l.Path=o,this.setState({loading:!0}),i.listPeerFolders(n,l).then((function(t){var n=t.Children||[];n=n.map((function(e){return"/"!==e.Path[0]&&(e.Path="/"+e.Path),e})),e.setState({nodes:n,loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"createFolder",value:function(e){var t=this,n=this.props,r=n.peerAddress,o=n.pydio,a=this.state.value,i=new S.ConfigServiceApi(y().getRestClient()),l=new S.RestCreatePeerFolderRequest;l.PeerAddress="ANY"===r?"":r,l.Path=a+"/"+e,i.createPeerFolder(r,l).then((function(e){t.lastSearch=null,t.loadValues(a).then((function(){t.handleNewRequest({key:l.Path}),t.setState({searchText:l.Path})}))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}},{key:"renderNode",value:function(e){var n=R().getBasename(e.Path),r=R().getDirname(e.Path),o=t().createElement("span",null,e.Path);return g().computeStringSlug(n)!==n?o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#c62828"}},n)):e.MetaStore&&e.MetaStore.symlink&&(o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#1976d2"}},n))),{key:e.Path,text:e.Path,invalid:!1,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:"mdi mdi-folder",color:"#616161",style:{float:"left",marginRight:8}})," ",o)}}},{key:"showCreateDialog",value:function(){var e=this,t=this.props.pydio,n=this.state.value,r=function(e){return t.MessageHash["ajxp_admin.ds.editor.selector."+e]||e};t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:r("mkdir"),legendId:r("mkdir.legend").replace("%s",n),fieldLabelId:r("mkdir.field"),submitValue:function(t){t&&e.createFolder(t)}})}},{key:"render",value:function(){var e=this,n=this.state,r=n.nodes,o=n.loading,a=n.exist,i=n.value,l=n.searchText,s=this.props,c=s.fieldLabel,d=s.pydio,p=[];r&&r.forEach((function(t){p.push(e.renderNode(t))}));var f=l||i;return t().createElement("div",{style:{position:"relative",marginTop:-5}},t().createElement("div",{style:{position:"absolute",right:6,top:29,width:30,zIndex:1}},t().createElement(u.RefreshIndicator,{size:25,left:0,top:0,status:o?"loading":"hide"})),i&&a&&!o&&(!l||l===i)&&t().createElement("div",{style:{position:"absolute",right:0,zIndex:1,top:18}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-folder-plus",iconStyle:{color:"#9e9e9e"},onClick:function(){return e.showCreateDialog()},tooltip:d.MessageHash["ajxp_admin.ds.editor.selector.mkdir"],tooltipPosition:"top-center"})),t().createElement(Yt,{fullWidth:!0,searchText:f,onUpdateInput:this.handleUpdateInput.bind(this),onNewRequest:this.handleNewRequest.bind(this),dataSource:p,hintText:c,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,menuProps:{maxHeight:200}}))}}]),r}(t().Component),Qt=function(e){Vt(r,e);var n=Wt(r);function r(e){var t;return It(this,r),(t=n.call(this,e)).state={peerAddresses:[],invalid:!1,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.editor."+t]||t}},t}return Ft(r,[{key:"compareAddresses",value:function(e,t){var n=e.split("|"),r=t.split("|");return r.filter((function(e){return n.indexOf(e)>-1})).length||n.filter((function(e){return r.indexOf(e)>-1})).length}},{key:"componentDidMount",value:function(){var e=this,t=this.props.model;new S.ConfigServiceApi(y().getRestClient()).listPeersAddresses().then((function(n){var r=n.PeerAddresses||[];if(1!==r||t.PeerAddress||(t.PeerAddress=r[0]),e.setState({peerAddresses:r}),t.PeerAddress&&-1===r.indexOf(t.PeerAddress)){var o=r.filter((function(n){return e.compareAddresses(n,t.PeerAddress)}));o.length?t.PeerAddress=o[0]:e.setState({invalidAddress:t.PeerAddress})}}))}},{key:"baseIsInvalid",value:function(e){var t=this.state.m,n=!1,r=R().getBasename(e);return g().trim(e,"/").split("/").length<2?n=t("selector.error.depth"):g().computeStringSlug(r)!==r&&(n=t("selector.error.dnsname")),n}},{key:"onPathChange",value:function(e,t){var n=this.props.model,r=this.baseIsInvalid(e);n.invalid=r,n.StorageConfiguration.folder=e,t?void 0!==n.StorageConfiguration.create&&delete n.StorageConfiguration.create:n.StorageConfiguration.create="true",this.setState({invalid:r})}},{key:"onPeerChange",value:function(e){var t=this.props.model,n=this.state.invalidAddress;e!==n&&(t.PeerAddress=e,n&&this.setState({invalidAddress:null}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.model,o=n.pydio,a=n.styles,i=this.state,l=i.peerAddresses,s=i.invalidAddress,c=i.invalid,d=i.m,p=Lt(l);return p=["ANY"].concat(Lt(p)),s&&"ANY"!==s&&(p=[s].concat(Lt(p))),t().createElement("div",null,t().createElement("div",{style:{paddingBottom:8}},t().createElement("div",{style:a.subLegend},d("storage.legend.fs.peer")),t().createElement(Jt,{value:r.PeerAddress||"",variant:"v2",hintText:d("selector.peer")+" *",onChange:function(t,n,r){return e.onPeerChange(r)},fullWidth:!0},p.map((function(e){var n=d("selector.peer.any");return"ANY"!==e&&(n=d("selector.peer.word")+" : "+e.replace("|"," | ")+(e===s?" ("+d("selector.peer.invalid")+")":"")),t().createElement(u.MenuItem,{value:e,primaryText:n})})))),t().createElement("div",null,t().createElement("div",{style:Mt(Mt({},a.subLegend),{},{paddingBottom:6})},d("storage.legend.fs.path")),r.PeerAddress&&t().createElement(Gt,{pydio:o,value:r.StorageConfiguration.folder,peerAddress:r.PeerAddress,onChange:this.onPathChange.bind(this),fieldLabel:d("selector.completer")+(r.StorageConfiguration.create?" ("+d("selector.completer.create")+")":"")+" *",hintText:d("selector.completer.hint")}),!r.PeerAddress&&t().createElement(zt,{style:{marginTop:-3},fullWidth:!0,variant:"v2",disabled:!0,value:r.StorageConfiguration.folder,floatingLabelText:d("selector.folder")+" *",hintText:d("selector.folder.hint")})),c&&t().createElement("div",{style:{color:"#c62828"}},c))}}]),r}(t().Component);const $t=require("pydio/util/dom");var Xt=n.n($t);function Zt(e){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(e)}function en(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nn(e,t,n){return t&&tn(e.prototype,t),n&&tn(e,n),e}function rn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}function on(e,t){return on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},on(e,t)}function an(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,a=ln(e);if(t){var i=ln(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return r=this,!(o=n)||"object"!==Zt(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r):o}}function ln(e){return ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ln(e)}var sn=function(e){rn(r,e);var n=an(r);function r(){return en(this,r),n.apply(this,arguments)}return nn(r,[{key:"render",value:function(){var e=this.props,n=e.onSelect,r=e.selected,o=e.value,a=e.primaryText,i=e.image,l={cont:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"10px 10px 0 10px",backgroundColor:"transparent",borderBottom:"2px solid transparent",transition:Xt().getBeziersTransition()},image:{width:30,height:30,opacity:.3,transition:Xt().getBeziersTransition()},label:{margin:5,marginTop:8,fontSize:11,fontWeight:500,color:"rgba(0,0,0,.3)",textAlign:"center",transition:Xt().getBeziersTransition()}};return r&&(l.cont.borderBottom="2px solid #0e4d6d",l.image.opacity=1,l.label.color="#0e4d6d"),t().createElement("div",{zDepth:0,style:l.cont,onClick:function(e){n(o)},rounded:!1},i&&t().createElement("img",{style:l.image,src:"/plug/access.settings/res/images/"+i}),t().createElement("div",{style:l.label},a))}}]),r}(t().Component),cn=function(e){rn(r,e);var n=an(r);function r(e){return en(this,r),n.call(this,e)}return nn(r,[{key:"onChange",value:function(e){var t=this.props,n=t.values;(0,t.onChange)(null,Object.keys(n).indexOf(e),e)}},{key:"render",value:function(){var e=this,n=this.props,r=n.values,o=n.value,a=n.disabled;return t().createElement("div",{style:{display:"flex",padding:"0 1px",backgroundColor:"rgb(251, 251, 252)"}},Object.keys(r).map((function(n){return t().createElement(sn,{value:n,selected:n===o,onSelect:a?function(){}:e.onChange.bind(e),primaryText:r[n].primaryText,image:r[n].image})})))}}]),r}(t().Component);const un=require("lodash");function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function pn(){return pn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pn.apply(this,arguments)}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yn(e,t){return yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},yn(e,t)}function hn(e){return hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hn(e)}var gn=c().requireLib("hoc").ModernTextField,bn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yn(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=hn(o);if(a){var i=hn(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==dn(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).state={buckets:[],selection:[],mode:t.modeFromValue(),monitorApi:e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret},e.dataSource.ObjectsBucket&&(t.state.selection=[e.dataSource.ObjectsBucket]),t.load(),t.loadSelection(),t.reloadSelection=(0,un.debounce)((function(){t.loadSelection()}),500),t.loadDebounced=(0,un.debounce)((function(){t.load()}),500),t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e){var t=e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret;t!==this.state.monitorApi&&(this.loadDebounced(),this.setState({monitorApi:t}))}},{key:"load",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?(this.setState({loading:!0}),ht.loadBuckets(t).then((function(t){var n=t.Children||[];e.setState({buckets:n.map((function(e){return e.Path})),loading:!1})})).catch((function(t){e.setState({buckets:[],loading:!1})}))):this.setState({buckets:[]})}},{key:"createBucket",value:function(){var e=this,t=this.props.dataSource,n=this.state.createBucket;this.setState({loading:!0}),ht.createBucket(t,n).then((function(){e.setState({create:!1,createBucket:""}),e.load()})).catch((function(t){e.setState({loading:!1})}))}},{key:"loadSelection",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?t.ObjectsBucket?this.setState({selection:[t.ObjectsBucket]}):(this.setState({selection:[]}),t.StorageConfiguration.bucketsRegexp&&ht.loadBuckets(t,t.StorageConfiguration.bucketsRegexp).then((function(t){var n=t.Children||[];e.setState({selection:n.map((function(e){return e.Path}))})}))):this.setState({selection:[]})}},{key:"modeFromValue",value:function(){var e="picker";return this.props.dataSource.StorageConfiguration.bucketsRegexp&&(e="regexp"),e}},{key:"toggleMode",value:function(){var e=this.state.mode,t=this.props.dataSource;"picker"===e?(t.ObjectsBucket&&(t.StorageConfiguration.bucketsRegexp=t.ObjectsBucket,t.ObjectsBucket="",this.reloadSelection()),this.setState({mode:"regexp"})):(t.StorageConfiguration.bucketsRegexp="",this.reloadSelection(),this.setState({mode:"picker"}))}},{key:"togglePicker",value:function(e){var t,n=this.props.dataSource,r=this.state.selection,o=[],a=r.indexOf(e);1===(o=-1===a?[].concat((t=r,function(e){if(Array.isArray(e))return fn(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return fn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fn(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[e]):g().arrayWithout(r,a)).length?(n.ObjectsBucket=o[0],n.StorageConfiguration.bucketsRegexp=""):(n.ObjectsBucket="",n.StorageConfiguration.bucketsRegexp=o.map((function(e){return"^"+e+"$"})).join("|")),this.setState({selection:o})}},{key:"updateRegexp",value:function(e){this.props.dataSource.StorageConfiguration.bucketsRegexp=e,this.reloadSelection()}},{key:"render",value:function(){var e=this,n=this.props.dataSource,r=this.state,o=r.buckets,a=r.selection,i=r.mode,l=r.loading,s=r.create,d=r.createBucket,p=void 0===d?"":d,f=c().getInstance().MessageHash,m=function(e){return f["ajxp_admin.ds.editor.storage."+e]||e},y={style:{width:30,height:30,padding:5},iconStyle:{width:20,height:20,color:"rgba(0,0,0,.5)",fontSize:18}},h=!n.ApiKey||!n.ApiSecret;return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginTop:20}},t().createElement("div",null,m("buckets.legend")),t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginRight:s?30:0}},s&&t().createElement("div",{style:{width:200,height:36}},t().createElement(gn,{hintText:m("buckets.create.hint"),fullWidth:!0,value:p,onChange:function(t,n){e.setState({createBucket:g().computeStringSlug(n)})}})),t().createElement(u.IconButton,pn({iconClassName:s?"mdi mdi-check":"mdi mdi-plus-circle",tooltip:m("buckets.create"),tooltipPosition:"top-left",onClick:function(){s?e.createBucket():e.setState({create:!0})},disabled:h},y)),s&&t().createElement(u.IconButton,pn({iconClassName:"mdi mdi-close",tooltip:f[54],tooltipPosition:"top-left",onClick:function(){return e.setState({create:!1,createBucket:""})},disabled:h},y))),t().createElement("div",{style:{display:"flex",alignItems:"flex-end"}},"regexp"===i&&t().createElement("div",{style:{width:200,height:36}},t().createElement(gn,{hintText:m("buckets.regexp.hint"),fullWidth:!0,value:n.StorageConfiguration.bucketsRegexp||"",onChange:function(t,n){e.updateRegexp(n)}})),t().createElement(u.IconButton,pn({iconClassName:"mdi mdi-filter",tooltip:"picker"===i?m("buckets.regexp"):"",tooltipPosition:"top-left",onClick:function(){e.toggleMode()},disabled:h},y))),t().createElement(u.IconButton,pn({iconClassName:"mdi mdi-reload",tooltip:m("buckets.reload"),tooltipPosition:"top-left",onClick:function(){e.load()},disabled:h},y))),t().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginTop:8,backgroundColor:"rgb(246 246 248)",borderRadius:"4px 4px 0 0",borderBottom:"1px solid #e0e0e0",minHeight:52,padding:2,maxHeight:275,overflowY:"auto"}},o.map((function(r){var o=-1!==a.indexOf(r),l={};return"picker"===i?l.onClick=function(){e.togglePicker(r)}:n.StorageConfiguration.bucketsRegexp||(l.onClick=function(){e.toggleMode(),e.togglePicker(r)}),t().createElement("div",{style:{margin:5}},t().createElement(u.Chip,pn({},l,{backgroundColor:o?"#03a9f4":null}),r))})),0===o.length&&t().createElement("div",{style:{paddingLeft:5,textAlign:"center",fontSize:12,color:"rgba(0,0,0,.3)"}},m(h?"buckets.cont.nokeys":l?"buckets.cont.loading":"buckets.cont.empty"))))}}])&&mn(n.prototype,r),l}(t().Component);function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}function Sn(){return Sn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Sn.apply(this,arguments)}function En(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?En(Object(n),!0).forEach((function(t){On(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):En(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t){return Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Cn(e,t)}function Pn(e){return Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pn(e)}var xn=AdminComponents,jn=xn.PaperEditorLayout,Rn=xn.AdminStyles,Tn=c().requireLib("hoc"),Nn=Tn.ModernTextField,An=Tn.ModernSelectField,Mn=Tn.ThemedModernStyles,Dn=["main","storage","data","advanced"],Ln=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(s,n);var r,o,a,i,l=(a=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Pn(a);if(i){var o=Pn(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==vn(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.pydio,r=e.create,o=e.dataSource,a=e.existingNames,i=e.createStructure,c=new ht(o,a,i),u=c.getModel().StorageConfiguration||{},d=u.customEndpoint?"custom":"aws";return"custom"===d&&u.minioServer&&(d="minio"),t.state={dirty:!1,create:r,observable:c,model:c.getModel(),loaded:!1,valid:c.isValid(),encryptionKeys:[],versioningPolicies:[],s3Custom:d,m:function(e){return n.MessageHash["ajxp_admin.ds.editor."+e]||e}},ht.loadEncryptionKeys().then((function(e){t.setState({encryptionKeys:e.Keys||[]})})),ht.loadVersioningPolicies().then((function(e){t.setState({versioningPolicies:e.Policies||[]})})),t}return r=s,o=[{key:"componentWillReceiveProps",value:function(e){if(e.dataSource&&this.state.model.Name!==e.dataSource.Name)if(this.state.dirty)alert(this.props.pydio.MessageHash["role_editor.19"]);else{var t=new ht(e.dataSource);this.setState({observable:t,model:t.getModel()})}e.create&&this.state.create!==e.create&&this.setState({create:e.create})}},{key:"componentDidMount",value:function(){var e=this;this.state.observable.observe("update",(function(){e.setState({dirty:!0}),e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.observable.stopObserving("update")}},{key:"resetForm",value:function(){var e=this,t=this.state.observable.revert();this.setState({valid:!0,dirty:!1,model:t},(function(){e.forceUpdate()}))}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.observable;this.props.pydio.UI.openConfirmDialog({message:n("delete.warning"),validCallback:function(){r.deleteSource().then((function(){e.props.closeEditor(),e.props.reloadList()}))},destructive:[r.getModel().Name]})}},{key:"saveSource",value:function(){var e=this,t=this.state,n=t.observable,r=t.create;this.state.observable.saveSource().then((function(){var t=null;r&&(t=n.getModel().Name),e.setState({valid:!0,dirty:!1,create:!1}),r&&e.props.closeEditor(),e.props.reloadList(t)}))}},{key:"launchResync",value:function(){this.state.observable.resyncSource()}},{key:"toggleEncryption",value:function(e){var t=this.state.model;"VALUE_CREATE"===e?this.setState({showDialog:"enableEncryptionWithCreate",dialogTargetValue:e,newKeyName:t.Name||""}):"VALUE_CLEAR"===e?this.setState({showDialog:"disableEncryption",dialogTargetValue:e}):"MASTER"!==t.EncryptionMode?this.setState({showDialog:"enableEncryption",dialogTargetValue:e}):t.EncryptionKey=e}},{key:"confirmEncryption",value:function(e){var t=this,n=this.state,r=n.model,o=n.newKeyName;if("VALUE_CREATE"===e){var a=new S.ConfigServiceApi(y().getRestClient()),i=new S.EncryptionAdminCreateKeyRequest;return i.KeyID=o,i.Label=o,void a.createEncryptionKey(i).then((function(e){r.EncryptionMode="MASTER",r.EncryptionKey=o,t.setState({showDialog:!1,dialogTargetValue:null,encryptionKeys:[{ID:o,Label:o}]})})).catch((function(){}))}"VALUE_CLEAR"===e?(r.EncryptionMode="CLEAR",r.EncryptionKey=""):(r.EncryptionMode="MASTER",r.EncryptionKey=e),this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"toggleS3Custom",value:function(e){var t=this.state.model;"aws"===e?(t.StorageConfiguration.customEndpoint="",t.StorageConfiguration.customRegion="",t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion=""):"minio"===e?(t.StorageConfiguration.minioServer="true",t.StorageConfiguration.signatureVersion="v4"):(t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion="v4"),this.setState({s3Custom:e})}},{key:"stepperBack",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Dn.indexOf(t);n>0&&this.setState({currentPane:Dn[n-1]})}},{key:"stepperNext",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Dn.indexOf(t);n<Dn.length-1&&this.setState({currentPane:Dn[n+1]})}},{key:"render",value:function(){var n=this,r=this.props,o=r.storageTypes,a=r.pydio,i=r.readonly,l=r.muiTheme,s=this.state,c=s.currentPane,d=void 0===c?"main":c,p=s.model,f=s.create,m=s.observable,y=s.encryptionKeys,h=s.versioningPolicies,g=s.showDialog,b=s.dialogTargetValue,v=s.newKeyName,S=s.s3Custom,E=s.m,w=Mn(l),O=[];i||f||(O.push(t().createElement(u.Toggle,{style:{borderRight:"1px solid #e0e0e0",paddingRight:14,zoom:.8},labelStyle:{fontSize:17},toggled:!p.Disabled,onToggle:function(e,t){p.Disabled=!t},labelPosition:"right",label:E("options.enabled")})),O.push(jn.actionButton(this.context.getMessage("plugins.6"),"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty)),O.push(jn.actionButton(this.context.getMessage("plugins.5"),"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.dirty)));var k=p.Name?E("title").replace("%s",p.Name):E("new"),C=p.StorageConfiguration,P=Rn(this.props.muiTheme.palette),x={title:wn(wn({},P.body.block.headerFull),{},{margin:"0 -20px"}),legend:{},subLegend:{padding:"10px 6px 0 4px",fontSize:12,lineHeight:"16px",color:"rgba(0,0,0,0.6)",textAlign:"justify"},section:wn({padding:"0 20px 20px",margin:10,backgroundColor:"white"},P.body.block.container),storageSection:{padding:20,marginTop:-1}},j={LOCAL:{primaryText:this.context.getMessage("ds.storage.fs","ajxp_admin"),image:"fs.png"},S3:{primaryText:this.context.getMessage("ds.storage.s3","ajxp_admin"),image:"s3-compat.png"},AZURE:{primaryText:this.context.getMessage("ds.storage.azure","ajxp_admin"),image:"azure.png"},GCS:{primaryText:this.context.getMessage("ds.storage.gcs","ajxp_admin"),image:"gcs.png"}},R={};o.forEach((function(e){R[e]=j[e]})),p.StorageType&&!R[p.StorageType]&&(R[p.StorageType]=j[p.StorageType]);var T,N,A=function(e,t){return t===d?e:wn(wn({},e),{},{display:"none"})};if(f){var M={main:E("tab.identifier"),storage:E("tab.storage"),data:E("tab.lifecycle"),advanced:E("tab.advanced")},D=!1;("main"!==d||p.Name&&!m.getNameError(E))&&("storage"!==d||m.isValid())||(D=!0);var L=xe(M,d,(function(e){return n.setState({currentPane:e})}),D,(function(){return n.saveSource()}),(function(){return m.isValid()}),{back:E("tab.button-back"),next:E("tab.button-next"),save:E("tab.button-create")});T=L.Steps,N=L.Buttons}var _=t().createElement(u.Dialog,{open:g,title:E("enc.warning"),onRequestClose:function(){n.setState({showDialog:!1,dialogTargetValue:null})},actions:[t().createElement(u.FlatButton,{label:a.MessageHash[54],onClick:function(){n.setState({showDialog:!1,dialogTargetValue:null})}}),t().createElement(u.FlatButton,{label:E("enc.validate"),disabled:"enableEncryptionWithCreate"===g&&!v,onClick:function(){n.confirmEncryption(b)}})]},("enableEncryption"===g||"enableEncryptionWithCreate"===g)&&t().createElement("div",{style:{lineHeight:"1.6em"}},E("enc.dialog.enable.1"),"",E("enc.dialog.enable.2")," ",t().createElement("b",{style:{fontWeight:500}},E("enc.dialog.enable.2bold")),t().createElement("br",null),E("enc.dialog.enable.3"),"enableEncryptionWithCreate"===g&&t().createElement("div",null,t().createElement(Nn,{hintText:E("enc.dialog.enable.create"),fullWidth:!0,variant:"v2",value:v,onChange:function(e,t){n.setState({newKeyName:t})}}))),"disableEncryption"===g&&t().createElement("div",{style:{lineHeight:"1.6em"}},E("enc.dialog.disable"))),I=t().createElement(u.Paper,{zDepth:0,style:A(x.section,"main")},t().createElement("div",{style:wn(wn({},x.title),{},{marginBottom:16})},E("options")),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("options.id")+" *",disabled:!f,value:p.Name,onChange:function(e,t){p.Name=t},errorText:m.getNameError(E)})),B=t().createElement(u.Paper,{zDepth:0,style:A(wn(wn({},x.section),{},{padding:0,marginBottom:f?200:null}),f?"storage":"main")},t().createElement(cn,{disabled:!f,value:p.StorageType,onChange:function(e,t,n){p.StorageType=n},values:R}),"LOCAL"===p.StorageType&&t().createElement("div",{style:x.storageSection},t().createElement("div",{style:x.legend},E("storage.legend.fs")),t().createElement(Qt,{model:p,pydio:this.props.pydio,styles:x}),!p.FlatStorage&&t().createElement("div",null,t().createElement(u.Checkbox,Sn({labelPosition:"right",label:E("storage.fs.macos"),checked:"true"===C.normalize,onCheck:function(e,t){C.normalize=t?"true":"false"}},w.toggleFieldV2)))),"S3"===p.StorageType&&t().createElement("div",{style:x.storageSection},t().createElement("div",{style:x.legend},E("storage.legend.s3")),t().createElement(An,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.endpoint.type"),value:S,onChange:function(e,t,r){n.toggleS3Custom(r)}},t().createElement(u.MenuItem,{value:"aws",primaryText:E("storage.s3.endpoint.amazon")}),t().createElement(u.MenuItem,{value:"minio",primaryText:E("storage.s3.endpoint.minio")}),t().createElement(u.MenuItem,{value:"custom",primaryText:E("storage.s3.endpoint.custom")})),("custom"===S||"minio"===S)&&t().createElement("div",null,t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.endpoint")+" - "+E("storage.s3.endpoint.hint"),value:p.StorageConfiguration.customEndpoint,onChange:function(e,t){p.StorageConfiguration.customEndpoint=t}}),t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:3,marginRight:5}},t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.region"),value:p.StorageConfiguration.customRegion,onChange:function(e,t){p.StorageConfiguration.customRegion=t}})),t().createElement("div",{style:{flex:1}},t().createElement(An,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.signatureVersion"),value:p.StorageConfiguration.signatureVersion,onChange:function(e,t,n){p.StorageConfiguration.signatureVersion=n}},t().createElement(u.MenuItem,{value:"v4",primaryText:"v4"}),t().createElement(u.MenuItem,{value:"v2",primaryText:"v2"}))))),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement("form",{autoComplete:"off"},t().createElement("input",{type:"hidden",value:"something"}),t().createElement(Nn,{autoComplete:"off",fullWidth:!0,variant:"v2",type:"password",hintText:E("storage.s3.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),t().createElement(bn,{dataSource:p,hintText:E("storage.s3.bucket")}),p.ObjectsBucket&&t().createElement("div",{style:{paddingTop:20}},t().createElement("div",{style:wn({},x.subLegend)},E("storage.s3.legend.bucketPathPrefix")),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.bucketPathPrefix"),value:p.ObjectsBaseFolder||"",onChange:function(e,t){p.ObjectsBaseFolder=t}})),(p.ObjectsBucket||p.StorageConfiguration.bucketsRegexp)&&t().createElement(t().Fragment,null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.s3.legend.storageClass")),t().createElement("div",null,t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.storageClass"),value:p.StorageConfiguration.storageClass||"",onChange:function(e,t){p.StorageConfiguration.storageClass=t}}))),p.StorageConfiguration.bucketsRegexp&&!p.ObjectsBucket&&t().createElement(t().Fragment,null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.s3.legend.tags")),t().createElement("div",null,t().createElement(Nn,{fullWidth:!0,variant:"v2",disabled:!!p.ObjectsBucket,hintText:E("storage.s3.bucketsTags"),value:p.StorageConfiguration.bucketsTags||"",onChange:function(e,t){p.StorageConfiguration.bucketsTags=t}})))),"AZURE"===p.StorageType&&t().createElement("div",{style:x.storageSection},t().createElement("div",{style:x.legend},E("storage.legend.azure")),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.azure.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.azure.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement(Nn,{fullWidth:!0,variant:"v2",type:"password",hintText:E("storage.azure.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),"GCS"===p.StorageType&&t().createElement("div",{style:x.storageSection},t().createElement("div",{style:x.legend},E("storage.legend.gcs")),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.gcs.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.gcs.credentials")+" *",value:p.StorageConfiguration.jsonCredentials,onChange:function(e,t){p.StorageConfiguration.jsonCredentials=t},multiLine:!0}),t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("storage.s3.path"),value:p.ObjectsBaseFolder,onChange:function(e,t){p.ObjectsBaseFolder=t}}))),F=t().createElement(u.Paper,{zDepth:0,style:A(x.section,"data")},t().createElement("div",{style:x.title},E("datamanagement")),!p.StorageConfiguration.cellsInternal&&t().createElement(e.Fragment,null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.versioning")),t().createElement(An,{fullWidth:!0,variant:"v2",hintText:E("versioning"),value:p.VersioningPolicyName,onChange:function(e,t,n){p.VersioningPolicyName=n}},t().createElement(u.MenuItem,{value:void 0,primaryText:E("versioning.disabled")}),h.map((function(e){return t().createElement(u.MenuItem,{value:e.Uuid,primaryText:e.Name+" (stored in "+e.VersionsDataSourceName+")"})})))),t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.encryption")),t().createElement(An,{fullWidth:!0,variant:"v2",hintText:E("enc.key"),value:"MASTER"===p.EncryptionMode?p.EncryptionKey:"VALUE_CLEAR",onChange:function(e,t,r){n.toggleEncryption(r)}},t().createElement(u.MenuItem,{value:"VALUE_CLEAR",primaryText:E("enc.key.clear")}),y.map((function(e){return t().createElement(u.MenuItem,{value:e.ID,primaryText:e.Label})})),"MASTER"!==p.EncryptionMode&&0===y.length&&t().createElement(u.MenuItem,{value:"VALUE_CREATE",primaryText:E("enc.key.create")}))),V=t().createElement(u.Paper,{zDepth:0,style:A(x.section,"advanced")},t().createElement("div",{style:x.title},E("tab.advanced")),!p.StorageConfiguration.cellsInternal&&t().createElement("div",null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.flatStorage")),t().createElement(u.Checkbox,Sn({label:E("storage.flatStorage"),labelPosition:"right",disabled:!f,checked:!p.FlatStorage,onCheck:function(e,t){p.FlatStorage=!t}},w.toggleFieldV2)),f&&p.FlatStorage&&t().createElement(Nn,{fullWidth:!0,variant:"v2",hintText:E("initFlatFromSnapshot"),value:p.StorageConfiguration.initFromSnapshot||"",onChange:function(e,t){t?p.StorageConfiguration.initFromSnapshot=t:delete p.StorageConfiguration.initFromSnapshot}}),p.FlatStorage&&(f||p.StorageConfiguration.foldersShardingPattern)&&t().createElement(Nn,{fullWidth:!0,variant:"v2",disabled:!f,hintText:E("foldersShardingPattern"),value:p.StorageConfiguration.foldersShardingPattern||"",onChange:function(e,t){t?p.StorageConfiguration.foldersShardingPattern=t:delete p.StorageConfiguration.foldersShardingPattern}})),!p.FlatStorage&&t().createElement("div",null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.skipResync")),t().createElement(u.Checkbox,Sn({label:E("storage.skipResync"),labelPosition:"right",checked:p.SkipSyncOnRestart,onCheck:function(e,t){p.SkipSyncOnRestart=t}},w.toggleFieldV2))),"LOCAL"!==p.StorageType&&t().createElement("div",null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.readOnly")),t().createElement(u.Checkbox,Sn({label:E("storage.readOnly"),labelPosition:"right",checked:"true"===p.StorageConfiguration.readOnly,onCheck:function(e,t){p.StorageConfiguration.readOnly=t?"true":""}},w.toggleFieldV2))),(!p.StorageConfiguration.readOnly||"true"!==p.StorageConfiguration.readOnly)&&t().createElement("div",null,t().createElement("div",{style:wn(wn({},x.subLegend),{},{paddingTop:20})},E("storage.legend.checksumMapper")),t().createElement(u.Checkbox,Sn({label:E("storage.nativeEtags"),labelPosition:"right",checked:p.StorageConfiguration.nativeEtags,onCheck:function(e,t){p.StorageConfiguration.nativeEtags=t?"true":""}},w.toggleFieldV2)),!p.StorageConfiguration.nativeEtags&&t().createElement("div",null,t().createElement(u.Checkbox,Sn({label:E("storage.checksumMapper"),labelPosition:"right",checked:"dao"===p.StorageConfiguration.checksumMapper,onCheck:function(e,t){p.StorageConfiguration.checksumMapper=t?"dao":""}},w.toggleFieldV2)))));return t().createElement(jn,{title:k,titleLeftIcon:"mdi mdi-database",titleActionBar:O,closeAction:this.props.closeEditor,leftNavItems:f?null:[{label:E("tab.main"),value:"main",icon:"mdi mdi-database-plus"},{label:E("tab.lifecycle"),value:"data",icon:"mdi mdi-recycle"},{label:E("tab.advanced"),value:"advanced",icon:"mdi mdi-settings"}],leftNavSelected:d,leftNavChange:function(e){n.setState({currentPane:e})},className:"workspace-editor",contentFill:!1,rightPanelStyle:f?{paddingTop:64}:null},T,_,B,I,F,V,N)}}],o&&kn(r.prototype,o),s}(t().Component);function _n(e){return _n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_n(e)}function In(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bn(e,t){return Bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Bn(e,t)}function Fn(e){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Fn(e)}Ln.contextTypes={messages:l().object,getMessage:l().func},Ln=(0,f.muiThemeable)()(Ln);var Vn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bn(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Fn(o);if(a){var i=Fn(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==_n(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),i.apply(this,arguments)}return n=l,(r=[{key:"render",value:function(){var e=this.props,n=e.policy,r=e.rendering,o=e.pydio,a=function(e){return o.MessageHash["ajxp_admin.versions.period."+e]||e},i=n.KeepPeriods,l=void 0===i?[]:i,s=n.NodeDeletedStrategy;if("short"===r){var c;if(1===l.length){var d=l[0];c=-1===d.MaxNumber?a("keep-all.always"):a("keep-n").replace("%s",d.MaxNumber)}else{c=a("retentions-n").replace("%s",l.length);var p=l[l.length-1];0===p.MaxNumber||void 0===p.MaxNumber?c+=" | "+a("remove-all-after").replace("%s",p.IntervalStart):c+=" | "+a("keep-n-after").replace("%1",p.MaxNumber).replace("%2",p.IntervalStart)}return t().createElement("span",null,c)}var f,m=l.map((function(e){var n,r=e.MaxNumber,o=t().createElement(u.FontIcon,{className:"mdi mdi-ray-start-arrow"}),i={};return void 0===e.IntervalStart||"0"===e.IntervalStart?o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-start"}):n=t().createElement("span",{style:{fontWeight:500,fontSize:16}},e.IntervalStart,""),-1===e.MaxNumber?r=a("keep-all"):e.MaxNumber?r=a("max-n").replace("%s",r):(r=a("remove-all"),o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-end",style:{color:"#c62828"}}),i={color:"#c62828"}),t().createElement(u.Step,null,t().createElement(u.StepLabel,{icon:o,style:i},n,r))})),y={color:"#c62828",fontWeight:500,fontSize:16};switch(s){case"KeepLast":f="Backup last";break;case"KeepAll":default:y.color=null,f="Backup all";break;case"KeepNone":f="Clean all"}return m.push(t().createElement(u.Step,null,t().createElement(u.StepLabel,{style:y,icon:t().createElement(u.FontIcon,{className:"mdi mdi-delete",style:y})},f))),t().createElement(u.Stepper,{activeStep:l.length-1,linear:!1},m)}}])&&In(n.prototype,r),l}(t().Component);function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function Wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hn(e,t){return Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Hn(e,t)}function zn(e){return zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},zn(e)}var Jn=c().requireLib("form"),Yn=Jn.Manager,Gn=Jn.FormPanel,Qn=AdminComponents,$n=Qn.PaperEditorLayout,Xn=Qn.AdminStyles,Zn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(s,e);var n,r,o,a,i,l=(a=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=zn(a);if(i){var o=zn(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Kn(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dirty:!1,policy:e.versionPolicy,loaded:!0,valid:!0,parameters:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.versions.editor."+t]||t}},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){this.state.policy!==e.versionPolicy&&this.setState({policy:e.versionPolicy})}},{key:"componentDidMount",value:function(){var e=this;y().getRestClient().callApi("/config/discovery/forms/{ServiceName}","GET",{ServiceName:"pydio.grpc.versions"},{},{},{},null,[],["application/json"],["application/json"],"String").then((function(t){var n=t.data,r=p().parseXml(n);e.setState({parameters:Yn.parseParameters(r,"//param"),loaded:!0})}))}},{key:"resetForm",value:function(){this.setState({valid:!0,dirty:!1,saveValue:null})}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.policy;this.props.pydio.UI.openConfirmDialog({message:n("delete.confirm"),destructive:[r.Label],validCallback:function(){Z().loadClass("EnterpriseSDK").then((function(t){new t.EnterpriseConfigServiceApi(y().getRestClient()).deleteVersioningPolicy(r.Uuid).then((function(t){e.props.closeEditor()}))}))}})}},{key:"saveSource",value:function(){var e=this;if(this.state.saveValue){var t=this.state.saveValue;Z().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(y().getRestClient()).putVersioningPolicy(t.Uuid,t).then((function(){e.props.reloadList(),e.setState({dirty:!1,policy:t,saveValue:null})}))}))}}},{key:"onFormChange",value:function(e){var t=this.state.m,n=s.valuesToTreeVersioningPolicy(e),r=n.KeepPeriods||[],o=r.findIndex((function(e){return 0===e.MaxNumber}));if(o>-1&&o<r.length-1){pydio.UI.displayMessage("ERROR",t("error.lastdelete"));for(var a=r.length-1-o;a>0;)r.pop(),a--}n.KeepPeriods=r,this.setState({saveValue:n,dirty:!0})}},{key:"updateValidStatus",value:function(e){}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.create,a=r.readonly,i=r.pydio,l=r.muiTheme,c=r.internalSources,d=this.state,p=d.loaded,f=d.policy,m=d.saveValue,y=d.m,h=this.state.parameters,g=l.palette,b=Xn(g);if(h&&p){c&&(h=h.map((function(e){return"VersionsDataSourceName"===e.name&&(e.choices+=","+c.map((function(e){return e+"|DataSource "+e})).join(",")),e})));var v=s.TreeVersioningPolicyToValues(f);m&&(v=s.TreeVersioningPolicyToValues(m)),e=t().createElement(Gn,{parameters:h,values:v,className:"full-width",onChange:this.onFormChange.bind(this),onValidStatusChange:this.updateValidStatus.bind(this),disabled:a,depth:-2,variant:"v2"})}var S=[];a||(o||(S.push($n.actionButton(y("delete"),"mdi mdi-delete",(function(){n.deleteSource()}))),S.push($n.actionButton(i.MessageHash["ajxp_admin.plugins.6"],"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty))),S.push($n.actionButton(i.MessageHash[53],"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.valid||!this.state.dirty)));var E=m?m.Name:f.Name;return E||(E=""),t().createElement($n,{title:p&&h?y("title").replace("%s",E):i.MessageHash["ajxp_admin.loading"],titleLeftIcon:"mdi mdi-clock-start",titleActionBar:S,closeAction:this.props.closeEditor,className:"workspace-editor",contentFill:!0},t().createElement(u.Paper,{zDepth:0,style:{backgroundColor:b.body.block.header.backgroundColor,padding:"0px 20px",height:64,display:"flex",alignItems:"center"}},t().createElement("div",{style:{overflowX:"auto",width:"100%"}},t().createElement(Vn,{pydio:i,policy:m||f}))),e,t().createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"\n.react-mui-context .pydio-form-panel.form-panel-odd > .pydio-form-group {\n    margin: 2px 10px 0px;\n}\n.react-mui-context .pydio-form-panel.form-panel-odd >.pydio-form-group > h1 {\n    background-color: transparent;\n    color:#607D8B;\n    border-bottom: 1px solid #eceff1;\n    font-size: 13px;\n    font-weight: 500;\n    margin: 0px -16px;\n    letter-spacing: initial;\n    padding: 12px 20px;\n}\n"}}))}}],o=[{key:"valuesToTreeVersioningPolicy",value:function(e){for(var t=[],n="IntervalStart",r="MaxNumber",o=n,a=r,i=0;void 0!==e[o]&&void 0!==e[a];){var l=new S.TreeVersioningKeepPeriod;l.IntervalStart=e[o],l.MaxNumber=e[a],t.push(l),delete e[a],delete e[o],o=n+"_"+ ++i,a=r+"_"+i}return e.KeepPeriods=t,S.TreeVersioningPolicy.constructFromObject(e)}},{key:"TreeVersioningPolicyToValues",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach((function(t){Un(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if(t.KeepPeriods){var n=0;t.KeepPeriods.map((function(e){n>0?(t["IntervalStart_"+n]=e.IntervalStart||0,t["MaxNumber_"+n]=e.MaxNumber||0):(t.IntervalStart=e.IntervalStart||0,t.MaxNumber=e.MaxNumber||0),n++}))}return t.NodeDeletedStrategy||(t.NodeDeletedStrategy="KeepAll"),t}}],r&&qn(n.prototype,r),o&&qn(n,o),s}(t().Component);Zn=(0,f.muiThemeable)()(Zn);var er="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),tr=new Uint8Array(16);function nr(){if(!er)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return er(tr)}for(var rr=[],or=0;or<256;++or)rr[or]=(or+256).toString(16).substr(1);const ar=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||nr)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[r+a]=o[a];return t||function(e,t){var n=t||0,r=rr;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(o)};function ir(e){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ir(e)}function lr(){return lr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lr.apply(this,arguments)}function sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cr(e,t){return cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},cr(e,t)}function ur(e){return ur=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ur(e)}var dr=c().requireLib("components").MaterialTable,pr=c().requireLib("hoc").ModernTextField;const fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cr(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=ur(o);if(a){var i=ur(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==ir(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).state={keys:[],showDialog:!1,showExportKey:null,exportedKey:null,showCreateKey:null,showImportKey:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.encryption."+t]||e.pydio.MessageHash[t]||t}},t}return n=l,(r=[{key:"load",value:function(){var e=this;new S.ConfigServiceApi(y().getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest).then((function(t){e.setState({keys:t.Keys||[]})}))}},{key:"componentDidMount",value:function(){this.load()}},{key:"exportKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(y().getRestClient()),o=new S.EncryptionAdminExportKeyRequest;o.KeyID=this.state.showExportKey,o.StrPassword=this.refs["key-password-field"].getValue(),this.refs["key-password-confirm"].getValue()===o.StrPassword?r.exportEncryptionKey(o).then((function(t){e.setState({exportedKey:t.Key,showExportKey:null},(function(){e.timeout=setTimeout((function(){e.setState({exportedKey:"",showDialog:!1})}),1e4)})),e.setState({showExportKey:null})})).catch((function(r){t.UI.displayMessage("ERROR",n("key.export.fail")+" : "+r.message),e.setState({showExportKey:null})})):t.UI.displayMessage("ERROR",n("238"))}},{key:"createKey",value:function(){var e=this,t=new S.ConfigServiceApi(y().getRestClient()),n=new S.EncryptionAdminCreateKeyRequest;n.KeyID=this.refs.createKeyId.getValue(),n.Label=this.refs.createKeyLabel.getValue(),t.createEncryptionKey(n).then((function(t){e.load(),e.setState({showDialog:!1})})).catch((function(){e.setState({showDialog:!1})}))}},{key:"deleteKey",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("key.delete.warning"),destructive:[e],validCallback:function(){var n=new S.ConfigServiceApi(y().getRestClient()),r=new S.EncryptionAdminDeleteKeyRequest;r.KeyID=e,n.deleteEncryptionKey(r).then((function(e){t.load()}))}})}},{key:"importKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(y().getRestClient()),o=this.state.showImportKey,a=!0;o.ID||((o=new S.EncryptionKey).ID=this.refs["key-import-id"].getValue(),o.Label=this.refs["key-import-label"].getValue(),a=!1),o.Content=this.refs["key-imported-field"].getValue();var i=new S.EncryptionAdminImportKeyRequest;i.StrPassword=this.refs["key-password-field"].getValue(),i.Key=o,i.Override=a,r.importEncryptionKey(i).then((function(r){r.Success?t.UI.displayMessage("SUCCESS",n("key.import.success")):t.UI.displayMessage("ERROR",n("key.import.fail")),e.load(),e.setState({showImportKey:!1,showDialog:!1})})).catch((function(){e.setState({showImportKey:!1,showDialog:!1})}))}},{key:"render",value:function(){var e=this,n=this.state,r=n.keys,o=n.showDialog,a=n.showImportKey,i=n.showExportKey,l=n.exportedKey,s=n.showCreateKey,c=n.m,d=this.props,p=(d.pydio,d.accessByName),f=d.adminStyles,m=[{name:"Label",label:c("key.label"),style:{width:"30%",fontSize:15},headerStyle:{width:"30%"},sorter:{type:"string",default:!0}},{name:"ID",label:c("key.id"),hideSmall:!0,sorter:{type:"string"}},{name:"Owner",label:c("key.owner"),hideSmall:!0,sorter:{type:"string"}},{name:"CreationDate",label:c("key.created"),hideSmall:!0,useMoment:!0,sorter:{type:"number"}}],y=[];p("CreateEncryption")&&y.push({iconClassName:"mdi mdi-import",tooltip:c("key.import"),onClick:function(t){e.setState({showDialog:!0,showImportKey:t})}},{iconClassName:"mdi mdi-export",tooltip:c("key.export"),onClick:function(t){e.setState({showDialog:!0,showExportKey:t.ID})}},{iconClassName:"mdi mdi-delete",tooltip:c("key.delete"),onClick:function(t){e.deleteKey(t.ID)}});var h,g,b=[];i||l?(g=c("key.export"),l?(h=t().createElement(pr,{value:l.Content,fullWidth:!0,variant:"v2",floatingLabelText:c("key.export.result.copy"),multiLine:!0,ref:"key-imported-field"}),b=[t().createElement(u.FlatButton,{label:c("86"),onClick:function(){clearTimeout(e.timeout),e.setState({showExportKey:null,exportedKey:"",showDialog:!1})}})]):(h=t().createElement("div",null,t().createElement(pr,{variant:"v2",floatingLabelText:c("key.export.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(pr,{variant:"v2",floatingLabelText:c("key.export.confirm"),ref:"key-password-confirm",type:"password",fullWidth:!0})),b=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showExportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.export"),primary:!0,onClick:function(){e.exportKey()}})])):a?(g=c("key.import"),h=t().createElement("div",null,!a.ID&&t().createElement("div",null,t().createElement(pr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"key-import-id",fullWidth:!0}),t().createElement(pr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"key-import-label",fullWidth:!0})),t().createElement(pr,{variant:"v2",floatingLabelText:c("key.import.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(pr,{variant:"v2",fullWidth:!0,floatingLabelText:c("key.import.content"),multiLine:!0,ref:"key-imported-field"})),b=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showImportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.import"),primary:!0,onClick:function(){e.importKey()}})]):s&&(g=c("key.create"),h=t().createElement("div",null,t().createElement(pr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"createKeyId",fullWidth:!0}),t().createElement(pr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"createKeyLabel",fullWidth:!0})),b=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showCreateKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.create"),primary:!0,onClick:function(){e.createKey()}})]);var v=AdminComponents.AdminStyles().body,S=v.tableMaster,E=v.block.props,w=v.block.container;return t().createElement("div",null,t().createElement(u.Dialog,{title:g,open:o,onRequestClose:function(){e.setState({showDialog:!1,showExportKey:null,showImportKey:null,showCreateKey:!1})},modal:!0,actions:b,contentStyle:{maxWidth:340}},h),t().createElement(u.Paper,lr({},E,{style:w}),t().createElement(dr,{data:r,columns:m,actions:y,onSelectRows:function(){},showCheckboxes:!1,emptyStateString:c("key.emptyState"),masterStyles:S,storageKey:"console.encryption-keys.list"})),p("CreateEncryption")&&t().createElement("div",{style:{textAlign:"right",paddingRight:24,paddingBottom:24}},t().createElement(u.FlatButton,lr({primary:!0,label:c("key.import"),onClick:function(){e.setState({showImportKey:{},showDialog:!0})}},f.props.header.flatButton)),t().createElement("span",{style:{marginLeft:8}},t().createElement(u.FlatButton,lr({primary:!0,label:c("key.create"),onClick:function(){e.setState({showCreateKey:!0,showDialog:!0})}},f.props.header.flatButton)))))}}])&&sr(n.prototype,r),l}(t().Component);function mr(e){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mr(e)}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hr(e,t){return hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},hr(e,t)}function gr(e){return gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},gr(e)}const br=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hr(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=gr(o);if(a){var i=gr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==mr(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).state={value:"flat"},t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e,t){e.open&&!this.props.open&&this.setState({value:"flat"})}},{key:"submit",value:function(){var e=this.props,t=e.onSubmit,n=e.onRequestClose;t(this.state.value),n()}},{key:"render",value:function(){var e=this,n=this.props,r=n.open,o=n.onRequestClose,a=this.state.value,i=function(e){return c().getMessages()["ajxp_admin.ds.format-picker."+e]||e},l=function(e){var n=t().createElement("div",null,t().createElement("div",null,i(e+".title")),t().createElement("div",{style:{opacity:.67,margin:"5px 0 10px"}},i(e+".legend")));return t().createElement(u.RadioButton,{value:e,label:n})},s=[t().createElement(u.FlatButton,{label:c().getMessages()[54],onClick:function(){o()},primary:!0}),t().createElement(u.FlatButton,{label:i("submit"),primary:!0,onClick:function(){return e.submit()}})];return t().createElement(u.Dialog,{open:r,title:i("title"),onRequestClose:o,actions:s},t().createElement("div",{style:{marginBottom:20}},i("legend")),t().createElement(u.RadioButtonGroup,{valueSelected:a,onChange:function(t,n){return e.setState({value:n})}},l("flat"),l("structured"),l("internal")))}}])&&yr(n.prototype,r),l}(t().Component);function vr(e){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vr(e)}function Sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sr(Object(n),!0).forEach((function(t){wr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Or(){return Or=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Or.apply(this,arguments)}function kr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cr(e,t){return Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Cr(e,t)}function Pr(e){return Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pr(e)}var xr=c().requireLib("components").MaterialTable,jr=c().requireLib("boot"),Rr=jr.JobsStore,Tr=jr.moment,Nr=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(s,n);var r,o,a,i,l=(a=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Pr(a);if(i){var o=Pr(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==vr(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dataSources:[],resyncJobs:{},versioningPolicies:[],dsLoaded:!1,versionsLoaded:!1,showExportKey:!1,exportedKey:null,showImportKey:!1,importResult:null,keyOperationError:null,startedServices:[],peerAddresses:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.ds."+t]||t}},t}return r=s,o=[{key:"componentDidMount",value:function(){var e=this,t=new S.ConfigServiceApi(y().getRestClient()),n=this.props.pydio;this.statusPoller=setInterval((function(){n.WebSocketClient.getStatus()&&(ht.loadStatuses().then((function(t){e.setState({startedServices:t.Services||[]})})),t.listPeersAddresses().then((function(t){e.setState({peerAddresses:t.PeerAddresses||[]})})))}),2500),setTimeout((function(){e.syncPoller=setInterval((function(){n.WebSocketClient.getStatus()&&e.syncStatuses()}),2500)}),1250),this.load()}},{key:"componentWillUnmount",value:function(){clearInterval(this.statusPoller),clearInterval(this.syncPoller)}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setState({dsLoaded:!1,versionsLoaded:!1,newDsName:t}),ht.loadDatasources().then((function(t){e.setState({dataSources:t.DataSources||[],dsLoaded:!0},(function(){e.syncStatuses()}))})),ht.loadVersioningPolicies().then((function(t){e.setState({versioningPolicies:t.Policies||[],versionsLoaded:!0})})),ht.loadStatuses().then((function(t){e.setState({startedServices:t.Services})})),this.refs&&this.refs.encKeys&&this.refs.encKeys.load()}},{key:"syncStatuses",value:function(){var e=this,t=this.state.dataSources,n=void 0===t?[]:t;n.length&&Rr.getInstance().getAdminJobs(null,null,n.map((function(e){return"resync-ds-"+e.Name})),1).then((function(t){var n={};(t.Jobs||[]).forEach((function(e){e.Tasks&&e.Tasks.length&&(n[e.ID.replace("resync-ds-","")]=e)})),e.setState({resyncJobs:n})}))}},{key:"closeEditor",value:function(){this.props.closeRightPane()}},{key:"openDataSource",value:function(e){if(e.length){var t=e[0],n=this.props,r=n.openRightPane,o=n.accessByName,a=n.pydio,i=n.storageTypes;r({COMPONENT:Ln,PROPS:{ref:"editor",pydio:a,dataSource:t,storageTypes:i,readonly:!o("CreateDatasource"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"makeStatusLabel",value:function(e,n){switch(e){case"error":return t().createElement("span",{style:{color:"#e53935"}},t().createElement("span",{className:"mdi mdi-alert"})," ",n);case"running":return t().createElement("span",{style:{color:"#ef6c00"}},t().createElement("span",{className:"mdi mdi-timer-sand"})," ",n);default:return t().createElement("span",{style:{color:"#1b5e20"}},t().createElement("span",{className:"mdi mdi-check"})," ",n)}}},{key:"computeStatus",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&e.Disabled)return-1;var r,o,a,i=this.state,l=i.startedServices,s=void 0===l?[]:l,c=i.peerAddresses,u=void 0===c?[]:c,d=i.m,p=i.newDsName;if(!s.length)return d("status.na");if(s.map((function(t){t.Name==="pydio.grpc.data.sync."+e.Name&&"STARTED"===t.Status?o=!0:t.Name==="pydio.grpc.data.index."+e.Name&&"STARTED"===t.Status?r=!0:t.Name==="pydio.grpc.data.objects."+e.ObjectsServiceName&&"STARTED"===t.Status&&(a=!0)})),r&&o&&a)return p&&e.Name===p&&setTimeout((function(){t.setState({newDsName:null})}),100),n?0:this.makeStatusLabel("ok",d("status.ok"));if(p&&e.Name===p)return n?1:this.makeStatusLabel("running",d("status.starting"));if(r||o||a){var f=[];return r||f.push(d("status.index")),o||f.push(d("status.sync")),a||f.push(d("status.object")),n?3:this.makeStatusLabel("error",f.join(" - "))}var m=d("status.ko");return u&&-1===u.indexOf(e.PeerAddress)&&(m=d("status.ko-peers").replace("%s",e.PeerAddress)),n?2:this.makeStatusLabel("error",m)}},{key:"computeJobStatus",value:function(e){var t=e.Tasks[0];switch(t.Status){case"Finished":return this.makeStatusLabel("ok",Tr(new Date(1e3*parseInt(t.EndTime))).fromNow());case"Running":return this.makeStatusLabel("running",t.StatusMessage||"Running...");case"Error":return this.makeStatusLabel("error",t.StatusMessage);case"Queued":return this.makeStatusLabel("running",t.StatusMessage)}return this.makeStatusLabel("ok",t.StatusMessage)}},{key:"openVersionPolicy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e||e.length){var n,r=!1;if(void 0===e){r=!0,(n=new S.TreeVersioningPolicy).Uuid=ar(),n.VersionsDataSourceName="versions",n.NodeDeletedStrategy="KeepAll";var o=new S.TreeVersioningKeepPeriod;o.IntervalStart="0",o.MaxNumber=-1,n.KeepPeriods=[o]}else n=e[0],t&&(r=!0,(n=S.TreeVersioningPolicy.constructFromObject(JSON.parse(JSON.stringify(n)))).Uuid=ar(),n.Name+=" (Copy)");var a=this.props,i=a.openRightPane,l=a.pydio,s=a.versioningReadonly,c=a.accessByName,u=this.state.dataSources;i({COMPONENT:Zn,PROPS:{ref:"editor",versionPolicy:n,create:r,pydio:l,internalSources:u.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal})).map((function(e){return e.Name})),readonly:s||!c("CreateVersioning"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"deleteVersionPolicy",value:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.versions.editor.delete.confirm"],destructive:[e.Name],validCallback:function(){Z().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(y().getRestClient()).deleteVersioningPolicy(e.Uuid).then((function(e){t.load()}))}))}})}},{key:"createDataSource",value:function(e){var t=this.props,n=t.pydio,r=t.storageTypes,o=this.state.dataSources;this.props.openRightPane({COMPONENT:Ln,PROPS:{ref:"editor",create:!0,createStructure:e,existingNames:o.map((function(e){return e.Name})),pydio:n,storageTypes:r,closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}},{key:"resyncDataSource",value:function(e,t,n){e.UI.openConfirmDialog({message:t("editor.legend.resync"),skipNext:"datasource.resync.confirm",validCallback:function(){new ht(n).resyncSource()}})}},{key:"deleteDataSource",value:function(e,t,n){var r=this;e.UI.openConfirmDialog({message:t("editor.delete.warning"),validCallback:function(){new ht(n).deleteSource().then((function(){r.load()}))},destructive:[n.Name]})}},{key:"createWorkspaceFromDatasource",value:function(e,t,n){var r=new C,o=r.getModel(),a=n.Name;o.Label=a,o.Description="Root of "+a,o.Slug=a,o.Attributes.DEFAULT_RIGHTS="";var i={Uuid:"DATASOURCE:"+a,Path:a};o.RootNodes[i.Uuid]=i,e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:t("board.wsfromds.title"),legendId:t("board.wsfromds.legend").replace("%s",a),fieldLabelId:t("board.wsfromds.field"),defaultValue:t("board.wsfromds.defaultPrefix").replace("%s",a),submitValue:function(t){o.Label=t,r.save().then((function(t){localStorage.setItem("admin.workspace.autoload",t.UUID),e.goTo("/data/workspaces")}))}})}},{key:"render",value:function(){var n=this,r=this.state,o=r.dataSources,a=r.resyncJobs,i=r.versioningPolicies,l=r.m,s=r.createDialog;o.sort(g().arraySorter("Name"));var c=o.filter((function(e){return!(e.StorageConfiguration&&e.StorageConfiguration.cellsInternal)})),d=o.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal}));i.sort(g().arraySorter("Name"));var p=AdminComponents.AdminStyles(this.props.muiTheme.palette),f=p.body,m=f.tableMaster,y=f.block.props,h=f.block.container,b=this.props,v=b.currentNode,S=b.pydio,E=b.versioningReadonly,w=b.accessByName,O=[{name:"Name",label:l("name"),style:{fontSize:15,width:"15%"},headerStyle:{width:"15%"},sorter:{type:"string",default:!0}},{name:"StorageType",label:l("storage"),style:{width:"15%"},headerStyle:{width:"15%"},renderCell:function(e){var t="storage.fs";switch(e.StorageType){case"S3":t="storage.s3";break;case"AZURE":t="storage.azure";break;case"GCS":t="storage.gcs"}return l(t)},sorter:{type:"string"}},{name:"Status",label:l("status"),hideSmall:!0,renderCell:function(e){return e.Disabled?t().createElement("span",{style:{color:"#757575"}},t().createElement("span",{className:"mdi mdi-checkbox-blank-circle-outline"})," ",l("status.disabled")):n.computeStatus(e)},sorter:{type:"number",value:function(e){return n.computeStatus(e,!0)}}},{name:"SyncStatus",label:l("syncStatus"),hideSmall:!0,renderCell:function(e){return a&&a[e.Name]?n.computeJobStatus(a[e.Name]):"n/a"},sorter:{type:"number",value:function(e){return a&&a[e.Name]?a[e.Name].Tasks[0].EndTime:0}}},{name:"VersioningPolicyName",label:l("versioning"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,renderCell:function(e){var t=i.find((function(t){return t.Uuid===e.VersioningPolicyName}));return t?t.Name:e.VersioningPolicyName||"-"},sorter:{type:"string"}},{name:"EncryptionMode",label:l("encryption"),hideSmall:!0,style:{width:"8%",textAlign:"center"},headerStyle:{width:"8%"},renderCell:function(e){return"MASTER"===e.EncryptionMode?t().createElement("span",{className:"mdi mdi-check"}):"-"},sorter:{type:"number",value:function(e){return"MASTER"===e.EncryptionMode?1:0}}}];c.filter((function(e){return!e.FlatStorage})).length||(O=O.filter((function(e){return"SyncStatus"!==e.name})));var k=O.filter((function(e){return"VersioningPolicyName"!==e.name&&"SyncStatus"!==e.name})),C=v.getLabel(),P=v.getMetadata().get("icon_class"),x=[];w("CreateDatasource")&&x.push(t().createElement(u.FlatButton,Or({primary:!0,label:S.MessageHash["ajxp_admin.ws.4"],onClick:function(){return n.setState({createDialog:!0})}},p.props.header.flatButton)));var j=!E&&w("CreateVersioning");j&&x.push(t().createElement(u.FlatButton,Or({primary:!0,label:S.MessageHash["ajxp_admin.ws.4b"],onClick:function(){n.openVersionPolicy()}},p.props.header.flatButton)));var R=[{name:"Name",label:l("versioning.name"),style:{width:180,fontSize:15},headerStyle:{width:180},sorter:{type:"string",default:!0}},{name:"Description",label:l("versioning.description"),sorter:{type:"string"}},{name:"KeepPeriods",hideSmall:!0,label:l("versioning.periods"),renderCell:function(e){return t().createElement(Vn,{rendering:"short",policy:e,pydio:S})}},{name:"VersionsDataSourceName",style:{width:180},headerStyle:{width:180},label:l("versioning.storage"),sorter:{type:"string"},hideSmall:!0}],T=[];w("CreateDatasource")&&T.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit datasource",onClick:function(e){n.openDataSource([e])}}),T.push({iconClassName:"mdi mdi-folder-plus",tooltip:"Create workspace here",onClick:function(e){return n.createWorkspaceFromDatasource(S,l,e)}}),w("CreateDatasource")&&T.push({iconClassName:"mdi mdi-delete",tooltip:l("editor.legend.delete.button"),onClick:function(e){return n.deleteDataSource(S,l,e)}});var N=[].concat(T);c.filter((function(e){return!e.FlatStorage})).length>0&&T.push({iconClassName:"mdi mdi-sync",tooltip:l("editor.legend.resync.button"),onClick:function(e){return n.resyncDataSource(S,l,e)},disable:function(e){return e.FlatStorage}});var A=[];return A.push({iconClassName:j?"mdi mdi-pencil":"mdi mdi-eye",tooltip:j?"Edit policy":"Display policy",onClick:function(e){n.openVersionPolicy([e])}}),j&&(A.push({iconClassName:"mdi mdi-content-copy",tooltip:"Duplicate policy",onClick:function(e){return n.openVersionPolicy([e],!0)}}),A.push({iconClassName:"mdi mdi-delete",tooltip:"Delete policy",destructive:!0,onClick:function(e){return n.deleteVersionPolicy(e)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:C,icon:P,actions:x,reloadAction:this.load.bind(this),loading:!(this.state.dsLoaded&&this.state.versionsLoaded)}),t().createElement(br,{open:s,onRequestClose:function(){n.setState({createDialog:!1})},onSubmit:function(e){n.createDataSource(e)}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:l("board.ds.title"),legend:l("board.ds.legend")}),t().createElement(u.Paper,Or({},y,{style:Er({},h)}),t().createElement(xr,{data:c,columns:O,actions:T,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:m,storageKey:"console.datasources.list"})),d.length>0&&t().createElement(e.Fragment,null,t().createElement("div",{style:{padding:"0px 20px"}},l("board.ds.internal.legend")),t().createElement(u.Paper,Or({},y,{style:Er({},h)}),t().createElement(xr,{data:d,columns:k,actions:N,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:m,storageKey:"console.internalsources.list"}))),t().createElement(AdminComponents.SubHeader,{title:l("board.versioning.title"),legend:l("board.versioning.legend")}),t().createElement(u.Paper,Or({},y,{style:Er({},h)}),t().createElement(xr,{data:i,columns:R,actions:A,onSelectRows:this.openVersionPolicy.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:m,storageKey:"console.versioning.policies.list"})),t().createElement(AdminComponents.SubHeader,{title:l("board.enc.title"),legend:l("board.enc.legend")}),t().createElement(fr,{pydio:S,ref:"encKeys",accessByName:w,adminStyles:p}))))}}],o&&kr(r.prototype,o),s}(t().Component);function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function Mr(){return Mr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mr.apply(this,arguments)}function Dr(e,t){if(e){if("string"==typeof e)return Lr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lr(e,t):void 0}}function Lr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ir(e,t){return Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ir(e,t)}function Br(e){return Br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Br(e)}Nr.propTypes={dataModel:l().instanceOf(ze()).isRequired,rootNode:l().instanceOf(Ye()).isRequired,currentNode:l().instanceOf(Ye()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,filter:l().string,versioningReadonly:l().bool},Nr=(0,f.muiThemeable)()(Nr);var Fr=n(173).muiThemeable,Vr=c().requireLib("components").MaterialTable,Kr=c().requireLib("boot").AsyncComponent,Wr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ir(e,t)}(l,e);var n,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Br(o);if(a){var i=Br(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Ar(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).state={loading:!1,namespaces:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t}},t}return n=l,(r=[{key:"componentWillMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading:!0}),G.loadNamespaces().then((function(t){e.setState({loading:!1,namespaces:t.Namespaces||[]})}))}},{key:"emptyNs",value:function(){var e=new S.IdmUserMetaNamespace;return e.Policies=[S.ServiceResourcePolicy.constructFromObject({Action:"READ",Subject:"*",Effect:"allow"}),S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Subject:"*",Effect:"allow"})],e.JsonDefinition=JSON.stringify({type:"string"}),e.Indexable=!0,e}},{key:"create",value:function(){this.setState({create:!0,dialogOpen:!0,selectedNamespace:this.emptyNs()})}},{key:"deleteNs",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("delete.confirm"),destructive:[e.Namespace],validCallback:function(){G.deleteNS(e).then((function(){t.load()}))}})}},{key:"open",value:function(e){e.length&&this.setState({create:!1,dialogOpen:!0,selectedNamespace:e[0]})}},{key:"close",value:function(){this.setState({dialogOpen:!1,selectedNamespace:null})}},{key:"render",value:function(){var e=this,n=this.props,r=n.muiTheme,o=n.currentNode,a=n.pydio,i=n.accessByName,l=n.policiesBuilder,s=n.customButtons,c=void 0===s?[]:s,d=AdminComponents.AdminStyles(r.palette),p=this.state,f=p.namespaces,m=p.loading,y=p.dialogOpen,h=p.selectedNamespace,g=p.create,b=p.m,v=p.async;h||(h=this.emptyNs());var S,E=function(e){if(Array.isArray(e))return Lr(e)}(S=new Set(f.map((function(e){return be(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(S)||Dr(S)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();f.sort((function(e,t){var n,r;return(n=e.Order||0)===(r=t.Order||0)?0:n>r?1:-1}));var w=[{name:"Order",label:b("order"),style:{width:30},headerStyle:{width:30},hideSmall:!0,renderCell:function(e){return e.Order||"0"},sorter:{type:"number"}},{name:"Namespace",label:b("namespace"),style:{fontSize:15},sorter:{type:"string"}},{name:"Label",label:b("label"),style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"Indexable",label:b("indexable"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0,renderCell:function(e){return e.Indexable?"Yes":"No"},sorter:{type:"number",value:function(e){return e.Indexable?1:0}}},{name:"JsonDefinition",label:b("definition"),hideSmall:!0,renderCell:function(e){var t=e.JsonDefinition;if(!t)return"";var n=JSON.parse(t);return G.MetaTypes[n.type]||n.type},sorter:{type:"string"}}],O={};E.length?f.map((function(e){var t=be(e);O[t]||(O[t]=[]),O[t].push(e)})):O[""]=f;var k=o.getLabel(),C=o.getMetadata().get("icon_class"),P=[],x=[];return c&&c.forEach((function(n){if(!n.access||i(n.access)){var r=a.MessageHash[n.label]||n.label,o=function(){if(n.insert){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}}(e,t)||Dr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n.insert.split("."),2),r=t[0],o=t[1];e.setState({async:{namespace:r,component:o}})}};n.icon?P.push(t().createElement(u.IconButton,Mr({iconClassName:"mdi mdi-"+n.icon,tooltip:r,onClick:o},d.props.header.iconButton))):P.push(t().createElement(u.FlatButton,Mr({label:r,onClick:o},d.props.header.flatButton)))}})),i("Create")&&(P.push(t().createElement(u.FlatButton,Mr({primary:!0,label:b("namespace.add"),onClick:function(){e.create()}},d.props.header.flatButton))),x.push({iconClassName:"mdi mdi-pencil",onClick:function(t){e.open([t])}},{iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteNs(t)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement(we,{pydio:a,open:y,create:g,namespace:h,onRequestClose:function(){return e.close()},reloadList:function(){return e.load()},namespaces:f,readonly:!i("Create"),policiesBuilder:l}),t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:k,icon:C,actions:P,reloadAction:this.load.bind(this),loading:m}),v&&t().createElement(Kr,{namespace:v.namespace,componentName:v.component,onDismiss:function(){return e.setState({async:null},(function(){e.load()}))}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:b("namespaces"),legend:b("namespaces.legend")}),Object.keys(O).sort().map((function(n){return t().createElement(t().Fragment,null,n&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},"["+b("group")+"] "+n),!n&&E.length>0&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},b("default-group")),t().createElement(u.Paper,d.body.block.props,t().createElement(Vr,{data:O[n],columns:w,actions:x,onSelectRows:e.open.bind(e),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:b("empty"),masterStyles:d.body.tableMaster,storageKey:"console.metadata.list"})))})))))}}])&&_r(n.prototype,r),l}(t().Component);Wr=Fr()(Wr)})(),window.AdminWorkspaces=r})();