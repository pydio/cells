(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")},880:e=>{e.exports=require("pydio/http/api")},590:e=>{e.exports=require("pydio/lang/observable")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{DataSource:()=>vt,DataSourceEditor:()=>Vn,DataSourcesBoard:()=>Br,MetadataBoard:()=>Gr,TemplatePath:()=>pt,TemplatePathEditor:()=>kt,VirtualNodes:()=>Dt,Workspace:()=>C,WsAutoComplete:()=>Y,WsDashboard:()=>it});const e=require("react");var t=n.n(e);const o=require("create-react-class");var i=n.n(o);const a=require("prop-types");var l=n.n(a);const s=require("pydio");var c=n.n(s);const u=require("material-ui"),d=require("pydio/util/xml");var p=n.n(d),f=n(173),y=n(880),m=n.n(y);const h=require("pydio/util/lang");var b=n.n(h),g=n(590),v=n.n(g);const S=require("cells-sdk");function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(i){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalAttributes={},t.dirty=!1,e?t.initModel(e):(t.create=!0,t.model=new S.IdmWorkspace,t.model.Scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.model.RootNodes={},t.internalAttributes={DEFAULT_RIGHTS:""},t.model.PoliciesContextEditable=!0,t.model.Attributes=JSON.stringify(t.internalAttributes)),t.observableModel=t.buildProxy(t.model),t}return t=l,r=[{key:"rootIsTemplatePath",value:function(e){return!(!e.MetaStore||!e.MetaStore.resolution)}},{key:"listWorkspaces",value:function(){var e=new S.WorkspaceServiceApi(m().getRestClient()),t=new S.RestSearchWorkspaceRequest,n=new S.IdmWorkspaceSingleQuery;return n.scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.Queries=[n],e.searchWorkspaces(t)}}],(n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;return"Slug"===n?o=b().computeStringSlug(o):"Label"===n&&t.create&&(e.Slug=b().computeStringSlug(o)),e[n]=o,t.dirty=!0,t.notify("update"),!0},get:function(e,n){var r=e[n];return"Attributes"===n&&(r=t.internalAttributes),r instanceof Array?r:r instanceof Object?t.buildProxy(r):r}})}},{key:"initModel",value:function(e){if(this.create=!1,this.dirty=!1,this.model=e,this.snapshot=JSON.parse(JSON.stringify(e)),e.Attributes){var t=JSON.parse(e.Attributes);"object"===w(t)&&Object.keys(t).length&&(this.internalAttributes=t)}else this.internalAttributes={};e.RootNodes||(e.RootNodes={})}},{key:"getModel",value:function(){return this.observableModel}},{key:"hasTemplatePath",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"hasFolderRoots",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return!l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"save",value:function(){var e=this;return this.model.Attributes=JSON.stringify(this.internalAttributes),new S.WorkspaceServiceApi(m().getRestClient()).putWorkspace(this.model.Slug,this.model).then((function(t){return e.initModel(t),e.observableModel=e.buildProxy(e.model),t}))}},{key:"remove",value:function(){return new S.WorkspaceServiceApi(m().getRestClient()).deleteWorkspace(this.model.Slug)}},{key:"revert",value:function(){var e=S.IdmWorkspace.constructFromObject(this.snapshot||{});this.initModel(e),this.observableModel=this.buildProxy(this.model)}},{key:"isValid",value:function(){return this.model.Slug&&this.model.Label&&Object.keys(this.model.RootNodes).length>0}},{key:"isDirty",value:function(){return this.dirty}}])&&O(t.prototype,n),r&&O(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());const P=require("lodash.debounce");var j=n.n(P);const x=require("pydio/util/path");var T=n.n(x),R=["muiTheme","children"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t,n){return(t=B(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function B(e){var t=function(e,t){if("object"!==_(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===_(t)?t:String(t)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},K.apply(this,arguments)}var W=c().requireLib("hoc"),U=W.ModernAutoComplete,q=W.ModernTextField,H=W.ThemedModernStyles,J=W.ModernSelectField,z=(0,f.muiThemeable)()((function(e){var n=e.muiTheme,r=e.children,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,R),i=H(n);return t().createElement("div",K({style:i.fillBlockV2Right},o),r)})),Y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(i);if(a){var n=V(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.value,r=void 0===n?"":n;return t.debounced=j()((function(){var e=t.state.value;t.loadValues(e)}),300),t.state={nodes:[],value:r},t}return n=s,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.validateOnLoad,n=this.state.value;this.loadValues(n,(function(){var n=e.state,r=n.nodes,o=n.value;r.filter((function(e){return e.Path===o&&(!e.Type||"COLLECTION"===e.Type&&!e.MetaStore&&!e.MetaStore.resolution)})).map((function(t){e.loadValues(o+"/")})),t&&e.handleNewRequest(o)}))}},{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({value:e}),e||(0,this.props.onDelete)()}},{key:"handleNewRequest",value:function(e){var t,n,r=this.state.nodes,o=this.props,i=o.onChange,a=void 0===i?function(){}:i,l=o.onDelete,s=void 0===l?function(){}:l,c=o.onError,u=void 0===c?function(){}:c;if("string"==typeof e){if(""===e)return void s();t=e,(n=r.filter((function(t){return t.Path===e}))[0])||(n=r.filter((function(t){return 0===t.Path.indexOf(e)}))[0])}else"object"===_(e)&&(t=e.key,n=e.node);if(!n)return u();this.setState({value:t}),a(t,n)}},{key:"loadValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e.lastIndexOf("/"),o=e.substr(0,r);if(null===this.lastSearch||this.lastSearch!==o){this.lastSearch=o,this.setState({loading:!0});var i=new S.AdminTreeServiceApi(m().getRestClient()),a=new S.TreeListNodesRequest,l=new S.TreeNode;l.Path=o+"/",a.Node=l,i.listAdminTree(a).then((function(e){t.setState({nodes:e.Children||[],loading:!1},(function(){return n()}))})).catch((function(){t.setState({loading:!1},(function(){return n()}))}))}}},{key:"render",value:function(){var e=this,n=this.state,r=n.value,o=n.nodes,i=n.loading,a=this.props,l=a.pydio,c=a.onDelete,d=a.onChange,p=a.isTemplatePath,f=a.skipTemplates,y=a.label,m=a.zDepth,h=void 0===m?0:m,g=function(e){return l.MessageHash["ajxp_admin."+e]||e},v=[];if(o){var S={};if(o.forEach((function(e){if(!(e.MetaStore&&e.MetaStore.resolution&&"cells"===e.Uuid||T().getBasename(e.Path).startsWith("."))){var t=s.renderNode(e,g);S[t.categ]||(S[t.categ]=[]),S[t.categ].push(t)}})),Object.keys(S).length>1){v.push({key:"h1",text:"",value:t().createElement(u.MenuItem,{primaryText:g("ws.complete.datasources"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var w=S[Object.keys(S)[0]];if(w.sort(b().arraySorter("text")),v.push.apply(v,M(w)),!f){v.push({key:"h2",text:"",value:t().createElement(u.MenuItem,{primaryText:g("ws.complete.templates"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var O=S[Object.keys(S)[1]];O.sort(b().arraySorter("text")),v.push.apply(v,M(O))}}else 1===Object.keys(S).length&&v.push.apply(v,M(S[Object.keys(S)[0]]))}var E=!0,k=t().createElement(U,{fullWidth:!0,searchText:r,onUpdateInput:function(t){return e.handleUpdateInput(t)},onNewRequest:function(t){return e.handleNewRequest(t)},onClose:function(){return e.handleNewRequest(r)},dataSource:v,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},floatingLabelText:y||g("ws.complete.label"),openOnFocus:!0,menuProps:{maxHeight:200,desktop:!0},hasRightBlock:!0});if(r&&"/"!==r){if(p){var C=p.MetaStore.resolution.split("\n").pop(),P=r+" - "+g("ws.complete.resolves")+C;k=t().createElement(q,{floatingLabelText:y||g("ws.complete.label"),variant:"v2",fullWidth:!0,value:P,inputStyle:{color:"inherit"},disabled:!0})}}else k=t().createElement(J,{floatingLabelText:y||g("ws.complete.label"),variant:"v2",fullWidth:!0,maxHeight:300,onChange:function(e,t,n){var r=o.filter((function(e){return e.Path===n}))[0];d(r.Path,r)}},v.map((function(e){return e.value}))),E=!1;return t().createElement(u.Paper,{zDepth:h,style:A({display:"flex",alignItems:"center",margin:"2px 0"},this.props.style)},t().createElement("div",{style:{position:"relative",flex:1,height:60}},t().createElement("div",{style:{position:"absolute",right:0,top:30,width:30}},t().createElement(u.RefreshIndicator,{size:30,left:0,top:0,status:i?"loading":"hide"})),k),E&&t().createElement(z,null,t().createElement(u.IconButton,{style:{marginTop:2},iconStyle:{color:c?"#9e9e9e":"#eee"},iconClassName:"mdi mdi-delete",onClick:c,disabled:!c})))}}],o=[{key:"renderNode",value:function(e,n){var r=t().createElement("span",null,e.Path),o="mdi mdi-folder",i="folder";if(e.MetaStore&&e.MetaStore.resolution){o="mdi mdi-file-tree",i="templatePath";var a=e.MetaStore.resolution.split("\n").pop();r=t().createElement("span",null,e.Path," ",t().createElement("i",{style:{color:"#9e9e9e"}},"- ",n("ws.complete.resolves")," ",a))}else"LEAF"===e.Type&&(o="mdi mdi-file");return{key:e.Path,text:e.Path,node:e,categ:i,value:t().createElement(u.MenuItem,{value:e.Path},t().createElement(u.FontIcon,{className:o,color:"#607d8b",style:{float:"left",marginRight:8,fontSize:20}})," ",r)}}}],r&&I(n.prototype,r),o&&I(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==G(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===G(o)?o:String(o)),r)}var o}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"loadNamespaces",value:function(){return new S.UserMetaServiceApi(m().getRestClient()).listUserMetaNamespace()}},{key:"putNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("PUT"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"deleteNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("DELETE"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"clearLocalCache",value:function(){try{window.ReactMeta&&ReactMeta.Renderer.getClient().clearConfigs()}catch(e){}}}],null&&Q(t.prototype,null),n&&Q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();$.MetaTypes={string:"Text",textarea:"Long Text",integer:"Number",boolean:"Boolean",date:"Date",choice:"Selection",tags:"Extensible Tags",stars_rate:"Stars Rating",css_label:"Color Labels",json:"JSON"};const X=require("pydio/util/func");var Z=n.n(X);const ee=require("pydio/http/resources-manager");var te=n.n(ee);function ne(e,t){if(e){if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ae(e,t,n){return(t=de(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function le(){return le=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},le.apply(this,arguments)}function se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,de(r.key),r)}}function ue(e,t,n){return t&&ce(e.prototype,t),n&&ce(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function de(e){var t=function(e,t){if("object"!==he(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==he(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===he(t)?t:String(t)}function pe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fe(e,t)}function fe(e,t){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fe(e,t)}function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=me(e);if(t){var o=me(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function me(e){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},me(e)}function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}var be=c().requireLib("hoc"),ge=be.ModernTextField,ve=be.ModernAutoComplete,Se=be.ThemedModernStyles;function we(e){try{return JSON.parse(e.JsonDefinition).groupName||""}catch(e){return""}}function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var n=e.split("."),r=n.shift(),o=n.join(".");return te().loadClass(r).then((function(n){var i=Z().getFunctionByName(o,n);if(!i){if("object"===he(n)&&n[r]){var a=Z().getFunctionByName(o,n[r]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(n){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw n}))}var Ee=function(n){pe(o,n);var r=ye(o);function o(e){return se(this,o),r.call(this,e)}return ue(o,[{key:"togglePolicies",value:function(e,t){var n=this.props,r=n.policies,o=void 0===r?[]:r,i=n.onChangePolicies,a=o.filter((function(t){return t.Action!==e}));a.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),"READ"===e&&t&&(a=a.filter((function(e){return"WRITE"!==e.Action}))).push(S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Effect:"allow",Subject:"profile:admin"})),i(a)}},{key:"render",value:function(){var n,r,o=this,i=this.props,a=i.readonly,l=i.policies,s=i.pydio,c=i.muiTheme,d=function(e){return s.MessageHash["ajxp_admin.metadata."+e]||e},p=Se(c);return l&&l.map((function(e){"profile:admin"===e.Subject&&"READ"===e.Action&&(n=!0),"profile:admin"===e.Subject&&"WRITE"===e.Action&&(r=!0)})),t().createElement(e.Fragment,null,t().createElement("div",null,t().createElement(u.Toggle,le({label:d("toggle.read"),disabled:a,labelPosition:"left",toggled:n,onToggle:function(e,t){o.togglePolicies("READ",t)}},p.toggleFieldV2))),t().createElement("div",null,t().createElement(u.Toggle,le({label:d("toggle.write"),labelPosition:"left",disabled:n||a,toggled:r,onToggle:function(e,t){o.togglePolicies("WRITE",t)}},p.toggleFieldV2))))}}]),o}(t().Component);Ee=(0,f.muiThemeable)()(Ee);var ke=function(e){pe(r,e);var n=ye(r);function r(e){var t;return se(this,r),(t=n.call(this,e)).state={namespace:t.cloneNs(e.namespace),m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t},selectorNewKey:"",selectorNewValue:"",PoliciesBuilder:Ee},te().loadClass("ReactMeta").then((function(e){t.setState({metaModule:e});var n=t.props.policiesBuilder;n&&Oe(n,Ee).then((function(e){return t.setState({PoliciesBuilder:e})}))})),t}return ue(r,[{key:"cloneNs",value:function(e){return S.IdmUserMetaNamespace.constructFromObject(JSON.parse(JSON.stringify(e)))}},{key:"componentWillReceiveProps",value:function(e){if(e.open!==this.props.open){var t=e.create,n=e.namespaces,r=this.cloneNs(e.namespace);t&&n.length&&(r.Order=n.map((function(e){return e.Order||0})).reduce((function(e,t){return Math.max(e,t)}),0)+1),this.setState({namespace:r})}}},{key:"save",value:function(){var e=this,t=this.state.namespace;$.putNS(t).then((function(){e.props.onRequestClose(),e.props.reloadList()}))}},{key:"getHideValue",value:function(){var e=this.state.namespace;try{return JSON.parse(e.JsonDefinition).hide}catch(e){return!1}}},{key:"setHideValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(ie(ie({},n),{},{hide:e})),this.setState({namespace:t})}},{key:"setGroupValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(ie(ie({},n),{},{groupName:e})),this.setState({namespace:t})}},{key:"getAdditionalData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.state.namespace;try{var n=JSON.parse(t.JsonDefinition).data||e;if(e.items&&n.split){var r=n.split(",").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||ne(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split("|"),2);return{key:t[0],value:t[1]}}));return{items:r}}return n}catch(e){}return e}},{key:"setAdditionalDataKey",value:function(e,t){var n=this.state.namespace,r=JSON.parse(n.JsonDefinition),o=ae({},e,t);r.data=ie(ie({},r.data),o),n.JsonDefinition=JSON.stringify(r),this.setState({namespace:n})}},{key:"togglePolicies",value:function(e,t){var n=this,r=this.state.namespace,o=(r.Policies||[]).filter((function(t){return t.Action!==e}));o.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),r.Policies=o,this.setState({namespace:r},(function(){"READ"===e&&t&&n.togglePolicies("WRITE",!0)}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.create,o=n.namespaces,i=n.pydio,a=n.readonly,l=n.muiTheme,s=this.state,d=s.namespace,p=s.m,f=s.PoliciesBuilder,y=s.metaModule,h=Se(l);if(!y)return null;var b,g=y.TypeEditor;b=d.Label?d.Label:p("editor.title.create");var v="string";d.JsonDefinition&&(v=JSON.parse(d.JsonDefinition).type);var w,O,E=!1;if(d.Label?d.Namespace&&"usermeta-"!==d.Namespace||(E=!0,w=p("editor.ns.error")):(E=!0,O=p("editor.label.error")),r&&o.filter((function(e){return e.Namespace===d.Namespace})).length&&(E=!0,w=p("editor.ns.exists")),"choice"===v){var k=this.getAdditionalData({items:[]}).items;k&&k.length||(E=!0)}var C,P=function(e){if(Array.isArray(e))return re(e)}(C=new Set(o.map((function(e){return we(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(C)||ne(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();d.Policies&&d.Policies.map((function(e){"profile:admin"===e.Subject&&e.Action,"profile:admin"===e.Subject&&e.Action}));var j=[t().createElement(u.FlatButton,{primary:!0,label:i.MessageHash[54],onClick:this.props.onRequestClose}),t().createElement(u.FlatButton,{primary:!0,disabled:E||a,label:i.MessageHash[53],onClick:function(){e.save()}})];"tags"!==v||a||j.unshift(t().createElement(u.FlatButton,{primary:!1,label:p("editor.tags.reset"),onClick:function(){new S.UserMetaServiceApi(m().getRestClient()).deleteUserMetaTags(d.Namespace,"*").then((function(){i.UI.displayMessage("SUCCESS",p("editor.tags.cleared").replace("%s",d.Namespace))})).catch((function(e){i.UI.displayMessage("ERROR",e.message)}))}}));var x={section:{marginTop:10,fontWeight:500,fontSize:12}};return t().createElement(u.Dialog,{title:b,actions:j,modal:!1,contentStyle:{width:520},open:this.props.open,onRequestClose:this.props.onRequestClose,autoScrollBodyContent:!0,bodyStyle:{padding:20}},t().createElement(g,{m:p,pydio:i,namespace:d,forcePrefix:"usermeta-",onChange:function(t){return e.setState({namespace:t})},readonly:a,create:r,labelError:O,nameError:w,styles:x}),t().createElement("div",{style:x.section},c().getInstance().MessageHash[310]),t().createElement(u.Toggle,le({label:p("toggle.list-visibility"),disabled:a,labelPosition:"left",toggled:!this.getHideValue(),onToggle:function(t,n){e.setHideValue(!n)}},h.toggleFieldV2)),t().createElement(u.Toggle,le({label:p("toggle.index"),disabled:a,labelPosition:"left",toggled:d.Indexable,onToggle:function(t,n){d.Indexable=n,e.setState({namespace:d})}},h.toggleFieldV2)),f&&t().createElement(f,{policies:d.Policies,readonly:a,onChangePolicies:function(t){return e.setState({namespace:ie(ie({},d),{},{Policies:t})})},pydio:i}),t().createElement("div",{style:x.section},p("order")),t().createElement(ge,{floatingLabelText:p("order"),value:d.Order?d.Order:"0",onChange:function(t,n){d.Order=parseInt(n),e.setState({namespace:d})},fullWidth:!0,type:"number",readOnly:a,variant:"v2"}),t().createElement(ve,{floatingLabelFixed:!0,fullWidth:!0,floatingLabelText:p("group-field"),filter:function(e,t){return!e.indexOf||0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,dataSource:P,searchText:we(d)||"",onNewRequest:function(t,n){e.setGroupValue(t)},onUpdateInput:function(t){e.setGroupValue(t)},menuProps:{maxHeight:300,overflowY:"auto"}}))}}]),r}(t().Component);(ke=(0,f.muiThemeable)()(ke)).PropTypes={namespace:l().instanceOf(S.IdmUserMetaNamespace).isRequired,namespaces:l().arrayOf(S.IdmUserMetaNamespace),create:l().bool,reloadList:l().func,onRequestClose:l().func};const Ce=ke;function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Te(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Pe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Pe(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re={display:"flex",alignItems:"center",padding:"0 20px 0 8px",position:"absolute",height:64,zIndex:10,top:64,left:0,right:0,backgroundColor:"rgb(246 246 248)",boxShadow:"rgba(0, 0, 0, .1) 0px 1px 2px"};function Ne(e,n,r,o,i,a,l){var s=Object.keys(e),c=0===s.indexOf(n),d=o||s.indexOf(n)===s.length-1,p=t().createElement("div",{style:Re},t().createElement("div",{style:{flex:1}},t().createElement(u.Stepper,{activeStep:s.indexOf(n)},s.map((function(n){return t().createElement(u.Step,null,t().createElement(u.StepLabel,null,e[n]))}))))),f=t().createElement("div",{style:xe(xe({},Re),{},{top:null,bottom:0,backgroundColor:"white",boxShadow:"rgba(0, 0, 0, .1) 0px -1px 2px"})},t().createElement("span",{style:{flex:1}}),t().createElement(u.FlatButton,{primary:!0,label:l.back,onClick:function(){var e=s.indexOf(n);e>0&&r(s[e-1])},disabled:c}),t().createElement(u.FlatButton,{primary:!0,label:l.next,onClick:function(){var e=s.indexOf(n);e<s.length-1&&r(s[e+1])},disabled:d}),t().createElement("div",{style:{width:1,height:40,backgroundColor:"#efefef",margin:"0 5px"}}),t().createElement(u.FlatButton,{primary:!0,label:l.save,onClick:i,disabled:!a()}));return{Steps:p,Buttons:f}}function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},De.apply(this,arguments)}function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){_e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t,n){return(t=Be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Be(r.key),r)}}function Be(e){var t=function(e,t){if("object"!==Ae(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ae(t)?t:String(t)}function Fe(e,t){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fe(e,t)}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}var Ke=c().requireLib("hoc"),We=Ke.ModernTextField,Ue=Ke.ModernSelectField,qe=Ke.ThemedModernStyles,He=c().requireLib("form").InputIntegerBytes,Je=AdminComponents,ze=Je.PaperEditorLayout,Ye=Je.AdminStyles,Ge=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fe(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ve(i);if(a){var n=Ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.presetModel||new C(e.workspace);n.observe("update",(function(){t.forceUpdate()})),t.state={workspace:n.getModel(),container:n,newFolderKey:Math.random(),showDialog:!1};var r=t.props.policiesBuilder;return r&&Oe(r,null).then((function(e){return t.setState({PoliciesBuilder:e})})).catch((function(e){})),t}return r=s,(o=[{key:"enableSync",value:function(e){e?this.setState({showDialog:"enableSync",dialogTargetValue:e}):this.setState({showDialog:"disableSync",dialogTargetValue:e})}},{key:"confirmSync",value:function(e){this.state.workspace.Attributes.ALLOW_SYNC=e,this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"revert",value:function(){var e=this,t=this.state.container;t.revert(),this.setState({workspace:t.getModel()},(function(){e.forceUpdate()}))}},{key:"save",value:function(){var e=this,t=this.state.container,n=this.props,r=n.reloadList,o=n.closeEditor;this.setState({saving:!0});var i=t.create;t.save().then((function(){r(),e.setState({workspace:t.getModel(),saving:!1},(function(){e.forceUpdate()})),i&&o()})).catch((function(){e.setState({saving:!1})}))}},{key:"remove",value:function(){var e=this.state.container,t=this.props,n=t.closeEditor,r=t.reloadList,o=t.pydio;o.UI.openConfirmDialog({message:o.MessageHash["settings.35"],destructive:[e.getModel().Label],validCallback:function(){e.remove().then((function(){r(),n()}))}})}},{key:"render",value:function(){var n=this,r=this.props,o=r.closeEditor,i=r.pydio,a=r.advanced,l=r.muiTheme,s=this.state,c=s.workspace,d=s.container,p=s.newFolderKey,f=s.saving,y=s.showDialog,m=s.dialogTargetValue,h=s.PoliciesBuilder,b=s.policiesEdit,g=qe(l),v=function(e){return i.MessageHash["ajxp_admin."+e]||e},S=function(e){return i.MessageHash["settings."+e]||e},w=function(e){return i.MessageHash["advanced_settings."+e]||e},O=!c.PoliciesContextEditable,E=[];d.create||O||E.push(ze.actionButton(v("plugins.6"),"mdi mdi-undo",(function(){n.revert()}),!d.isDirty())),O||E.push(ze.actionButton(i.MessageHash[53],"mdi mdi-content-save",(function(){n.save()}),f||!(d.isDirty()&&d.isValid())));var k=Ye(this.props.muiTheme.palette),P={title:Le(Le({},k.body.block.headerFull),{},{margin:"0 -20px"}),legend:{padding:"16px 4px 8px"},section:Le({padding:"0 20px 20px",margin:10,backgroundColor:"white"},k.body.block.container),toggleDiv:{},divider:{margin:"24px -20px 0px",height:1,border:"none",backgroundColor:"rgb(236 239 241)"}},j=c.RootNodes,x=Object.keys(j).map((function(e){var r=C.rootIsTemplatePath(j[e]),o=v(r?"ws.editor.path.template":"ws.complete.folders");return t().createElement(Y,{key:j[e].Uuid,pydio:i,label:o,value:j[e].Path,isTemplatePath:r?j[e]:null,onDelete:function(){delete j[e],n.forceUpdate()},onChange:function(t,n){delete j[e],""!==t&&(j[n.Uuid]=n)},skipTemplates:d.hasFolderRoots()})}));if(!d.hasTemplatePath()){var R=this.state.newRoot,N=void 0!==R&&R;!Object.keys(j).length||N?x.push(t().createElement(Y,{key:p,pydio:i,value:"",onChange:function(e,t){t&&(j[t.Uuid]=t,n.setState({newFolderKey:Math.random(),newRoot:!1}))},skipTemplates:d.hasFolderRoots()})):x.push(t().createElement(u.FlatButton,{label:"+ "+v("ws.complete.additional"),onClick:function(){return n.setState({newRoot:!0})},primary:!0}))}var A,D,M=function(e,t){return e};if(d.create){var L,_=this.state.currentPane,I=void 0===_?"data":_,B={data:v("ws.editor.data.title"),main:v("ws.30"),other:v("ws.editor.other")};M=function(e,t){return t===I?Le(Le({},e),{},{marginTop:80}):{display:"none"}},"data"===I&&0===Object.keys(j).length&&(L=!0);var F=Ne(B,I,(function(e){"data"!==I||"main"!==e||1!==Object.keys(j).length||c.Label||(c.Label=T().getBasename(j[Object.keys(j)[0]].Path)),n.setState({currentPane:e})}),L,(function(){return n.save()}),(function(){return d.isValid()}),{back:v("ds.editor.tab.button-back"),next:v("ds.editor.tab.button-next"),save:v("ds.editor.tab.button-create")});A=F.Steps,D=F.Buttons}var V,K=t().createElement(u.Dialog,{open:y,title:v("ws.editor.sync.warning"),onRequestClose:function(){n.confirmSync(!m)},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.confirmSync(!m)}}),t().createElement(u.FlatButton,{label:v("ws.editor.sync.warning.validate"),onClick:function(){n.confirmSync(m)}})]},"enableSync"===y&&t().createElement("div",null,v("ws.editor.sync.warning.enable")),"disableSync"===y&&t().createElement("div",null,v("ws.editor.sync.warning.disable"))),W=t().createElement(u.Paper,{zDepth:0,style:M(P.section,"main")},t().createElement("div",{style:P.title},v("ws.30")),t().createElement("div",{style:P.legend},v("ws.editor.options.legend")),t().createElement(We,{fullWidth:!0,errorText:c.Label?"":v("ws.editor.label.legend"),floatingLabelText:S("8"),value:c.Label,onChange:function(e,t){c.Label=t},variant:"v2"}),t().createElement(We,{fullWidth:!0,errorText:c.Label&&!c.Slug?v("ws.editor.slug.legend"):"",floatingLabelText:v("ws.5"),value:c.Slug,onChange:function(e,t){c.Slug=t},variant:"v2"}),t().createElement(We,{fullWidth:!0,floatingLabelText:v("ws.editor.description"),value:c.Description,onChange:function(e,t){c.Description=t},variant:"v2"})),U=t().createElement(u.Paper,{zDepth:0,style:M(P.section,"data")},t().createElement("div",{style:P.title},v("ws.editor.data.title")),t().createElement("div",{style:P.legend},v("ws.editor.data.legend")),x,t().createElement("div",{style:P.legend},v("ws.editor.default_rights")),t().createElement(Ue,{fullWidth:!0,value:c.Attributes.DEFAULT_RIGHTS||"",onChange:function(e,t,n){c.Attributes.DEFAULT_RIGHTS=n},floatingLabelText:v("ws.editor.default_rights.hint"),variant:"v2"},t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.none"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.read"),value:"r"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.readwrite"),value:"rw"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.write"),value:"w"}))),q=t().createElement(u.Paper,{zDepth:0,style:M(P.section,"other")},t().createElement("div",{style:P.title},v("ws.editor.other")),t().createElement("div",{style:Le({},P.legend)},v("ws.editor.other.skiprecycle.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,De({label:v("ws.editor.other.skiprecycle"),labelPosition:"right",checked:c.Attributes.SKIP_RECYCLE,onCheck:function(e,t){c.Attributes.SKIP_RECYCLE=t}},g.toggleFieldV2))),a&&t().createElement(e.Fragment,null,t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Le({},P.legend)},v("ws.editor.other.sync.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,De({label:v("ws.editor.other.sync"),labelPosition:"right",checked:c.Attributes.ALLOW_SYNC,onCheck:function(e,t){!d.hasTemplatePath()&&t?n.enableSync(t):t?c.Attributes.ALLOW_SYNC=t:n.enableSync(t)}},g.toggleFieldV2))),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Le({},P.legend)},v("ws.editor.other.quota")),t().createElement(He,{variant:"v2",attributes:{label:"Quota"},value:c.Attributes.QUOTA||0,onChange:function(e){e>0?c.Attributes.QUOTA=e+"":(c.Attributes.QUOTA="0",delete c.Attributes.QUOTA)}}),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:Le({},P.legend)},v("ws.editor.other.layout")),t().createElement(Ue,{fullWidth:!0,floatingLabelText:v("ws.editor.other.layout"),variant:"v2",value:c.Attributes.META_LAYOUT||"",onChange:function(e,t,n){c.Attributes.META_LAYOUT=n}},t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.default"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.easy"),value:"meta.layout_sendfile"}))));return h&&(V=t().createElement(u.Paper,{zDepth:0,style:M(P.section,"policies")},t().createElement("div",{style:P.title},w("editor.visibility.workspace")),t().createElement("div",{style:Le({},P.legend)},w("editor.visibility.warning"),!b&&t().createElement("span",{style:{fontWeight:500,cursor:"pointer"},onClick:function(){return n.setState({policiesEdit:!0})}}," - ",w("editor.visibility.edit"))),t().createElement(h,{pydio:i,policies:c.Policies,onChangePolicies:function(e){return c.Policies=e},readonly:!b,showHeader:!1,forceCustom:!0,advancedLegend:t().createElement("span",null),advancedContainerStyle:b?{paddingBottom:300}:{},allowedActions:{READ:w("policies.builder.action.read"),WRITE:w("policies.builder.action.write")}}))),t().createElement(ze,{title:c.Label||S("90"),titleLeftIcon:"mdi mdi-folder-open",titleActionBar:E,closeAction:o,className:"workspace-editor",contentFill:!1},A,K,W,U,q,V,D)}}])&&Ie(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(e.Component);Ge=(0,f.muiThemeable)()(Ge);const Qe=require("pydio/model/data-model");var $e=n.n(Qe);const Xe=require("pydio/model/node");var Ze=n.n(Xe),et=c().requireLib("components").MaterialTable;const tt=i()({displayName:"WorkspaceList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf($e()).isRequired,rootNode:l().instanceOf(Ze()).isRequired,currentNode:l().instanceOf(Ze()).isRequired,openSelection:l().func,advanced:l().boolean},getInitialState:function(){return{workspaces:[],loading:!1}},startLoad:function(){this.props.onLoadState&&this.props.onLoadState(!0),this.setState({loading:!0})},endLoad:function(){this.props.onLoadState&&this.props.onLoadState(!1),this.setState({loading:!1})},reload:function(){var e=this,t=localStorage.getItem("admin.workspace.autoload");localStorage.removeItem("admin.workspace.autoload"),this.startLoad(),C.listWorkspaces().then((function(n){if(e.endLoad(),e.setState({workspaces:n.Workspaces||[]}),t){var r=n.Workspaces.filter((function(e){return e.UUID===t}));1===r.length&&e.props.openSelection(r[0])}})).catch((function(t){e.endLoad()}))},componentDidMount:function(){this.reload()},openTableRows:function(e){e.length&&this.props.openSelection(e[0].workspace)},deleteAction:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.35"],destructive:[e.Label],validCallback:function(){new C(e).remove().then((function(){t.reload()}))}})},computeTableData:function(){var e=[],t=this.props.filterString;return this.state.workspaces.map((function(n){var r="";n.RootNodes&&(r=Object.keys(n.RootNodes).map((function(e){return b().trimRight(n.RootNodes[e].Path,"/")})).join(", "));var o=!1;if(n.Attributes)try{var i=JSON.parse(n.Attributes);!0!==i.ALLOW_SYNC&&"true"!==i.ALLOW_SYNC||(o=!0)}catch(e){}if(t){var a=t.toLowerCase(),l=n.Label&&n.Label.toLowerCase().indexOf(a)>=0,s=n.Description&&n.Description.toLowerCase().indexOf(a)>=0,c=r&&r.toLowerCase().indexOf(a)>=0;if(!(l||s||c))return}e.push({workspace:n,label:n.Label,description:n.Description,slug:n.Slug,summary:r,syncable:o})})),e.sort(b().arraySorter("label",!1,!0)),e},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.editable,a=n.tableStyles,l=n.openSelection,s=function(e){return r.MessageHash["ajxp_admin."+e]},c=function(e){return r.MessageHash["settings."+e]},u=[{name:"label",label:c("8"),style:{width:"20%",fontSize:15},headerStyle:{width:"20%"},sorter:{type:"string",default:"true"}},{name:"description",label:c("103"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"summary",label:s("ws.board.summary"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}}];o&&u.push({name:"syncable",label:s("ws.board.syncable"),style:{width:"10%",textAlign:"center"},headerStyle:{width:"10%",textAlign:"center"},sorter:{type:"number",sortValue:function(e){return e.syncable?1:0}},renderCell:function(e){return t().createElement("span",{className:"mdi mdi-check",style:{fontSize:18,opacity:e.syncable?1:0}})}}),u.push({name:"slug",label:s("ws.5"),style:{width:"20%"},headerStyle:{width:"20%"},sorter:{type:"string"}});var d=this.state.loading,p=this.computeTableData(),f=[];i&&f.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit Workspace",onClick:function(e){l(e.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}});var y=r.user.getRepositoriesList();return f.push({iconClassName:"mdi mdi-open-in-new",tooltip:"Open this workspace...",onClick:function(e){r.triggerRepositoryChange(e.workspace.UUID)},disable:function(e){return!y.has(e.workspace.UUID)}}),i&&f.push({iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteAction(t.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}}),t().createElement(et,{data:p,columns:u,actions:f,onSelectRows:i?this.openTableRows.bind(this):null,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:s(d?"loading":"ws.board.empty"),masterStyles:a,paginate:[10,25,50,100],defaultPageSize:25,storageKey:"console.workspaces.list"})}});function nt(){return nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nt.apply(this,arguments)}var rt=c().requireLib("hoc").ModernTextField,ot=i()({displayName:"WsDashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf($e()).isRequired,rootNode:l().instanceOf(Ze()).isRequired,currentNode:l().instanceOf(Ze()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,accessByName:l().func.isRequired,advanced:l().boolean},getInitialState:function(){return{selectedNode:null,searchString:""}},dirtyEditor:function(){var e=this.props.pydio;return!(!this.refs.editor||!this.refs.editor.isDirty()||confirm(e.MessageHash["role_editor.19"]))},openWorkspace:function(e){var t=this;if(!this.dirtyEditor()){var n=Ge,r=p().XPathSelectSingleNode(this.props.pydio.getXmlRegistry(),'//client_configs/component_config[@component="AdminWorkspaces.Dashboard"]/editor');r&&(n=r.getAttribute("namespace")+"."+r.getAttribute("component"));var o=this.props,i=o.pydio,a=o.advanced,l=(o.accessByName,o.policiesBuilder),s={COMPONENT:n,PROPS:{ref:"editor",pydio:i,workspace:e,closeEditor:this.closeWorkspace,advanced:a,policiesBuilder:l,reloadList:function(){t.refs.workspacesList.reload()}}};return this.props.openRightPane(s),!0}},closeWorkspace:function(){this.dirtyEditor()||this.props.closeRightPane()},showWorkspaceCreator:function(e){var t=this,n=this.props,r=n.pydio,o=n.advanced,i={COMPONENT:Ge,PROPS:{ref:"editor",type:e,pydio:r,advanced:o,closeEditor:this.closeWorkspace,reloadList:function(){t.refs.workspacesList.reload()}}};this.props.openRightPane(i)},reloadWorkspaceList:function(){this.refs.workspacesList.reload()},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.currentNode,a=n.accessByName,l=n.muiTheme,s=this.state,c=s.searchString,d=s.loading,p=AdminComponents.AdminStyles(l.palette),f=[];a("Create")&&f.push(t().createElement(u.FlatButton,nt({primary:!0,label:this.context.getMessage("ws.3"),onClick:this.showWorkspaceCreator},p.props.header.flatButton)));var y=t().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},t().createElement("div",{style:{maxWidth:420,flex:1,paddingLeft:8}},t().createElement(rt,{fullWidth:!0,hintText:this.context.getMessage("ws.filter.workspaces"),value:c,onChange:function(t,n){return e.setState({searchString:n})},variant:"compact"})));return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout workspaces-board"},t().createElement(AdminComponents.Header,{title:i.getLabel(),icon:"mdi mdi-folder-open",actions:f,centerContent:y,reloadAction:this.reloadWorkspaceList,loading:d}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("ws.dashboard","ajxp_admin")}),t().createElement(u.Paper,nt({},p.body.block.props,{style:p.body.block.container}),t().createElement(tt,{ref:"workspacesList",pydio:r,openSelection:this.openWorkspace,advanced:o,editable:a("Create"),onLoadState:function(t){e.setState({loading:t})},tableStyles:p.body.tableMaster,filterString:c}))))}});const it=(0,f.muiThemeable)()(ot);function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dt(r.key),r)}}function st(e,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},st(e,t)}function ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}function dt(e){var t=function(e,t){if("object"!==at(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==at(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===at(t)?t:String(t)}var pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&st(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ut(o);if(i){var n=ut(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===at(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ct(e)}(this,e)});function l(e){var t,n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=ct(t=a.call(this)),o=void 0,(r=dt(r="data"))in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e?t.data=e:(t.data=new S.TreeNode,t.data.Type=S.TreeNodeType.constructFromObject("COLLECTION"),t.data.MetaStore={name:"",resolution:"",onDelete:"",contentType:"text/javascript"}),t}return t=l,r=[{key:"loadNodes",value:function(e){var t=new S.ConfigServiceApi(m().getRestClient());c().startLoading(),t.listVirtualNodes().then((function(t){c().endLoading();var n=[];t.Children&&t.Children.map((function(e){n.push(new l(e))})),e(n)})).catch((function(){c().endLoading()}))}}],(n=[{key:"getName",value:function(){return this.data.MetaStore.name}},{key:"setName",value:function(e){this.data.MetaStore.name=e;var t=b().computeStringSlug(e);this.data.Uuid=t,this.data.Path=t,this.notify("update")}},{key:"getValue",value:function(){return this.data.MetaStore.resolution}},{key:"setValue",value:function(e){this.data.MetaStore.resolution=e,this.notify("update")}},{key:"getOnDelete",value:function(){return this.data.MetaStore.onDelete}},{key:"setOnDelete",value:function(e){this.data.MetaStore.onDelete=e,this.notify("update")}},{key:"save",value:function(e){var t=this;te().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVirtualNode(t.data.Uuid,t.data).then((function(){e()}))}))}},{key:"remove",value:function(e){var t=this;te().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVirtualNode(t.data.Uuid).then((function(){e()}))}))}}])&&lt(t.prototype,n),r&&lt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());function ft(e){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ft(e)}function yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ft(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ft(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===ft(o)?o:String(o)),r)}var o}function mt(e,t){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mt(e,t)}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ht(e)}var bt=n(590),gt=n(880),vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mt(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ht(o);if(i){var n=ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ft(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flat";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalInvalid=!1,t.nameInvalid=!1,t.existingNames=n,e)t.model=e,e.StorageConfiguration||(e.StorageConfiguration={}),t.snapshot=JSON.parse(JSON.stringify(e));else switch(t.model=new S.ObjectDataSource,t.model.EncryptionMode=S.ObjectEncryptionMode.constructFromObject("CLEAR"),t.model.StorageType=S.ObjectStorageType.constructFromObject("LOCAL"),r){case"flat":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!0;break;case"structured":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!1;break;case"internal":t.model.StorageConfiguration={folder:"",normalize:"false",cellsInternal:"true"},t.model.FlatStorage=!0}return t.observableModel=t.buildProxy(t.model),t}return t=l,n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;if("StorageType"===n)e.StorageConfiguration={},"LOCAL"===o?e.StorageConfiguration={folder:"",normalize:"false"}:"S3"===o?e.StorageConfiguration={customEndpoint:""}:"GCS"===o&&(e.StorageConfiguration={jsonCredentials:""}),t.internalInvalid=!1,e.ApiKey=e.ApiSecret="";else if("Name"===n)o=b().computeStringSlug(o).replace("-","").substr(0,33),t.existingNames&&t.existingNames.indexOf(o)>-1?t.nameInvalid=!0:t.nameInvalid=!1;else if("folder"===n)"/"!==o[0]&&(o="/"+o);else{if("invalid"===n)return t.internalInvalid=r,t.notify("update"),!0;"PeerAddress"===n&&"ANY"===r&&(o="")}return e[n]=o,t.notify("update"),!0},get:function(e,n){var r=e[n];return r instanceof Array?r:r instanceof Object?t.buildProxy(r):"StorageType"===n?r||"LOCAL":"PeerAddress"===n?r||"ANY":r}})}},{key:"getModel",value:function(){return this.observableModel}},{key:"isValid",value:function(){return!this.internalInvalid&&!this.nameInvalid&&("S3"===this.model.StorageType||"AZURE"===this.model.StorageType?this.model.ApiKey&&this.model.ApiSecret&&this.model.Name&&(this.model.ObjectsBucket||this.model.StorageConfiguration.bucketsRegexp):"GCS"===this.model.StorageType?this.model.Name&&this.model.ObjectsBucket&&this.model.StorageConfiguration&&this.model.StorageConfiguration.jsonCredentials:this.model.Name&&this.model.StorageConfiguration&&this.model.StorageConfiguration.folder)}},{key:"getNameError",value:function(e){return this.nameInvalid?e("name.inuse"):null}},{key:"deleteSource",value:function(){return new S.ConfigServiceApi(gt.getRestClient()).deleteDataSource(this.model.Name)}},{key:"resyncSource",value:function(){var e=new S.JobsServiceApi(gt.getRestClient()),t=new S.RestUserJobRequest;return t.JobName="datasource-resync",t.JsonParameters=JSON.stringify({dsName:this.model.Name}),e.userCreateJob("datasource-resync",t)}},{key:"revert",value:function(){return this.model=this.snapshot,this.observableModel=this.buildProxy(this.model),this.snapshot=JSON.parse(JSON.stringify(this.model)),this.observableModel}},{key:"saveSource",value:function(){var e=this;return new S.ConfigServiceApi(gt.getRestClient()).putDataSource(this.model.Name,this.model).then((function(t){e.snapshot=JSON.parse(JSON.stringify(e.model)),e.notify("update")}))}},{key:"stripPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return e;var n={};return Object.keys(e).map((function(r){n[r.replace(t,"")]=e[r]})),n}},{key:"getDataWithPrefix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.model;var n={};return Object.keys(this.model).forEach((function(r){n[t+r]=e.model[r],"EncryptionMode"!==r||e.model[r]||(n[t+r]="CLEAR")})),n}}],r=[{key:"loadDatasources",value:function(){return new S.ConfigServiceApi(gt.getRestClient()).listDataSources()}},{key:"loadVersioningPolicies",value:function(){return new S.ConfigServiceApi(gt.getRestClient()).listVersioningPolicies()}},{key:"loadStatuses",value:function(){return new S.ConfigServiceApi(gt.getRestClient()).listServices("STARTED")}},{key:"loadEncryptionKeys",value:function(){return new S.ConfigServiceApi(gt.getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest)}},{key:"loadBuckets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new S.ConfigServiceApi(gt.getRestClient()),r=new S.RestListStorageBucketsRequest;return r.DataSource=e,t&&(r.BucketsRegexp=t),n.listStorageBuckets(r)}},{key:"createBucket",value:function(e,t){var n=new S.ConfigServiceApi(gt.getRestClient()),r=new S.RestCreateStorageBucketRequest;return r.DataSource=e,n.createStorageBucket(t,r)}}],n&&yt(t.prototype,n),r&&yt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(bt);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==St(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===St(o)?o:String(o)),r)}var o}function Ot(e,t){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ot(e,t)}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}var kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ot(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Et(o);if(i){var n=Et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===St(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=a.call(this,e);var n=e.node.getValue(),r=!1;return n||(n='// Compute the Path variable that this node must resolve to. \n// Use Ctrl+Space to see the objects available for completion.\nPath = "";',r=!0),t.state={value:n,cleanOnDelete:"rename-uuid"===e.node.getOnDelete(),dirty:r},t}return n=l,(r=[{key:"onChange",value:function(e,t){this.setState({value:t,dirty:!0})}},{key:"save",value:function(){var e=this,t=this.props,n=t.node,r=t.onSave,o=void 0===r?function(){}:r,i=this.state,a=i.value,l=i.cleanOnDelete;n.setValue(a),l?n.setOnDelete("rename-uuid"):n.setOnDelete(""),n.save((function(){e.setState({dirty:!1},o)}))}},{key:"remove",value:function(){var e=this;this.props.node.remove((function(){e.props.reloadList()}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.pydio,o=n.dataSources,i=n.readonly,a=n.oneLiner,l=n.onClose,s=void 0===l?function(){}:l,c=this.state,d=c.value,p=c.dirty,f=c.cleanOnDelete,y=function(e){return r.MessageHash["ajxp_admin.virtual."+e]||e},m={};o&&o.map((function(e){m[e.Name]=e.Name}));var h={Path:"",DataSources:m,User:{Name:"",Uuid:"",GroupPath:"",GroupFlat:"",Profile:"",DisplayName:"",Email:"",AuthSource:"",Roles:[]}},b=t().createElement(AdminComponents.CodeMirrorField,{mode:"javascript",globalScope:h,value:d,onChange:this.onChange.bind(this),readOnly:i}),g=y("card.cleanOnDelete"),v=d&&d.indexOf("User.Name")>=0;return v?f||(g=t().createElement("span",null,g," ",t().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-on"))):g=t().createElement("span",null,g," ",t().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-off")),a?t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1,lineHeight:"40px"}},b),t().createElement("div",{style:{display:"flex"}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-content-save",onClick:this.save.bind(this),disabled:!p,tooltip:"Save"}),t().createElement(u.IconButton,{iconClassName:"mdi mdi-close",onClick:function(){return s()},tooltip:"Close"}))):t().createElement("div",{style:{backgroundColor:"#f5f5f5",paddingBottom:12}},t().createElement("div",{style:{padding:i?"16px 24px 8px":"10px 24px 0",fontWeight:500,display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1}},y("card.title")),!i&&t().createElement(u.FlatButton,{onClick:this.save.bind(this),primary:!0,disabled:!p,label:y("save")})),t().createElement("div",{style:{margin:"6px 24px 0 24px",border:"1px solid #e0e0e0"}},b),t().createElement("div",{style:{margin:"12px 24px",opacity:v?1:.4}},t().createElement(u.Checkbox,{disabled:i,checked:f,onCheck:function(t,n){e.setState({cleanOnDelete:n,dirty:!0})},label:g})))}}])&&wt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function Pt(){return Pt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pt.apply(this,arguments)}function jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ct(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ct(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Ct(o)?o:String(o)),r)}var o}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tt(e,t)}function Rt(e){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Rt(e)}var Nt=c().requireLib("hoc").ModernTextField,At=c().requireLib("components").MaterialTable,Dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Rt(o);if(i){var n=Rt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ct(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={nodesLoaded:!1,nodes:[],dataSourcesLoaded:!1,dataSources:[]},pt.loadNodes((function(e){t.setState({nodes:e,nodesLoaded:!0})})),vt.loadDatasources().then((function(e){t.setState({dataSources:e.DataSources,dataSourcesLoaded:!0})})),t}return n=l,(r=[{key:"reload",value:function(){var e=this;this.setState({nodesLoaded:!1}),pt.loadNodes((function(t){e.setState({nodes:t,nodesLoaded:!0})}))}},{key:"createNode",value:function(){this.handleRequestClose();var e,t=this.state,n=t.newName,r=t.nodes,o=new pt;o.setName(n),this.setState({nodes:[].concat((e=r,function(e){if(Array.isArray(e))return jt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return jt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[o]),selectedNode:n,newName:null})}},{key:"handleTouchTap",value:function(e){var t=this;e.preventDefault(),this.setState({newName:"",open:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newNode&&t.refs.newNode.focus()}),300)}))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this,n=this.props,r=n.readonly,o=n.pydio,i=n.muiTheme,a=n.accessByName,l=this.state,s=l.nodes,c=l.dataSources,d=l.nodesLoaded,p=l.dataSourcesLoaded,f=l.selectedNode,y=function(e){return o.MessageHash["ajxp_admin.virtual."+e]||e},m=AdminComponents.AdminStyles(i.palette),h=s.map((function(n){return n.getName()===f?{node:n,expandedRow:t().createElement(kt,{pydio:o,dataSources:c,node:n,reloadList:e.reload.bind(e),readonly:r||!a("Create"),adminStyles:m,onSave:e.reload.bind(e)})}:{node:n}})),b=[];!r&&a("Create")&&b.push(t().createElement(u.FlatButton,Pt({primary:!0,label:y("create"),onClick:this.handleTouchTap.bind(this)},m.props.header.flatButton)));var g=[{name:"id",label:y("col.id"),style:{width:"25%",fontSize:15},headerStyle:{width:"25%"},renderCell:function(e){return e.node.getName()},sorter:{type:"string"}},{name:"code",label:y("col.code"),renderCell:function(e){return t().createElement("pre",null,e.node.getValue().split("\n").pop())}}],v=[];return r?v.push({iconClassName:"mdi mdi-eye",tooltip:y("code.display"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}):(v.push({iconClassName:"mdi mdi-pencil",tooltip:y("code.edit"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}),v.push({iconClassName:"mdi mdi-delete",tooltip:y("delete"),onClick:function(t){o.UI.openConfirmDialog({message:y("delete.confirm"),destructive:[t.node.getName()],validCallback:function(){t.node.remove((function(){e.reload()}))}})},disable:function(e){return"cells"===e.node.getName()||"my-files"===e.node.getName()}})),t().createElement("div",{className:"vertical-layout workspaces-list layout-fill",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:y("title"),icon:"mdi mdi-help-network",actions:b,reloadAction:this.reload.bind(this),loading:!(d&&p)}),t().createElement(u.Popover,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{margin:"0 10px"}},t().createElement(Nt,{ref:"newNode",floatingLabelText:y("label"),value:this.state.newName,onChange:function(t,n){e.setState({newName:n})},hintText:y("label.new")})),t().createElement(u.Divider,null),t().createElement("div",{style:{textAlign:"right",padding:"4px 10px"}},t().createElement(u.FlatButton,{label:o.MessageHash[54],onClick:this.handleRequestClose.bind(this)}),t().createElement(u.RaisedButton,{primary:!0,label:y("create.button"),onClick:this.createNode.bind(this)}))),t().createElement("div",{className:"layout-fill",style:{overflowY:"auto"}},t().createElement("div",{style:{padding:20,paddingBottom:0}},y("legend.1")),d&&p&&t().createElement(u.Paper,Pt({},m.body.block.props,{style:m.body.block.container}),t().createElement(At,{columns:g,data:h,actions:v,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:m.body.tableMaster,storageKey:"console.templatepaths.list"})),(!d||!p)&&t().createElement("div",{style:{margin:16,textAlign:"center",padding:20}},o.MessageHash["ajxp_admin.loading"]),!r&&a("Create")&&t().createElement("div",{style:{padding:"0 24px",opacity:".5"}},y("legend.2"))))}}])&&xt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Mt(e){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(e)}function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){It(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function It(e,t,n){return(t=Ut(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bt(e){return function(e){if(Array.isArray(e))return Ft(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ft(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ut(r.key),r)}}function Wt(e,t,n){return t&&Kt(e.prototype,t),n&&Kt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ut(e){var t=function(e,t){if("object"!==Mt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Mt(t)?t:String(t)}function qt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ht(e,t)}function Ht(e,t){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ht(e,t)}function Jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Yt(e);if(t){var o=Yt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Mt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zt(e)}(this,n)}}function zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yt(e){return Yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Yt(e)}Dt=(0,f.muiThemeable)()(Dt);var Gt=c().requireLib("hoc"),Qt=Gt.ModernTextField,$t=Gt.ModernSelectField,Xt=Gt.ModernAutoComplete,Zt=function(e){qt(r,e);var n=Jt(r);function r(e){var t;return Vt(this,r),(t=n.call(this,e)).debounced=j()(t.loadValues.bind(zt(t)),300),t.state={searchText:e.value,value:e.value},t}return Wt(r,[{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({searchText:e})}},{key:"handleNewRequest",value:function(e){var t,n=this.state.nodes,r=!1;if(void 0===e.key){t="/"+b().trim(e,"/");var o=!1;n.map((function(e){e.Path!==t&&0!==e.Path.indexOf(t+"/")||(o=!0)})),o&&(r=!0)}else t=e.key,r=!0;this.setState({value:t,exist:r}),this.props.onChange(t,r),this.loadValues(t)}},{key:"componentWillMount",value:function(){this.lastSearch=null;var e="";this.props.value&&(e=this.props.value),this.loadValues(e)}},{key:"componentWillReceiveProps",value:function(e){e.value&&e.value!==this.state.value&&this.setState({value:e.value,exist:!0})}},{key:"loadValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props.peerAddress,r=this.state.searchText,o=t;if(!t&&r){var i=r.lastIndexOf("/");o=r.substr(0,i)}if(null!==this.lastSearch&&this.lastSearch===o)return Promise.resolve();this.lastSearch=o;var a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestListPeerFoldersRequest;return l.PeerAddress="ANY"===n?"":n,l.Path=o,this.setState({loading:!0}),a.listPeerFolders(n,l).then((function(t){var n=t.Children||[];n=n.map((function(e){return"/"!==e.Path[0]&&(e.Path="/"+e.Path),e})),e.setState({nodes:n,loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"createFolder",value:function(e){var t=this,n=this.props,r=n.peerAddress,o=n.pydio,i=this.state.value,a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestCreatePeerFolderRequest;l.PeerAddress="ANY"===r?"":r,l.Path=i+"/"+e,a.createPeerFolder(r,l).then((function(e){t.lastSearch=null,t.loadValues(i).then((function(){t.handleNewRequest({key:l.Path}),t.setState({searchText:l.Path})}))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}},{key:"renderNode",value:function(e){var n=T().getBasename(e.Path),r=T().getDirname(e.Path),o=t().createElement("span",null,e.Path);return b().computeStringSlug(n)!==n?o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#c62828"}},n)):e.MetaStore&&e.MetaStore.symlink&&(o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#1976d2"}},n))),{key:e.Path,text:e.Path,invalid:!1,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:"mdi mdi-folder",color:"#616161",style:{float:"left",marginRight:8}})," ",o)}}},{key:"showCreateDialog",value:function(){var e=this,t=this.props.pydio,n=this.state.value,r=function(e){return t.MessageHash["ajxp_admin.ds.editor.selector."+e]||e};t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:r("mkdir"),legendId:r("mkdir.legend").replace("%s",n),fieldLabelId:r("mkdir.field"),submitValue:function(t){t&&e.createFolder(t)}})}},{key:"render",value:function(){var e=this,n=this.state,r=n.nodes,o=n.loading,i=n.exist,a=n.value,l=n.searchText,s=this.props,c=s.fieldLabel,d=s.pydio,p=[];r&&r.forEach((function(t){p.push(e.renderNode(t))}));var f=l||a;return t().createElement("div",{style:{position:"relative",marginTop:-5}},t().createElement("div",{style:{position:"absolute",right:6,top:29,width:30,zIndex:1}},t().createElement(u.RefreshIndicator,{size:25,left:0,top:0,status:o?"loading":"hide"})),a&&i&&!o&&(!l||l===a)&&t().createElement("div",{style:{position:"absolute",right:0,zIndex:1,top:18}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-folder-plus",iconStyle:{color:"#9e9e9e"},onClick:function(){return e.showCreateDialog()},tooltip:d.MessageHash["ajxp_admin.ds.editor.selector.mkdir"],tooltipPosition:"top-center"})),t().createElement(Xt,{fullWidth:!0,searchText:f,onUpdateInput:this.handleUpdateInput.bind(this),onNewRequest:this.handleNewRequest.bind(this),dataSource:p,hintText:c,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,menuProps:{maxHeight:200}}))}}]),r}(t().Component),en=function(e){qt(r,e);var n=Jt(r);function r(e){var t;return Vt(this,r),(t=n.call(this,e)).state={peerAddresses:[],invalid:!1,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.editor."+t]||t}},t}return Wt(r,[{key:"compareAddresses",value:function(e,t){var n=e.split("|"),r=t.split("|");return r.filter((function(e){return n.indexOf(e)>-1})).length||n.filter((function(e){return r.indexOf(e)>-1})).length}},{key:"componentDidMount",value:function(){var e=this,t=this.props.model;new S.ConfigServiceApi(m().getRestClient()).listPeersAddresses().then((function(n){var r=n.PeerAddresses||[];if(1!==r||t.PeerAddress||(t.PeerAddress=r[0]),e.setState({peerAddresses:r}),t.PeerAddress&&-1===r.indexOf(t.PeerAddress)){var o=r.filter((function(n){return e.compareAddresses(n,t.PeerAddress)}));o.length?t.PeerAddress=o[0]:e.setState({invalidAddress:t.PeerAddress})}}))}},{key:"baseIsInvalid",value:function(e){var t=this.state.m,n=!1,r=T().getBasename(e);return b().trim(e,"/").split("/").length<2?n=t("selector.error.depth"):b().computeStringSlug(r)!==r&&(n=t("selector.error.dnsname")),n}},{key:"onPathChange",value:function(e,t){var n=this.props.model,r=this.baseIsInvalid(e);n.invalid=r,n.StorageConfiguration.folder=e,t?void 0!==n.StorageConfiguration.create&&delete n.StorageConfiguration.create:n.StorageConfiguration.create="true",this.setState({invalid:r})}},{key:"onPeerChange",value:function(e){var t=this.props.model,n=this.state.invalidAddress;e!==n&&(t.PeerAddress=e,n&&this.setState({invalidAddress:null}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.model,o=n.pydio,i=n.styles,a=this.state,l=a.peerAddresses,s=a.invalidAddress,c=a.invalid,d=a.m,p=Bt(l);return p=["ANY"].concat(Bt(p)),s&&"ANY"!==s&&(p=[s].concat(Bt(p))),t().createElement("div",null,t().createElement("div",{style:{paddingBottom:8}},t().createElement("div",{style:i.subLegend},d("storage.legend.fs.peer")),t().createElement($t,{value:r.PeerAddress||"",variant:"v2",hintText:d("selector.peer")+" *",onChange:function(t,n,r){return e.onPeerChange(r)},fullWidth:!0},p.map((function(e){var n=d("selector.peer.any");return"ANY"!==e&&(n=d("selector.peer.word")+" : "+e.replace("|"," | ")+(e===s?" ("+d("selector.peer.invalid")+")":"")),t().createElement(u.MenuItem,{value:e,primaryText:n})})))),t().createElement("div",null,t().createElement("div",{style:_t(_t({},i.subLegend),{},{paddingBottom:6})},d("storage.legend.fs.path")),r.PeerAddress&&t().createElement(Zt,{pydio:o,value:r.StorageConfiguration.folder,peerAddress:r.PeerAddress,onChange:this.onPathChange.bind(this),fieldLabel:d("selector.completer")+(r.StorageConfiguration.create?" ("+d("selector.completer.create")+")":"")+" *",hintText:d("selector.completer.hint")}),!r.PeerAddress&&t().createElement(Qt,{style:{marginTop:-3},fullWidth:!0,variant:"v2",disabled:!0,value:r.StorageConfiguration.folder,floatingLabelText:d("selector.folder")+" *",hintText:d("selector.folder.hint")})),c&&t().createElement("div",{style:{color:"#c62828"}},c))}}]),r}(t().Component);const tn=require("pydio/util/dom");var nn=n.n(tn);function rn(e){return rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(e)}function on(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==rn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==rn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===rn(o)?o:String(o)),r)}var o}function ln(e,t,n){return t&&an(e.prototype,t),n&&an(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function sn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cn(e,t)}function cn(e,t){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cn(e,t)}function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=dn(e);if(t){var o=dn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===rn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function dn(e){return dn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dn(e)}var pn=function(e){sn(r,e);var n=un(r);function r(){return on(this,r),n.apply(this,arguments)}return ln(r,[{key:"render",value:function(){var e=this.props,n=e.onSelect,r=e.selected,o=e.value,i=e.primaryText,a=e.image,l={cont:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"10px 10px 0 10px",backgroundColor:"transparent",borderBottom:"2px solid transparent",transition:nn().getBeziersTransition()},image:{width:30,height:30,opacity:.3,transition:nn().getBeziersTransition()},label:{margin:5,marginTop:8,fontSize:11,fontWeight:500,color:"rgba(0,0,0,.3)",textAlign:"center",transition:nn().getBeziersTransition()}};return r&&(l.cont.borderBottom="2px solid #0e4d6d",l.image.opacity=1,l.label.color="#0e4d6d"),t().createElement("div",{zDepth:0,style:l.cont,onClick:function(e){n(o)},rounded:!1},a&&t().createElement("img",{style:l.image,src:"/plug/access.settings/res/images/"+a}),t().createElement("div",{style:l.label},i))}}]),r}(t().Component),fn=function(e){sn(r,e);var n=un(r);function r(e){return on(this,r),n.call(this,e)}return ln(r,[{key:"onChange",value:function(e){var t=this.props,n=t.values;(0,t.onChange)(null,Object.keys(n).indexOf(e),e)}},{key:"render",value:function(){var e=this,n=this.props,r=n.values,o=n.value,i=n.disabled;return t().createElement("div",{style:{display:"flex",padding:"0 1px",backgroundColor:"rgb(251, 251, 252)"}},Object.keys(r).map((function(n){return t().createElement(pn,{value:n,selected:n===o,onSelect:i?function(){}:e.onChange.bind(e),primaryText:r[n].primaryText,image:r[n].image})})))}}]),r}(t().Component);const yn=require("lodash");function mn(e){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(e)}function hn(){return hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hn.apply(this,arguments)}function bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==mn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==mn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===mn(o)?o:String(o)),r)}var o}function vn(e,t){return vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vn(e,t)}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}var wn=c().requireLib("hoc").ModernTextField,On=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vn(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Sn(o);if(i){var n=Sn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===mn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={buckets:[],selection:[],mode:t.modeFromValue(),monitorApi:e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret},e.dataSource.ObjectsBucket&&(t.state.selection=[e.dataSource.ObjectsBucket]),t.load(),t.loadSelection(),t.reloadSelection=(0,yn.debounce)((function(){t.loadSelection()}),500),t.loadDebounced=(0,yn.debounce)((function(){t.load()}),500),t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e){var t=e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret;t!==this.state.monitorApi&&(this.loadDebounced(),this.setState({monitorApi:t}))}},{key:"load",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?(this.setState({loading:!0}),vt.loadBuckets(t).then((function(t){var n=t.Children||[];e.setState({buckets:n.map((function(e){return e.Path})),loading:!1})})).catch((function(t){e.setState({buckets:[],loading:!1})}))):this.setState({buckets:[]})}},{key:"createBucket",value:function(){var e=this,t=this.props.dataSource,n=this.state.createBucket;this.setState({loading:!0}),vt.createBucket(t,n).then((function(){e.setState({create:!1,createBucket:""}),e.load()})).catch((function(t){e.setState({loading:!1})}))}},{key:"loadSelection",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?t.ObjectsBucket?this.setState({selection:[t.ObjectsBucket]}):(this.setState({selection:[]}),t.StorageConfiguration.bucketsRegexp&&vt.loadBuckets(t,t.StorageConfiguration.bucketsRegexp).then((function(t){var n=t.Children||[];e.setState({selection:n.map((function(e){return e.Path}))})}))):this.setState({selection:[]})}},{key:"modeFromValue",value:function(){var e="picker";return this.props.dataSource.StorageConfiguration.bucketsRegexp&&(e="regexp"),e}},{key:"toggleMode",value:function(){var e=this.state.mode,t=this.props.dataSource;"picker"===e?(t.ObjectsBucket&&(t.StorageConfiguration.bucketsRegexp=t.ObjectsBucket,t.ObjectsBucket="",this.reloadSelection()),this.setState({mode:"regexp"})):(t.StorageConfiguration.bucketsRegexp="",this.reloadSelection(),this.setState({mode:"picker"}))}},{key:"togglePicker",value:function(e){var t,n=this.props.dataSource,r=this.state.selection,o=[],i=r.indexOf(e);1===(o=-1===i?[].concat((t=r,function(e){if(Array.isArray(e))return bn(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return bn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bn(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[e]):b().arrayWithout(r,i)).length?(n.ObjectsBucket=o[0],n.StorageConfiguration.bucketsRegexp=""):(n.ObjectsBucket="",n.StorageConfiguration.bucketsRegexp=o.map((function(e){return"^"+e+"$"})).join("|")),this.setState({selection:o})}},{key:"updateRegexp",value:function(e){this.props.dataSource.StorageConfiguration.bucketsRegexp=e,this.reloadSelection()}},{key:"render",value:function(){var e=this,n=this.props.dataSource,r=this.state,o=r.buckets,i=r.selection,a=r.mode,l=r.loading,s=r.create,d=r.createBucket,p=void 0===d?"":d,f=c().getInstance().MessageHash,y=function(e){return f["ajxp_admin.ds.editor.storage."+e]||e},m={style:{width:30,height:30,padding:5},iconStyle:{width:20,height:20,color:"rgba(0,0,0,.5)",fontSize:18}},h=!n.ApiKey||!n.ApiSecret;return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginTop:20}},t().createElement("div",null,y("buckets.legend")),t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginRight:s?30:0}},s&&t().createElement("div",{style:{width:200,height:36}},t().createElement(wn,{hintText:y("buckets.create.hint"),fullWidth:!0,value:p,onChange:function(t,n){e.setState({createBucket:b().computeStringSlug(n)})}})),t().createElement(u.IconButton,hn({iconClassName:s?"mdi mdi-check":"mdi mdi-plus-circle",tooltip:y("buckets.create"),tooltipPosition:"top-left",onClick:function(){s?e.createBucket():e.setState({create:!0})},disabled:h},m)),s&&t().createElement(u.IconButton,hn({iconClassName:"mdi mdi-close",tooltip:f[54],tooltipPosition:"top-left",onClick:function(){return e.setState({create:!1,createBucket:""})},disabled:h},m))),t().createElement("div",{style:{display:"flex",alignItems:"flex-end"}},"regexp"===a&&t().createElement("div",{style:{width:200,height:36}},t().createElement(wn,{hintText:y("buckets.regexp.hint"),fullWidth:!0,value:n.StorageConfiguration.bucketsRegexp||"",onChange:function(t,n){e.updateRegexp(n)}})),t().createElement(u.IconButton,hn({iconClassName:"mdi mdi-filter",tooltip:"picker"===a?y("buckets.regexp"):"",tooltipPosition:"top-left",onClick:function(){e.toggleMode()},disabled:h},m))),t().createElement(u.IconButton,hn({iconClassName:"mdi mdi-reload",tooltip:y("buckets.reload"),tooltipPosition:"top-left",onClick:function(){e.load()},disabled:h},m))),t().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginTop:8,backgroundColor:"rgb(246 246 248)",borderRadius:"4px 4px 0 0",borderBottom:"1px solid #e0e0e0",minHeight:52,padding:2,maxHeight:275,overflowY:"auto"}},o.map((function(r){var o=-1!==i.indexOf(r),l={};return"picker"===a?l.onClick=function(){e.togglePicker(r)}:n.StorageConfiguration.bucketsRegexp||(l.onClick=function(){e.toggleMode(),e.togglePicker(r)}),t().createElement("div",{style:{margin:5}},t().createElement(u.Chip,hn({},l,{backgroundColor:o?"#03a9f4":null}),r))})),0===o.length&&t().createElement("div",{style:{paddingLeft:5,textAlign:"center",fontSize:12,color:"rgba(0,0,0,.3)"}},y(h?"buckets.cont.nokeys":l?"buckets.cont.loading":"buckets.cont.empty"))))}}])&&gn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function En(e){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(e)}function kn(){return kn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kn.apply(this,arguments)}function Cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cn(Object(n),!0).forEach((function(t){jn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jn(e,t,n){return(t=Tn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tn(r.key),r)}}function Tn(e){var t=function(e,t){if("object"!==En(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==En(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===En(t)?t:String(t)}function Rn(e,t){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rn(e,t)}function Nn(e){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nn(e)}var An=AdminComponents,Dn=An.PaperEditorLayout,Mn=An.AdminStyles,Ln=c().requireLib("hoc"),_n=Ln.ModernTextField,In=Ln.ModernSelectField,Bn=Ln.ThemedModernStyles,Fn=["main","storage","data","advanced"],Vn=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rn(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Nn(i);if(a){var n=Nn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===En(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.pydio,r=e.create,o=e.dataSource,i=e.existingNames,a=e.createStructure,c=new vt(o,i,a),u=c.getModel().StorageConfiguration||{},d=u.customEndpoint?"custom":"aws";return"custom"===d&&u.minioServer&&(d="minio"),t.state={dirty:!1,create:r,observable:c,model:c.getModel(),loaded:!1,valid:c.isValid(),encryptionKeys:[],versioningPolicies:[],s3Custom:d,m:function(e){return n.MessageHash["ajxp_admin.ds.editor."+e]||e}},vt.loadEncryptionKeys().then((function(e){t.setState({encryptionKeys:e.Keys||[]})})),vt.loadVersioningPolicies().then((function(e){t.setState({versioningPolicies:e.Policies||[]})})),t}return r=s,o=[{key:"componentWillReceiveProps",value:function(e){if(e.dataSource&&this.state.model.Name!==e.dataSource.Name)if(this.state.dirty)alert(this.props.pydio.MessageHash["role_editor.19"]);else{var t=new vt(e.dataSource);this.setState({observable:t,model:t.getModel()})}e.create&&this.state.create!==e.create&&this.setState({create:e.create})}},{key:"componentDidMount",value:function(){var e=this;this.state.observable.observe("update",(function(){e.setState({dirty:!0}),e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.observable.stopObserving("update")}},{key:"resetForm",value:function(){var e=this,t=this.state.observable.revert();this.setState({valid:!0,dirty:!1,model:t},(function(){e.forceUpdate()}))}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.observable;this.props.pydio.UI.openConfirmDialog({message:n("delete.warning"),validCallback:function(){r.deleteSource().then((function(){e.props.closeEditor(),e.props.reloadList()}))},destructive:[r.getModel().Name]})}},{key:"saveSource",value:function(){var e=this,t=this.state,n=t.observable,r=t.create;this.state.observable.saveSource().then((function(){var t=null;r&&(t=n.getModel().Name),e.setState({valid:!0,dirty:!1,create:!1}),r&&e.props.closeEditor(),e.props.reloadList(t)}))}},{key:"launchResync",value:function(){this.state.observable.resyncSource()}},{key:"toggleEncryption",value:function(e){var t=this.state.model;"VALUE_CREATE"===e?this.setState({showDialog:"enableEncryptionWithCreate",dialogTargetValue:e,newKeyName:t.Name||""}):"VALUE_CLEAR"===e?this.setState({showDialog:"disableEncryption",dialogTargetValue:e}):"MASTER"!==t.EncryptionMode?this.setState({showDialog:"enableEncryption",dialogTargetValue:e}):t.EncryptionKey=e}},{key:"confirmEncryption",value:function(e){var t=this,n=this.state,r=n.model,o=n.newKeyName;if("VALUE_CREATE"===e){var i=new S.ConfigServiceApi(m().getRestClient()),a=new S.EncryptionAdminCreateKeyRequest;return a.KeyID=o,a.Label=o,void i.createEncryptionKey(a).then((function(e){r.EncryptionMode="MASTER",r.EncryptionKey=o,t.setState({showDialog:!1,dialogTargetValue:null,encryptionKeys:[{ID:o,Label:o}]})})).catch((function(){}))}"VALUE_CLEAR"===e?(r.EncryptionMode="CLEAR",r.EncryptionKey=""):(r.EncryptionMode="MASTER",r.EncryptionKey=e),this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"toggleS3Custom",value:function(e){var t=this.state.model;"aws"===e?(t.StorageConfiguration.customEndpoint="",t.StorageConfiguration.customRegion="",t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion=""):"minio"===e?(t.StorageConfiguration.minioServer="true",t.StorageConfiguration.signatureVersion="v4"):(t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion="v4"),this.setState({s3Custom:e})}},{key:"stepperBack",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Fn.indexOf(t);n>0&&this.setState({currentPane:Fn[n-1]})}},{key:"stepperNext",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Fn.indexOf(t);n<Fn.length-1&&this.setState({currentPane:Fn[n+1]})}},{key:"render",value:function(){var n=this,r=this.props,o=r.storageTypes,i=r.pydio,a=r.readonly,l=r.muiTheme,s=this.state,c=s.currentPane,d=void 0===c?"main":c,p=s.model,f=s.create,y=s.observable,m=s.encryptionKeys,h=s.versioningPolicies,b=s.showDialog,g=s.dialogTargetValue,v=s.newKeyName,S=s.s3Custom,w=s.m,O=Bn(l),E=[];a||f||(E.push(t().createElement(u.Toggle,{style:{borderRight:"1px solid #e0e0e0",paddingRight:14,zoom:.8},labelStyle:{fontSize:17},toggled:!p.Disabled,onToggle:function(e,t){p.Disabled=!t},labelPosition:"right",label:w("options.enabled")})),E.push(Dn.actionButton(this.context.getMessage("plugins.6"),"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty)),E.push(Dn.actionButton(this.context.getMessage("plugins.5"),"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.dirty)));var k=p.Name?w("title").replace("%s",p.Name):w("new"),C=p.StorageConfiguration,P=Mn(this.props.muiTheme.palette),j={title:Pn(Pn({},P.body.block.headerFull),{},{margin:"0 -20px"}),legend:{},subLegend:{padding:"10px 6px 0 4px",fontSize:12,lineHeight:"16px",color:"rgba(0,0,0,0.6)",textAlign:"justify"},section:Pn({padding:"0 20px 20px",margin:10,backgroundColor:"white"},P.body.block.container),storageSection:{padding:20,marginTop:-1}},x={LOCAL:{primaryText:this.context.getMessage("ds.storage.fs","ajxp_admin"),image:"fs.png"},S3:{primaryText:this.context.getMessage("ds.storage.s3","ajxp_admin"),image:"s3-compat.png"},AZURE:{primaryText:this.context.getMessage("ds.storage.azure","ajxp_admin"),image:"azure.png"},GCS:{primaryText:this.context.getMessage("ds.storage.gcs","ajxp_admin"),image:"gcs.png"}},T={};o.forEach((function(e){T[e]=x[e]})),p.StorageType&&!T[p.StorageType]&&(T[p.StorageType]=x[p.StorageType]);var R,N,A=function(e,t){return t===d?e:Pn(Pn({},e),{},{display:"none"})};if(f){var D={main:w("tab.identifier"),storage:w("tab.storage"),data:w("tab.lifecycle"),advanced:w("tab.advanced")},M=!1;("main"!==d||p.Name&&!y.getNameError(w))&&("storage"!==d||y.isValid())||(M=!0);var L=Ne(D,d,(function(e){return n.setState({currentPane:e})}),M,(function(){return n.saveSource()}),(function(){return y.isValid()}),{back:w("tab.button-back"),next:w("tab.button-next"),save:w("tab.button-create")});R=L.Steps,N=L.Buttons}var _=t().createElement(u.Dialog,{open:b,title:w("enc.warning"),onRequestClose:function(){n.setState({showDialog:!1,dialogTargetValue:null})},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.setState({showDialog:!1,dialogTargetValue:null})}}),t().createElement(u.FlatButton,{label:w("enc.validate"),disabled:"enableEncryptionWithCreate"===b&&!v,onClick:function(){n.confirmEncryption(g)}})]},("enableEncryption"===b||"enableEncryptionWithCreate"===b)&&t().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.enable.1"),"",w("enc.dialog.enable.2")," ",t().createElement("b",{style:{fontWeight:500}},w("enc.dialog.enable.2bold")),t().createElement("br",null),w("enc.dialog.enable.3"),"enableEncryptionWithCreate"===b&&t().createElement("div",null,t().createElement(_n,{hintText:w("enc.dialog.enable.create"),fullWidth:!0,variant:"v2",value:v,onChange:function(e,t){n.setState({newKeyName:t})}}))),"disableEncryption"===b&&t().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.disable"))),I=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"main")},t().createElement("div",{style:Pn(Pn({},j.title),{},{marginBottom:16})},w("options")),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("options.id")+" *",disabled:!f,value:p.Name,onChange:function(e,t){p.Name=t},errorText:y.getNameError(w)})),B=t().createElement(u.Paper,{zDepth:0,style:A(Pn(Pn({},j.section),{},{padding:0,marginBottom:f?200:null}),f?"storage":"main")},t().createElement(fn,{disabled:!f,value:p.StorageType,onChange:function(e,t,n){p.StorageType=n},values:T}),"LOCAL"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.fs")),t().createElement(en,{model:p,pydio:this.props.pydio,styles:j}),!p.FlatStorage&&t().createElement("div",null,t().createElement(u.Checkbox,kn({labelPosition:"right",label:w("storage.fs.macos"),checked:"true"===C.normalize,onCheck:function(e,t){C.normalize=t?"true":"false"}},O.toggleFieldV2)))),"S3"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.s3")),t().createElement(In,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint.type"),value:S,onChange:function(e,t,r){n.toggleS3Custom(r)}},t().createElement(u.MenuItem,{value:"aws",primaryText:w("storage.s3.endpoint.amazon")}),t().createElement(u.MenuItem,{value:"minio",primaryText:w("storage.s3.endpoint.minio")}),t().createElement(u.MenuItem,{value:"custom",primaryText:w("storage.s3.endpoint.custom")})),("custom"===S||"minio"===S)&&t().createElement("div",null,t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint")+" - "+w("storage.s3.endpoint.hint"),value:p.StorageConfiguration.customEndpoint,onChange:function(e,t){p.StorageConfiguration.customEndpoint=t}}),t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:3,marginRight:5}},t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.region"),value:p.StorageConfiguration.customRegion,onChange:function(e,t){p.StorageConfiguration.customRegion=t}})),t().createElement("div",{style:{flex:1}},t().createElement(In,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.signatureVersion"),value:p.StorageConfiguration.signatureVersion,onChange:function(e,t,n){p.StorageConfiguration.signatureVersion=n}},t().createElement(u.MenuItem,{value:"v4",primaryText:"v4"}),t().createElement(u.MenuItem,{value:"v2",primaryText:"v2"}))))),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement("form",{autoComplete:"off"},t().createElement("input",{type:"hidden",value:"something"}),t().createElement(_n,{autoComplete:"off",fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.s3.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),t().createElement(On,{dataSource:p,hintText:w("storage.s3.bucket")}),p.ObjectsBucket&&t().createElement("div",{style:{paddingTop:20}},t().createElement("div",{style:Pn({},j.subLegend)},w("storage.s3.legend.bucketPathPrefix")),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.bucketPathPrefix"),value:p.ObjectsBaseFolder||"",onChange:function(e,t){p.ObjectsBaseFolder=t}})),(p.ObjectsBucket||p.StorageConfiguration.bucketsRegexp)&&t().createElement(t().Fragment,null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.storageClass")),t().createElement("div",null,t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.storageClass"),value:p.StorageConfiguration.storageClass||"",onChange:function(e,t){p.StorageConfiguration.storageClass=t}}))),p.StorageConfiguration.bucketsRegexp&&!p.ObjectsBucket&&t().createElement(t().Fragment,null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.tags")),t().createElement("div",null,t().createElement(_n,{fullWidth:!0,variant:"v2",disabled:!!p.ObjectsBucket,hintText:w("storage.s3.bucketsTags"),value:p.StorageConfiguration.bucketsTags||"",onChange:function(e,t){p.StorageConfiguration.bucketsTags=t}})))),"AZURE"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.azure")),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement(_n,{fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.azure.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),"GCS"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.gcs")),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.credentials")+" *",value:p.StorageConfiguration.jsonCredentials,onChange:function(e,t){p.StorageConfiguration.jsonCredentials=t},multiLine:!0}),t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.path"),value:p.ObjectsBaseFolder,onChange:function(e,t){p.ObjectsBaseFolder=t}}))),F=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"data")},t().createElement("div",{style:j.title},w("datamanagement")),!p.StorageConfiguration.cellsInternal&&t().createElement(e.Fragment,null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.versioning")),t().createElement(In,{fullWidth:!0,variant:"v2",hintText:w("versioning"),value:p.VersioningPolicyName,onChange:function(e,t,n){p.VersioningPolicyName=n}},t().createElement(u.MenuItem,{value:void 0,primaryText:w("versioning.disabled")}),h.map((function(e){return t().createElement(u.MenuItem,{value:e.Uuid,primaryText:e.Name+" (stored in "+e.VersionsDataSourceName+")"})})))),t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.encryption")),t().createElement(In,{fullWidth:!0,variant:"v2",hintText:w("enc.key"),value:"MASTER"===p.EncryptionMode?p.EncryptionKey:"VALUE_CLEAR",onChange:function(e,t,r){n.toggleEncryption(r)}},t().createElement(u.MenuItem,{value:"VALUE_CLEAR",primaryText:w("enc.key.clear")}),m.map((function(e){return t().createElement(u.MenuItem,{value:e.ID,primaryText:e.Label})})),"MASTER"!==p.EncryptionMode&&0===m.length&&t().createElement(u.MenuItem,{value:"VALUE_CREATE",primaryText:w("enc.key.create")}))),V=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"advanced")},t().createElement("div",{style:j.title},w("tab.advanced")),!p.StorageConfiguration.cellsInternal&&t().createElement("div",null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.flatStorage")),t().createElement(u.Checkbox,kn({label:w("storage.flatStorage"),labelPosition:"right",disabled:!f,checked:!p.FlatStorage,onCheck:function(e,t){p.FlatStorage=!t}},O.toggleFieldV2)),f&&p.FlatStorage&&t().createElement(_n,{fullWidth:!0,variant:"v2",hintText:w("initFlatFromSnapshot"),value:p.StorageConfiguration.initFromSnapshot||"",onChange:function(e,t){t?p.StorageConfiguration.initFromSnapshot=t:delete p.StorageConfiguration.initFromSnapshot}}),p.FlatStorage&&(f||p.StorageConfiguration.foldersShardingPattern)&&t().createElement(_n,{fullWidth:!0,variant:"v2",disabled:!f,hintText:w("foldersShardingPattern"),value:p.StorageConfiguration.foldersShardingPattern||"",onChange:function(e,t){t?p.StorageConfiguration.foldersShardingPattern=t:delete p.StorageConfiguration.foldersShardingPattern}})),!p.FlatStorage&&t().createElement("div",null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.skipResync")),t().createElement(u.Checkbox,kn({label:w("storage.skipResync"),labelPosition:"right",checked:p.SkipSyncOnRestart,onCheck:function(e,t){p.SkipSyncOnRestart=t}},O.toggleFieldV2))),"LOCAL"!==p.StorageType&&t().createElement("div",null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.readOnly")),t().createElement(u.Checkbox,kn({label:w("storage.readOnly"),labelPosition:"right",checked:"true"===p.StorageConfiguration.readOnly,onCheck:function(e,t){p.StorageConfiguration.readOnly=t?"true":""}},O.toggleFieldV2))),(!p.StorageConfiguration.readOnly||"true"!==p.StorageConfiguration.readOnly)&&t().createElement("div",null,t().createElement("div",{style:Pn(Pn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.checksumMapper")),t().createElement(u.Checkbox,kn({label:w("storage.nativeEtags"),labelPosition:"right",checked:p.StorageConfiguration.nativeEtags,onCheck:function(e,t){p.StorageConfiguration.nativeEtags=t?"true":""}},O.toggleFieldV2)),!p.StorageConfiguration.nativeEtags&&t().createElement("div",null,t().createElement(u.Checkbox,kn({label:w("storage.checksumMapper"),labelPosition:"right",checked:"dao"===p.StorageConfiguration.checksumMapper,onCheck:function(e,t){p.StorageConfiguration.checksumMapper=t?"dao":""}},O.toggleFieldV2)))));return t().createElement(Dn,{title:k,titleLeftIcon:"mdi mdi-database",titleActionBar:E,closeAction:this.props.closeEditor,leftNavItems:f?null:[{label:w("tab.main"),value:"main",icon:"mdi mdi-database-plus"},{label:w("tab.lifecycle"),value:"data",icon:"mdi mdi-recycle"},{label:w("tab.advanced"),value:"advanced",icon:"mdi mdi-settings"}],leftNavSelected:d,leftNavChange:function(e){n.setState({currentPane:e})},className:"workspace-editor",contentFill:!1,rightPanelStyle:f?{paddingTop:64}:null},R,_,B,I,F,V,N)}}],o&&xn(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Kn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Kn(o)?o:String(o)),r)}var o}function Un(e,t){return Un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Un(e,t)}function qn(e){return qn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qn(e)}Vn.contextTypes={messages:l().object,getMessage:l().func},Vn=(0,f.muiThemeable)()(Vn);var Hn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Un(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qn(o);if(i){var n=qn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Kn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),a.apply(this,arguments)}return n=l,(r=[{key:"render",value:function(){var e=this.props,n=e.policy,r=e.rendering,o=e.pydio,i=function(e){return o.MessageHash["ajxp_admin.versions.period."+e]||e},a=n.KeepPeriods,l=void 0===a?[]:a,s=n.NodeDeletedStrategy;if("short"===r){var c;if(1===l.length){var d=l[0];c=-1===d.MaxNumber?i("keep-all.always"):i("keep-n").replace("%s",d.MaxNumber)}else{c=i("retentions-n").replace("%s",l.length);var p=l[l.length-1];0===p.MaxNumber||void 0===p.MaxNumber?c+=" | "+i("remove-all-after").replace("%s",p.IntervalStart):c+=" | "+i("keep-n-after").replace("%1",p.MaxNumber).replace("%2",p.IntervalStart)}return t().createElement("span",null,c)}var f,y=l.map((function(e){var n,r=e.MaxNumber,o=t().createElement(u.FontIcon,{className:"mdi mdi-ray-start-arrow"}),a={};return void 0===e.IntervalStart||"0"===e.IntervalStart?o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-start"}):n=t().createElement("span",{style:{fontWeight:500,fontSize:16}},e.IntervalStart,""),-1===e.MaxNumber?r=i("keep-all"):e.MaxNumber?r=i("max-n").replace("%s",r):(r=i("remove-all"),o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-end",style:{color:"#c62828"}}),a={color:"#c62828"}),t().createElement(u.Step,null,t().createElement(u.StepLabel,{icon:o,style:a},n,r))})),m={color:"#c62828",fontWeight:500,fontSize:16};switch(s){case"KeepLast":f="Backup last";break;case"KeepAll":default:m.color=null,f="Backup all";break;case"KeepNone":f="Clean all"}return y.push(t().createElement(u.Step,null,t().createElement(u.StepLabel,{style:m,icon:t().createElement(u.FontIcon,{className:"mdi mdi-delete",style:m})},f))),t().createElement(u.Stepper,{activeStep:l.length-1,linear:!1},y)}}])&&Wn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Jn(e){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(e)}function zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e,t,n){return(t=Qn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qn(r.key),r)}}function Qn(e){var t=function(e,t){if("object"!==Jn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Jn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Jn(t)?t:String(t)}function $n(e,t){return $n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$n(e,t)}function Xn(e){return Xn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xn(e)}var Zn=c().requireLib("form"),er=Zn.Manager,tr=Zn.FormPanel,nr=AdminComponents,rr=nr.PaperEditorLayout,or=nr.AdminStyles,ir=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$n(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Xn(i);if(a){var n=Xn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dirty:!1,policy:e.versionPolicy,loaded:!0,valid:!0,parameters:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.versions.editor."+t]||t}},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){this.state.policy!==e.versionPolicy&&this.setState({policy:e.versionPolicy})}},{key:"componentDidMount",value:function(){var e=this;m().getRestClient().callApi("/config/discovery/forms/{ServiceName}","GET",{ServiceName:"pydio.grpc.versions"},{},{},{},null,[],["application/json"],["application/json"],"String").then((function(t){var n=t.data,r=p().parseXml(n);e.setState({parameters:er.parseParameters(r,"//param"),loaded:!0})}))}},{key:"resetForm",value:function(){this.setState({valid:!0,dirty:!1,saveValue:null})}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.policy;this.props.pydio.UI.openConfirmDialog({message:n("delete.confirm"),destructive:[r.Label],validCallback:function(){te().loadClass("EnterpriseSDK").then((function(t){new t.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(r.Uuid).then((function(t){e.props.closeEditor()}))}))}})}},{key:"saveSource",value:function(){var e=this;if(this.state.saveValue){var t=this.state.saveValue;te().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVersioningPolicy(t.Uuid,t).then((function(){e.props.reloadList(),e.setState({dirty:!1,policy:t,saveValue:null})}))}))}}},{key:"onFormChange",value:function(e){var t=this.state.m,n=s.valuesToTreeVersioningPolicy(e),r=n.KeepPeriods||[],o=r.findIndex((function(e){return 0===e.MaxNumber}));if(o>-1&&o<r.length-1){pydio.UI.displayMessage("ERROR",t("error.lastdelete"));for(var i=r.length-1-o;i>0;)r.pop(),i--}n.KeepPeriods=r,this.setState({saveValue:n,dirty:!0})}},{key:"updateValidStatus",value:function(e){}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.create,i=r.readonly,a=r.pydio,l=r.muiTheme,c=r.internalSources,d=this.state,p=d.loaded,f=d.policy,y=d.saveValue,m=d.m,h=this.state.parameters,b=l.palette,g=or(b);if(h&&p){c&&(h=h.map((function(e){return"VersionsDataSourceName"===e.name&&(e.choices+=","+c.map((function(e){return e+"|DataSource "+e})).join(",")),e})));var v=s.TreeVersioningPolicyToValues(f);y&&(v=s.TreeVersioningPolicyToValues(y)),e=t().createElement(tr,{parameters:h,values:v,className:"full-width",onChange:this.onFormChange.bind(this),onValidStatusChange:this.updateValidStatus.bind(this),disabled:i,depth:-2,variant:"v2"})}var S=[];i||(o||(S.push(rr.actionButton(m("delete"),"mdi mdi-delete",(function(){n.deleteSource()}))),S.push(rr.actionButton(a.MessageHash["ajxp_admin.plugins.6"],"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty))),S.push(rr.actionButton(a.MessageHash[53],"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.valid||!this.state.dirty)));var w=y?y.Name:f.Name;return w||(w=""),t().createElement(rr,{title:p&&h?m("title").replace("%s",w):a.MessageHash["ajxp_admin.loading"],titleLeftIcon:"mdi mdi-clock-start",titleActionBar:S,closeAction:this.props.closeEditor,className:"workspace-editor",contentFill:!0},t().createElement(u.Paper,{zDepth:0,style:{backgroundColor:g.body.block.header.backgroundColor,padding:"0px 20px",height:64,display:"flex",alignItems:"center"}},t().createElement("div",{style:{overflowX:"auto",width:"100%"}},t().createElement(Hn,{pydio:a,policy:y||f}))),e,g.formSimpleCss())}}],o=[{key:"valuesToTreeVersioningPolicy",value:function(e){for(var t=[],n="IntervalStart",r="MaxNumber",o=n,i=r,a=0;void 0!==e[o]&&void 0!==e[i];){var l=new S.TreeVersioningKeepPeriod;l.IntervalStart=e[o],l.MaxNumber=e[i],t.push(l),delete e[i],delete e[o],o=n+"_"+ ++a,i=r+"_"+a}return e.KeepPeriods=t,S.TreeVersioningPolicy.constructFromObject(e)}},{key:"TreeVersioningPolicyToValues",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zn(Object(n),!0).forEach((function(t){Yn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if(t.KeepPeriods){var n=0;t.KeepPeriods.map((function(e){n>0?(t["IntervalStart_"+n]=e.IntervalStart||0,t["MaxNumber_"+n]=e.MaxNumber||0):(t.IntervalStart=e.IntervalStart||0,t.MaxNumber=e.MaxNumber||0),n++}))}return t.NodeDeletedStrategy||(t.NodeDeletedStrategy="KeepAll"),t}}],r&&Gn(n.prototype,r),o&&Gn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);ir=(0,f.muiThemeable)()(ir);var ar="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),lr=new Uint8Array(16);function sr(){if(!ar)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ar(lr)}for(var cr=[],ur=0;ur<256;++ur)cr[ur]=(ur+256).toString(16).substr(1);const dr=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||sr)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[r+i]=o[i];return t||function(e,t){var n=t||0,r=cr;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(o)};function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function fr(){return fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fr.apply(this,arguments)}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==pr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===pr(o)?o:String(o)),r)}var o}function mr(e,t){return mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mr(e,t)}function hr(e){return hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hr(e)}var br=c().requireLib("components").MaterialTable,gr=c().requireLib("hoc").ModernTextField;const vr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=hr(o);if(i){var n=hr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={keys:[],showDialog:!1,showExportKey:null,exportedKey:null,showCreateKey:null,showImportKey:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.encryption."+t]||e.pydio.MessageHash[t]||t}},t}return n=l,(r=[{key:"load",value:function(){var e=this;new S.ConfigServiceApi(m().getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest).then((function(t){e.setState({keys:t.Keys||[]})}))}},{key:"componentDidMount",value:function(){this.load()}},{key:"exportKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=new S.EncryptionAdminExportKeyRequest;o.KeyID=this.state.showExportKey,o.StrPassword=this.refs["key-password-field"].getValue(),this.refs["key-password-confirm"].getValue()===o.StrPassword?r.exportEncryptionKey(o).then((function(t){e.setState({exportedKey:t.Key,showExportKey:null},(function(){e.timeout=setTimeout((function(){e.setState({exportedKey:"",showDialog:!1})}),1e4)})),e.setState({showExportKey:null})})).catch((function(r){t.UI.displayMessage("ERROR",n("key.export.fail")+" : "+r.message),e.setState({showExportKey:null})})):t.UI.displayMessage("ERROR",n("238"))}},{key:"createKey",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=new S.EncryptionAdminCreateKeyRequest;n.KeyID=this.refs.createKeyId.getValue(),n.Label=this.refs.createKeyLabel.getValue(),t.createEncryptionKey(n).then((function(t){e.load(),e.setState({showDialog:!1})})).catch((function(){e.setState({showDialog:!1})}))}},{key:"deleteKey",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("key.delete.warning"),destructive:[e],validCallback:function(){var n=new S.ConfigServiceApi(m().getRestClient()),r=new S.EncryptionAdminDeleteKeyRequest;r.KeyID=e,n.deleteEncryptionKey(r).then((function(e){t.load()}))}})}},{key:"importKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=this.state.showImportKey,i=!0;o.ID||((o=new S.EncryptionKey).ID=this.refs["key-import-id"].getValue(),o.Label=this.refs["key-import-label"].getValue(),i=!1),o.Content=this.refs["key-imported-field"].getValue();var a=new S.EncryptionAdminImportKeyRequest;a.StrPassword=this.refs["key-password-field"].getValue(),a.Key=o,a.Override=i,r.importEncryptionKey(a).then((function(r){r.Success?t.UI.displayMessage("SUCCESS",n("key.import.success")):t.UI.displayMessage("ERROR",n("key.import.fail")),e.load(),e.setState({showImportKey:!1,showDialog:!1})})).catch((function(){e.setState({showImportKey:!1,showDialog:!1})}))}},{key:"render",value:function(){var e=this,n=this.state,r=n.keys,o=n.showDialog,i=n.showImportKey,a=n.showExportKey,l=n.exportedKey,s=n.showCreateKey,c=n.m,d=this.props,p=(d.pydio,d.accessByName),f=d.adminStyles,y=[{name:"Label",label:c("key.label"),style:{width:"30%",fontSize:15},headerStyle:{width:"30%"},sorter:{type:"string",default:!0}},{name:"ID",label:c("key.id"),hideSmall:!0,sorter:{type:"string"}},{name:"Owner",label:c("key.owner"),hideSmall:!0,sorter:{type:"string"}},{name:"CreationDate",label:c("key.created"),hideSmall:!0,useMoment:!0,sorter:{type:"number"}}],m=[];p("CreateEncryption")&&m.push({iconClassName:"mdi mdi-import",tooltip:c("key.import"),onClick:function(t){e.setState({showDialog:!0,showImportKey:t})}},{iconClassName:"mdi mdi-export",tooltip:c("key.export"),onClick:function(t){e.setState({showDialog:!0,showExportKey:t.ID})}},{iconClassName:"mdi mdi-delete",tooltip:c("key.delete"),onClick:function(t){e.deleteKey(t.ID)}});var h,b,g=[];a||l?(b=c("key.export"),l?(h=t().createElement(gr,{value:l.Content,fullWidth:!0,variant:"v2",floatingLabelText:c("key.export.result.copy"),multiLine:!0,ref:"key-imported-field"}),g=[t().createElement(u.FlatButton,{label:c("86"),onClick:function(){clearTimeout(e.timeout),e.setState({showExportKey:null,exportedKey:"",showDialog:!1})}})]):(h=t().createElement("div",null,t().createElement(gr,{variant:"v2",floatingLabelText:c("key.export.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(gr,{variant:"v2",floatingLabelText:c("key.export.confirm"),ref:"key-password-confirm",type:"password",fullWidth:!0})),g=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showExportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.export"),primary:!0,onClick:function(){e.exportKey()}})])):i?(b=c("key.import"),h=t().createElement("div",null,!i.ID&&t().createElement("div",null,t().createElement(gr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"key-import-id",fullWidth:!0}),t().createElement(gr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"key-import-label",fullWidth:!0})),t().createElement(gr,{variant:"v2",floatingLabelText:c("key.import.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(gr,{variant:"v2",fullWidth:!0,floatingLabelText:c("key.import.content"),multiLine:!0,ref:"key-imported-field"})),g=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showImportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.import"),primary:!0,onClick:function(){e.importKey()}})]):s&&(b=c("key.create"),h=t().createElement("div",null,t().createElement(gr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"createKeyId",fullWidth:!0}),t().createElement(gr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"createKeyLabel",fullWidth:!0})),g=[t().createElement(u.FlatButton,{label:c("54"),onClick:function(){e.setState({showCreateKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.create"),primary:!0,onClick:function(){e.createKey()}})]);var v=AdminComponents.AdminStyles().body,S=v.tableMaster,w=v.block.props,O=v.block.container;return t().createElement("div",null,t().createElement(u.Dialog,{title:b,open:o,onRequestClose:function(){e.setState({showDialog:!1,showExportKey:null,showImportKey:null,showCreateKey:!1})},modal:!0,actions:g,contentStyle:{maxWidth:340}},h),t().createElement(u.Paper,fr({},w,{style:O}),t().createElement(br,{data:r,columns:y,actions:m,onSelectRows:function(){},showCheckboxes:!1,emptyStateString:c("key.emptyState"),masterStyles:S,storageKey:"console.encryption-keys.list"})),p("CreateEncryption")&&t().createElement("div",{style:{textAlign:"right",paddingRight:24,paddingBottom:24}},t().createElement(u.FlatButton,fr({primary:!0,label:c("key.import"),onClick:function(){e.setState({showImportKey:{},showDialog:!0})}},f.props.header.flatButton)),t().createElement("span",{style:{marginLeft:8}},t().createElement(u.FlatButton,fr({primary:!0,label:c("key.create"),onClick:function(){e.setState({showCreateKey:!0,showDialog:!0})}},f.props.header.flatButton)))))}}])&&yr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Sr(e){return Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sr(e)}function wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Sr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Sr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Sr(o)?o:String(o)),r)}var o}function Or(e,t){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Or(e,t)}function Er(e){return Er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Er(e)}const kr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Or(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Er(o);if(i){var n=Er(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Sr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={value:"flat"},t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e,t){e.open&&!this.props.open&&this.setState({value:"flat"})}},{key:"submit",value:function(){var e=this.props,t=e.onSubmit,n=e.onRequestClose;t(this.state.value),n()}},{key:"render",value:function(){var e=this,n=this.props,r=n.open,o=n.onRequestClose,i=this.state.value,a=function(e){return c().getMessages()["ajxp_admin.ds.format-picker."+e]||e},l=function(e){var n=t().createElement("div",null,t().createElement("div",null,a(e+".title")),t().createElement("div",{style:{opacity:.67,margin:"5px 0 10px"}},a(e+".legend")));return t().createElement(u.RadioButton,{value:e,label:n})},s=[t().createElement(u.FlatButton,{label:c().getMessages()[54],onClick:function(){o()},primary:!0}),t().createElement(u.FlatButton,{label:a("submit"),primary:!0,onClick:function(){return e.submit()}})];return t().createElement(u.Dialog,{open:r,title:a("title"),onRequestClose:o,actions:s},t().createElement("div",{style:{marginBottom:20}},a("legend")),t().createElement(u.RadioButtonGroup,{valueSelected:i,onChange:function(t,n){return e.setState({value:n})}},l("flat"),l("structured"),l("internal")))}}])&&wr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function Pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(n),!0).forEach((function(t){xr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xr(e,t,n){return(t=Nr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tr(){return Tr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Tr.apply(this,arguments)}function Rr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nr(r.key),r)}}function Nr(e){var t=function(e,t){if("object"!==Cr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Cr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Cr(t)?t:String(t)}function Ar(e,t){return Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ar(e,t)}function Dr(e){return Dr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dr(e)}var Mr=c().requireLib("components").MaterialTable,Lr=c().requireLib("boot"),_r=Lr.JobsStore,Ir=Lr.moment,Br=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ar(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Dr(i);if(a){var n=Dr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Cr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dataSources:[],resyncJobs:{},versioningPolicies:[],dsLoaded:!1,versionsLoaded:!1,showExportKey:!1,exportedKey:null,showImportKey:!1,importResult:null,keyOperationError:null,startedServices:[],peerAddresses:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.ds."+t]||t}},t}return r=s,o=[{key:"componentDidMount",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=this.props.pydio;this.statusPoller=setInterval((function(){n.WebSocketClient.getStatus()&&(vt.loadStatuses().then((function(t){e.setState({startedServices:t.Services||[]})})),t.listPeersAddresses().then((function(t){e.setState({peerAddresses:t.PeerAddresses||[]})})))}),2500),setTimeout((function(){e.syncPoller=setInterval((function(){n.WebSocketClient.getStatus()&&e.syncStatuses()}),2500)}),1250),this.load()}},{key:"componentWillUnmount",value:function(){clearInterval(this.statusPoller),clearInterval(this.syncPoller)}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setState({dsLoaded:!1,versionsLoaded:!1,newDsName:t}),vt.loadDatasources().then((function(t){e.setState({dataSources:t.DataSources||[],dsLoaded:!0},(function(){e.syncStatuses()}))})),vt.loadVersioningPolicies().then((function(t){e.setState({versioningPolicies:t.Policies||[],versionsLoaded:!0})})),vt.loadStatuses().then((function(t){e.setState({startedServices:t.Services})})),this.refs&&this.refs.encKeys&&this.refs.encKeys.load()}},{key:"syncStatuses",value:function(){var e=this,t=this.state.dataSources,n=void 0===t?[]:t;n.length&&_r.getInstance().getAdminJobs(null,null,n.map((function(e){return"resync-ds-"+e.Name})),1).then((function(t){var n={};(t.Jobs||[]).forEach((function(e){e.Tasks&&e.Tasks.length&&(n[e.ID.replace("resync-ds-","")]=e)})),e.setState({resyncJobs:n})}))}},{key:"closeEditor",value:function(){this.props.closeRightPane()}},{key:"openDataSource",value:function(e){if(e.length){var t=e[0],n=this.props,r=n.openRightPane,o=n.accessByName,i=n.pydio,a=n.storageTypes;r({COMPONENT:Vn,PROPS:{ref:"editor",pydio:i,dataSource:t,storageTypes:a,readonly:!o("CreateDatasource"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"makeStatusLabel",value:function(e,n){switch(e){case"error":return t().createElement("span",{style:{color:"#e53935"}},t().createElement("span",{className:"mdi mdi-alert"})," ",n);case"running":return t().createElement("span",{style:{color:"#ef6c00"}},t().createElement("span",{className:"mdi mdi-timer-sand"})," ",n);default:return t().createElement("span",{style:{color:"#1b5e20"}},t().createElement("span",{className:"mdi mdi-check"})," ",n)}}},{key:"computeStatus",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&e.Disabled)return-1;var r,o,i,a=this.state,l=a.startedServices,s=void 0===l?[]:l,c=a.peerAddresses,u=void 0===c?[]:c,d=a.m,p=a.newDsName;if(!s.length)return d("status.na");if(s.map((function(t){t.Name==="pydio.grpc.data.sync."+e.Name&&"STARTED"===t.Status?o=!0:t.Name==="pydio.grpc.data.index."+e.Name&&"STARTED"===t.Status?r=!0:t.Name==="pydio.grpc.data.objects."+e.ObjectsServiceName&&"STARTED"===t.Status&&(i=!0)})),r&&o&&i)return p&&e.Name===p&&setTimeout((function(){t.setState({newDsName:null})}),100),n?0:this.makeStatusLabel("ok",d("status.ok"));if(p&&e.Name===p)return n?1:this.makeStatusLabel("running",d("status.starting"));if(r||o||i){var f=[];return r||f.push(d("status.index")),o||f.push(d("status.sync")),i||f.push(d("status.object")),n?3:this.makeStatusLabel("error",f.join(" - "))}var y=d("status.ko");return u&&-1===u.indexOf(e.PeerAddress)&&(y=d("status.ko-peers").replace("%s",e.PeerAddress)),n?2:this.makeStatusLabel("error",y)}},{key:"computeJobStatus",value:function(e){var t=e.Tasks[0];switch(t.Status){case"Finished":return this.makeStatusLabel("ok",Ir(new Date(1e3*parseInt(t.EndTime))).fromNow());case"Running":return this.makeStatusLabel("running",t.StatusMessage||"Running...");case"Error":return this.makeStatusLabel("error",t.StatusMessage);case"Queued":return this.makeStatusLabel("running",t.StatusMessage)}return this.makeStatusLabel("ok",t.StatusMessage)}},{key:"openVersionPolicy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e||e.length){var n,r=!1;if(void 0===e){r=!0,(n=new S.TreeVersioningPolicy).Uuid=dr(),n.VersionsDataSourceName="versions",n.NodeDeletedStrategy="KeepAll";var o=new S.TreeVersioningKeepPeriod;o.IntervalStart="0",o.MaxNumber=-1,n.KeepPeriods=[o]}else n=e[0],t&&(r=!0,(n=S.TreeVersioningPolicy.constructFromObject(JSON.parse(JSON.stringify(n)))).Uuid=dr(),n.Name+=" (Copy)");var i=this.props,a=i.openRightPane,l=i.pydio,s=i.versioningReadonly,c=i.accessByName,u=this.state.dataSources;a({COMPONENT:ir,PROPS:{ref:"editor",versionPolicy:n,create:r,pydio:l,internalSources:u.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal})).map((function(e){return e.Name})),readonly:s||!c("CreateVersioning"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"deleteVersionPolicy",value:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.versions.editor.delete.confirm"],destructive:[e.Name],validCallback:function(){te().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(e.Uuid).then((function(e){t.load()}))}))}})}},{key:"createDataSource",value:function(e){var t=this.props,n=t.pydio,r=t.storageTypes,o=this.state.dataSources;this.props.openRightPane({COMPONENT:Vn,PROPS:{ref:"editor",create:!0,createStructure:e,existingNames:o.map((function(e){return e.Name})),pydio:n,storageTypes:r,closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}},{key:"resyncDataSource",value:function(e,t,n){e.UI.openConfirmDialog({message:t("editor.legend.resync"),skipNext:"datasource.resync.confirm",validCallback:function(){new vt(n).resyncSource()}})}},{key:"deleteDataSource",value:function(e,t,n){var r=this;e.UI.openConfirmDialog({message:t("editor.delete.warning"),validCallback:function(){new vt(n).deleteSource().then((function(){r.load()}))},destructive:[n.Name]})}},{key:"createWorkspaceFromDatasource",value:function(e,t,n){var r=new C,o=r.getModel(),i=n.Name;o.Label=i,o.Description="Root of "+i,o.Slug=i,o.Attributes.DEFAULT_RIGHTS="";var a={Uuid:"DATASOURCE:"+i,Path:i};o.RootNodes[a.Uuid]=a,e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:t("board.wsfromds.title"),legendId:t("board.wsfromds.legend").replace("%s",i),fieldLabelId:t("board.wsfromds.field"),defaultValue:t("board.wsfromds.defaultPrefix").replace("%s",i),submitValue:function(t){o.Label=t,r.save().then((function(t){localStorage.setItem("admin.workspace.autoload",t.UUID),e.goTo("/data/workspaces")}))}})}},{key:"render",value:function(){var n=this,r=this.state,o=r.dataSources,i=r.resyncJobs,a=r.versioningPolicies,l=r.m,s=r.createDialog;o.sort(b().arraySorter("Name"));var c=o.filter((function(e){return!(e.StorageConfiguration&&e.StorageConfiguration.cellsInternal)})),d=o.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal}));a.sort(b().arraySorter("Name"));var p=AdminComponents.AdminStyles(this.props.muiTheme.palette),f=p.body,y=f.tableMaster,m=f.block.props,h=f.block.container,g=this.props,v=g.currentNode,S=g.pydio,w=g.versioningReadonly,O=g.accessByName,E=[{name:"Name",label:l("name"),style:{fontSize:15,width:"15%"},headerStyle:{width:"15%"},sorter:{type:"string",default:!0}},{name:"StorageType",label:l("storage"),style:{width:"15%"},headerStyle:{width:"15%"},renderCell:function(e){var t="storage.fs";switch(e.StorageType){case"S3":t="storage.s3";break;case"AZURE":t="storage.azure";break;case"GCS":t="storage.gcs"}return l(t)},sorter:{type:"string"}},{name:"Status",label:l("status"),hideSmall:!0,renderCell:function(e){return e.Disabled?t().createElement("span",{style:{color:"#757575"}},t().createElement("span",{className:"mdi mdi-checkbox-blank-circle-outline"})," ",l("status.disabled")):n.computeStatus(e)},sorter:{type:"number",value:function(e){return n.computeStatus(e,!0)}}},{name:"SyncStatus",label:l("syncStatus"),hideSmall:!0,renderCell:function(e){return i&&i[e.Name]?n.computeJobStatus(i[e.Name]):"n/a"},sorter:{type:"number",value:function(e){return i&&i[e.Name]?i[e.Name].Tasks[0].EndTime:0}}},{name:"VersioningPolicyName",label:l("versioning"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,renderCell:function(e){var t=a.find((function(t){return t.Uuid===e.VersioningPolicyName}));return t?t.Name:e.VersioningPolicyName||"-"},sorter:{type:"string"}},{name:"EncryptionMode",label:l("encryption"),hideSmall:!0,style:{width:"8%",textAlign:"center"},headerStyle:{width:"8%"},renderCell:function(e){return"MASTER"===e.EncryptionMode?t().createElement("span",{className:"mdi mdi-check"}):"-"},sorter:{type:"number",value:function(e){return"MASTER"===e.EncryptionMode?1:0}}}];c.filter((function(e){return!e.FlatStorage})).length||(E=E.filter((function(e){return"SyncStatus"!==e.name})));var k=E.filter((function(e){return"VersioningPolicyName"!==e.name&&"SyncStatus"!==e.name})),C=v.getLabel(),P=v.getMetadata().get("icon_class"),j=[];O("CreateDatasource")&&j.push(t().createElement(u.FlatButton,Tr({primary:!0,label:S.MessageHash["ajxp_admin.ws.4"],onClick:function(){return n.setState({createDialog:!0})}},p.props.header.flatButton)));var x=!w&&O("CreateVersioning");x&&j.push(t().createElement(u.FlatButton,Tr({primary:!0,label:S.MessageHash["ajxp_admin.ws.4b"],onClick:function(){n.openVersionPolicy()}},p.props.header.flatButton)));var T=[{name:"Name",label:l("versioning.name"),style:{width:180,fontSize:15},headerStyle:{width:180},sorter:{type:"string",default:!0}},{name:"Description",label:l("versioning.description"),sorter:{type:"string"}},{name:"KeepPeriods",hideSmall:!0,label:l("versioning.periods"),renderCell:function(e){return t().createElement(Hn,{rendering:"short",policy:e,pydio:S})}},{name:"VersionsDataSourceName",style:{width:180},headerStyle:{width:180},label:l("versioning.storage"),sorter:{type:"string"},hideSmall:!0}],R=[];O("CreateDatasource")&&R.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit datasource",onClick:function(e){n.openDataSource([e])}}),R.push({iconClassName:"mdi mdi-folder-plus",tooltip:"Create workspace here",onClick:function(e){return n.createWorkspaceFromDatasource(S,l,e)}}),O("CreateDatasource")&&R.push({iconClassName:"mdi mdi-delete",tooltip:l("editor.legend.delete.button"),onClick:function(e){return n.deleteDataSource(S,l,e)}});var N=[].concat(R);c.filter((function(e){return!e.FlatStorage})).length>0&&R.push({iconClassName:"mdi mdi-sync",tooltip:l("editor.legend.resync.button"),onClick:function(e){return n.resyncDataSource(S,l,e)},disable:function(e){return e.FlatStorage}});var A=[];return A.push({iconClassName:x?"mdi mdi-pencil":"mdi mdi-eye",tooltip:x?"Edit policy":"Display policy",onClick:function(e){n.openVersionPolicy([e])}}),x&&(A.push({iconClassName:"mdi mdi-content-copy",tooltip:"Duplicate policy",onClick:function(e){return n.openVersionPolicy([e],!0)}}),A.push({iconClassName:"mdi mdi-delete",tooltip:"Delete policy",destructive:!0,onClick:function(e){return n.deleteVersionPolicy(e)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:C,icon:P,actions:j,reloadAction:this.load.bind(this),loading:!(this.state.dsLoaded&&this.state.versionsLoaded)}),t().createElement(kr,{open:s,onRequestClose:function(){n.setState({createDialog:!1})},onSubmit:function(e){n.createDataSource(e)}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:l("board.ds.title"),legend:l("board.ds.legend")}),t().createElement(u.Paper,Tr({},m,{style:jr({},h)}),t().createElement(Mr,{data:c,columns:E,actions:R,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.datasources.list"})),d.length>0&&t().createElement(e.Fragment,null,t().createElement("div",{style:{padding:"0px 20px"}},l("board.ds.internal.legend")),t().createElement(u.Paper,Tr({},m,{style:jr({},h)}),t().createElement(Mr,{data:d,columns:k,actions:N,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.internalsources.list"}))),t().createElement(AdminComponents.SubHeader,{title:l("board.versioning.title"),legend:l("board.versioning.legend")}),t().createElement(u.Paper,Tr({},m,{style:jr({},h)}),t().createElement(Mr,{data:a,columns:T,actions:A,onSelectRows:this.openVersionPolicy.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:y,storageKey:"console.versioning.policies.list"})),t().createElement(AdminComponents.SubHeader,{title:l("board.enc.title"),legend:l("board.enc.legend")}),t().createElement(vr,{pydio:S,ref:"encKeys",accessByName:O,adminStyles:p}))))}}],o&&Rr(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function Vr(){return Vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vr.apply(this,arguments)}function Kr(e,t){if(e){if("string"==typeof e)return Wr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wr(e,t):void 0}}function Wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Fr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Fr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Fr(o)?o:String(o)),r)}var o}function qr(e,t){return qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},qr(e,t)}function Hr(e){return Hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Hr(e)}Br.propTypes={dataModel:l().instanceOf($e()).isRequired,rootNode:l().instanceOf(Ze()).isRequired,currentNode:l().instanceOf(Ze()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,filter:l().string,versioningReadonly:l().bool},Br=(0,f.muiThemeable)()(Br);var Jr=n(173).muiThemeable,zr=c().requireLib("components").MaterialTable,Yr=c().requireLib("boot").AsyncComponent,Gr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Hr(o);if(i){var n=Hr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Fr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={loading:!1,namespaces:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t}},t}return n=l,(r=[{key:"componentWillMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading:!0}),$.loadNamespaces().then((function(t){e.setState({loading:!1,namespaces:t.Namespaces||[]})}))}},{key:"emptyNs",value:function(){var e=new S.IdmUserMetaNamespace;return e.Policies=[S.ServiceResourcePolicy.constructFromObject({Action:"READ",Subject:"*",Effect:"allow"}),S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Subject:"*",Effect:"allow"})],e.JsonDefinition=JSON.stringify({type:"string"}),e.Indexable=!0,e}},{key:"create",value:function(){this.setState({create:!0,dialogOpen:!0,selectedNamespace:this.emptyNs()})}},{key:"deleteNs",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("delete.confirm"),destructive:[e.Namespace],validCallback:function(){$.deleteNS(e).then((function(){t.load()}))}})}},{key:"open",value:function(e){e.length&&this.setState({create:!1,dialogOpen:!0,selectedNamespace:e[0]})}},{key:"close",value:function(){this.setState({dialogOpen:!1,selectedNamespace:null})}},{key:"render",value:function(){var e=this,n=this.props,r=n.muiTheme,o=n.currentNode,i=n.pydio,a=n.accessByName,l=n.policiesBuilder,s=n.customButtons,c=void 0===s?[]:s,d=AdminComponents.AdminStyles(r.palette),p=this.state,f=p.namespaces,y=p.loading,m=p.dialogOpen,h=p.selectedNamespace,b=p.create,g=p.m,v=p.async;h||(h=this.emptyNs());var S,w=function(e){if(Array.isArray(e))return Wr(e)}(S=new Set(f.map((function(e){return we(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(S)||Kr(S)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();f.sort((function(e,t){var n,r;return(n=e.Order||0)===(r=t.Order||0)?0:n>r?1:-1}));var O=[{name:"Order",label:g("order"),style:{width:30},headerStyle:{width:30},hideSmall:!0,renderCell:function(e){return e.Order||"0"},sorter:{type:"number"}},{name:"Namespace",label:g("namespace"),style:{fontSize:15},sorter:{type:"string"}},{name:"Label",label:g("label"),style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"Indexable",label:g("indexable"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0,renderCell:function(e){return e.Indexable?"Yes":"No"},sorter:{type:"number",value:function(e){return e.Indexable?1:0}}},{name:"JsonDefinition",label:g("definition"),hideSmall:!0,renderCell:function(e){var t=e.JsonDefinition;if(!t)return"";var n=JSON.parse(t);return $.MetaTypes[n.type]||n.type},sorter:{type:"string"}}],E={};w.length?f.map((function(e){var t=we(e);E[t]||(E[t]=[]),E[t].push(e)})):E[""]=f;var k=o.getLabel(),C=o.getMetadata().get("icon_class"),P=[],j=[];return c&&c.forEach((function(n){if(!n.access||a(n.access)){var r=i.MessageHash[n.label]||n.label,o=function(){if(n.insert){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||Kr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n.insert.split("."),2),r=t[0],o=t[1];e.setState({async:{namespace:r,component:o}})}};n.icon?P.push(t().createElement(u.IconButton,Vr({iconClassName:"mdi mdi-"+n.icon,tooltip:r,onClick:o},d.props.header.iconButton))):P.push(t().createElement(u.FlatButton,Vr({label:r,onClick:o},d.props.header.flatButton)))}})),a("Create")&&(P.push(t().createElement(u.FlatButton,Vr({primary:!0,label:g("namespace.add"),onClick:function(){e.create()}},d.props.header.flatButton))),j.push({iconClassName:"mdi mdi-pencil",onClick:function(t){e.open([t])}},{iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteNs(t)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement(Ce,{pydio:i,open:m,create:b,namespace:h,onRequestClose:function(){return e.close()},reloadList:function(){return e.load()},namespaces:f,readonly:!a("Create"),policiesBuilder:l}),t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:k,icon:C,actions:P,reloadAction:this.load.bind(this),loading:y}),v&&t().createElement(Yr,{namespace:v.namespace,componentName:v.component,onDismiss:function(){return e.setState({async:null},(function(){e.load()}))}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:g("namespaces"),legend:g("namespaces.legend")}),Object.keys(E).sort().map((function(n){return t().createElement(t().Fragment,null,n&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},"["+g("group")+"] "+n),!n&&w.length>0&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},g("default-group")),t().createElement(u.Paper,d.body.block.props,t().createElement(zr,{data:E[n],columns:O,actions:j,onSelectRows:e.open.bind(e),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:g("empty"),masterStyles:d.body.tableMaster,storageKey:"console.metadata.list"})))})))))}}])&&Ur(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);Gr=Jr()(Gr)})(),window.AdminWorkspaces=r})();