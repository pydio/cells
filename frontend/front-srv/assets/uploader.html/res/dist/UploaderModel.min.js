!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).UploaderModel=t()}(function(){return function r(o,i,s){function u(e,t){if(!i[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(a)return a(e,!0);throw(n=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",n}n=i[e]={exports:{}},o[e][0].call(n.exports,function(t){return u(o[e][1][t]||t)},n,n.exports,r,o,i,s)}return i[e].exports}for(var a="function"==typeof require&&require,t=0;t<s.length;t++)u(s[t]);return u}({1:[function(t,e,n){var r,o;r=this,o=function(){"use strict";function r(){this._listeners={}}r.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},r.prototype.removeEventListener=function(t,e){!this._listeners[t]||0<=(e=this._listeners[t].indexOf(e))&&this._listeners[t].splice(e,1)},r.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),n=0,r=e.length;n<r;++n)e[n].call(this,t)};function o(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}}function n(t,e,n){this.target=t,this.type=e,this.data=n}function t(t,e,n){if(r.call(this),"number"!=typeof e||Math.floor(e)!==e||e<1)throw new Error("Invalid concurrency");this._concurrency=e,this._options=n||{},this._options.promise=this._options.promise||Promise,this._iterator=function(t,e){var n,r=typeof t;if("object"==r){if("function"==typeof t.next)return t;if("function"==typeof t.then)return o(t)}return"function"==r?"function"==typeof(r=t).constructor&&"GeneratorFunction"===r.constructor.name?t():(n=t,{next:function(){var t=n();return t?{value:t}:{done:!0}}}):o(e.resolve(t))}(t,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null}return((t.prototype=new r).constructor=t).prototype.concurrency=function(t){return void 0!==t&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},t.prototype.size=function(){return this._size},t.prototype.active=function(){return!!this._promise},t.prototype.promise=function(){return this._promise},t.prototype.start=function(){var n=this,t=this._options.promise;return this._promise=new t(function(t,e){n._callbacks={reject:e,resolve:t},n._proceed()}),this._promise},t.prototype._fireEvent=function(t,e){this.dispatchEvent(new n(this,t,e))},t.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},t.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},t.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},t.prototype._trackPromise=function(e){var n=this;e.then(function(t){n._onPooledPromiseFulfilled(e,t)},function(t){n._onPooledPromiseRejected(e,t)}).catch(function(t){n._settle(new Error("Promise processing failed: "+t))})},t.prototype._proceed=function(){if(!this._done){for(var t={done:!1};this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=null===t||!!t.done}this._done&&0===this._size&&this._settle()},t.PromisePoolEvent=n,t.PromisePool=t},"object"==typeof n?e.exports=o():(r.PromisePool=o(),r.promisePool=r.PromisePool)},{}],2:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(t("pydio")),i=r(t("pydio/util/path")),u=r(t("pydio/lang/observable"));function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=d(n);return t=r?(t=d(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?f(e):t}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(o,u["default"]);var t,e,n,r=c(o);function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),t=r.call(this),s.default.getInstance().observe("registry_loaded",function(){this._global=null}.bind(f(t))),t}return t=o,n=[{key:"getInstance",value:function(){return o.__INSTANCE=!o.__INSTANCE?new o:o.__INSTANCE}},{key:"getUserPreference",value:function(t,e){var n=s.default.getInstance();if(!n.user)return null;var r=n.user.getPreference("gui_preferences",!0);return r&&r[t]?(n.user.activeRepository&&r[t]["repo-"+n.user.activeRepository]?r[t]["repo-"+n.user.activeRepository]:r[t])[e]:null}},{key:"setUserPreference",value:function(t,e,n){var r=s.default.getInstance();if(r&&r.user){var o=r.user.getPreference("gui_preferences",!0);if((o=o||{})[t]||(o[t]={}),r.user.activeRepository){var i="repo-"+r.user.activeRepository;if(o[t][i]||(o[t][i]={}),o[t][i][e]&&o[t][i][e]===n)return;o[t][i][e]=n}else{if(o[t][e]&&o[t][e]===n)return;o[t][e]=n}r.user.setPreference("gui_preferences",o,!0),r.user.savePreference("gui_preferences")}}}],(e=[{key:"_loadOptions",value:function(){this._global||(this._global=s.default.getInstance().getPluginConfigs("uploader"))}},{key:"getOptionAsBool",value:function(t){t=this.getOption(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0);return!0===t||"true"===t}},{key:"getOption",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if(this._loadOptions(),e){e=o.getUserPreference("originalUploadForm_XHRUploader",e);if(null!=e)return e}return this._global.has(t)?this._global.get(t):void 0!==n?n:null}},{key:"getAutoStart",value:function(){return this.getOptionAsBool("DEFAULT_AUTO_START","upload_auto_send")}},{key:"getAutoClose",value:function(){return this.getOptionAsBool("DEFAULT_AUTO_CLOSE","upload_auto_close")}},{key:"updateOption",value:function(t,e){o.setUserPreference("originalUploadForm_XHRUploader",t,e=2<arguments.length&&void 0!==arguments[2]&&arguments[2]?e?"true":"false":e),this.notify("change")}},{key:"extensionAllowed",value:function(t){var e=this.getOption("ALLOWED_EXTENSIONS","","");if(e){var n=(n=this.getOption("ALLOWED_EXTENSIONS_READABLE","",""))&&" ("+n+")",t=i.default.getFileExtension(t.getLabel());if(-1===e.split(",").indexOf(t))throw new Error(s.default.getInstance().MessageHash[367]+e+n)}}}])&&a(t.prototype,e),n&&a(t,n),o}();n.default=t,e.exports=n.default},{pydio:"pydio","pydio/lang/observable":"pydio/lang/observable","pydio/util/path":"pydio/util/path"}],3:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;r(t("pydio"));var s=r(t("./StatusItem")),i=r(t("pydio/util/path")),u=r(t("pydio/http/api")),a=t("cells-sdk");function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=p(n);return t=r?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?d(e):t}}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(o,s["default"]);var t,e,n,r=f(o);function o(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,"folder",e,n))._new=!0,e._label=i.default.getBasename(t),e.children.pg[e.getId()]=0,n&&n.addChild(d(e)),e}return t=o,(e=[{key:"isNew",value:function(){return this._new}},{key:"setIgnore",value:function(){this.setStatus(s.default.StatusLoaded),this.children.pg[this.getId()]=100,this.recomputeProgress(),this._new=!1}},{key:"_doProcess",value:function(e){var t,n=this;if(this._new){try{t=this.getFullPath()}catch(t){return void this.setStatus(s.default.StatusError)}var r=new a.TreeServiceApi(u.default.getRestClient()),o=new a.RestCreateNodesRequest,i=new a.TreeNode;i.Path=t,i.Type=a.TreeNodeType.constructFromObject("COLLECTION"),o.Nodes=[i],r.createNodes(o).then(function(t){n.setStatus(s.default.StatusLoaded),n.children.pg[n.getId()]=100,n.recomputeProgress(),e()})}else e()}}])&&l(t.prototype,e),n&&l(t,n),o}();n.default=t,e.exports=n.default},{"./StatusItem":6,"cells-sdk":"cells-sdk",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path"}],4:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=r(t("./StatusItem"));r(t("pydio"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=l(n);return t=r?(t=l(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(o,i["default"]);var t,e,n,r=a(o);function o(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=r.call(this,"part",null,t))._label="Part "+e,t}return t=o,(e=[{key:"setProgress",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._progress=t,this.notify("progress",t),null!==e&&this.notify("bytes",e)}}])&&s(t.prototype,e),n&&s(t,n),o}();n.default=t,e.exports=n.default},{"./StatusItem":6,pydio:"pydio"}],5:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=r(t("pydio")),a=r(t("pydio/http/api")),l=r(t("pydio/util/path")),s=r(t("pydio/util/lang")),u=r(t("./FolderItem")),c=r(t("./StatusItem")),f=r(t("es6-promise-pool")),d=t("cells-sdk");function r(t){return t&&t.__esModule?t:{default:t}}function p(t,e,n,r,o,i,s){try{var u=t[i](s),a=u.value}catch(t){return void n(t)}u.done?e(a):Promise.resolve(a).then(r,o)}function h(u){return function(){var t=this,s=arguments;return new Promise(function(e,n){var r=u.apply(t,s);function o(t){p(r,e,n,o,i,"next",t)}function i(t){p(r,e,n,o,i,"throw",t)}o(void 0)})}}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=b(n);return t=r?(t=b(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(o,u["default"]);var t,e,n,r=v(o);function o(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,"/",e))._repositoryId=t,e._status=c.default.StatusAnalyze,delete e.children.pg[e.getId()],e._analyzeStatus="",e}return t=o,(e=[{key:"getAnalyzeStatus",value:function(){return this._analyzeStatus}},{key:"setAnalyzeStatus",value:function(t){this._analyzeStatus=t,this.notify("status",this._status)}},{key:"setCreateFolders",value:function(t){this._createFoldersStatus=t}},{key:"getCreateFolders",value:function(){return this._createFoldersStatus}},{key:"getFullPath",value:function(){var t=i.default.getInstance().user.getRepositoriesList();if(!t.has(this._repositoryId))throw new Error("Repository disconnected?");var e=t.get(this._repositoryId).getSlug(),t=this._targetNode.getPath();return t=e+(t=(t=s.default.trimRight(t,"/")).normalize?t.normalize("NFC"):t)}},{key:"treeViewFromMaterialPath",value:function(o){var e=[];return Object.keys(o).forEach(function(n){var t=n.split("/");t.shift();var r=e;t.forEach(function(e){var t=r.find(function(t){return t.name===e});r=t?t.children:(t={name:e,item:o[n],path:n,children:[]},r.push(t),t.children)})}),e}},{key:"bulkStatSliced",value:function(n,e,r){this.setAnalyzeStatus("checking "+e.length+" items");for(var o=Promise.resolve({Nodes:[]}),i=e.slice(0,r);i.length;)!function(){e=e.slice(r);var t=new d.RestGetBulkMetaRequest;t.NodePaths=i,o=o.then(function(e){return n.bulkStatNodes(t).then(function(t){return e.Nodes=e.Nodes.concat(t.Nodes||[]),e})}),i=e.slice(0,r)}();return o}},{key:"prepare",value:function(s){var u=this;if("overwrite"===s)return this.setStatus("ready"),Promise.resolve();var t=i.default.getInstance().getPluginConfigs("uploader.html").get("DEFAULT_STAT_SLICES"),e=400;t&&!isNaN(parseInt(t))&&(e=parseInt(t)),this.setStatus(c.default.StatusAnalyze);var n=new d.TreeServiceApi(a.default.getRestClient()),r=new d.RestGetBulkMetaRequest;return r.NodePaths=[],this.walk(function(t){r.NodePaths.push(t.getFullPath())},function(){return!0},"both"),new Promise(function(o,t){var i=[];u.bulkStatSliced(n,r.NodePaths,e).then(function(e){if(!e.Nodes||!e.Nodes.length)return u.setStatus("ready"),void o(i);if("alert"===s)return u.setStatus("confirm"),void o();function r(t){return-1!==e.Nodes.map(function(t){return t.Path}).indexOf(t.getFullPath())}var t,n=function(){var e=[];return u.walk(function(t){r(t)&&e.push(t)},function(){return!0},"file"),new f.default(function(){if(!e.length)return null;var r=e.pop();return new Promise(function(){var e=h(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.newPath(r.getFullPath());case 2:n=t.sent,n=l.default.getBasename(n),r.updateLabel(n),u.setAnalyzeStatus("checking "+n),e();case 7:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())},5).start()};"rename-folders"===s?(t=Promise.resolve(),u.walk(function(n){t=t.then(h(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(n))return t.next=3,u.newPath(n.getFullPath(),!0);t.next=7;break;case 3:e=t.sent,e=l.default.getBasename(e),n.updateLabel(e),u.setAnalyzeStatus("checking "+e);case 7:case"end":return t.stop()}},t)})))},function(){return!0},"folder"),t.then(function(){return n()}).then(function(t){u.setStatus("ready"),o(t)})):(u.walk(function(t){r(t)&&t.setIgnore&&t.setIgnore()},function(){return!0},"folder"),n().then(function(t){u.setStatus("ready"),o(t)}))})})}},{key:"newPath",value:function(u){var a=this,l=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var e=h(regeneratorRuntime.mark(function t(e){var n,r,o,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=u,r="",l||(i=u.lastIndexOf("/"),-1<(s=u.lastIndexOf("."))&&i<s&&i+1<s&&(n=u.substring(0,s),r=u.substring(s))),o=u,i=1,s=!0;case 6:if(s)return o=n+"-"+i+r,i++,t.next=11,a.nodeExists(o);t.next=14;break;case 11:s=t.sent,t.next=6;break;case 14:e(o);case 15:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())}},{key:"nodeExists",value:function(r){return new Promise(function(e){var t=new d.TreeServiceApi(a.default.getRestClient()),n=new d.RestGetBulkMetaRequest;n.NodePaths=[r],t.bulkStatNodes(n).then(function(t){t.Nodes&&t.Nodes[0]?e(!0):e(!1)}).catch(function(){return e(!1)})})}}])&&y(t.prototype,e),n&&y(t,n),o}();n.default=t,e.exports=n.default},{"./FolderItem":3,"./StatusItem":6,"cells-sdk":"cells-sdk","es6-promise-pool":1,pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/util/lang":"pydio/util/lang","pydio/util/path":"pydio/util/path"}],6:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(t("pydio/lang/observable")),s=i(t("pydio"));function i(t){return t&&t.__esModule?t:{default:t}}function a(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=p(n);return t=r?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?d(e):t}}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(u,r["default"]);var t,e,n,i=f(u);function u(t,e){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this))._status=u.StatusNew,n._type=t,n._id=Math.random(),n._errorMessage=null;var o=s.default.getInstance();return n._repositoryId=r?r.getRepositoryId():o.user.activeRepository,n._exists=!1,n._progress=0,n.children={folders:[],files:[],pg:{}},n._targetNode=e,r&&(n._parent=r,(t===u.TypeFolder?r.children.folders:r.children.files).push(d(n))),n}return t=u,(e=[{key:"getId",value:function(){return this._id}},{key:"getParent",value:function(){return this._parent}},{key:"getLabel",value:function(){return this._label&&this._label.normalize?this._label.normalize("NFC"):this._label}},{key:"updateTargetNode",value:function(t){this._targetNode=t}},{key:"getTargetNode",value:function(){return this._targetNode}},{key:"updateLabel",value:function(t){this._label=t,this.notify("update_label",t)}},{key:"getFullPath",value:function(){return this._parent.getFullPath()+"/"+this.getLabel()}},{key:"getProgress",value:function(){return this._progress}},{key:"setExists",value:function(){this._exists=!0}},{key:"getExists",value:function(){return this._exists}},{key:"getType",value:function(){return this._type}},{key:"getStatus",value:function(){return this._status}},{key:"setStatus",value:function(t){this._status=t,this.notify("status",t)}},{key:"updateRepositoryId",value:function(t){this._repositoryId=t}},{key:"getRepositoryId",value:function(){return this._repositoryId}},{key:"getErrorMessage",value:function(){return this._errorMessage||""}},{key:"onError",value:function(t){this._errorMessage=t,this.setStatus(u.StatusError)}},{key:"process",value:function(t){this._doProcess(t)}},{key:"abort",value:function(t){this._doAbort&&this._doAbort(t)}},{key:"pause",value:function(){var t;this._doPause&&(t=this._doPause(),this.setStatus(t))}},{key:"resume",value:function(){this._doResume&&(this._doResume(),this.setStatus(u.StatusLoading))}},{key:"addChild",value:function(e){var n=this;this.children.pg[e.getId()]=0,e.observe("progress",function(t){n.children.pg[e.getId()]=t,n.recomputeProgress()}),this.notify("child_added")}},{key:"recomputeProgress",value:function(){var t,e=this,n=Object.keys(this.children.pg).map(function(t){return e.children.pg[t]});n.length&&(t=n.reduce(function(t,e){return t+e}),this._progress=t/n.length,this.notify("progress",this._progress))}},{key:"removeChild",value:function(t){t.abort(),t.walk(function(t){t.abort()},function(){return!0},u.TypeFile);var e=t.getId(),n=this.children.folders.indexOf(t),r=this.children.files.indexOf(t),o=!1;-1<n?(this.children.folders=LangUtils.arrayWithout(this.children.folders,n),o=!0):-1<r&&(this.children.files=LangUtils.arrayWithout(this.children.files,r),o=!0),o&&(t.stopObserving("progress"),delete this.children.pg[e],this.recomputeProgress(),this.notify("children"))}},{key:"getChildren",value:function(){return[].concat(a(this.children.folders),a(this.children.files))}},{key:"walk",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return!0},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:u.TypeBoth,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(t){return!1},t=!1;if(r===u.TypeBoth||r===u.TypeFile)for(var i=this.children.files,s=0;s<i.length;s++){if(o(i[s])){t=!0;break}n(i[s])&&e(i[s])}t||this.children.folders.forEach(function(t){r!==u.TypeFolder&&r!==u.TypeBoth||!n(t)||e(t),o(t)||t.walk(e,n,r,o)})}},{key:"collectWithLimit",value:function(e){var n=[];return this.walk(function(t){n.push(t)},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return!0},2<arguments.length&&void 0!==arguments[2]?arguments[2]:"both",function(t){return n.length>=e}),n}}])&&l(t.prototype,e),n&&l(t,n),u}();(n.default=t).StatusNew="new",t.StatusAnalyze="analyse",t.StatusFolders="folders",t.StatusLoading="loading",t.StatusLoaded="loaded",t.StatusError="error",t.StatusPause="pause",t.StatusCannotPause="cannot-pause",t.StatusMultiPause="multi-pause",t.TypeFolder="folder",t.TypeFile="file",t.TypeBoth="both",e.exports=n.default},{pydio:"pydio","pydio/lang/observable":"pydio/lang/observable"}],7:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=r(t("pydio")),s=r(t("pydio/util/lang")),f=r(t("pydio/util/path")),i=r(t("pydio/lang/observable")),u=r(t("./Task")),d=r(t("./Configs")),a=r(t("./StatusItem")),p=r(t("./UploadItem")),h=r(t("./FolderItem")),y=r(t("./Session")),l=r(t("pydio/http/api")),g=t("cells-sdk"),v=r(t("pydio/model/meta-node-provider"));function r(t){return t&&t.__esModule?t:{default:t}}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S(n);return t=r?(t=S(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(o,i["default"]);var t,e,n,r=m(o);function o(){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=r.call(this))._processing=[],n._sessions=[],n._blacklist=[".ds_store",".pydio"],n._pauseRequired=!1,v.default.RegisterLoaderHook("uploads",function(e){n._sessions.forEach(function(t){n.sessionToNodes(t,e)})}),n}return t=o,n=[{key:"openUploadDialog",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0]?c.default.getInstance().getController().fireAction("upload",{confirmDialog:!0}):c.default.getInstance().getController().fireAction("upload")}},{key:"getInstance",value:function(){return o.__INSTANCE=!o.__INSTANCE?new o:o.__INSTANCE}}],(e=[{key:"getAutoStart",value:function(){return d.default.getInstance().getAutoStart()}},{key:"makeStatusString",value:function(t){t="html_uploader.status."+("file"===t.getType()?"file":"dir")+"."+t.getStatus();return c.default.getMessages()[t]||t}},{key:"createNode",value:function(t,e){var n=new g.TreeNode;return n.Path=s.default.trim(e,"/"),n.Type="file"===t.getType()?"LEAF":"COLLECTION",t.getSize&&(n.Size=t.getSize()),n.MTime=Math.round(new Date/1e3),n.MetaStore={"local:entryDescription":'"'+this.makeStatusString(t)+'"',"local:UploadStatus":'"'+t.getStatus()+'"',"local:UploadProgress":t.getProgress()||0},v.default.parseTreeNode(n)}},{key:"sessionToNodes",value:function(t){var o=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===i&&(i=t.getTargetNode());var r=c.default.getInstance().user.getActiveRepositoryObject(),e=i.getPath();t.walk(function(n){function r(t){return(e+"/"+t.getLabel()).replace("//","/")}var t=r(n);i.findChildByPath(t)||n.getStatus()===a.default.StatusLoaded||n.getStatus()===a.default.StatusError||i.addChild(o.createNode(n,t)),n.observe("update_label",function(t){var e=o.createNode(n,r(n));i.addChild(e)}),n.observe("progress",function(t){var e=i.findChildByPath(r(n));e||(e=o.createNode(n,r(n)),i.addChild(e)),"file"===n.getType()&&e.getMetadata().get("local:UploadProgress")!==t&&(e.getMetadata().set("local:entryDescription",o.makeStatusString(n)),e.getMetadata().set("local:UploadStatus",n.getStatus()),e.getMetadata().set("local:UploadProgress",t),e.setMetadata(e.getMetadata(),!0))}),n.observe("status",function(t){var e=i.findChildByPath(r(n));e&&(t===a.default.StatusLoaded?(e.getMetadata().delete("local:entryDescription"),e.getMetadata().delete("local:UploadStatus"),e.getMetadata().delete("local:UploadProgress")):(e.getMetadata().set("local:UploadStatus",t),e.getMetadata().set("local:entryDescription",o.makeStatusString(n))),e.setMetadata(e.getMetadata(),!0)),n.getStatus()===a.default.StatusError&&setTimeout(function(){var t=i.findChildByPath(r(n));t&&t.getParent()&&!t.getMetadata().has("uuid")&&t.getParent().removeChild(t)},1500)})},function(t){var e=s.default.trim(r.getSlug()+i.getPath(),"/"),n=f.default.getDirname(t.getFullPath());return r.getId()===t.getRepositoryId()&&n===e})}},{key:"pushSession",value:function(t){var n=this;this._sessions.push(t),t.Task=u.default.create(t),t.observe("update",function(){n.notify("update")}),t.observe("children",function(){0===t.getChildren().length&&n.removeSession(t),n.sessionToNodes(t),n.notify("update")}),t.observe("child_added",function(){n.sessionToNodes(t)}),this.notify("update"),t.observe("status",function(t){var e;"ready"===t?!(e=n.getAutoStart())||n._processing.length||n._pauseRequired?e||o.openUploadDialog():n.processNext():"confirm"===t&&o.openUploadDialog(!0)}),this.notify("session_added",t)}},{key:"removeSession",value:function(t){t.Task.setIdle();t=this._sessions.indexOf(t);this._sessions=s.default.arrayWithout(this._sessions,t),this.notify("update")}},{key:"log",value:function(){}},{key:"hasQueue",value:function(){var e=0;return this._sessions.forEach(function(t){t.walk(function(){e++},function(t){return t.getStatus()===a.default.StatusNew||t.getStatus()===a.default.StatusPause||t.getStatus()===a.default.StatusMultiPause},"both",function(){return 1<=e})}),0<e}},{key:"hasErrors",value:function(){var e=0;return this._sessions.forEach(function(t){t.walk(function(){e++},function(t){return"error"===t.getStatus()},"both",function(){return 1<=e})}),0<e}},{key:"clearAll",value:function(){var e=this;this.clearStatus("new"),this._sessions.forEach(function(t){t.walk(function(t){t.getParent().removeChild(t)}),t.Task.setIdle(),e.removeSession(t)}),this._pauseRequired=!1,this.notify("update")}},{key:"clearStatus",value:function(e){this._sessions.forEach(function(t){t.walk(function(t){t.getParent().removeChild(t)},function(t){return t.getStatus()===e},a.default.TypeFile),t.walk(function(t){t.getParent().removeChild(t)},function(t){var e=0;return t.walk(function(){e++},function(){return!0},a.default.TypeFile),0===e},a.default.TypeFolder)})}},{key:"monitorProcessing",value:function(t){var e=this;this._processingMonitor||(this._processingMonitor=function(){e.notify("update")}),t.observe("status",this._processingMonitor),this._processing.push(t)}},{key:"unmonitorProcessing",value:function(t){var e=this._processing.indexOf(t);-1<e&&(this._processingMonitor&&t.stopObserving("status",this._processingMonitor),this._processing=s.default.arrayWithout(this._processing,e))}},{key:"processNext",value:function(){var n=this,t=this.getFolders();if(t.length&&!this._pauseRequired){var e=new g.TreeServiceApi(l.default.getRestClient()),r=new g.RestCreateNodesRequest;return r.Nodes=[],t.forEach(function(t){var e=new g.TreeNode;e.Path=t.getFullPath(),e.Type=g.TreeNodeType.constructFromObject("COLLECTION"),r.Nodes.push(e),t.setStatus(a.default.StatusLoading),n.monitorProcessing(t)}),this.notify("update"),void e.createNodes(r).then(function(){t.forEach(function(t){t.setStatus(a.default.StatusLoaded),t.children.pg[t.getId()]=100,t.recomputeProgress(),n.unmonitorProcessing(t)}),n.processNext(),n.notify("update")}).catch(function(t){n.processNext(),n.notify("update")})}e=this.getNexts();e.length&&!this._pauseRequired?e.forEach(function(t){n.monitorProcessing(t),t.process(function(){n.unmonitorProcessing(t),n.processNext(),n.notify("update")})}):this.hasErrors()?o.openUploadDialog():d.default.getInstance().getAutoClose()&&!this._pauseRequired&&this.notify("auto_close"),this.notify("update")}},{key:"getFolders",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:60,r=[];return this._sessions.forEach(function(t){var e=0;t.walk(function(t){r.push(t),e++},function(t){return"new"===t.getStatus()&&t.isNew()},"folder",function(){return r.length>=n}),t.setCreateFolders(e),t.setStatus(e?a.default.StatusFolders:a.default.StatusLoading)}),r}},{key:"getNexts",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,e=[];if(this._sessions.forEach(function(t){t.walk(function(t){e.push(t)},function(t){return"new"===t.getStatus()&&t.isNew()},"folder",function(){return 1<=e.length})}),e.length)return[e.shift()];var r=[],o=this._processing.length;return this._sessions.forEach(function(t){var e=0;t.walk(function(t){r.push(t),e++},function(t){return"new"===t.getStatus()||"pause"===t.getStatus()},"file",function(){return r.length>=n-o}),0===e&&0===o&&t.Task.setIdle()}),r}},{key:"stopOrRemoveItem",value:function(t){t.abort(),this.unmonitorProcessing(t),this.notify("update")}},{key:"getSessions",value:function(){return this._sessions}},{key:"isRunning",value:function(){return 0<this._processing.filter(function(t){return t.getStatus()===a.default.StatusLoading}).length}},{key:"pause",value:function(){this._pauseRequired=!0,this._processing.forEach(function(t){return t.pause()}),this.notify("update")}},{key:"resume",value:function(){this._pauseRequired=!1,this._sessions.forEach(function(t){return t.setStatus("ready")}),this._processing.forEach(function(t){return t.resume()}),this.notify("update"),this.processNext()}},{key:"handleFolderPickerResult",value:function(t,o){var i=this,e=d.default.getInstance().getOption("DEFAULT_EXISTING","upload_existing"),n=new y.default(c.default.getInstance().user.activeRepository,o);this.pushSession(n);for(var r={},s=0;s<t.length;s++){var u,a=t[s],l="/"+f.default.getBasename(a.name);t[s].webkitRelativePath&&(l="/"+t[s].webkitRelativePath,"/"!==(u=f.default.getDirname(l))&&(r[f.default.getDirname(u)]="FOLDER"),r[u]="FOLDER"),r[l]=a}(function n(t,r){t.forEach(function(t){var e;"FOLDER"===t.item?(e=new h.default(t.path,o,r),n(t.children,e)):-1===i._blacklist.indexOf(f.default.getBasename(t.path).toLowerCase())&&new p.default(t.item,o,t.path,r)})})(n.treeViewFromMaterialPath(r),n),n.prepare(e).catch(function(t){})}},{key:"handleDropEventResults",value:function(r,t,s){var o=this,e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,n=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,u=d.default.getInstance().getOption("DEFAULT_EXISTING","upload_existing"),a=new y.default(n||c.default.getInstance().user.activeRepository,s);this.pushSession(a);function l(t){return!(e&&!e(t))&&-1===o._blacklist.indexOf(f.default.getBasename(t).toLowerCase())}if(s&&s.isLeaf()&&s.getMetadata().has("local:dropFunc"))s.getMetadata().get("local:dropFunc")("native",a,r,t,s).then(function(){a.prepare(u).then(function(){o.notify("update")}).catch(function(t){o.notify("update")})}).catch(function(t){o.removeSession(a),console.error(t)});else if(r&&r.length&&(r[0].getAsEntry||r[0].webkitGetAsEntry))!function(){for(var i=console?console.log:function(t){alert(t)},t=r.length,n=[],e=0;e<t;e++)(function(t){var e=void 0;if(r[t].kind&&"file"!==r[t].kind)return;(e=r[0].getAsEntry?r[t].getAsEntry():r[t].webkitGetAsEntry()).isFile?n.push(new Promise(function(n,t){e.file(function(t){var e;0<t.size&&l(t.name)&&(e=new p.default(t,s,null,a)),n(e)},function(){t(),i()})})):e.isDirectory&&(e.folderItem=new h.default(e.fullPath,s,a),n.push(o.recurseDirectory(e,function(r){var o=r.fullPath;return new Promise(function(n,e){r.file(function(t){var e;0<t.size&&l(t.name)&&(e=new p.default(t,s,o,r.parentItem)),n(e)},function(t){e(t),i()})})},function(t){return l(t.fullPath)&&(t.folderItem=new h.default(t.fullPath,s,t.parentItem)),Promise.resolve(t.folderItem)},i)))})(e);Promise.all(n).then(function(){return a.prepare(u).then(function(){o.notify("update")})}).catch(function(t){o.notify("update")})}();else{for(var i=0;i<t.length;i++){if(0===t[i].size)return void alert(c.default.getInstance().MessageHash["html_uploader.no-folders-support"]);if(!l(t[i].name))return;new p.default(t[i],s,null,a)}a.prepare(u).then(function(){o.notify("update")}).catch(function(t){o.notify("update")})}}},{key:"recurseDirectory",value:function(t,r,o,e){var i=this;return new Promise(function(n){i.dirEntries(t).then(function(t){var e=[];t.forEach(function(t){t.parent&&t.parent.folderItem&&(t.parentItem=t.parent.folderItem),t.isDirectory?e.push(o(t)):e.push(r(t))}),Promise.all(e).then(function(){n()})})})}},{key:"dirEntries",value:function(o){var i=this,t=o.createReader(),s=[];return new Promise(function(r,e){(function n(){t.readEntries(function(t){var e;t.length?(s=s.concat(Array.prototype.slice.call(t||[],0)),n()):(e=[],s.forEach(function(t){t.parent=o,t.isDirectory&&e.push(i.dirEntries(t).then(function(t){s=s.concat(t)}))}),e.length?Promise.all(e).then(function(){r(s)}):r(s))},function(t){e(t)})})()})}}])&&b(t.prototype,e),n&&b(t,n),o}();n.default=t,e.exports=n.default},{"./Configs":2,"./FolderItem":3,"./Session":5,"./StatusItem":6,"./Task":8,"./UploadItem":9,"cells-sdk":"cells-sdk",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/lang/observable":"pydio/lang/observable","pydio/model/meta-node-provider":"pydio/model/meta-node-provider","pydio/util/lang":"pydio/util/lang","pydio/util/path":"pydio/util/path"}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var u=r(t("pydio")),a=t("cells-sdk"),l=r(t("./StatusItem"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=u.default.requireLib("boot").JobsStore,t=function(){function s(n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var e=u.default.getInstance();this.job=new a.JobsJob,this.job.ID="local-upload-task-"+n.getId(),this.job.Owner=e.user.id;function o(t){return e.MessageHash["html_uploader.task."+t]||t}this.job.Label=o("label"),this.job.Stoppable=!0;var i=new a.JobsTask;this.task=i,this.job.Tasks=[this.task],this.task.HasProgress=!0,this.task.ID="upload",this.task.Status=a.JobsTaskStatus.constructFromObject("Idle"),this.job.openDetailPane=function(){e.Controller.fireAction("upload")},i._statusObserver=function(t){var e;t===l.default.StatusFolders&&n.getCreateFolders()?(r.job.Label=o("status.folders"),e=n.getCreateFolders(),i.StatusMessage=1<e?o("message.folder-many").replace("%s",e):o("message.folder-one"),i.Status=a.JobsTaskStatus.constructFromObject("Running")):t===l.default.StatusAnalyze?(r.job.Label=o("status.analyse"),e=n.getChildren().length,i.StatusMessage=1<e?o("message.analyse-many").replace("%s",e):o(1===e?"message.analyse-one":"message.analyse-wait"),i.Status=a.JobsTaskStatus.constructFromObject("Running")):"ready"===t?(r.job.Label=o("7"),i.StatusMessage=o("status.ready"),i.Status=a.JobsTaskStatus.constructFromObject("Idle")):"paused"===t?(r.job.Label=o("status.paused"),i.Status=a.JobsTaskStatus.constructFromObject("Paused")):"loading"===t&&(r.job.Label=o("status.upload"),i.Status=a.JobsTaskStatus.constructFromObject("Running")),r.notifyMainStore()},i._progressObserver=function(t){r.job.Label=o("status.upload"),i.Progress=t/100,i.Status=a.JobsTaskStatus.constructFromObject("Running"),0<t&&(i.StatusMessage=o("message.upload-progress").replace("%s",Math.ceil(t))),r.notifyMainStore()},n.observe("status",i._statusObserver),n.observe("progress",i._progressObserver),i._statusObserver(n.getStatus()),i._progressObserver(n.getProgress()),c.getInstance().enqueueLocalJob(this.job)}var t,e,n;return t=s,n=[{key:"create",value:function(t){return new s(t)}}],(e=[{key:"setIdle",value:function(){1!==this.task.Progress?(this.task.Status=a.JobsTaskStatus.constructFromObject("Idle"),this.task.StatusMessage="",this.notifyMainStore()):c.getInstance().deleteLocalJob(this.job.ID)}},{key:"notifyMainStore",value:function(){1!==this.task.Progress&&(this.task.StartTime=(new Date).getTime()/1e3,this.job.Tasks=[this.task],c.getInstance().enqueueLocalJob(this.job))}}])&&o(t.prototype,e),n&&o(t,n),s}();n.default=t,e.exports=n.default},{"./StatusItem":6,"cells-sdk":"cells-sdk",pydio:"pydio"}],9:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=i(t("./StatusItem")),r=i(t("./PartItem")),l=i(t("pydio")),u=i(t("pydio/util/path")),c=i(t("pydio/http/api")),f=i(t("./Configs"));function i(t){return t&&t.__esModule?t:{default:t}}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(n);return t=r?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?y(e):t}}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(s,a["default"]);var t,e,n,i=h(s);function s(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=i.call(this,"file",e,r))._file=t,e._status="new",e._userMeta=o,e._label=n?u.default.getBasename(n):t.name,t.size>c.default.getMultipartThreshold()&&e.createParts(),r&&r.addChild(y(e)),e}return t=s,(e=[{key:"createParts",value:function(){var t=c.default.getMultipartPartSize();this._parts=[];for(var e=0;e<Math.ceil(this._file.size/t);e++)this._parts.push(new r.default(this,e+1))}},{key:"getFile",value:function(){return this._file}},{key:"getSize",value:function(){return this._file.size}},{key:"getHumanSize",value:function(){return u.default.roundFileSize(this._file.size)}},{key:"setProgress",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._progress=t,this.notify("progress",t),null!==e&&this.notify("bytes",e)}},{key:"_parseXHRResponse",value:function(){this.xhr&&this.xhr.responseText&&"OK"!==this.xhr.responseText&&this.onError("Unexpected response: "+this.xhr.responseText)}},{key:"_doProcess",value:function(e){var o=this;this._userAborted=!1;function n(){o.setStatus(a.default.StatusLoaded),o._parseXHRResponse(),e()}function r(t){var e,n,r;o._status!==a.default.StatusError&&t.total&&(n=Math.round(100*t.loaded/t.total),r=t.loaded,o.setProgress(n,r),o._parts&&t.part&&o._parts[t.part-1]&&t.partLoaded&&t.partTotal&&(e=o._parts[t.part-1],(n=Math.round(100*t.partLoaded/t.partTotal))<100?e.getStatus()!==a.default.StatusCannotPause&&e.setStatus(a.default.StatusLoading):(r=e.getStatus()===a.default.StatusCannotPause,e.setStatus(a.default.StatusLoaded),r&&0===o._parts.filter(function(t){return e.getStatus()===a.default.StatusCannotPause}).length&&o.setStatus(a.default.StatusPause)),e.setProgress(n,t.partLoaded)))}function i(t){o.onError(u[210]+": "+t.message),e()}function s(e){return function(t){if(t&&t.indexOf){if(0<=t.indexOf("422"))return void i(new Error(u["html_uploader.status.error.422"]+" (422)"));if(0<=t.indexOf("403"))return void i(new Error(u["html_uploader.status.error.403"]+" (403)"))}o._userAborted?i(t||new Error(u["html_uploader.status.error.aborted"])):2<=e?i(t):window.setTimeout(function(){o.uploadPresigned(n,r,s(++e))},150*e)}}var u=l.default.getMessages();this.setStatus(a.default.StatusLoading),addEventListener("unload",function(){o._status===a.default.StatusLoading&&(console.error("Page unloaded during upload, try to abort upload!"),o._doAbort())});try{f.default.getInstance().extensionAllowed(this)}catch(t){return this.onError(t.message),void e()}s(0)()}},{key:"_doAbort",value:function(t){if(this._status!==a.default.StatusLoaded){if(this.xhr)try{this._userAborted=!0,this.xhr.abort()}catch(t){}this.setStatus(a.default.StatusError),this.setProgress(0)}}},{key:"_doPause",value:function(){return this.xhr?this.xhr.pause?(this.xhr.pause(),this._parts&&this._parts.length&&this._parts.filter(function(t){return t.getStatus()===a.default.StatusLoading}).forEach(function(t){return t.setStatus(a.default.StatusCannotPause)}),a.default.StatusMultiPause):a.default.StatusCannotPause:a.default.StatusNew}},{key:"_doResume",value:function(){this.xhr&&this.xhr.resume&&this.xhr.resume()}},{key:"uploadPresigned",value:function(t,e,n){var r,o=this;try{r=this.getFullPath()}catch(t){return this.setStatus(a.default.StatusError),void this.setProgress(0)}this.getSize()<c.default.getMultipartThreshold()?c.default.getClient().uploadPresigned(this._file,r,t,n,e,this._userMeta).then(function(t){o.xhr=t}):c.default.getClient().uploadMultipart(this._file,r,t,n,e,this._userMeta).then(function(t){o.xhr=t})}}])&&d(t.prototype,e),n&&d(t,n),s}();n.default=t,e.exports=n.default},{"./Configs":2,"./PartItem":4,"./StatusItem":6,pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path"}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Store",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"Configs",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"UploadItem",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"FolderItem",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"PartItem",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"Session",{enumerable:!0,get:function(){return a.default}});var r=l(t("./Store")),o=l(t("./Configs")),i=l(t("./UploadItem")),s=l(t("./FolderItem")),u=l(t("./PartItem")),a=l(t("./Session"));function l(t){return t&&t.__esModule?t:{default:t}}},{"./Configs":2,"./FolderItem":3,"./PartItem":4,"./Session":5,"./Store":7,"./UploadItem":9}]},{},[10])(10)});