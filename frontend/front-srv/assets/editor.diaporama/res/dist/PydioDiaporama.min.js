!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PydioDiaporama=e()}(function(){return function n(o,i,u){function a(t,e){if(!i[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);throw(r=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=i[t]={exports:{}},o[t][0].call(r.exports,function(e){return a(o[t][1][e]||e)},r,r.exports,n,o,i,u)}return i[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)a(u[e]);return a}({1:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.onSizeChange=r.onTogglePlaying=r.onToggleResolution=r.onSelectionChange=void 0;var o=((n=e("pydio"))&&n.__esModule?n:{default:n}).default.requireLib("hoc").EditorActions;r.onSelectionChange=function(e){var t=e.dispatch,r=e.tab;return function(e){return t(o.tabModify({id:r.id,title:e.getLabel(),node:e}))}};r.onToggleResolution=function(e){var t=e.dispatch;return function(e){return t(o.editorModify({resolution:e?"hi":"lo"}))}};r.onTogglePlaying=function(e){var t=e.dispatch,r=e.tab;return function(e){return t(o.tabModify({id:r.id,playing:e}))}};r.onSizeChange=function(e){var t=e.dispatch;return function(e){return t(o.editorModify(e))}}},{pydio:"pydio"}],2:[function(e,t,r){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.ImageContainer=r.Image=void 0;var n,y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("react")),o=(n=e("prop-types"))&&n.__esModule?n:{default:n},i=["src","style"],d=["src","style","width","height","imgStyle","imgClassName","scale","mFont"];function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function b(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?f(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function g(e,t){if(null==e)return{};var r,n=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],0<=t.indexOf(r)||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r]);return n}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=v(r);return e=n?(e=v(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==u(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var j=function(){h(t,y.Component);var e=O(t);function t(){return l(this,t),e.apply(this,arguments)}return m(t,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.style,e=g(e,i),t=(t=t.replace(new RegExp("'","g"),"\\'")).replace(new RegExp("\\+","g"),encodeURIComponent("+"));return y.default.createElement("div",c({},e,{style:b(b({},r),{},{backgroundImage:"url('".concat(t,"')"),backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat",margin:"auto"})}))}}]),t}();r.Image=j,r.ImageContainer=function(){h(p,y.Component);var e=O(p);function p(){return l(this,p),e.apply(this,arguments)}return m(p,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.style,n=e.width,o=e.height,i=e.imgStyle,u=e.imgClassName,a=e.scale,c=void 0===a?1:a,f=e.mFont,a=g(e,d),e=this.props.editorData;if(e&&e.extensions&&0<e.extensions.length){var l=e.extensions[0],s=window[l];if(s&&s.getWrapper&&s.getWrapper("ImageContainer"))return y.default.createElement(s.getWrapper("ImageContainer"),b(b({},this.props),{},{style:b(b({},p.styles),r)}),y.default.createElement(j,{src:t,className:u,style:b({width:n&&n*c||"100%",height:o&&o*c||"100%"},i)}))}l=a||{},s=l.className,a=l.mimeFontOverlayStyle,l={};return f&&(l.position="relative"),y.default.createElement("div",{style:b(b(b({},p.styles),r),l),className:s},y.default.createElement(j,{src:t,className:u,style:b({width:n&&n*c||"100%",height:o&&o*c||"100%"},i)}),f&&y.default.createElement("div",{className:f+" mimefont mimefont-overlay",style:a}))}}],[{key:"propTypes",get:function(){return{src:o.default.string.isRequired,imgClassName:o.default.string,imgStyle:o.default.object,width:o.default.number,height:o.default.number}}},{key:"defaultProps",get:function(){return{src:""}}},{key:"styles",get:function(){return{flex:1,display:"flex",flexDirection:"column",alignItems:"center",overflow:"auto",width:"100%",height:"100%"}}}]),p}()},{"prop-types":"prop-types",react:"react"}],3:[function(e,t,r){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("react")),i=l(e("prop-types")),n=e("react-redux"),o=e("redux"),c=e("./components"),f=l(e("./sizes"));function l(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function p(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function y(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function d(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=O(r);return e=n?(e=O(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==u(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){return-1<j.mimes.indexOf(e.getAjxpMime())}var j=Pydio.getInstance().Registry.getActiveExtensionByType("editor").filter(function(e){return"editor.diaporama"===e.id})[0],P=pydio.getPluginConfigs("editor.diaporama"),w=P&&P.get("PREVIEWER_LOWRES_SIZES").split(",")||[300,700,1e3,1300],_=Pydio.requireLib("hoc"),S=_.withResolution,e=_.withSelection,P=_.withResize,_=_.EditorActions,x=P(c.ImageContainer),_=(0,n.connect)(null,_)(_=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(o,a.PureComponent);var e,t,r,n=h(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n.apply(this,arguments)}return e=o,r=[{key:"propTypes",get:function(){return{node:i.default.instanceOf(AjxpNode).isRequired}}}],(t=[{key:"componentWillReceiveProps",value:function(e){this.props.selectionPlaying!==e.selectionPlaying&&(e.selectionPlaying?this.pe=new PeriodicalExecuter(e.onRequestSelectionPlay,3):this.pe&&this.pe.stop());var t=this.props.editorModify;e.isActive&&t({fixedToolbar:!1})}},{key:"render",value:function(){var e,t=this.props,r=t.node,n=t.src,o=t.editorData;if(!r||!n)return null;var i=["diaporama-image-main-block"],t={boxShadow:"rgba(0, 0, 0, 0.117647) 0px 1px 6px, rgba(0, 0, 0, 0.117647) 0px 1px 4px"};return(e=r.getMetadata().get("image_exif_orientation")?r.getMetadata().get("image_exif_orientation"):e)&&(i=[].concat(d(i),["ort-rotate-"+e]),t.imageOrientation="none"),a.default.createElement(x,{editorData:o,node:r,src:n,renderOnChange:!0,passOnProps:!0,imgClassName:i.join(" "),imgStyle:t})}}])&&g(e.prototype,t),r&&g(e,r),o}())||_,_=(0,o.compose)(e(function(n){return new Promise(function(e,t){var r=[];n.getParent().getChildren().forEach(function(e){return r.push(e)}),e({selection:r=r.filter(v).sort(function(e,t){return e.getLabel().localeCompare(t.getLabel(),void 0,{numeric:!0})}),currentIndex:r.reduce(function(e,t,r){return t===n&&r||e},0)})})},v),S(w,function(e){return(0,f.default)(e,"hq")},function(e,t){return(0,f.default)(e,"editor")}),(0,n.connect)(function(e,t){var r=t.node,n=t.editorData;if(!r)return t;var o=e.tabs.filter(function(e){var t=e.editorData,e=e.node;return(!t||t.id===n.id)&&e.getPath()===r.getPath()})[0]||{};if(!o)return t;e=o.node;return y({orientation:"hi"===o.resolution?e.getMetadata().get("image_exif_orientation"):null},t)}))(_);r.default=_,t.exports=r.default},{"./components":2,"./sizes":6,"prop-types":"prop-types",react:"react","react-redux":"react-redux",redux:"redux"}],4:[function(e,t,r){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Badge",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(r,"Panel",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(r,"Editor",{enumerable:!0,get:function(){return i.default}}),r.Actions=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("./actions"));r.Actions=n;var o=a(e("./preview")),i=a(e("./editor"));function a(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},{"./actions":1,"./editor":3,"./preview":5}],5:[function(e,t,r){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("react")),a=e("./components"),c=(n=e("./sizes"))&&n.__esModule?n:{default:n},f=["node"];function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e,t){if(null==e)return{};var r,n=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],0<=t.indexOf(r)||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r]);return n}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(r);return e=n?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==u(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(o,i.Component);var e,t,r,n=b(o);function o(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this,e)).state={src:""},e}return e=o,(t=[{key:"componentDidMount",value:function(){var t=this,e=this.props.node;(0,c.default)(e,"preview").then(function(e){e&&t.setState({src:e})})}},{key:"render",value:function(){var e=this.props,t=e.node,e=p(e,f);t&&t.getMetadata().get("image_exif_orientation")&&(n=t.getMetadata().get("image_exif_orientation"),e.className?e.className+=" ort-rotate-"+n:e.className="ort-rotate-"+n,5<=parseInt(n)&&e.style&&200===e.style.height&&(e.style.height=250));var r,n=this.state.src;return n?(e.mimeFontOverlay&&t.isLeaf()&&t.getMetadata().get("ImagePreview")&&((t=t.getSvgSource())&&(r="mdi mdi-"+t)),i.default.createElement(a.ImageContainer,s({},e,{src:n,mFont:r,imgStyle:{width:"100%",height:"100%",flex:1}}))):null}}])&&y(e.prototype,t),r&&y(e,r),o}();r.default=g,t.exports=r.default},{"./components":2,"./sizes":6,react:"react"}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){if(!e)return Promise.resolve("");if(!e.getMetadata().get("thumbnails")&&e.getMetadata().get("ImagePreview"))return function(e){var t=e.getMetadata().get("ImagePreview"),r=u.default.getFileExtension(t);return i.default.getClient().buildPresignedGetUrl(e,null,"image/"+r,{Bucket:"io",Key:"pydio-thumbstore/"+t})}(e);var r=e.getMetadata().get("thumbnails")||[],n={};r.map(function(e){(n[e.size]=e).id&&(n[e.id]=e)});var o,r=Object.keys(n);r.length&&(o=n[r[0]].size);switch(t){case"preview":return n.sm?a(e,n.sm.size):n[256]?a(e,256):o?a(e,o):c(e);case"editor":return n.md?a(e,n.md.size):n[512]?a(e,512):o?a(e,o):c(e);default:return c(e)}};var i=n(e("pydio/http/api")),u=n(e("pydio/util/path"));function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return i.default.getClient().buildPresignedGetUrl(e,null,"image/jpeg",{Bucket:"io",Key:"pydio-thumbstore/"+e.getMetadata().get("uuid")+"-"+t+".jpg"})}function c(e){return i.default.getClient().buildPresignedGetUrl(e,null,"image/"+e.getAjxpMime())}t.exports=r.default},{"pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path"}]},{},[4])(4)});