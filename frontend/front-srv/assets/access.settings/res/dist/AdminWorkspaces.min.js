(()=>{"use strict";var e={509:e=>{e.exports=require("material-ui/styles")},81:e=>{e.exports=require("pydio/http/api")},514:e=>{e.exports=require("pydio/lang/observable")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};n.r(r),n.d(r,{DataSource:()=>Rt,DataSourceEditor:()=>cr,DataSourcesBoard:()=>ho,MetadataBoard:()=>To,TemplatePath:()=>St,TemplatePathEditor:()=>Ft,VirtualNodes:()=>$t,Workspace:()=>T,WsAutoComplete:()=>Z,WsDashboard:()=>ft});const o=require("react");var i=n.n(o);const a=require("create-react-class");var l=n.n(a);const s=require("prop-types");var c=n.n(s);const u=require("pydio");var d=n.n(u);const p=require("material-ui"),f=require("pydio/util/xml");var y=n.n(f),m=n(509),h=n(81),b=n.n(h);const g=require("pydio/util/lang");var v=n.n(g),S=n(514),w=n.n(S);const E=require("cells-sdk");function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,C(r.key),r)}}function C(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(P=function(){return!!e})()}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}var T=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=j(t),function(e,t){if(t&&("object"==O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,P()?Reflect.construct(t,n||[],j(e).constructor):t.apply(e,n))}(this,t)).internalAttributes={},n.dirty=!1,e?n.initModel(e):(n.create=!0,n.model=new E.IdmWorkspace,n.model.Scope=E.IdmWorkspaceScope.constructFromObject("ADMIN"),n.model.RootNodes={},n.internalAttributes={DEFAULT_RIGHTS:""},n.model.PoliciesContextEditable=!0,n.model.Attributes=JSON.stringify(n.internalAttributes)),n.observableModel=n.buildProxy(n.model),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}(t,e),n=t,o=[{key:"rootIsTemplatePath",value:function(e){return!(!e.MetaStore||!e.MetaStore.resolution)}},{key:"listWorkspaces",value:function(){var e=new E.WorkspaceServiceApi(b().getRestClient()),t=new E.RestSearchWorkspaceRequest,n=new E.IdmWorkspaceSingleQuery;return n.scope=E.IdmWorkspaceScope.constructFromObject("ADMIN"),t.Queries=[n],e.searchWorkspaces(t)}}],(r=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;return"Slug"===n?o=v().computeStringSlug(o):"Label"===n&&t.create&&(e.Slug=v().computeStringSlug(o)),e[n]=o,t.dirty=!0,t.notify("update"),!0},get:function(e,n){var r=e[n];return"Attributes"===n&&(r=t.internalAttributes),r instanceof Array?r:r instanceof Object?t.buildProxy(r):r}})}},{key:"initModel",value:function(e){if(this.create=!1,this.dirty=!1,this.model=e,this.snapshot=JSON.parse(JSON.stringify(e)),e.Attributes){var t=JSON.parse(e.Attributes);"object"===O(t)&&Object.keys(t).length&&(this.internalAttributes=t)}else this.internalAttributes={};e.RootNodes||(e.RootNodes={})}},{key:"getModel",value:function(){return this.observableModel}},{key:"hasTemplatePath",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(n){return t.rootIsTemplatePath(e.model.RootNodes[n])})).length>0}},{key:"hasFolderRoots",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(n){return!t.rootIsTemplatePath(e.model.RootNodes[n])})).length>0}},{key:"save",value:function(){var e=this;return this.model.Attributes=JSON.stringify(this.internalAttributes),new E.WorkspaceServiceApi(b().getRestClient()).putWorkspace(this.model.Slug,this.model).then((function(t){return e.initModel(t),e.observableModel=e.buildProxy(e.model),t}))}},{key:"remove",value:function(){return new E.WorkspaceServiceApi(b().getRestClient()).deleteWorkspace(this.model.Slug)}},{key:"revert",value:function(){var e=E.IdmWorkspace.constructFromObject(this.snapshot||{});this.initModel(e),this.observableModel=this.buildProxy(this.model)}},{key:"isValid",value:function(){return this.model.Slug&&this.model.Label&&Object.keys(this.model.RootNodes).length>0}},{key:"isDirty",value:function(){return this.dirty}}])&&k(n.prototype,r),o&&k(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(w());const N=require("lodash.debounce");var A=n.n(N);const R=require("pydio/util/path");var D=n.n(R),M=["muiTheme","children"];function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t,n){return(t=W(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,W(r.key),r)}}function W(e){var t=function(e){if("object"!=V(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==V(t)?t:t+""}function U(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(U=function(){return!!e})()}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},z.apply(null,arguments)}var J=d().requireLib("hoc"),Y=J.ModernAutoComplete,G=J.ModernTextField,Q=J.ThemedModernStyles,$=J.ModernSelectField,X=(0,m.muiThemeable)()((function(e){var t=e.muiTheme,n=e.children,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,M),o=Q(t);return i().createElement("div",z({style:o.fillBlockV2Right},r),n)})),Z=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,n){return t=q(t),function(e,t){if(t&&("object"==V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,U()?Reflect.construct(t,n||[],q(e).constructor):t.apply(e,n))}(this,t,[e]);var r=e.value,o=void 0===r?"":r;return n.debounced=A()((function(){var e=n.state.value;n.loadValues(e)}),300),n.state={nodes:[],value:o},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.validateOnLoad,n=this.state.value;this.loadValues(n,(function(){var n=e.state,r=n.nodes,o=n.value;r.filter((function(e){return e.Path===o&&(!e.Type||"COLLECTION"===e.Type&&!e.MetaStore&&!e.MetaStore.resolution)})).map((function(t){e.loadValues(o+"/")})),t&&e.handleNewRequest(o)}))}},{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({value:e}),e||(0,this.props.onDelete)()}},{key:"handleNewRequest",value:function(e){var t,n,r=this.state.nodes,o=this.props,i=o.onChange,a=void 0===i?function(){}:i,l=o.onDelete,s=void 0===l?function(){}:l,c=o.onError,u=void 0===c?function(){}:c;if("string"==typeof e){if(""===e)return void s();t=e,(n=r.filter((function(t){return t.Path===e}))[0])||(n=r.filter((function(t){return 0===t.Path.indexOf(e)}))[0])}else"object"===V(e)&&(t=e.key,n=e.node);if(!n)return u();this.setState({value:t}),a(t,n)}},{key:"loadValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e.lastIndexOf("/"),o=e.substr(0,r);if(null===this.lastSearch||this.lastSearch!==o){this.lastSearch=o,this.setState({loading:!0});var i=new E.AdminTreeServiceApi(b().getRestClient()),a=new E.TreeListNodesRequest,l=new E.TreeNode;l.Path=o+"/",a.Node=l,i.listAdminTree(a).then((function(e){t.setState({nodes:e.Children||[],loading:!1},(function(){return n()}))})).catch((function(){t.setState({loading:!1},(function(){return n()}))}))}}},{key:"render",value:function(){var e=this,n=this.state,r=n.value,o=n.nodes,a=n.loading,l=this.props,s=l.pydio,c=l.onDelete,u=l.onChange,d=l.isTemplatePath,f=l.skipTemplates,y=l.label,m=l.zDepth,h=void 0===m?0:m,b=function(e){return s.MessageHash["ajxp_admin."+e]||e},g=[];if(o){var S={};if(o.forEach((function(e){if(!(e.MetaStore&&e.MetaStore.resolution&&"cells"===e.Uuid||D().getBasename(e.Path).startsWith("."))){var n=t.renderNode(e,b);S[n.categ]||(S[n.categ]=[]),S[n.categ].push(n)}})),Object.keys(S).length>1){g.push({key:"h1",text:"",value:i().createElement(p.MenuItem,{primaryText:b("ws.complete.datasources"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var w=S[Object.keys(S)[0]];if(w.sort(v().arraySorter("text")),g.push.apply(g,B(w)),!f){g.push({key:"h2",text:"",value:i().createElement(p.MenuItem,{primaryText:b("ws.complete.templates"),style:{fontSize:13,fontWeight:500},disabled:!0,value:"____subheader____"})});var E=S[Object.keys(S)[1]];E.sort(v().arraySorter("text")),g.push.apply(g,B(E))}}else 1===Object.keys(S).length&&g.push.apply(g,B(S[Object.keys(S)[0]]))}var O=!0,k=i().createElement(Y,{fullWidth:!0,searchText:r,onUpdateInput:function(t){return e.handleUpdateInput(t)},onNewRequest:function(t){return e.handleNewRequest(t)},onClose:function(){return e.handleNewRequest(r)},dataSource:g,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},floatingLabelText:y||b("ws.complete.label"),openOnFocus:!0,menuProps:{maxHeight:200,desktop:!0},hasRightBlock:!0});if(r&&"/"!==r){if(d){var C=d.MetaStore.resolution.split("\n").pop(),P=r+" - "+b("ws.complete.resolves")+' "'+C+'"';k=i().createElement(G,{floatingLabelText:y||b("ws.complete.label"),variant:"v2",fullWidth:!0,value:P,inputStyle:{color:"inherit"},disabled:!0})}}else k=i().createElement($,{floatingLabelText:y||b("ws.complete.label"),variant:"v2",fullWidth:!0,maxHeight:300,onChange:function(e,t,n){u(n.Path,n)}},g.map((function(e){return e.value}))),O=!1;return i().createElement(p.Paper,{zDepth:h,style:_({display:"flex",alignItems:"center",margin:"2px 0"},this.props.style)},i().createElement("div",{style:{position:"relative",flex:1,height:60}},i().createElement("div",{style:{position:"absolute",right:0,top:30,width:30}},i().createElement(p.RefreshIndicator,{size:30,left:0,top:0,status:a?"loading":"hide"})),k),O&&i().createElement(X,null,i().createElement(p.IconButton,{style:{marginTop:2},iconStyle:{color:c?"#9e9e9e":"#eee"},iconClassName:"mdi mdi-delete",onClick:c,disabled:!c})))}}],o=[{key:"renderNode",value:function(e,t){var n=i().createElement("span",null,e.Path),r="mdi mdi-folder",o="folder";if(e.MetaStore&&e.MetaStore.resolution){r="mdi mdi-file-tree",o="templatePath";var a=e.MetaStore.resolution.split("\n").pop();n=i().createElement("span",null,e.Path," ",i().createElement("i",{style:{color:"#9e9e9e"}},"- ",t("ws.complete.resolves")," ",a))}else"LEAF"===e.Type&&(r="mdi mdi-file");return{key:e.Path,text:e.Path,node:e,categ:o,value:i().createElement(p.MenuItem,{value:e},i().createElement(p.FontIcon,{className:r,color:"#607d8b",style:{float:"left",marginRight:8,fontSize:20}})," ",n)}}}],r&&K(n.prototype,r),o&&K(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(i().Component);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ne(r.key),r)}}function ne(e){var t=function(e){if("object"!=ee(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(t)?t:t+""}var re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,n=[{key:"loadNamespaces",value:function(){return new E.UserMetaServiceApi(b().getRestClient()).listUserMetaNamespace()}},{key:"putNS",value:function(t){var n=new E.UserMetaServiceApi(b().getRestClient()),r=new E.IdmUpdateUserMetaNamespaceRequest;return r.Operation=E.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("PUT"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"deleteNS",value:function(t){var n=new E.UserMetaServiceApi(b().getRestClient()),r=new E.IdmUpdateUserMetaNamespaceRequest;return r.Operation=E.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("DELETE"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"clearLocalCache",value:function(){try{window.ReactMeta&&ReactMeta.Renderer.getClient().clearConfigs()}catch(e){}}}],null&&te(t.prototype,null),n&&te(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();re.MetaTypes={string:"Text",textarea:"Long Text",integer:"Number",boolean:"Boolean",date:"Date",choice:"Selection",tags:"Extensible Tags",stars_rate:"Stars Rating",css_label:"Color Labels",json:"JSON"};const oe=require("pydio/util/func");var ie=n.n(oe);const ae=require("pydio/http/resources-manager");var le=n.n(ae);function se(e,t){if(e){if("string"==typeof e)return ce(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pe(e,t,n){return(t=be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fe.apply(null,arguments)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,be(r.key),r)}}function he(e,t,n){return t&&me(e.prototype,t),n&&me(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function be(e){var t=function(e){if("object"!=Oe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Oe(t)?t:t+""}function ge(e,t,n){return t=Se(t),function(e,t){if(t&&("object"==Oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ve()?Reflect.construct(t,n||[],Se(e).constructor):t.apply(e,n))}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ve=function(){return!!e})()}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ee(e,t)}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}var ke=d().requireLib("hoc"),Ce=ke.ModernTextField,Pe=ke.ModernAutoComplete,je=ke.ThemedModernStyles;function xe(e){try{return JSON.parse(e.JsonDefinition).groupName||""}catch(e){return""}}function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var n=e.split("."),r=n.shift(),o=n.join(".");return le().loadClass(r).then((function(n){var i=ie().getFunctionByName(o,n);if(!i){if("object"===Oe(n)&&n[r]){var a=ie().getFunctionByName(o,n[r]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(n){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw n}))}var Ne=function(e){function t(e){return ye(this,t),ge(this,t,[e])}return we(t,e),he(t,[{key:"togglePolicies",value:function(e,t){var n=this.props,r=n.policies,o=void 0===r?[]:r,i=n.onChangePolicies,a=o.filter((function(t){return t.Action!==e}));a.push(E.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),"READ"===e&&t&&(a=a.filter((function(e){return"WRITE"!==e.Action}))).push(E.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Effect:"allow",Subject:"profile:admin"})),i(a)}},{key:"render",value:function(){var e,t,n=this,r=this.props,a=r.readonly,l=r.policies,s=r.pydio,c=r.muiTheme,u=function(e){return s.MessageHash["ajxp_admin.metadata."+e]||e},d=je(c);return l&&l.map((function(n){"profile:admin"===n.Subject&&"READ"===n.Action&&(e=!0),"profile:admin"===n.Subject&&"WRITE"===n.Action&&(t=!0)})),i().createElement(o.Fragment,null,i().createElement("div",null,i().createElement(p.Toggle,fe({label:u("toggle.read"),disabled:a,labelPosition:"left",toggled:e,onToggle:function(e,t){n.togglePolicies("READ",t)}},d.toggleFieldV2))),i().createElement("div",null,i().createElement(p.Toggle,fe({label:u("toggle.write"),labelPosition:"left",disabled:e||a,toggled:t,onToggle:function(e,t){n.togglePolicies("WRITE",t)}},d.toggleFieldV2))))}}])}(i().Component);Ne=(0,m.muiThemeable)()(Ne);var Ae=function(e){function t(e){var n;return ye(this,t),(n=ge(this,t,[e])).state={namespace:n.cloneNs(e.namespace),m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t},selectorNewKey:"",selectorNewValue:"",PoliciesBuilder:Ne},le().loadClass("ReactMeta").then((function(e){n.setState({metaModule:e});var t=n.props.policiesBuilder;t&&Te(t,Ne).then((function(e){return n.setState({PoliciesBuilder:e})}))})),n}return we(t,e),he(t,[{key:"cloneNs",value:function(e){return E.IdmUserMetaNamespace.constructFromObject(JSON.parse(JSON.stringify(e)))}},{key:"componentWillReceiveProps",value:function(e){if(e.open!==this.props.open){var t=e.create,n=e.namespaces,r=this.cloneNs(e.namespace);t&&n.length&&(r.Order=n.map((function(e){return e.Order||0})).reduce((function(e,t){return Math.max(e,t)}),0)+1),this.setState({namespace:r})}}},{key:"save",value:function(){var e=this,t=this.state.namespace;re.putNS(t).then((function(){e.props.onRequestClose(),e.props.reloadList()}))}},{key:"getHideValue",value:function(){var e=this.state.namespace;try{return JSON.parse(e.JsonDefinition).hide}catch(e){return!1}}},{key:"setHideValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(de(de({},n),{},{hide:e})),this.setState({namespace:t})}},{key:"setGroupValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(de(de({},n),{},{groupName:e})),this.setState({namespace:t})}},{key:"getAdditionalData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.state.namespace;try{var n=JSON.parse(t.JsonDefinition).data||e;if(e.items&&n.split){var r=n.split(",").map((function(e){var t,n,r=(t=e.split("|"),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,n)||se(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{key:r[0],value:r[1]}}));return{items:r}}return n}catch(e){}return e}},{key:"setAdditionalDataKey",value:function(e,t){var n=this.state.namespace,r=JSON.parse(n.JsonDefinition),o=pe({},e,t);r.data=de(de({},r.data),o),n.JsonDefinition=JSON.stringify(r),this.setState({namespace:n})}},{key:"togglePolicies",value:function(e,t){var n=this,r=this.state.namespace,o=(r.Policies||[]).filter((function(t){return t.Action!==e}));o.push(E.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),r.Policies=o,this.setState({namespace:r},(function(){"READ"===e&&t&&n.togglePolicies("WRITE",!0)}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.create,r=t.namespaces,o=t.pydio,a=t.readonly,l=t.muiTheme,s=this.state,c=s.namespace,u=s.m,f=s.PoliciesBuilder,y=s.metaModule,m=je(l);if(!y)return null;var h,g=y.TypeEditor;h=c.Label?c.Label:u("editor.title.create");var v="string";c.JsonDefinition&&(v=JSON.parse(c.JsonDefinition).type);var S,w,O=!1;if(c.Label?c.Namespace&&"usermeta-"!==c.Namespace||(O=!0,S=u("editor.ns.error")):(O=!0,w=u("editor.label.error")),n&&r.filter((function(e){return e.Namespace===c.Namespace})).length&&(O=!0,S=u("editor.ns.exists")),"choice"===v){var k=this.getAdditionalData({items:[]}).items;k&&k.length||(O=!0)}var C,P=function(e){if(Array.isArray(e))return ce(e)}(C=new Set(r.map((function(e){return xe(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(C)||se(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();c.Policies&&c.Policies.map((function(e){"profile:admin"===e.Subject&&e.Action,"profile:admin"===e.Subject&&e.Action}));var j=[i().createElement(p.FlatButton,{primary:!0,label:o.MessageHash[54],onClick:this.props.onRequestClose}),i().createElement(p.FlatButton,{primary:!0,disabled:O||a,label:o.MessageHash[53],onClick:function(){e.save()}})];"tags"!==v||a||j.unshift(i().createElement(p.FlatButton,{primary:!1,label:u("editor.tags.reset"),onClick:function(){new E.UserMetaServiceApi(b().getRestClient()).deleteUserMetaTags(c.Namespace,"*").then((function(){o.UI.displayMessage("SUCCESS",u("editor.tags.cleared").replace("%s",c.Namespace))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}}));var x={section:{marginTop:10,fontWeight:500,fontSize:12}};return i().createElement(p.Dialog,{title:h,actions:j,modal:!1,contentStyle:{width:520},open:this.props.open,onRequestClose:this.props.onRequestClose,autoScrollBodyContent:!0,bodyStyle:{padding:20}},i().createElement(g,{m:u,pydio:o,namespace:c,forcePrefix:"usermeta-",onChange:function(t){return e.setState({namespace:t})},readonly:a,create:n,labelError:w,nameError:S,styles:x}),i().createElement("div",{style:x.section},d().getInstance().MessageHash[310]),i().createElement(p.Toggle,fe({label:u("toggle.list-visibility"),disabled:a,labelPosition:"left",toggled:!this.getHideValue(),onToggle:function(t,n){e.setHideValue(!n)}},m.toggleFieldV2)),i().createElement(p.Toggle,fe({label:u("toggle.index"),disabled:a,labelPosition:"left",toggled:c.Indexable,onToggle:function(t,n){c.Indexable=n,e.setState({namespace:c})}},m.toggleFieldV2)),f&&i().createElement(f,{policies:c.Policies,readonly:a,onChangePolicies:function(t){return e.setState({namespace:de(de({},c),{},{Policies:t})})},pydio:o}),i().createElement("div",{style:x.section},u("order")),i().createElement(Ce,{floatingLabelText:u("order"),value:c.Order?c.Order:"0",onChange:function(t,n){c.Order=parseInt(n),e.setState({namespace:c})},fullWidth:!0,type:"number",readOnly:a,variant:"v2"}),i().createElement(Pe,{floatingLabelFixed:!0,fullWidth:!0,floatingLabelText:u("group-field"),filter:function(e,t){return!e.indexOf||0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,dataSource:P,searchText:xe(c)||"",onNewRequest:function(t,n){e.setGroupValue(t)},onUpdateInput:function(t){e.setGroupValue(t)},menuProps:{maxHeight:300,overflowY:"auto"}}))}}])}(i().Component);(Ae=(0,m.muiThemeable)()(Ae)).PropTypes={namespace:c().instanceOf(E.IdmUserMetaNamespace).isRequired,namespaces:c().arrayOf(E.IdmUserMetaNamespace),create:c().bool,reloadList:c().func,onRequestClose:c().func};const Re=Ae;function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){_e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t,n){return(t=function(e){var t=function(e){if("object"!=De(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==De(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ie={display:"flex",alignItems:"center",padding:"0 20px 0 8px",position:"absolute",height:64,zIndex:10,top:64,left:0,right:0,backgroundColor:"rgb(246 246 248)",boxShadow:"rgba(0, 0, 0, .1) 0px 1px 2px"};function Be(e,t,n,r,o,a,l){var s=Object.keys(e),c=0===s.indexOf(t),u=r||s.indexOf(t)===s.length-1,d=i().createElement("div",{style:Ie},i().createElement("div",{style:{flex:1}},i().createElement(p.Stepper,{activeStep:s.indexOf(t)},s.map((function(t){return i().createElement(p.Step,null,i().createElement(p.StepLabel,null,e[t]))}))))),f=i().createElement("div",{style:Le(Le({},Ie),{},{top:null,bottom:0,backgroundColor:"white",boxShadow:"rgba(0, 0, 0, .1) 0px -1px 2px"})},i().createElement("span",{style:{flex:1}}),i().createElement(p.FlatButton,{primary:!0,label:l.back,onClick:function(){var e=s.indexOf(t);e>0&&n(s[e-1])},disabled:c}),i().createElement(p.FlatButton,{primary:!0,label:l.next,onClick:function(){var e=s.indexOf(t);e<s.length-1&&n(s[e+1])},disabled:u}),i().createElement("div",{style:{width:1,height:40,backgroundColor:"#efefef",margin:"0 5px"}}),i().createElement(p.FlatButton,{primary:!0,label:l.save,onClick:o,disabled:!a()}));return{Steps:d,Buttons:f}}function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ve.apply(null,arguments)}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){Ue(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ue(e,t,n){return(t=He(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,He(r.key),r)}}function He(e){var t=function(e){if("object"!=Fe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fe(t)?t:t+""}function ze(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ze=function(){return!!e})()}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}function Ye(e,t){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ye(e,t)}var Ge=d().requireLib("hoc"),Qe=Ge.ModernTextField,$e=Ge.ModernSelectField,Xe=Ge.ThemedModernStyles,Ze=d().requireLib("form").InputIntegerBytes,et=AdminComponents,tt=et.PaperEditorLayout,nt=et.AdminStyles,rt=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,n){return t=Je(t),function(e,t){if(t&&("object"==Fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ze()?Reflect.construct(t,n||[],Je(e).constructor):t.apply(e,n))}(this,t,[e]);var r=e.presetModel||new T(e.workspace);r.observe("update",(function(){n.forceUpdate()})),n.state={workspace:r.getModel(),container:r,newFolderKey:Math.random(),showDialog:!1};var o=n.props.policiesBuilder;return o&&Te(o,null).then((function(e){return n.setState({PoliciesBuilder:e})})).catch((function(e){})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ye(e,t)}(t,e),n=t,(r=[{key:"enableSync",value:function(e){e?this.setState({showDialog:"enableSync",dialogTargetValue:e}):this.setState({showDialog:"disableSync",dialogTargetValue:e})}},{key:"confirmSync",value:function(e){this.state.workspace.Attributes.ALLOW_SYNC=e,this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"revert",value:function(){var e=this,t=this.state.container;t.revert(),this.setState({workspace:t.getModel()},(function(){e.forceUpdate()}))}},{key:"save",value:function(){var e=this,t=this.state.container,n=this.props,r=n.reloadList,o=n.closeEditor;this.setState({saving:!0});var i=t.create;t.save().then((function(){r(),e.setState({workspace:t.getModel(),saving:!1},(function(){e.forceUpdate()})),i&&o()})).catch((function(){e.setState({saving:!1})}))}},{key:"remove",value:function(){var e=this.state.container,t=this.props,n=t.closeEditor,r=t.reloadList,o=t.pydio;o.UI.openConfirmDialog({message:o.MessageHash["settings.35"],destructive:[e.getModel().Label],validCallback:function(){e.remove().then((function(){r(),n()}))}})}},{key:"render",value:function(){var e=this,t=this.props,n=t.closeEditor,r=t.pydio,a=t.advanced,l=t.muiTheme,s=this.state,c=s.workspace,u=s.container,d=s.newFolderKey,f=s.saving,y=s.showDialog,m=s.dialogTargetValue,h=s.PoliciesBuilder,b=s.policiesEdit,g=Xe(l),v=function(e){return r.MessageHash["ajxp_admin."+e]||e},S=function(e){return r.MessageHash["settings."+e]||e},w=function(e){return r.MessageHash["advanced_settings."+e]||e},E=!c.PoliciesContextEditable,O=[];u.create||E||O.push(tt.actionButton(v("plugins.6"),"mdi mdi-undo",(function(){e.revert()}),!u.isDirty())),E||O.push(tt.actionButton(r.MessageHash[53],"mdi mdi-content-save",(function(){e.save()}),f||!(u.isDirty()&&u.isValid())));var k=nt(this.props.muiTheme.palette),C={title:We(We({},k.body.block.headerFull),{},{margin:"0 -20px"}),legend:{padding:"16px 4px 8px"},section:We({padding:"0 20px 20px",margin:10,backgroundColor:"white"},k.body.block.container),toggleDiv:{},divider:{margin:"24px -20px 0px",height:1,border:"none",backgroundColor:"rgb(236 239 241)"}},P=c.RootNodes,j=Object.keys(P).map((function(t){var n=T.rootIsTemplatePath(P[t]),o=v(n?"ws.editor.path.template":"ws.complete.folders");return i().createElement(Z,{key:P[t].Uuid,pydio:r,label:o,value:P[t].Path,isTemplatePath:n?P[t]:null,onDelete:function(){delete P[t],e.forceUpdate()},onChange:function(e,n){console.log(P,e,n),delete P[t],""!==e&&(P[n.Uuid]=n)},skipTemplates:u.hasFolderRoots()})}));if(!u.hasTemplatePath()){var x=this.state.newRoot,N=void 0!==x&&x;!Object.keys(P).length||N?j.push(i().createElement(Z,{key:d,pydio:r,value:"",onChange:function(t,n){n&&(P[n.Uuid]=n,e.setState({newFolderKey:Math.random(),newRoot:!1}))},skipTemplates:u.hasFolderRoots()})):j.push(i().createElement(p.FlatButton,{label:"+ "+v("ws.complete.additional"),onClick:function(){return e.setState({newRoot:!0})},primary:!0}))}var A,R,M=function(e,t){return e};if(u.create){var L,_=this.state.currentPane,I=void 0===_?"data":_,B={data:v("ws.editor.data.title"),main:v("ws.30"),other:v("ws.editor.other")};M=function(e,t){return t===I?We(We({},e),{},{marginTop:80}):{display:"none"}},"data"===I&&0===Object.keys(P).length&&(L=!0);var F=Be(B,I,(function(t){"data"!==I||"main"!==t||1!==Object.keys(P).length||c.Label||(c.Label=D().getBasename(P[Object.keys(P)[0]].Path)),e.setState({currentPane:t})}),L,(function(){return e.save()}),(function(){return u.isValid()}),{back:v("ds.editor.tab.button-back"),next:v("ds.editor.tab.button-next"),save:v("ds.editor.tab.button-create")});A=F.Steps,R=F.Buttons}var V,K=i().createElement(p.Dialog,{open:y,title:v("ws.editor.sync.warning"),onRequestClose:function(){e.confirmSync(!m)},actions:[i().createElement(p.FlatButton,{label:r.MessageHash[54],onClick:function(){e.confirmSync(!m)}}),i().createElement(p.FlatButton,{label:v("ws.editor.sync.warning.validate"),onClick:function(){e.confirmSync(m)}})]},"enableSync"===y&&i().createElement("div",null,v("ws.editor.sync.warning.enable")),"disableSync"===y&&i().createElement("div",null,v("ws.editor.sync.warning.disable"))),W=i().createElement(p.Paper,{zDepth:0,style:M(C.section,"main")},i().createElement("div",{style:C.title},v("ws.30")),i().createElement("div",{style:C.legend},v("ws.editor.options.legend")),i().createElement(Qe,{fullWidth:!0,errorText:c.Label?"":v("ws.editor.label.legend"),floatingLabelText:S("8"),value:c.Label,onChange:function(e,t){c.Label=t},variant:"v2"}),i().createElement(Qe,{fullWidth:!0,errorText:c.Label&&!c.Slug?v("ws.editor.slug.legend"):"",floatingLabelText:v("ws.5"),value:c.Slug,onChange:function(e,t){c.Slug=t},variant:"v2"}),i().createElement(Qe,{fullWidth:!0,floatingLabelText:v("ws.editor.description"),value:c.Description,onChange:function(e,t){c.Description=t},variant:"v2"})),U=i().createElement(p.Paper,{zDepth:0,style:M(C.section,"data")},i().createElement("div",{style:C.title},v("ws.editor.data.title")),i().createElement("div",{style:C.legend},v("ws.editor.data.legend")),j,i().createElement("div",{style:C.legend},v("ws.editor.default_rights")),i().createElement($e,{fullWidth:!0,value:c.Attributes.DEFAULT_RIGHTS||"",onChange:function(e,t,n){c.Attributes.DEFAULT_RIGHTS=n},floatingLabelText:v("ws.editor.default_rights.hint"),variant:"v2"},i().createElement(p.MenuItem,{primaryText:v("ws.editor.default_rights.none"),value:""}),i().createElement(p.MenuItem,{primaryText:v("ws.editor.default_rights.read"),value:"r"}),i().createElement(p.MenuItem,{primaryText:v("ws.editor.default_rights.readwrite"),value:"rw"}),i().createElement(p.MenuItem,{primaryText:v("ws.editor.default_rights.write"),value:"w"}))),q=i().createElement(p.Paper,{zDepth:0,style:M(C.section,"other")},i().createElement("div",{style:C.title},v("ws.editor.other")),i().createElement("div",{style:We({},C.legend)},v("ws.editor.other.skiprecycle.legend")),i().createElement("div",{style:C.toggleDiv},i().createElement(p.Checkbox,Ve({label:v("ws.editor.other.skiprecycle"),labelPosition:"right",checked:c.Attributes.SKIP_RECYCLE,onCheck:function(e,t){c.Attributes.SKIP_RECYCLE=t}},g.toggleFieldV2))),a&&i().createElement(o.Fragment,null,i().createElement("hr",{style:C.divider}),i().createElement("div",{style:We({},C.legend)},v("ws.editor.other.sync.legend")),i().createElement("div",{style:C.toggleDiv},i().createElement(p.Checkbox,Ve({label:v("ws.editor.other.sync"),labelPosition:"right",checked:c.Attributes.ALLOW_SYNC,onCheck:function(t,n){!u.hasTemplatePath()&&n?e.enableSync(n):n?c.Attributes.ALLOW_SYNC=n:e.enableSync(n)}},g.toggleFieldV2))),i().createElement("hr",{style:C.divider}),i().createElement("div",{style:We({},C.legend)},v("ws.editor.other.quota")),i().createElement(Ze,{variant:"v2",attributes:{label:"Quota"},value:c.Attributes.QUOTA||0,onChange:function(e){e>0?c.Attributes.QUOTA=e+"":(c.Attributes.QUOTA="0",delete c.Attributes.QUOTA)}}),i().createElement("hr",{style:C.divider}),i().createElement("div",{style:We({},C.legend)},v("ws.editor.other.layout")),i().createElement($e,{fullWidth:!0,floatingLabelText:v("ws.editor.other.layout"),variant:"v2",value:c.Attributes.META_LAYOUT||"",onChange:function(e,t,n){c.Attributes.META_LAYOUT=n}},i().createElement(p.MenuItem,{primaryText:v("ws.editor.other.layout.default"),value:""}),i().createElement(p.MenuItem,{primaryText:v("ws.editor.other.layout.easy"),value:"meta.layout_sendfile"}))));return h&&(V=i().createElement(p.Paper,{zDepth:0,style:M(C.section,"policies")},i().createElement("div",{style:C.title},w("editor.visibility.workspace")),i().createElement("div",{style:We({},C.legend)},w("editor.visibility.warning"),!b&&i().createElement("span",{style:{fontWeight:500,cursor:"pointer"},onClick:function(){return e.setState({policiesEdit:!0})}}," - ",w("editor.visibility.edit"))),i().createElement(h,{pydio:r,policies:c.Policies,onChangePolicies:function(e){return c.Policies=e},readonly:!b,showHeader:!1,forceCustom:!0,advancedLegend:i().createElement("span",null),advancedContainerStyle:b?{paddingBottom:300}:{},allowedActions:{READ:w("policies.builder.action.read"),WRITE:w("policies.builder.action.write")}}))),i().createElement(tt,{title:c.Label||S("90"),titleLeftIcon:"mdi mdi-folder-open",titleActionBar:O,closeAction:n,className:"workspace-editor",contentFill:!1},A,K,W,U,q,V,R)}}])&&qe(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(o.Component);rt=(0,m.muiThemeable)()(rt);const ot=require("pydio/model/data-model");var it=n.n(ot);const at=require("pydio/model/node");var lt=n.n(at),st=d().requireLib("components").MaterialTable;const ct=l()({displayName:"WorkspaceList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:c().instanceOf(it()).isRequired,rootNode:c().instanceOf(lt()).isRequired,currentNode:c().instanceOf(lt()).isRequired,openSelection:c().func,advanced:c().boolean},getInitialState:function(){return{workspaces:[],loading:!1}},startLoad:function(){this.props.onLoadState&&this.props.onLoadState(!0),this.setState({loading:!0})},endLoad:function(){this.props.onLoadState&&this.props.onLoadState(!1),this.setState({loading:!1})},reload:function(){var e=this,t=localStorage.getItem("admin.workspace.autoload");localStorage.removeItem("admin.workspace.autoload"),this.startLoad(),T.listWorkspaces().then((function(n){if(e.endLoad(),e.setState({workspaces:n.Workspaces||[]}),t){var r=n.Workspaces.filter((function(e){return e.UUID===t}));1===r.length&&e.props.openSelection(r[0])}})).catch((function(t){e.endLoad()}))},componentDidMount:function(){this.reload()},openTableRows:function(e){e.length&&this.props.openSelection(e[0].workspace)},deleteAction:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.35"],destructive:[e.Label],validCallback:function(){new T(e).remove().then((function(){t.reload()}))}})},computeTableData:function(){var e=[],t=this.props.filterString;return this.state.workspaces.map((function(n){var r="";n.RootNodes&&(r=Object.keys(n.RootNodes).map((function(e){return v().trimRight(n.RootNodes[e].Path,"/")})).join(", "));var o=!1;if(n.Attributes)try{var i=JSON.parse(n.Attributes);!0!==i.ALLOW_SYNC&&"true"!==i.ALLOW_SYNC||(o=!0)}catch(e){}if(t){var a=t.toLowerCase(),l=n.Label&&n.Label.toLowerCase().indexOf(a)>=0,s=n.Description&&n.Description.toLowerCase().indexOf(a)>=0,c=r&&r.toLowerCase().indexOf(a)>=0;if(!(l||s||c))return}e.push({workspace:n,label:n.Label,description:n.Description,slug:n.Slug,summary:r,syncable:o})})),e.sort(v().arraySorter("label",!1,!0)),e},render:function(){var e=this,t=this.props,n=t.pydio,r=t.advanced,o=t.editable,a=t.tableStyles,l=t.openSelection,s=function(e){return n.MessageHash["ajxp_admin."+e]},c=function(e){return n.MessageHash["settings."+e]},u=[{name:"label",label:c("8"),style:{width:"20%",fontSize:15},headerStyle:{width:"20%"},sorter:{type:"string",default:"true"}},{name:"description",label:c("103"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"summary",label:s("ws.board.summary"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}}];r&&u.push({name:"syncable",label:s("ws.board.syncable"),style:{width:"10%",textAlign:"center"},headerStyle:{width:"10%",textAlign:"center"},sorter:{type:"number",sortValue:function(e){return e.syncable?1:0}},renderCell:function(e){return i().createElement("span",{className:"mdi mdi-check",style:{fontSize:18,opacity:e.syncable?1:0}})}}),u.push({name:"slug",label:s("ws.5"),style:{width:"20%"},headerStyle:{width:"20%"},sorter:{type:"string"}});var d=this.state.loading,p=this.computeTableData(),f=[];o&&f.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit Workspace",onClick:function(e){l(e.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}});var y=n.user.getRepositoriesList();return f.push({iconClassName:"mdi mdi-open-in-new",tooltip:"Open this workspace...",onClick:function(e){n.triggerRepositoryChange(e.workspace.UUID)},disable:function(e){return!y.has(e.workspace.UUID)}}),o&&f.push({iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteAction(t.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}}),i().createElement(st,{data:p,columns:u,actions:f,onSelectRows:o?this.openTableRows.bind(this):null,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:s(d?"loading":"ws.board.empty"),masterStyles:a,paginate:[10,25,50,100],defaultPageSize:25,storageKey:"console.workspaces.list"})}});function ut(){return ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ut.apply(null,arguments)}var dt=d().requireLib("hoc").ModernTextField,pt=l()({displayName:"WsDashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:c().instanceOf(it()).isRequired,rootNode:c().instanceOf(lt()).isRequired,currentNode:c().instanceOf(lt()).isRequired,openEditor:c().func.isRequired,openRightPane:c().func.isRequired,closeRightPane:c().func.isRequired,accessByName:c().func.isRequired,advanced:c().boolean},getInitialState:function(){return{selectedNode:null,searchString:""}},dirtyEditor:function(){var e=this.props.pydio;return!(!this.refs.editor||!this.refs.editor.isDirty()||confirm(e.MessageHash["role_editor.19"]))},openWorkspace:function(e){var t=this;if(!this.dirtyEditor()){var n=rt,r=y().XPathSelectSingleNode(this.props.pydio.getXmlRegistry(),'//client_configs/component_config[@component="AdminWorkspaces.Dashboard"]/editor');r&&(n=r.getAttribute("namespace")+"."+r.getAttribute("component"));var o=this.props,i=o.pydio,a=o.advanced,l=(o.accessByName,o.policiesBuilder),s={COMPONENT:n,PROPS:{ref:"editor",pydio:i,workspace:e,closeEditor:this.closeWorkspace,advanced:a,policiesBuilder:l,reloadList:function(){t.refs.workspacesList.reload()}}};return this.props.openRightPane(s),!0}},closeWorkspace:function(){this.dirtyEditor()||this.props.closeRightPane()},showWorkspaceCreator:function(e){var t=this,n=this.props,r=n.pydio,o=n.advanced,i={COMPONENT:rt,PROPS:{ref:"editor",type:e,pydio:r,advanced:o,closeEditor:this.closeWorkspace,reloadList:function(){t.refs.workspacesList.reload()}}};this.props.openRightPane(i)},reloadWorkspaceList:function(){this.refs.workspacesList.reload()},render:function(){var e=this,t=this.props,n=t.pydio,r=t.advanced,o=t.currentNode,a=t.accessByName,l=t.muiTheme,s=this.state,c=s.searchString,u=s.loading,d=AdminComponents.AdminStyles(l.palette),f=[];a("Create")&&f.push(i().createElement(p.FlatButton,ut({primary:!0,label:this.context.getMessage("ws.3"),onClick:this.showWorkspaceCreator},d.props.header.flatButton)));var y=i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},i().createElement("div",{style:{maxWidth:420,flex:1,paddingLeft:8}},i().createElement(dt,{fullWidth:!0,hintText:this.context.getMessage("ws.filter.workspaces"),value:c,onChange:function(t,n){return e.setState({searchString:n})},variant:"compact"})));return i().createElement("div",{className:"main-layout-nav-to-stack vertical-layout workspaces-board"},i().createElement(AdminComponents.Header,{title:o.getLabel(),icon:"mdi mdi-folder-open",actions:f,centerContent:y,reloadAction:this.reloadWorkspaceList,loading:u}),i().createElement("div",{className:"layout-fill"},i().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("ws.dashboard","ajxp_admin")}),i().createElement(p.Paper,ut({},d.body.block.props,{style:d.body.block.container}),i().createElement(ct,{ref:"workspacesList",pydio:n,openSelection:this.openWorkspace,advanced:r,editable:a("Create"),onLoadState:function(t){e.setState({loading:t})},tableStyles:d.body.tableMaster,filterString:c}))))}});const ft=(0,m.muiThemeable)()(pt);function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vt(r.key),r)}}function ht(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ht=function(){return!!e})()}function bt(e){return bt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bt(e)}function gt(e,t){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gt(e,t)}function vt(e){var t=function(e){if("object"!=yt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==yt(t)?t:t+""}var St=function(e){function t(e){var n,r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,n){return t=bt(t),function(e,t){if(t&&("object"==yt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ht()?Reflect.construct(t,n||[],bt(e).constructor):t.apply(e,n))}(this,t),r=n,i=void 0,(o=vt(o="data"))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,e?n.data=e:(n.data=new E.TreeNode,n.data.Type=E.TreeNodeType.constructFromObject("COLLECTION"),n.data.MetaStore={name:"",resolution:"",onDelete:"",contentType:"text/javascript"}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gt(e,t)}(t,e),n=t,o=[{key:"loadNodes",value:function(e){var n=new E.ConfigServiceApi(b().getRestClient());d().startLoading(),n.listVirtualNodes().then((function(n){d().endLoading();var r=[];n.Children&&n.Children.map((function(e){r.push(new t(e))})),e(r)})).catch((function(){d().endLoading()}))}}],(r=[{key:"getName",value:function(){return this.data.MetaStore.name}},{key:"setName",value:function(e){this.data.MetaStore.name=e;var t=v().computeStringSlug(e);this.data.Uuid=t,this.data.Path=t,this.notify("update")}},{key:"getValue",value:function(){return this.data.MetaStore.resolution}},{key:"setValue",value:function(e){this.data.MetaStore.resolution=e,this.notify("update")}},{key:"getOnDelete",value:function(){return this.data.MetaStore.onDelete}},{key:"setOnDelete",value:function(e){this.data.MetaStore.onDelete=e,this.notify("update")}},{key:"save",value:function(e){var t=this;le().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(b().getRestClient()).putVirtualNode(t.data.Uuid,t.data).then((function(){e()}))}))}},{key:"remove",value:function(e){var t=this;le().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(b().getRestClient()).deleteVirtualNode(t.data.Uuid).then((function(){e()}))}))}}])&&mt(n.prototype,r),o&&mt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(w());function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){kt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kt(e,t,n){return(t=Pt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pt(r.key),r)}}function Pt(e){var t=function(e){if("object"!=wt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==wt(t)?t:t+""}function jt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(jt=function(){return!!e})()}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tt(e,t)}var Nt=n(514),At=n(81),Rt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flat";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=xt(t),function(e,t){if(t&&("object"==wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,jt()?Reflect.construct(t,n||[],xt(e).constructor):t.apply(e,n))}(this,t)).internalInvalid=!1,n.nameInvalid=!1,n.existingNames=r,e)n.model=e,e.StorageConfiguration||(e.StorageConfiguration={}),n.snapshot=JSON.parse(JSON.stringify(e));else switch(n.model=new E.ObjectDataSource,n.model.EncryptionMode=E.ObjectEncryptionMode.constructFromObject("CLEAR"),n.model.StorageType=E.ObjectStorageType.constructFromObject("LOCAL"),o){case"flat":n.model.StorageConfiguration={folder:"",normalize:"false"},n.model.FlatStorage=!0;break;case"structured":n.model.StorageConfiguration={folder:"",normalize:"false"},n.model.FlatStorage=!1;break;case"internal":n.model.StorageConfiguration={folder:"",normalize:"false",cellsInternal:"true"},n.model.FlatStorage=!0}return n.observableModel=n.buildProxy(n.model),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}(t,e),n=t,r=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;if("StorageType"===n){var i=e.StorageConfiguration&&"true"===e.StorageConfiguration.cellsInternal;e.StorageConfiguration=i?{cellsInternal:"true"}:{},"LOCAL"===o?e.StorageConfiguration=Ot({folder:"",normalize:"false"},e.StorageConfiguration):"S3"===o?e.StorageConfiguration=Ot({customEndpoint:""},e.StorageConfiguration):"GCS"===o&&(e.StorageConfiguration=Ot({jsonCredentials:""},e.StorageConfiguration)),t.internalInvalid=!1,e.ApiKey=e.ApiSecret=""}else if("Name"===n)o=v().computeStringSlug(o).replace("-","").substr(0,33),t.existingNames&&t.existingNames.indexOf(o)>-1?t.nameInvalid=!0:t.nameInvalid=!1;else if("folder"===n)"/"!==o[0]&&(o="/"+o);else{if("invalid"===n)return t.internalInvalid=r,t.notify("update"),!0;"PeerAddress"===n&&"ANY"===r&&(o="")}return e[n]=o,t.notify("update"),!0},get:function(e,n){var r=e[n];return r instanceof Array?r:r instanceof Object?t.buildProxy(r):"StorageType"===n?r||"LOCAL":"PeerAddress"===n?r||"ANY":r}})}},{key:"getModel",value:function(){return this.observableModel}},{key:"isValid",value:function(){return!this.internalInvalid&&!this.nameInvalid&&("S3"===this.model.StorageType||"AZURE"===this.model.StorageType?this.model.ApiKey&&this.model.ApiSecret&&this.model.Name&&(this.model.ObjectsBucket||this.model.StorageConfiguration.bucketsRegexp):"GCS"===this.model.StorageType?this.model.Name&&this.model.ObjectsBucket&&this.model.StorageConfiguration&&this.model.StorageConfiguration.jsonCredentials:this.model.Name&&this.model.StorageConfiguration&&this.model.StorageConfiguration.folder)}},{key:"getNameError",value:function(e){return this.nameInvalid?e("name.inuse"):null}},{key:"deleteSource",value:function(){return new E.ConfigServiceApi(At.getRestClient()).deleteDataSource(this.model.Name)}},{key:"resyncSource",value:function(){var e=new E.JobsServiceApi(At.getRestClient()),t=new E.RestUserJobRequest;return t.JobName="datasource-resync",t.JsonParameters=JSON.stringify({dsName:this.model.Name}),e.userCreateJob("datasource-resync",t)}},{key:"revert",value:function(){return this.model=this.snapshot,this.observableModel=this.buildProxy(this.model),this.snapshot=JSON.parse(JSON.stringify(this.model)),this.observableModel}},{key:"saveSource",value:function(){var e=this;return new E.ConfigServiceApi(At.getRestClient()).putDataSource(this.model.Name,this.model).then((function(t){e.snapshot=JSON.parse(JSON.stringify(e.model)),e.notify("update")}))}},{key:"stripPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return e;var n={};return Object.keys(e).map((function(r){n[r.replace(t,"")]=e[r]})),n}},{key:"getDataWithPrefix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.model;var n={};return Object.keys(this.model).forEach((function(r){n[t+r]=e.model[r],"EncryptionMode"!==r||e.model[r]||(n[t+r]="CLEAR")})),n}}],o=[{key:"loadDatasources",value:function(){return new E.ConfigServiceApi(At.getRestClient()).listDataSources()}},{key:"loadVersioningPolicies",value:function(){return new E.ConfigServiceApi(At.getRestClient()).listVersioningPolicies()}},{key:"loadStatuses",value:function(){return new E.ConfigServiceApi(At.getRestClient()).listServices("STARTED")}},{key:"loadEncryptionKeys",value:function(){return new E.ConfigServiceApi(At.getRestClient()).listEncryptionKeys(new E.EncryptionAdminListKeysRequest)}},{key:"loadBuckets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new E.ConfigServiceApi(At.getRestClient()),r=new E.RestListStorageBucketsRequest;return r.DataSource=e,t&&(r.BucketsRegexp=t),n.listStorageBuckets(r)}},{key:"createBucket",value:function(e,t){var n=new E.ConfigServiceApi(At.getRestClient()),r=new E.RestCreateStorageBucketRequest;return r.DataSource=e,n.createStorageBucket(t,r)}}],r&&Ct(n.prototype,r),o&&Ct(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Nt);function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Lt(r.key),r)}}function Lt(e){var t=function(e){if("object"!=Dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dt(t)?t:t+""}function _t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_t=function(){return!!e})()}function It(e){return It=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},It(e)}function Bt(e,t){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bt(e,t)}var Ft=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,n){return t=It(t),function(e,t){if(t&&("object"==Dt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_t()?Reflect.construct(t,n||[],It(e).constructor):t.apply(e,n))}(this,t,[e]);var r=e.node.getValue(),o=!1;return r||(r='// Compute the Path variable that this node must resolve to. \n// Use Ctrl+Space to see the objects available for completion.\nPath = "";',o=!0),n.state={value:r,cleanOnDelete:"rename-uuid"===e.node.getOnDelete(),dirty:o},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bt(e,t)}(t,e),n=t,(r=[{key:"onChange",value:function(e,t){this.setState({value:t,dirty:!0})}},{key:"save",value:function(){var e=this,t=this.props,n=t.node,r=t.onSave,o=void 0===r?function(){}:r,i=this.state,a=i.value,l=i.cleanOnDelete;n.setValue(a),l?n.setOnDelete("rename-uuid"):n.setOnDelete(""),n.save((function(){e.setState({dirty:!1},o)}))}},{key:"remove",value:function(){var e=this;this.props.node.remove((function(){e.props.reloadList()}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.pydio,r=t.dataSources,o=t.readonly,a=t.oneLiner,l=t.onClose,s=void 0===l?function(){}:l,c=this.state,u=c.value,d=c.dirty,f=c.cleanOnDelete,y=function(e){return n.MessageHash["ajxp_admin.virtual."+e]||e},m={};r&&r.map((function(e){m[e.Name]=e.Name}));var h={Path:"",DataSources:m,User:{Name:"",Uuid:"",GroupPath:"",GroupFlat:"",Profile:"",DisplayName:"",Email:"",AuthSource:"",Roles:[]}},b=i().createElement(AdminComponents.CodeMirrorField,{mode:"javascript",globalScope:h,value:u,onChange:this.onChange.bind(this),readOnly:o}),g=y("card.cleanOnDelete"),v=u&&u.indexOf("User.Name")>=0;return v?f||(g=i().createElement("span",null,g," ",i().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-on"))):g=i().createElement("span",null,g," ",i().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-off")),a?i().createElement("div",{style:{display:"flex"}},i().createElement("div",{style:{flex:1,lineHeight:"40px"}},b),i().createElement("div",{style:{display:"flex"}},i().createElement(p.IconButton,{iconClassName:"mdi mdi-content-save",onClick:this.save.bind(this),disabled:!d,tooltip:"Save"}),i().createElement(p.IconButton,{iconClassName:"mdi mdi-close",onClick:function(){return s()},tooltip:"Close"}))):i().createElement("div",{style:{backgroundColor:"#f5f5f5",paddingBottom:12}},i().createElement("div",{style:{padding:o?"16px 24px 8px":"10px 24px 0",fontWeight:500,display:"flex",alignItems:"center"}},i().createElement("div",{style:{flex:1}},y("card.title")),!o&&i().createElement(p.FlatButton,{onClick:this.save.bind(this),primary:!0,disabled:!d,label:y("save")})),i().createElement("div",{style:{margin:"6px 24px 0 24px",border:"1px solid #e0e0e0"}},b),i().createElement("div",{style:{margin:"12px 24px",opacity:v?1:.4}},i().createElement(p.Checkbox,{disabled:o,checked:f,onCheck:function(t,n){e.setState({cleanOnDelete:n,dirty:!0})},label:g})))}}])&&Mt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Kt(){return Kt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Kt.apply(null,arguments)}function Wt(e){return function(e){if(Array.isArray(e))return Ut(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ut(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ut(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ht(r.key),r)}}function Ht(e){var t=function(e){if("object"!=Vt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vt(t)?t:t+""}function zt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(zt=function(){return!!e})()}function Jt(e){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jt(e)}function Yt(e,t){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yt(e,t)}var Gt=d().requireLib("hoc").ModernTextField,Qt=d().requireLib("components").MaterialTable,$t=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Jt(t),function(e,t){if(t&&("object"==Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,zt()?Reflect.construct(t,n||[],Jt(e).constructor):t.apply(e,n))}(this,t,[e])).state={nodesLoaded:!1,nodes:[],dataSourcesLoaded:!1,dataSources:[]},St.loadNodes((function(e){n.setState({nodes:e,nodesLoaded:!0})})),Rt.loadDatasources().then((function(e){n.setState({dataSources:e.DataSources,dataSourcesLoaded:!0})})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yt(e,t)}(t,e),n=t,(r=[{key:"reload",value:function(){var e=this;this.setState({nodesLoaded:!1}),St.loadNodes((function(t){e.setState({nodes:t,nodesLoaded:!0})}))}},{key:"createNode",value:function(){this.handleRequestClose();var e=this.state,t=e.newName,n=e.nodes,r=new St;r.setName(t),this.setState({nodes:[].concat(Wt(n),[r]),selectedNode:t,newName:null})}},{key:"setNewName",value:function(e){var t,n=this.props.pydio,r=this.state.dataSources;this.setState({newName:e}),r.filter((function(t){return t.Name===e})).length?this.setState({newNameError:(t="create.error",n.MessageHash["ajxp_admin.virtual."+t]||t)}):this.setState({newNameError:null})}},{key:"handleTouchTap",value:function(e){var t=this;e.preventDefault(),this.setState({newName:"",open:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newNode&&t.refs.newNode.focus()}),300)}))}},{key:"handleRequestClose",value:function(){this.setState({open:!1,newName:"",newNameError:null})}},{key:"render",value:function(){var e=this,t=this.props,n=t.readonly,r=t.pydio,o=t.muiTheme,a=t.accessByName,l=this.state,s=l.nodes,c=l.dataSources,u=l.nodesLoaded,d=l.dataSourcesLoaded,f=l.selectedNode,y=l.newName,m=l.newNameError,h=function(e){return r.MessageHash["ajxp_admin.virtual."+e]||e},b=AdminComponents.AdminStyles(o.palette),g=s.map((function(t){return t.getName()===f?{node:t,expandedRow:i().createElement(Ft,{pydio:r,dataSources:c,node:t,reloadList:e.reload.bind(e),readonly:n||!a("Create"),adminStyles:b,onSave:e.reload.bind(e)})}:{node:t}})),v=[];!n&&a("Create")&&v.push(i().createElement(p.FlatButton,Kt({primary:!0,label:h("create"),onClick:this.handleTouchTap.bind(this),disabled:!d},b.props.header.flatButton)));var S=[{name:"id",label:h("col.id"),style:{width:"25%",fontSize:15},headerStyle:{width:"25%"},renderCell:function(e){return e.node.getName()},sorter:{type:"string"}},{name:"code",label:h("col.code"),renderCell:function(e){return i().createElement("pre",null,e.node.getValue().split("\n").pop())}}],w=[];return n?w.push({iconClassName:"mdi mdi-eye",tooltip:h("code.display"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}):(w.push({iconClassName:"mdi mdi-pencil",tooltip:h("code.edit"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}),w.push({iconClassName:"mdi mdi-delete",tooltip:h("delete"),onClick:function(t){r.UI.openConfirmDialog({message:h("delete.confirm"),destructive:[t.node.getName()],validCallback:function(){t.node.remove((function(){e.reload()}))}})},disable:function(e){return"cells"===e.node.getName()||"my-files"===e.node.getName()}})),i().createElement("div",{className:"vertical-layout workspaces-list layout-fill",style:{height:"100%"}},i().createElement(AdminComponents.Header,{title:h("title"),icon:"mdi mdi-help-network",actions:v,reloadAction:this.reload.bind(this),loading:!(u&&d)}),i().createElement(p.Popover,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},i().createElement("div",{style:{margin:"10px 20px 0",width:320}},i().createElement(Gt,{ref:"newNode",variant:"v2",fullWidth:!0,floatingLabelText:h("create"),value:y,onChange:function(t,n){e.setNewName(n)},hintText:h("label.new"),errorText:m})),i().createElement("div",{style:{textAlign:"right",padding:"5px 20px 20px"}},i().createElement(p.FlatButton,Kt({label:r.MessageHash[54],onClick:this.handleRequestClose.bind(this)},b.props.header.flatButton)),i().createElement(p.FlatButton,Kt({primary:!0,label:h("create.button"),onClick:this.createNode.bind(this)},b.props.header.flatButton,{disabled:!!m||!y})))),i().createElement("div",{className:"layout-fill",style:{overflowY:"auto"}},i().createElement("div",{style:{padding:20,paddingBottom:0}},h("legend.1")),u&&d&&i().createElement(p.Paper,Kt({},b.body.block.props,{style:b.body.block.container}),i().createElement(Qt,{columns:S,data:g,actions:w,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:b.body.tableMaster,storageKey:"console.templatepaths.list"})),(!u||!d)&&i().createElement("div",{style:{margin:16,textAlign:"center",padding:20}},r.MessageHash["ajxp_admin.loading"]),!n&&a("Create")&&i().createElement("div",{style:{padding:"0 24px",opacity:".5"}},h("legend.2"))))}}])&&qt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function Xt(e){return Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(e)}function Zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(n),!0).forEach((function(t){tn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tn(e,t,n){return(t=sn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nn(e){return function(e){if(Array.isArray(e))return rn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function on(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sn(r.key),r)}}function ln(e,t,n){return t&&an(e.prototype,t),n&&an(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function sn(e){var t=function(e){if("object"!=Xt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Xt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xt(t)?t:t+""}function cn(e,t,n){return t=dn(t),function(e,t){if(t&&("object"==Xt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,un()?Reflect.construct(t,n||[],dn(e).constructor):t.apply(e,n))}function un(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(un=function(){return!!e})()}function dn(e){return dn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dn(e)}function pn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fn(e,t)}function fn(e,t){return fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fn(e,t)}$t=(0,m.muiThemeable)()($t);var yn=d().requireLib("hoc"),mn=yn.ModernTextField,hn=yn.ModernSelectField,bn=yn.ModernAutoComplete,gn=function(e){function t(e){var n;return on(this,t),(n=cn(this,t,[e])).debounced=A()(n.loadValues.bind(n),300),n.state={searchText:e.value,value:e.value},n}return pn(t,e),ln(t,[{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({searchText:e})}},{key:"handleNewRequest",value:function(e){var t,n=this.state.nodes,r=!1;if(void 0===e.key){t="/"+v().trim(e,"/");var o=!1;n.map((function(e){e.Path!==t&&0!==e.Path.indexOf(t+"/")||(o=!0)})),o&&(r=!0)}else t=e.key,r=!0;this.setState({value:t,exist:r}),this.props.onChange(t,r),this.loadValues(t)}},{key:"componentWillMount",value:function(){this.lastSearch=null;var e="";this.props.value&&(e=this.props.value),this.loadValues(e)}},{key:"componentWillReceiveProps",value:function(e){e.value&&e.value!==this.state.value&&this.setState({value:e.value,exist:!0})}},{key:"loadValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props.peerAddress,r=this.state.searchText,o=t;if(!t&&r){var i=r.lastIndexOf("/");o=r.substr(0,i)}if(null!==this.lastSearch&&this.lastSearch===o)return Promise.resolve();this.lastSearch=o;var a=new E.ConfigServiceApi(b().getRestClient()),l=new E.RestListPeerFoldersRequest;return l.PeerAddress="ANY"===n?"":n,l.Path=o,this.setState({loading:!0}),a.listPeerFolders(n,l).then((function(t){var n=t.Children||[];n=n.map((function(e){return"/"!==e.Path[0]&&(e.Path="/"+e.Path),e})),e.setState({nodes:n,loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"createFolder",value:function(e){var t=this,n=this.props,r=n.peerAddress,o=n.pydio,i=this.state.value,a=new E.ConfigServiceApi(b().getRestClient()),l=new E.RestCreatePeerFolderRequest;l.PeerAddress="ANY"===r?"":r,l.Path=i+"/"+e,a.createPeerFolder(r,l).then((function(e){t.lastSearch=null,t.loadValues(i).then((function(){t.handleNewRequest({key:l.Path}),t.setState({searchText:l.Path})}))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}},{key:"renderNode",value:function(e){var t=D().getBasename(e.Path),n=D().getDirname(e.Path),r=i().createElement("span",null,e.Path);return v().computeStringSlug(t)!==t?r=i().createElement("span",null,i().createElement("span",null,n),"/",i().createElement("span",{style:{color:"#c62828"}},t)):e.MetaStore&&e.MetaStore.symlink&&(r=i().createElement("span",null,i().createElement("span",null,n),"/",i().createElement("span",{style:{color:"#1976d2"}},t))),{key:e.Path,text:e.Path,invalid:!1,value:i().createElement(p.MenuItem,null,i().createElement(p.FontIcon,{className:"mdi mdi-folder",color:"#616161",style:{float:"left",marginRight:8}})," ",r)}}},{key:"showCreateDialog",value:function(){var e=this,t=this.props.pydio,n=this.state.value,r=function(e){return t.MessageHash["ajxp_admin.ds.editor.selector."+e]||e};t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:r("mkdir"),legendId:r("mkdir.legend").replace("%s",n),fieldLabelId:r("mkdir.field"),submitValue:function(t){t&&e.createFolder(t)}})}},{key:"render",value:function(){var e=this,t=this.state,n=t.nodes,r=t.loading,o=t.exist,a=t.value,l=t.searchText,s=this.props,c=s.fieldLabel,u=s.pydio,d=[];n&&n.forEach((function(t){d.push(e.renderNode(t))}));var f=l||a;return i().createElement("div",{style:{position:"relative",marginTop:-5}},i().createElement("div",{style:{position:"absolute",right:6,top:29,width:30,zIndex:1}},i().createElement(p.RefreshIndicator,{size:25,left:0,top:0,status:r?"loading":"hide"})),a&&o&&!r&&(!l||l===a)&&i().createElement("div",{style:{position:"absolute",right:0,zIndex:1,top:18}},i().createElement(p.IconButton,{iconClassName:"mdi mdi-folder-plus",iconStyle:{color:"#9e9e9e"},onClick:function(){return e.showCreateDialog()},tooltip:u.MessageHash["ajxp_admin.ds.editor.selector.mkdir"],tooltipPosition:"top-center"})),i().createElement(bn,{fullWidth:!0,searchText:f,onUpdateInput:this.handleUpdateInput.bind(this),onNewRequest:this.handleNewRequest.bind(this),dataSource:d,hintText:c,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,menuProps:{maxHeight:200}}))}}])}(i().Component),vn=function(e){function t(e){var n;return on(this,t),(n=cn(this,t,[e])).state={peerAddresses:[],invalid:!1,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.editor."+t]||t}},n}return pn(t,e),ln(t,[{key:"compareAddresses",value:function(e,t){var n=e.split("|"),r=t.split("|");return r.filter((function(e){return n.indexOf(e)>-1})).length||n.filter((function(e){return r.indexOf(e)>-1})).length}},{key:"componentDidMount",value:function(){var e=this,t=this.props.model;new E.ConfigServiceApi(b().getRestClient()).listPeersAddresses().then((function(n){var r=n.PeerAddresses||[];if(1!==r||t.PeerAddress||(t.PeerAddress=r[0]),e.setState({peerAddresses:r}),t.PeerAddress&&-1===r.indexOf(t.PeerAddress)){var o=r.filter((function(n){return e.compareAddresses(n,t.PeerAddress)}));o.length?t.PeerAddress=o[0]:e.setState({invalidAddress:t.PeerAddress})}}))}},{key:"baseIsInvalid",value:function(e){var t=this.state.m,n=!1,r=D().getBasename(e);return v().trim(e,"/").split("/").length<2?n=t("selector.error.depth"):v().computeStringSlug(r)!==r&&(n=t("selector.error.dnsname")),n}},{key:"onPathChange",value:function(e,t){var n=this.props.model,r=this.baseIsInvalid(e);n.invalid=r,n.StorageConfiguration.folder=e,t?void 0!==n.StorageConfiguration.create&&delete n.StorageConfiguration.create:n.StorageConfiguration.create="true",this.setState({invalid:r})}},{key:"onPeerChange",value:function(e){var t=this.props.model,n=this.state.invalidAddress;e!==n&&(t.PeerAddress=e,n&&this.setState({invalidAddress:null}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.model,r=t.pydio,o=t.styles,a=this.state,l=a.peerAddresses,s=a.invalidAddress,c=a.invalid,u=a.m,d=nn(l);return d=["ANY"].concat(nn(d)),s&&"ANY"!==s&&(d=[s].concat(nn(d))),i().createElement("div",null,i().createElement("div",{style:{paddingBottom:8}},i().createElement("div",{style:o.subLegend},u("storage.legend.fs.peer")),i().createElement(hn,{value:n.PeerAddress||"",variant:"v2",hintText:u("selector.peer")+" *",onChange:function(t,n,r){return e.onPeerChange(r)},fullWidth:!0},d.map((function(e){var t=u("selector.peer.any");return"ANY"!==e&&(t=u("selector.peer.word")+" : "+e.replace("|"," | ")+(e===s?" ("+u("selector.peer.invalid")+")":"")),i().createElement(p.MenuItem,{value:e,primaryText:t})})))),i().createElement("div",null,i().createElement("div",{style:en(en({},o.subLegend),{},{paddingBottom:6})},u("storage.legend.fs.path")),n.PeerAddress&&i().createElement(gn,{pydio:r,value:n.StorageConfiguration.folder,peerAddress:n.PeerAddress,onChange:this.onPathChange.bind(this),fieldLabel:u("selector.completer")+(n.StorageConfiguration.create?" ("+u("selector.completer.create")+")":"")+" *",hintText:u("selector.completer.hint")}),!n.PeerAddress&&i().createElement(mn,{style:{marginTop:-3},fullWidth:!0,variant:"v2",disabled:!0,value:n.StorageConfiguration.folder,floatingLabelText:u("selector.folder")+" *",hintText:u("selector.folder.hint")})),c&&i().createElement("div",{style:{color:"#c62828"}},c))}}])}(i().Component);const Sn=require("pydio/util/dom");var wn=n.n(Sn);function En(e){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(e)}function On(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pn(r.key),r)}}function Cn(e,t,n){return t&&kn(e.prototype,t),n&&kn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pn(e){var t=function(e){if("object"!=En(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==En(t)?t:t+""}function jn(e,t,n){return t=Tn(t),function(e,t){if(t&&("object"==En(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xn()?Reflect.construct(t,n||[],Tn(e).constructor):t.apply(e,n))}function xn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xn=function(){return!!e})()}function Tn(e){return Tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tn(e)}function Nn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&An(e,t)}function An(e,t){return An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},An(e,t)}var Rn=function(e){function t(){return On(this,t),jn(this,t,arguments)}return Nn(t,e),Cn(t,[{key:"render",value:function(){var e=this.props,t=e.onSelect,n=e.selected,r=e.value,o=e.primaryText,a=e.image,l={cont:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"10px 10px 0 10px",backgroundColor:"transparent",borderBottom:"2px solid transparent",transition:wn().getBeziersTransition()},image:{width:30,height:30,opacity:.3,transition:wn().getBeziersTransition()},label:{margin:5,marginTop:8,fontSize:11,fontWeight:500,color:"rgba(0,0,0,.3)",textAlign:"center",transition:wn().getBeziersTransition()}};return n&&(l.cont.borderBottom="2px solid #0e4d6d",l.image.opacity=1,l.label.color="#0e4d6d"),i().createElement("div",{zDepth:0,style:l.cont,onClick:function(e){t(r)},rounded:!1},a&&i().createElement("img",{style:l.image,src:"/plug/access.settings/res/images/"+a}),i().createElement("div",{style:l.label},o))}}])}(i().Component),Dn=function(e){function t(e){return On(this,t),jn(this,t,[e])}return Nn(t,e),Cn(t,[{key:"onChange",value:function(e){var t=this.props,n=t.values;(0,t.onChange)(null,Object.keys(n).indexOf(e),e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.values,r=t.value,o=t.disabled;return i().createElement("div",{style:{display:"flex",padding:"0 1px",backgroundColor:"rgb(251, 251, 252)"}},Object.keys(n).map((function(t){return i().createElement(Rn,{value:t,selected:t===r,onSelect:o?function(){}:e.onChange.bind(e),primaryText:n[t].primaryText,image:n[t].image})})))}}])}(i().Component);const Mn=require("lodash");function Ln(e){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(e)}function _n(){return _n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_n.apply(null,arguments)}function In(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fn(r.key),r)}}function Fn(e){var t=function(e){if("object"!=Ln(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ln(t)?t:t+""}function Vn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Vn=function(){return!!e})()}function Kn(e){return Kn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Kn(e)}function Wn(e,t){return Wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Wn(e,t)}var Un=d().requireLib("hoc").ModernTextField,qn=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Kn(t),function(e,t){if(t&&("object"==Ln(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Vn()?Reflect.construct(t,n||[],Kn(e).constructor):t.apply(e,n))}(this,t,[e])).state={buckets:[],selection:[],mode:n.modeFromValue(),monitorApi:e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret},e.dataSource.ObjectsBucket&&(n.state.selection=[e.dataSource.ObjectsBucket]),n.load(),n.loadSelection(),n.reloadSelection=(0,Mn.debounce)((function(){n.loadSelection()}),500),n.loadDebounced=(0,Mn.debounce)((function(){n.load()}),500),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wn(e,t)}(t,e),n=t,(r=[{key:"componentWillReceiveProps",value:function(e){var t=e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret;t!==this.state.monitorApi&&(this.loadDebounced(),this.setState({monitorApi:t}))}},{key:"load",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?(this.setState({loading:!0}),Rt.loadBuckets(t).then((function(t){var n=t.Children||[];e.setState({buckets:n.map((function(e){return e.Path})),loading:!1})})).catch((function(t){e.setState({buckets:[],loading:!1})}))):this.setState({buckets:[]})}},{key:"createBucket",value:function(){var e=this,t=this.props.dataSource,n=this.state.createBucket;this.setState({loading:!0}),Rt.createBucket(t,n).then((function(){e.setState({create:!1,createBucket:""}),e.load()})).catch((function(t){e.setState({loading:!1})}))}},{key:"loadSelection",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?t.ObjectsBucket?this.setState({selection:[t.ObjectsBucket]}):(this.setState({selection:[]}),t.StorageConfiguration.bucketsRegexp&&Rt.loadBuckets(t,t.StorageConfiguration.bucketsRegexp).then((function(t){var n=t.Children||[];e.setState({selection:n.map((function(e){return e.Path}))})}))):this.setState({selection:[]})}},{key:"modeFromValue",value:function(){var e="picker";return this.props.dataSource.StorageConfiguration.bucketsRegexp&&(e="regexp"),e}},{key:"toggleMode",value:function(){var e=this.state.mode,t=this.props.dataSource;"picker"===e?(t.ObjectsBucket&&(t.StorageConfiguration.bucketsRegexp=t.ObjectsBucket,t.ObjectsBucket="",this.reloadSelection()),this.setState({mode:"regexp"})):(t.StorageConfiguration.bucketsRegexp="",this.reloadSelection(),this.setState({mode:"picker"}))}},{key:"togglePicker",value:function(e){var t=this.props.dataSource,n=this.state.selection,r=[],o=n.indexOf(e);1===(r=-1===o?[].concat(function(e){return function(e){if(Array.isArray(e))return In(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return In(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?In(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n),[e]):v().arrayWithout(n,o)).length?(t.ObjectsBucket=r[0],t.StorageConfiguration.bucketsRegexp=""):(t.ObjectsBucket="",t.StorageConfiguration.bucketsRegexp=r.map((function(e){return"^"+e+"$"})).join("|")),this.setState({selection:r})}},{key:"updateRegexp",value:function(e){this.props.dataSource.StorageConfiguration.bucketsRegexp=e,this.reloadSelection()}},{key:"render",value:function(){var e=this,t=this.props.dataSource,n=this.state,r=n.buckets,o=n.selection,a=n.mode,l=n.loading,s=n.create,c=n.createBucket,u=void 0===c?"":c,f=d().getInstance().MessageHash,y=function(e){return f["ajxp_admin.ds.editor.storage."+e]||e},m={style:{width:30,height:30,padding:5},iconStyle:{width:20,height:20,color:"rgba(0,0,0,.5)",fontSize:18}},h=!t.ApiKey||!t.ApiSecret;return i().createElement("div",null,i().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginTop:20}},i().createElement("div",null,y("buckets.legend")),i().createElement("div",{style:{flex:1}}),i().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginRight:s?30:0}},s&&i().createElement("div",{style:{width:200,height:36}},i().createElement(Un,{hintText:y("buckets.create.hint"),fullWidth:!0,value:u,onChange:function(t,n){e.setState({createBucket:v().computeStringSlug(n)})}})),i().createElement(p.IconButton,_n({iconClassName:s?"mdi mdi-check":"mdi mdi-plus-circle",tooltip:y("buckets.create"),tooltipPosition:"top-left",onClick:function(){s?e.createBucket():e.setState({create:!0})},disabled:h},m)),s&&i().createElement(p.IconButton,_n({iconClassName:"mdi mdi-close",tooltip:f[54],tooltipPosition:"top-left",onClick:function(){return e.setState({create:!1,createBucket:""})},disabled:h},m))),i().createElement("div",{style:{display:"flex",alignItems:"flex-end"}},"regexp"===a&&i().createElement("div",{style:{width:200,height:36}},i().createElement(Un,{hintText:y("buckets.regexp.hint"),fullWidth:!0,value:t.StorageConfiguration.bucketsRegexp||"",onChange:function(t,n){e.updateRegexp(n)}})),i().createElement(p.IconButton,_n({iconClassName:"mdi mdi-filter",tooltip:"picker"===a?y("buckets.regexp"):"",tooltipPosition:"top-left",onClick:function(){e.toggleMode()},disabled:h},m))),i().createElement(p.IconButton,_n({iconClassName:"mdi mdi-reload",tooltip:y("buckets.reload"),tooltipPosition:"top-left",onClick:function(){e.load()},disabled:h},m))),i().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginTop:8,backgroundColor:"rgb(246 246 248)",borderRadius:"4px 4px 0 0",borderBottom:"1px solid #e0e0e0",minHeight:52,padding:2,maxHeight:275,overflowY:"auto"}},r.map((function(n){var r=-1!==o.indexOf(n),l={};return"picker"===a?l.onClick=function(){e.togglePicker(n)}:t.StorageConfiguration.bucketsRegexp||(l.onClick=function(){e.toggleMode(),e.togglePicker(n)}),i().createElement("div",{style:{margin:5}},i().createElement(p.Chip,_n({},l,{backgroundColor:r?"#03a9f4":null}),n))})),0===r.length&&i().createElement("div",{style:{paddingLeft:5,textAlign:"center",fontSize:12,color:"rgba(0,0,0,.3)"}},y(h?"buckets.cont.nokeys":l?"buckets.cont.loading":"buckets.cont.empty"))))}}])&&Bn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function Hn(e){return Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hn(e)}function zn(){return zn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zn.apply(null,arguments)}function Jn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(n),!0).forEach((function(t){Gn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gn(e,t,n){return(t=$n(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$n(r.key),r)}}function $n(e){var t=function(e){if("object"!=Hn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Hn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hn(t)?t:t+""}function Xn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xn=function(){return!!e})()}function Zn(e){return Zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Zn(e)}function er(e,t){return er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},er(e,t)}var tr=AdminComponents,nr=tr.PaperEditorLayout,rr=tr.AdminStyles,or=d().requireLib("hoc"),ir=or.ModernTextField,ar=or.ModernSelectField,lr=or.ThemedModernStyles,sr=["main","storage","data","advanced"],cr=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,n){return t=Zn(t),function(e,t){if(t&&("object"==Hn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xn()?Reflect.construct(t,n||[],Zn(e).constructor):t.apply(e,n))}(this,t,[e]);var r=e.pydio,o=e.create,i=e.dataSource,a=e.existingNames,l=e.createStructure,s=new Rt(i,a,l),c=s.getModel().StorageConfiguration||{},u=c.customEndpoint?"custom":"aws";return"custom"===u&&c.minioServer&&(u="minio"),n.state={dirty:!1,create:o,observable:s,model:s.getModel(),loaded:!1,valid:s.isValid(),encryptionKeys:[],versioningPolicies:[],s3Custom:u,m:function(e){return r.MessageHash["ajxp_admin.ds.editor."+e]||e}},Rt.loadEncryptionKeys().then((function(e){n.setState({encryptionKeys:e.Keys||[]})})),Rt.loadVersioningPolicies().then((function(e){n.setState({versioningPolicies:e.Policies||[]})})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&er(e,t)}(t,e),n=t,r=[{key:"componentWillReceiveProps",value:function(e){if(e.dataSource&&this.state.model.Name!==e.dataSource.Name)if(this.state.dirty)alert(this.props.pydio.MessageHash["role_editor.19"]);else{var t=new Rt(e.dataSource);this.setState({observable:t,model:t.getModel()})}e.create&&this.state.create!==e.create&&this.setState({create:e.create})}},{key:"componentDidMount",value:function(){var e=this;this.state.observable.observe("update",(function(){e.setState({dirty:!0}),e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.observable.stopObserving("update")}},{key:"resetForm",value:function(){var e=this,t=this.state.observable.revert();this.setState({valid:!0,dirty:!1,model:t},(function(){e.forceUpdate()}))}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.observable;this.props.pydio.UI.openConfirmDialog({message:n("delete.warning"),validCallback:function(){r.deleteSource().then((function(){e.props.closeEditor(),e.props.reloadList()}))},destructive:[r.getModel().Name]})}},{key:"saveSource",value:function(){var e=this,t=this.state,n=t.observable,r=t.create;this.state.observable.saveSource().then((function(){var t=null;r&&(t=n.getModel().Name),e.setState({valid:!0,dirty:!1,create:!1}),r&&e.props.closeEditor(),e.props.reloadList(t)}))}},{key:"launchResync",value:function(){this.state.observable.resyncSource()}},{key:"toggleEncryption",value:function(e){var t=this.state.model;"VALUE_CREATE"===e?this.setState({showDialog:"enableEncryptionWithCreate",dialogTargetValue:e,newKeyName:t.Name||""}):"VALUE_CLEAR"===e?this.setState({showDialog:"disableEncryption",dialogTargetValue:e}):"MASTER"!==t.EncryptionMode?this.setState({showDialog:"enableEncryption",dialogTargetValue:e}):t.EncryptionKey=e}},{key:"confirmEncryption",value:function(e){var t=this,n=this.state,r=n.model,o=n.newKeyName;if("VALUE_CREATE"===e){var i=new E.ConfigServiceApi(b().getRestClient()),a=new E.EncryptionAdminCreateKeyRequest;return a.KeyID=o,a.Label=o,void i.createEncryptionKey(a).then((function(e){r.EncryptionMode="MASTER",r.EncryptionKey=o,t.setState({showDialog:!1,dialogTargetValue:null,encryptionKeys:[{ID:o,Label:o}]})})).catch((function(){}))}"VALUE_CLEAR"===e?(r.EncryptionMode="CLEAR",r.EncryptionKey=""):(r.EncryptionMode="MASTER",r.EncryptionKey=e),this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"toggleS3Custom",value:function(e){var t=this.state.model;"aws"===e?(t.StorageConfiguration.customEndpoint="",t.StorageConfiguration.customRegion="",t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion=""):"minio"===e?(t.StorageConfiguration.minioServer="true",t.StorageConfiguration.signatureVersion="v4"):(t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion="v4"),this.setState({s3Custom:e})}},{key:"stepperBack",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=sr.indexOf(t);n>0&&this.setState({currentPane:sr[n-1]})}},{key:"stepperNext",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=sr.indexOf(t);n<sr.length-1&&this.setState({currentPane:sr[n+1]})}},{key:"render",value:function(){var e=this,t=this.props,n=t.storageTypes,r=t.pydio,a=t.readonly,l=t.muiTheme,s=this.state,c=s.currentPane,u=void 0===c?"main":c,d=s.model,f=s.create,y=s.observable,m=s.encryptionKeys,h=s.versioningPolicies,b=s.showDialog,g=s.dialogTargetValue,v=s.newKeyName,S=s.s3Custom,w=s.m,E=lr(l),O=[];a||f||(O.push(i().createElement(p.Toggle,{style:{borderRight:"1px solid #e0e0e0",paddingRight:14,zoom:.8},labelStyle:{fontSize:17},toggled:!d.Disabled,onToggle:function(e,t){d.Disabled=!t},labelPosition:"right",label:w("options.enabled")})),O.push(nr.actionButton(this.context.getMessage("plugins.6"),"mdi mdi-undo",(function(){e.resetForm()}),!this.state.dirty)),O.push(nr.actionButton(this.context.getMessage("plugins.5"),"mdi mdi-content-save",(function(){e.saveSource()}),!this.state.dirty)));var k=d.Name?w("title").replace("%s",d.Name):w("new"),C=d.StorageConfiguration,P=rr(this.props.muiTheme.palette),j={title:Yn(Yn({},P.body.block.headerFull),{},{margin:"0 -20px"}),legend:{},subLegend:{padding:"10px 6px 0 4px",fontSize:12,lineHeight:"16px",color:"rgba(0,0,0,0.6)",textAlign:"justify"},section:Yn({padding:"0 20px 20px",margin:10,backgroundColor:"white"},P.body.block.container),storageSection:{padding:20,marginTop:-1}},x={LOCAL:{primaryText:this.context.getMessage("ds.storage.fs","ajxp_admin"),image:"fs.png"},S3:{primaryText:this.context.getMessage("ds.storage.s3","ajxp_admin"),image:"s3-compat.png"},AZURE:{primaryText:this.context.getMessage("ds.storage.azure","ajxp_admin"),image:"azure.png"},GCS:{primaryText:this.context.getMessage("ds.storage.gcs","ajxp_admin"),image:"gcs.png"}},T={};n.forEach((function(e){T[e]=x[e]})),d.StorageType&&!T[d.StorageType]&&(T[d.StorageType]=x[d.StorageType]);var N,A,R=function(e,t){return t===u?e:Yn(Yn({},e),{},{display:"none"})};if(f){var D={main:w("tab.identifier"),storage:w("tab.storage"),data:w("tab.lifecycle"),advanced:w("tab.advanced")},M=!1;("main"!==u||d.Name&&!y.getNameError(w))&&("storage"!==u||y.isValid())||(M=!0);var L=Be(D,u,(function(t){return e.setState({currentPane:t})}),M,(function(){return e.saveSource()}),(function(){return y.isValid()}),{back:w("tab.button-back"),next:w("tab.button-next"),save:w("tab.button-create")});N=L.Steps,A=L.Buttons}var _=i().createElement(p.Dialog,{open:b,title:w("enc.warning"),onRequestClose:function(){e.setState({showDialog:!1,dialogTargetValue:null})},actions:[i().createElement(p.FlatButton,{label:r.MessageHash[54],onClick:function(){e.setState({showDialog:!1,dialogTargetValue:null})}}),i().createElement(p.FlatButton,{label:w("enc.validate"),disabled:"enableEncryptionWithCreate"===b&&!v,onClick:function(){e.confirmEncryption(g)}})]},("enableEncryption"===b||"enableEncryptionWithCreate"===b)&&i().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.enable.1"),"",w("enc.dialog.enable.2")," ",i().createElement("b",{style:{fontWeight:500}},w("enc.dialog.enable.2bold")),i().createElement("br",null),w("enc.dialog.enable.3"),"enableEncryptionWithCreate"===b&&i().createElement("div",null,i().createElement(ir,{hintText:w("enc.dialog.enable.create"),fullWidth:!0,variant:"v2",value:v,onChange:function(t,n){e.setState({newKeyName:n})}}))),"disableEncryption"===b&&i().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.disable"))),I=i().createElement(p.Paper,{zDepth:0,style:R(j.section,"main")},i().createElement("div",{style:Yn(Yn({},j.title),{},{marginBottom:16})},w("options")),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("options.id")+" *",disabled:!f,value:d.Name,onChange:function(e,t){d.Name=t},errorText:y.getNameError(w)})),B=i().createElement(p.Paper,{zDepth:0,style:R(Yn(Yn({},j.section),{},{padding:0,marginBottom:f?200:null}),f?"storage":"main")},i().createElement(Dn,{disabled:!f,value:d.StorageType,onChange:function(e,t,n){d.StorageType=n},values:T}),"LOCAL"===d.StorageType&&i().createElement("div",{style:j.storageSection},i().createElement("div",{style:j.legend},w("storage.legend.fs")),i().createElement(vn,{model:d,pydio:this.props.pydio,styles:j}),!d.FlatStorage&&i().createElement("div",null,i().createElement(p.Checkbox,zn({labelPosition:"right",label:w("storage.fs.macos"),checked:"true"===C.normalize,onCheck:function(e,t){C.normalize=t?"true":"false"}},E.toggleFieldV2)))),"S3"===d.StorageType&&i().createElement("div",{style:j.storageSection},i().createElement("div",{style:j.legend},w("storage.legend.s3")),i().createElement(ar,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint.type"),value:S,onChange:function(t,n,r){e.toggleS3Custom(r)}},i().createElement(p.MenuItem,{value:"aws",primaryText:w("storage.s3.endpoint.amazon")}),i().createElement(p.MenuItem,{value:"minio",primaryText:w("storage.s3.endpoint.minio")}),i().createElement(p.MenuItem,{value:"custom",primaryText:w("storage.s3.endpoint.custom")})),("custom"===S||"minio"===S)&&i().createElement("div",null,i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint")+" - "+w("storage.s3.endpoint.hint"),value:d.StorageConfiguration.customEndpoint,onChange:function(e,t){d.StorageConfiguration.customEndpoint=t}}),i().createElement("div",{style:{display:"flex"}},i().createElement("div",{style:{flex:3,marginRight:5}},i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.region"),value:d.StorageConfiguration.customRegion,onChange:function(e,t){d.StorageConfiguration.customRegion=t}})),i().createElement("div",{style:{flex:1}},i().createElement(ar,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.signatureVersion"),value:d.StorageConfiguration.signatureVersion,onChange:function(e,t,n){d.StorageConfiguration.signatureVersion=n}},i().createElement(p.MenuItem,{value:"v4",primaryText:"v4"}),i().createElement(p.MenuItem,{value:"v2",primaryText:"v2"}))))),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.api")+" *",value:d.ApiKey,onChange:function(e,t){d.ApiKey=t}}),i().createElement("form",{autoComplete:"off"},i().createElement("input",{type:"hidden",value:"something"}),i().createElement(ir,{autoComplete:"off",fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.s3.secret")+" *",value:d.ApiSecret,onChange:function(e,t){d.ApiSecret=t}})),i().createElement(qn,{dataSource:d,hintText:w("storage.s3.bucket")}),d.ObjectsBucket&&i().createElement("div",{style:{paddingTop:20}},i().createElement("div",{style:Yn({},j.subLegend)},w("storage.s3.legend.bucketPathPrefix")),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.bucketPathPrefix"),value:d.ObjectsBaseFolder||"",onChange:function(e,t){d.ObjectsBaseFolder=t}})),(d.ObjectsBucket||d.StorageConfiguration.bucketsRegexp)&&i().createElement(i().Fragment,null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.storageClass")),i().createElement("div",null,i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.storageClass"),value:d.StorageConfiguration.storageClass||"",onChange:function(e,t){d.StorageConfiguration.storageClass=t}}))),d.StorageConfiguration.bucketsRegexp&&!d.ObjectsBucket&&i().createElement(i().Fragment,null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.tags")),i().createElement("div",null,i().createElement(ir,{fullWidth:!0,variant:"v2",disabled:!!d.ObjectsBucket,hintText:w("storage.s3.bucketsTags"),value:d.StorageConfiguration.bucketsTags||"",onChange:function(e,t){d.StorageConfiguration.bucketsTags=t}})))),"AZURE"===d.StorageType&&i().createElement("div",{style:j.storageSection},i().createElement("div",{style:j.legend},w("storage.legend.azure")),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.bucket")+" *",value:d.ObjectsBucket,onChange:function(e,t){d.ObjectsBucket=t}}),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.api")+" *",value:d.ApiKey,onChange:function(e,t){d.ApiKey=t}}),i().createElement(ir,{fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.azure.secret")+" *",value:d.ApiSecret,onChange:function(e,t){d.ApiSecret=t}})),"GCS"===d.StorageType&&i().createElement("div",{style:j.storageSection},i().createElement("div",{style:j.legend},w("storage.legend.gcs")),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.bucket")+" *",value:d.ObjectsBucket,onChange:function(e,t){d.ObjectsBucket=t}}),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.credentials")+" *",value:d.StorageConfiguration.jsonCredentials,onChange:function(e,t){d.StorageConfiguration.jsonCredentials=t},multiLine:!0}),i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.path"),value:d.ObjectsBaseFolder,onChange:function(e,t){d.ObjectsBaseFolder=t}}))),F=i().createElement(p.Paper,{zDepth:0,style:R(j.section,"data")},i().createElement("div",{style:j.title},w("datamanagement")),!d.StorageConfiguration.cellsInternal&&i().createElement(o.Fragment,null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.versioning")),i().createElement(ar,{fullWidth:!0,variant:"v2",hintText:w("versioning"),value:d.VersioningPolicyName,onChange:function(e,t,n){d.VersioningPolicyName=n}},i().createElement(p.MenuItem,{value:void 0,primaryText:w("versioning.disabled")}),h.map((function(e){return i().createElement(p.MenuItem,{value:e.Uuid,primaryText:e.Name+" (stored in "+e.VersionsDataSourceName+")"})})))),i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.encryption")),i().createElement(ar,{fullWidth:!0,variant:"v2",hintText:w("enc.key"),value:"MASTER"===d.EncryptionMode?d.EncryptionKey:"VALUE_CLEAR",onChange:function(t,n,r){e.toggleEncryption(r)}},i().createElement(p.MenuItem,{value:"VALUE_CLEAR",primaryText:w("enc.key.clear")}),m.map((function(e){return i().createElement(p.MenuItem,{value:e.ID,primaryText:e.Label})})),"MASTER"!==d.EncryptionMode&&0===m.length&&i().createElement(p.MenuItem,{value:"VALUE_CREATE",primaryText:w("enc.key.create")}))),V=i().createElement(p.Paper,{zDepth:0,style:R(j.section,"advanced")},i().createElement("div",{style:j.title},w("tab.advanced")),!d.StorageConfiguration.cellsInternal&&i().createElement("div",null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.flatStorage")),i().createElement(p.Checkbox,zn({label:w("storage.flatStorage"),labelPosition:"right",disabled:!f,checked:!d.FlatStorage,onCheck:function(e,t){d.FlatStorage=!t}},E.toggleFieldV2)),f&&d.FlatStorage&&i().createElement(ir,{fullWidth:!0,variant:"v2",hintText:w("initFlatFromSnapshot"),value:d.StorageConfiguration.initFromSnapshot||"",onChange:function(e,t){t?d.StorageConfiguration.initFromSnapshot=t:delete d.StorageConfiguration.initFromSnapshot}}),d.FlatStorage&&(f||d.StorageConfiguration.foldersShardingPattern)&&i().createElement(ir,{fullWidth:!0,variant:"v2",disabled:!f,hintText:w("foldersShardingPattern"),value:d.StorageConfiguration.foldersShardingPattern||"",onChange:function(e,t){t?d.StorageConfiguration.foldersShardingPattern=t:delete d.StorageConfiguration.foldersShardingPattern}})),!d.FlatStorage&&i().createElement("div",null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.skipResync")),i().createElement(p.Checkbox,zn({label:w("storage.skipResync"),labelPosition:"right",checked:d.SkipSyncOnRestart,onCheck:function(e,t){d.SkipSyncOnRestart=t}},E.toggleFieldV2))),"LOCAL"!==d.StorageType&&i().createElement("div",null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.readOnly")),i().createElement(p.Checkbox,zn({label:w("storage.readOnly"),labelPosition:"right",checked:"true"===d.StorageConfiguration.readOnly,onCheck:function(e,t){d.StorageConfiguration.readOnly=t?"true":""}},E.toggleFieldV2))),(!d.StorageConfiguration.readOnly||"true"!==d.StorageConfiguration.readOnly)&&i().createElement("div",null,i().createElement("div",{style:Yn(Yn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.checksumMapper")),i().createElement(p.Checkbox,zn({label:w("storage.nativeEtags"),labelPosition:"right",checked:d.StorageConfiguration.nativeEtags,onCheck:function(e,t){d.StorageConfiguration.nativeEtags=t?"true":""}},E.toggleFieldV2)),!d.StorageConfiguration.nativeEtags&&i().createElement("div",null,i().createElement(p.Checkbox,zn({label:w("storage.checksumMapper"),labelPosition:"right",checked:"dao"===d.StorageConfiguration.checksumMapper,onCheck:function(e,t){d.StorageConfiguration.checksumMapper=t?"dao":""}},E.toggleFieldV2)))));return i().createElement(nr,{title:k,titleLeftIcon:"mdi mdi-database",titleActionBar:O,closeAction:this.props.closeEditor,leftNavItems:f?null:[{label:w("tab.main"),value:"main",icon:"mdi mdi-database-plus"},{label:w("tab.lifecycle"),value:"data",icon:"mdi mdi-recycle"},{label:w("tab.advanced"),value:"advanced",icon:"mdi mdi-settings"}],leftNavSelected:u,leftNavChange:function(t){e.setState({currentPane:t})},className:"workspace-editor",contentFill:!1,rightPanelStyle:f?{paddingTop:64}:null},N,_,B,I,F,V,A)}}],r&&Qn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function ur(e){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur(e)}function dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pr(r.key),r)}}function pr(e){var t=function(e){if("object"!=ur(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ur(t)?t:t+""}function fr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(fr=function(){return!!e})()}function yr(e){return yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yr(e)}function mr(e,t){return mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mr(e,t)}cr.contextTypes={messages:c().object,getMessage:c().func},cr=(0,m.muiThemeable)()(cr);var hr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=yr(t),function(e,t){if(t&&("object"==ur(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,fr()?Reflect.construct(t,n||[],yr(e).constructor):t.apply(e,n))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mr(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.policy,n=e.rendering,r=e.pydio,o=function(e){return r.MessageHash["ajxp_admin.versions.period."+e]||e},a=t.KeepPeriods,l=void 0===a?[]:a,s=t.NodeDeletedStrategy;if("short"===n){var c;if(1===l.length){var u=l[0];c=-1===u.MaxNumber?o("keep-all.always"):o("keep-n").replace("%s",u.MaxNumber)}else{c=o("retentions-n").replace("%s",l.length);var d=l[l.length-1];0===d.MaxNumber||void 0===d.MaxNumber?c+=" | "+o("remove-all-after").replace("%s",d.IntervalStart):c+=" | "+o("keep-n-after").replace("%1",d.MaxNumber).replace("%2",d.IntervalStart)}return i().createElement("span",null,c)}var f,y=l.map((function(e){var t,n=e.MaxNumber,r=i().createElement(p.FontIcon,{className:"mdi mdi-ray-start-arrow"}),a={};return void 0===e.IntervalStart||"0"===e.IntervalStart?r=i().createElement(p.FontIcon,{className:"mdi mdi-clock-start"}):t=i().createElement("span",{style:{fontWeight:500,fontSize:16}},e.IntervalStart,""),-1===e.MaxNumber?n=o("keep-all"):e.MaxNumber?n=o("max-n").replace("%s",n):(n=o("remove-all"),r=i().createElement(p.FontIcon,{className:"mdi mdi-clock-end",style:{color:"#c62828"}}),a={color:"#c62828"}),i().createElement(p.Step,null,i().createElement(p.StepLabel,{icon:r,style:a},t,n))})),m={color:"#c62828",fontWeight:500,fontSize:16};switch(s){case"KeepLast":f="Backup last";break;case"KeepAll":default:m.color=null,f="Backup all";break;case"KeepNone":f="Clean all"}return y.push(i().createElement(p.Step,null,i().createElement(p.StepLabel,{style:m,icon:i().createElement(p.FontIcon,{className:"mdi mdi-delete",style:m})},f))),i().createElement(p.Stepper,{activeStep:l.length-1,linear:!1},y)}}])&&dr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function gr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vr(e,t,n){return(t=wr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,wr(r.key),r)}}function wr(e){var t=function(e){if("object"!=br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==br(t)?t:t+""}function Er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Er=function(){return!!e})()}function Or(e){return Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Or(e)}function kr(e,t){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kr(e,t)}var Cr=d().requireLib("form"),Pr=Cr.Manager,jr=Cr.FormPanel,xr=AdminComponents,Tr=xr.PaperEditorLayout,Nr=xr.AdminStyles,Ar=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Or(t),function(e,t){if(t&&("object"==br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Er()?Reflect.construct(t,n||[],Or(e).constructor):t.apply(e,n))}(this,t,[e])).state={dirty:!1,policy:e.versionPolicy,loaded:!0,valid:!0,parameters:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.versions.editor."+t]||t}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kr(e,t)}(t,e),n=t,r=[{key:"componentWillReceiveProps",value:function(e){this.state.policy!==e.versionPolicy&&this.setState({policy:e.versionPolicy})}},{key:"componentDidMount",value:function(){var e=this;b().getRestClient().callApi("/config/discovery/forms/{ServiceName}","GET",{ServiceName:"pydio.grpc.versions"},{},{},{},null,[],["application/json"],["application/json"],"String").then((function(t){var n=t.data,r=y().parseXml(n);e.setState({parameters:Pr.parseParameters(r,"//param"),loaded:!0})}))}},{key:"resetForm",value:function(){this.setState({valid:!0,dirty:!1,saveValue:null})}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.policy;this.props.pydio.UI.openConfirmDialog({message:n("delete.confirm"),destructive:[r.Label],validCallback:function(){le().loadClass("EnterpriseSDK").then((function(t){new t.EnterpriseConfigServiceApi(b().getRestClient()).deleteVersioningPolicy(r.Uuid).then((function(t){e.props.closeEditor()}))}))}})}},{key:"saveSource",value:function(){var e=this;if(this.state.saveValue){var t=this.state.saveValue;le().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(b().getRestClient()).putVersioningPolicy(t.Uuid,t).then((function(){e.props.reloadList(),e.setState({dirty:!1,policy:t,saveValue:null})}))}))}}},{key:"onFormChange",value:function(e){var n=this.state.m,r=t.valuesToTreeVersioningPolicy(e),o=r.KeepPeriods||[],i=o.findIndex((function(e){return 0===e.MaxNumber}));if(i>-1&&i<o.length-1){pydio.UI.displayMessage("ERROR",n("error.lastdelete"));for(var a=o.length-1-i;a>0;)o.pop(),a--}r.KeepPeriods=o,this.setState({saveValue:r,dirty:!0})}},{key:"updateValidStatus",value:function(e){}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.create,a=r.readonly,l=r.pydio,s=r.muiTheme,c=r.internalSources,u=this.state,d=u.loaded,f=u.policy,y=u.saveValue,m=u.m,h=this.state.parameters,b=s.palette,g=Nr(b);if(h&&d){c&&(h=h.map((function(e){return"VersionsDataSourceName"===e.name&&(e.choices+=","+c.map((function(e){return e+"|DataSource "+e})).join(",")),e})));var v=t.TreeVersioningPolicyToValues(f);y&&(v=t.TreeVersioningPolicyToValues(y)),e=i().createElement(jr,{parameters:h,values:v,className:"full-width",onChange:this.onFormChange.bind(this),onValidStatusChange:this.updateValidStatus.bind(this),disabled:a,depth:-2,variant:"v2"})}var S=[];a||(o||(S.push(Tr.actionButton(m("delete"),"mdi mdi-delete",(function(){n.deleteSource()}))),S.push(Tr.actionButton(l.MessageHash["ajxp_admin.plugins.6"],"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty))),S.push(Tr.actionButton(l.MessageHash[53],"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.valid||!this.state.dirty)));var w=y?y.Name:f.Name;return w||(w=""),i().createElement(Tr,{title:d&&h?m("title").replace("%s",w):l.MessageHash["ajxp_admin.loading"],titleLeftIcon:"mdi mdi-clock-start",titleActionBar:S,closeAction:this.props.closeEditor,className:"workspace-editor",contentFill:!0},i().createElement(p.Paper,{zDepth:0,style:{backgroundColor:g.body.block.header.backgroundColor,padding:"0px 20px",height:64,display:"flex",alignItems:"center"}},i().createElement("div",{style:{overflowX:"auto",width:"100%"}},i().createElement(hr,{pydio:l,policy:y||f}))),e,i().createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"\n.react-mui-context .pydio-form-panel.form-panel-odd > .pydio-form-group {\n    margin: 2px 10px 0px;\n}\n.react-mui-context .pydio-form-panel.form-panel-odd >.pydio-form-group > h1 {\n    background-color: transparent;\n    color:#607D8B;\n    border-bottom: 1px solid #eceff1;\n    font-size: 13px;\n    font-weight: 500;\n    margin: 0px -16px;\n    letter-spacing: initial;\n    padding: 12px 20px;\n}\n"}}))}}],o=[{key:"valuesToTreeVersioningPolicy",value:function(e){for(var t=[],n="IntervalStart",r="MaxNumber",o=n,i=r,a=0;void 0!==e[o]&&void 0!==e[i];){var l=new E.TreeVersioningKeepPeriod;l.IntervalStart=e[o],l.MaxNumber=e[i],t.push(l),delete e[i],delete e[o],o=n+"_"+ ++a,i=r+"_"+a}return e.KeepPeriods=t,E.TreeVersioningPolicy.constructFromObject(e)}},{key:"TreeVersioningPolicyToValues",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gr(Object(n),!0).forEach((function(t){vr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if(t.KeepPeriods){var n=0;t.KeepPeriods.map((function(e){n>0?(t["IntervalStart_"+n]=e.IntervalStart||0,t["MaxNumber_"+n]=e.MaxNumber||0):(t.IntervalStart=e.IntervalStart||0,t.MaxNumber=e.MaxNumber||0),n++}))}return t.NodeDeletedStrategy||(t.NodeDeletedStrategy="KeepAll"),t}}],r&&Sr(n.prototype,r),o&&Sr(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(i().Component);Ar=(0,m.muiThemeable)()(Ar);var Rr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),Dr=new Uint8Array(16);function Mr(){if(!Rr)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rr(Dr)}for(var Lr=[],_r=0;_r<256;++_r)Lr[_r]=(_r+256).toString(16).substr(1);const Ir=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||Mr)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[r+i]=o[i];return t||function(e,t){var n=t||0,r=Lr;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(o)};function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Fr(){return Fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fr.apply(null,arguments)}function Vr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kr(r.key),r)}}function Kr(e){var t=function(e){if("object"!=Br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Br(t)?t:t+""}function Wr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Wr=function(){return!!e})()}function Ur(e){return Ur=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ur(e)}function qr(e,t){return qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},qr(e,t)}var Hr=d().requireLib("components").MaterialTable,zr=d().requireLib("hoc").ModernTextField;const Jr=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Ur(t),function(e,t){if(t&&("object"==Br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Wr()?Reflect.construct(t,n||[],Ur(e).constructor):t.apply(e,n))}(this,t,[e])).state={keys:[],showDialog:!1,showExportKey:null,exportedKey:null,showCreateKey:null,showImportKey:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.encryption."+t]||e.pydio.MessageHash[t]||t}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qr(e,t)}(t,e),n=t,(r=[{key:"load",value:function(){var e=this;new E.ConfigServiceApi(b().getRestClient()).listEncryptionKeys(new E.EncryptionAdminListKeysRequest).then((function(t){e.setState({keys:t.Keys||[]})}))}},{key:"componentDidMount",value:function(){this.load()}},{key:"exportKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new E.ConfigServiceApi(b().getRestClient()),o=new E.EncryptionAdminExportKeyRequest;o.KeyID=this.state.showExportKey,o.StrPassword=this.refs["key-password-field"].getValue(),this.refs["key-password-confirm"].getValue()===o.StrPassword?r.exportEncryptionKey(o).then((function(t){e.setState({exportedKey:t.Key,showExportKey:null},(function(){e.timeout=setTimeout((function(){e.setState({exportedKey:"",showDialog:!1})}),1e4)})),e.setState({showExportKey:null})})).catch((function(r){t.UI.displayMessage("ERROR",n("key.export.fail")+" : "+r.message),e.setState({showExportKey:null})})):t.UI.displayMessage("ERROR",n("238"))}},{key:"createKey",value:function(){var e=this,t=new E.ConfigServiceApi(b().getRestClient()),n=new E.EncryptionAdminCreateKeyRequest;n.KeyID=this.refs.createKeyId.getValue(),n.Label=this.refs.createKeyLabel.getValue(),t.createEncryptionKey(n).then((function(t){e.load(),e.setState({showDialog:!1})})).catch((function(){e.setState({showDialog:!1})}))}},{key:"deleteKey",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("key.delete.warning"),destructive:[e],validCallback:function(){var n=new E.ConfigServiceApi(b().getRestClient()),r=new E.EncryptionAdminDeleteKeyRequest;r.KeyID=e,n.deleteEncryptionKey(r).then((function(e){t.load()}))}})}},{key:"importKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new E.ConfigServiceApi(b().getRestClient()),o=this.state.showImportKey,i=!0;o.ID||((o=new E.EncryptionKey).ID=this.refs["key-import-id"].getValue(),o.Label=this.refs["key-import-label"].getValue(),i=!1),o.Content=this.refs["key-imported-field"].getValue();var a=new E.EncryptionAdminImportKeyRequest;a.StrPassword=this.refs["key-password-field"].getValue(),a.Key=o,a.Override=i,r.importEncryptionKey(a).then((function(r){r.Success?t.UI.displayMessage("SUCCESS",n("key.import.success")):t.UI.displayMessage("ERROR",n("key.import.fail")),e.load(),e.setState({showImportKey:!1,showDialog:!1})})).catch((function(){e.setState({showImportKey:!1,showDialog:!1})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.keys,r=t.showDialog,o=t.showImportKey,a=t.showExportKey,l=t.exportedKey,s=t.showCreateKey,c=t.m,u=this.props,d=(u.pydio,u.accessByName),f=u.adminStyles,y=[{name:"Label",label:c("key.label"),style:{width:"30%",fontSize:15},headerStyle:{width:"30%"},sorter:{type:"string",default:!0}},{name:"ID",label:c("key.id"),hideSmall:!0,sorter:{type:"string"}},{name:"Owner",label:c("key.owner"),hideSmall:!0,sorter:{type:"string"}},{name:"CreationDate",label:c("key.created"),hideSmall:!0,useMoment:!0,sorter:{type:"number"}}],m=[];d("CreateEncryption")&&m.push({iconClassName:"mdi mdi-import",tooltip:c("key.import"),onClick:function(t){e.setState({showDialog:!0,showImportKey:t})}},{iconClassName:"mdi mdi-export",tooltip:c("key.export"),onClick:function(t){e.setState({showDialog:!0,showExportKey:t.ID})}},{iconClassName:"mdi mdi-delete",tooltip:c("key.delete"),onClick:function(t){e.deleteKey(t.ID)}});var h,b,g=[];a||l?(b=c("key.export"),l?(h=i().createElement(zr,{value:l.Content,fullWidth:!0,variant:"v2",floatingLabelText:c("key.export.result.copy"),multiLine:!0,ref:"key-imported-field"}),g=[i().createElement(p.FlatButton,{label:c("86"),onClick:function(){clearTimeout(e.timeout),e.setState({showExportKey:null,exportedKey:"",showDialog:!1})}})]):(h=i().createElement("div",null,i().createElement(zr,{variant:"v2",floatingLabelText:c("key.export.password"),ref:"key-password-field",type:"password",fullWidth:!0}),i().createElement(zr,{variant:"v2",floatingLabelText:c("key.export.confirm"),ref:"key-password-confirm",type:"password",fullWidth:!0})),g=[i().createElement(p.FlatButton,{label:c("54"),onClick:function(){e.setState({showExportKey:null,showDialog:!1})}}),i().createElement(p.FlatButton,{label:c("key.export"),primary:!0,onClick:function(){e.exportKey()}})])):o?(b=c("key.import"),h=i().createElement("div",null,!o.ID&&i().createElement("div",null,i().createElement(zr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"key-import-id",fullWidth:!0}),i().createElement(zr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"key-import-label",fullWidth:!0})),i().createElement(zr,{variant:"v2",floatingLabelText:c("key.import.password"),ref:"key-password-field",type:"password",fullWidth:!0}),i().createElement(zr,{variant:"v2",fullWidth:!0,floatingLabelText:c("key.import.content"),multiLine:!0,ref:"key-imported-field"})),g=[i().createElement(p.FlatButton,{label:c("54"),onClick:function(){e.setState({showImportKey:null,showDialog:!1})}}),i().createElement(p.FlatButton,{label:c("key.import"),primary:!0,onClick:function(){e.importKey()}})]):s&&(b=c("key.create"),h=i().createElement("div",null,i().createElement(zr,{variant:"v2",floatingLabelText:c("key.import.id"),ref:"createKeyId",fullWidth:!0}),i().createElement(zr,{variant:"v2",floatingLabelText:c("key.import.label"),ref:"createKeyLabel",fullWidth:!0})),g=[i().createElement(p.FlatButton,{label:c("54"),onClick:function(){e.setState({showCreateKey:null,showDialog:!1})}}),i().createElement(p.FlatButton,{label:c("key.create"),primary:!0,onClick:function(){e.createKey()}})]);var v=AdminComponents.AdminStyles().body,S=v.tableMaster,w=v.block.props,E=v.block.container;return i().createElement("div",null,i().createElement(p.Dialog,{title:b,open:r,onRequestClose:function(){e.setState({showDialog:!1,showExportKey:null,showImportKey:null,showCreateKey:!1})},modal:!0,actions:g,contentStyle:{maxWidth:340}},h),i().createElement(p.Paper,Fr({},w,{style:E}),i().createElement(Hr,{data:n,columns:y,actions:m,onSelectRows:function(){},showCheckboxes:!1,emptyStateString:c("key.emptyState"),masterStyles:S,storageKey:"console.encryption-keys.list"})),d("CreateEncryption")&&i().createElement("div",{style:{textAlign:"right",paddingRight:24,paddingBottom:24}},i().createElement(p.FlatButton,Fr({primary:!0,label:c("key.import"),onClick:function(){e.setState({showImportKey:{},showDialog:!0})}},f.props.header.flatButton)),i().createElement("span",{style:{marginLeft:8}},i().createElement(p.FlatButton,Fr({primary:!0,label:c("key.create"),onClick:function(){e.setState({showCreateKey:!0,showDialog:!0})}},f.props.header.flatButton)))))}}])&&Vr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function Yr(e){return Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yr(e)}function Gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qr(r.key),r)}}function Qr(e){var t=function(e){if("object"!=Yr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Yr(t)?t:t+""}function $r(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return($r=function(){return!!e})()}function Xr(e){return Xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xr(e)}function Zr(e,t){return Zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zr(e,t)}const eo=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Xr(t),function(e,t){if(t&&("object"==Yr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$r()?Reflect.construct(t,n||[],Xr(e).constructor):t.apply(e,n))}(this,t,[e])).state={value:"flat"},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zr(e,t)}(t,e),n=t,(r=[{key:"componentWillReceiveProps",value:function(e,t){e.open&&!this.props.open&&this.setState({value:"flat"})}},{key:"submit",value:function(){var e=this.props,t=e.onSubmit,n=e.onRequestClose;t(this.state.value),n()}},{key:"render",value:function(){var e=this,t=this.props,n=t.open,r=t.onRequestClose,o=this.state.value,a=function(e){return d().getMessages()["ajxp_admin.ds.format-picker."+e]||e},l=function(e){var t=i().createElement("div",null,i().createElement("div",null,a(e+".title")),i().createElement("div",{style:{opacity:.67,margin:"5px 0 10px"}},a(e+".legend")));return i().createElement(p.RadioButton,{value:e,label:t})},s=[i().createElement(p.FlatButton,{label:d().getMessages()[54],onClick:function(){r()},primary:!0}),i().createElement(p.FlatButton,{label:a("submit"),primary:!0,onClick:function(){return e.submit()}})];return i().createElement(p.Dialog,{open:n,title:a("title"),onRequestClose:r,actions:s},i().createElement("div",{style:{marginBottom:20}},a("legend")),i().createElement(p.RadioButtonGroup,{valueSelected:o,onChange:function(t,n){return e.setState({value:n})}},l("flat"),l("structured"),l("internal")))}}])&&Gr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function no(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ro(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?no(Object(n),!0).forEach((function(t){oo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):no(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oo(e,t,n){return(t=lo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function io(){return io=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},io.apply(null,arguments)}function ao(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,lo(r.key),r)}}function lo(e){var t=function(e){if("object"!=to(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=to(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==to(t)?t:t+""}function so(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(so=function(){return!!e})()}function co(e){return co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},co(e)}function uo(e,t){return uo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},uo(e,t)}var po=d().requireLib("components").MaterialTable,fo=d().requireLib("boot"),yo=fo.JobsStore,mo=fo.moment,ho=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=co(t),function(e,t){if(t&&("object"==to(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,so()?Reflect.construct(t,n||[],co(e).constructor):t.apply(e,n))}(this,t,[e])).state={dataSources:[],resyncJobs:{},versioningPolicies:[],dsLoaded:!1,versionsLoaded:!1,showExportKey:!1,exportedKey:null,showImportKey:!1,importResult:null,keyOperationError:null,startedServices:[],peerAddresses:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.ds."+t]||t}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uo(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){var e=this,t=new E.ConfigServiceApi(b().getRestClient()),n=this.props.pydio;this.statusPoller=setInterval((function(){n.WebSocketClient.getStatus()&&(Rt.loadStatuses().then((function(t){e.setState({startedServices:t.Services||[]})})),t.listPeersAddresses().then((function(t){e.setState({peerAddresses:t.PeerAddresses||[]})})))}),2500),setTimeout((function(){e.syncPoller=setInterval((function(){n.WebSocketClient.getStatus()&&e.syncStatuses()}),2500)}),1250),this.load()}},{key:"componentWillUnmount",value:function(){clearInterval(this.statusPoller),clearInterval(this.syncPoller)}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setState({dsLoaded:!1,versionsLoaded:!1,newDsName:t}),Rt.loadDatasources().then((function(t){e.setState({dataSources:t.DataSources||[],dsLoaded:!0},(function(){e.syncStatuses()}))})),Rt.loadVersioningPolicies().then((function(t){e.setState({versioningPolicies:t.Policies||[],versionsLoaded:!0})})),Rt.loadStatuses().then((function(t){e.setState({startedServices:t.Services})})),this.refs&&this.refs.encKeys&&this.refs.encKeys.load()}},{key:"syncStatuses",value:function(){var e=this,t=this.state.dataSources,n=void 0===t?[]:t;n.length&&yo.getInstance().getAdminJobs(null,null,n.map((function(e){return"resync-ds-"+e.Name})),1).then((function(t){var n={};(t.Jobs||[]).forEach((function(e){e.Tasks&&e.Tasks.length&&(n[e.ID.replace("resync-ds-","")]=e)})),e.setState({resyncJobs:n})}))}},{key:"closeEditor",value:function(){this.props.closeRightPane()}},{key:"openDataSource",value:function(e){if(e.length){var t=e[0],n=this.props,r=n.openRightPane,o=n.accessByName,i=n.pydio,a=n.storageTypes;r({COMPONENT:cr,PROPS:{ref:"editor",pydio:i,dataSource:t,storageTypes:a,readonly:!o("CreateDatasource"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"makeStatusLabel",value:function(e,t){switch(e){case"error":return i().createElement("span",{style:{color:"#e53935"}},i().createElement("span",{className:"mdi mdi-alert"})," ",t);case"running":return i().createElement("span",{style:{color:"#ef6c00"}},i().createElement("span",{className:"mdi mdi-timer-sand"})," ",t);default:return i().createElement("span",{style:{color:"#1b5e20"}},i().createElement("span",{className:"mdi mdi-check"})," ",t)}}},{key:"computeStatus",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&e.Disabled)return-1;var r,o,i,a=this.state,l=a.startedServices,s=void 0===l?[]:l,c=a.peerAddresses,u=void 0===c?[]:c,d=a.m,p=a.newDsName;if(!s.length)return d("status.na");if(s.map((function(t){t.Name==="pydio.grpc.data.sync."+e.Name&&"STARTED"===t.Status?o=!0:t.Name==="pydio.grpc.data.index."+e.Name&&"STARTED"===t.Status?r=!0:t.Name==="pydio.grpc.data.objects."+e.ObjectsServiceName&&"STARTED"===t.Status&&(i=!0)})),r&&o&&i)return p&&e.Name===p&&setTimeout((function(){t.setState({newDsName:null})}),100),n?0:this.makeStatusLabel("ok",d("status.ok"));if(p&&e.Name===p)return n?1:this.makeStatusLabel("running",d("status.starting"));if(r||o||i){var f=[];return r||f.push(d("status.index")),o||f.push(d("status.sync")),i||f.push(d("status.object")),n?3:this.makeStatusLabel("error",f.join(" - "))}var y=d("status.ko");return u&&-1===u.indexOf(e.PeerAddress)&&(y=d("status.ko-peers").replace("%s",e.PeerAddress)),n?2:this.makeStatusLabel("error",y)}},{key:"computeJobStatus",value:function(e){var t=e.Tasks[0];switch(t.Status){case"Finished":return this.makeStatusLabel("ok",mo(new Date(1e3*parseInt(t.EndTime))).fromNow());case"Running":return this.makeStatusLabel("running",t.StatusMessage||"Running...");case"Error":return this.makeStatusLabel("error",t.StatusMessage);case"Queued":return this.makeStatusLabel("running",t.StatusMessage)}return this.makeStatusLabel("ok",t.StatusMessage)}},{key:"openVersionPolicy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e||e.length){var n,r=!1;if(void 0===e){r=!0,(n=new E.TreeVersioningPolicy).Uuid=Ir(),n.VersionsDataSourceName="versions",n.NodeDeletedStrategy="KeepAll";var o=new E.TreeVersioningKeepPeriod;o.IntervalStart="0",o.MaxNumber=-1,n.KeepPeriods=[o]}else n=e[0],t&&(r=!0,(n=E.TreeVersioningPolicy.constructFromObject(JSON.parse(JSON.stringify(n)))).Uuid=Ir(),n.Name+=" (Copy)");var i=this.props,a=i.openRightPane,l=i.pydio,s=i.versioningReadonly,c=i.accessByName,u=this.state.dataSources;a({COMPONENT:Ar,PROPS:{ref:"editor",versionPolicy:n,create:r,pydio:l,internalSources:u.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal})).map((function(e){return e.Name})),readonly:s||!c("CreateVersioning"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"deleteVersionPolicy",value:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.versions.editor.delete.confirm"],destructive:[e.Name],validCallback:function(){le().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(b().getRestClient()).deleteVersioningPolicy(e.Uuid).then((function(e){t.load()}))}))}})}},{key:"createDataSource",value:function(e){var t=this.props,n=t.pydio,r=t.storageTypes,o=this.state.dataSources;this.props.openRightPane({COMPONENT:cr,PROPS:{ref:"editor",create:!0,createStructure:e,existingNames:o.map((function(e){return e.Name})),pydio:n,storageTypes:r,closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}},{key:"resyncDataSource",value:function(e,t,n){e.UI.openConfirmDialog({message:t("editor.legend.resync"),skipNext:"datasource.resync.confirm",validCallback:function(){new Rt(n).resyncSource()}})}},{key:"deleteDataSource",value:function(e,t,n){var r=this;e.UI.openConfirmDialog({message:t("editor.delete.warning"),validCallback:function(){new Rt(n).deleteSource().then((function(){r.load()}))},destructive:[n.Name]})}},{key:"createWorkspaceFromDatasource",value:function(e,t,n){var r=new T,o=r.getModel(),i=n.Name;o.Label=i,o.Description="Root of "+i,o.Slug=i,o.Attributes.DEFAULT_RIGHTS="";var a={Uuid:"DATASOURCE:"+i,Path:i};o.RootNodes[a.Uuid]=a,e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:t("board.wsfromds.title"),legendId:t("board.wsfromds.legend").replace("%s",i),fieldLabelId:t("board.wsfromds.field"),defaultValue:t("board.wsfromds.defaultPrefix").replace("%s",i),submitValue:function(t){o.Label=t,r.save().then((function(t){localStorage.setItem("admin.workspace.autoload",t.UUID),e.goTo("/data/workspaces")}))}})}},{key:"render",value:function(){var e=this,t=this.state,n=t.dataSources,r=t.resyncJobs,a=t.versioningPolicies,l=t.m,s=t.createDialog;n.sort(v().arraySorter("Name"));var c=n.filter((function(e){return!(e.StorageConfiguration&&e.StorageConfiguration.cellsInternal)})),u=n.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal}));a.sort(v().arraySorter("Name"));var d=AdminComponents.AdminStyles(this.props.muiTheme.palette),f=d.body,y=f.tableMaster,m=f.block.props,h=f.block.container,b=this.props,g=b.currentNode,S=b.pydio,w=b.versioningReadonly,E=b.accessByName,O=[{name:"Name",label:l("name"),style:{fontSize:15,width:"15%"},headerStyle:{width:"15%"},sorter:{type:"string",default:!0}},{name:"StorageType",label:l("storage"),style:{width:"15%"},headerStyle:{width:"15%"},renderCell:function(e){var t="storage.fs";switch(e.StorageType){case"S3":t="storage.s3";break;case"AZURE":t="storage.azure";break;case"GCS":t="storage.gcs"}return l(t)},sorter:{type:"string"}},{name:"Status",label:l("status"),hideSmall:!0,renderCell:function(t){return t.Disabled?i().createElement("span",{style:{color:"#757575"}},i().createElement("span",{className:"mdi mdi-checkbox-blank-circle-outline"})," ",l("status.disabled")):e.computeStatus(t)},sorter:{type:"number",value:function(t){return e.computeStatus(t,!0)}}},{name:"SyncStatus",label:l("syncStatus"),hideSmall:!0,renderCell:function(t){return r&&r[t.Name]?e.computeJobStatus(r[t.Name]):"n/a"},sorter:{type:"number",value:function(e){return r&&r[e.Name]?r[e.Name].Tasks[0].EndTime:0}}},{name:"VersioningPolicyName",label:l("versioning"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,renderCell:function(e){var t=a.find((function(t){return t.Uuid===e.VersioningPolicyName}));return t?t.Name:e.VersioningPolicyName||"-"},sorter:{type:"string"}},{name:"EncryptionMode",label:l("encryption"),hideSmall:!0,style:{width:"8%",textAlign:"center"},headerStyle:{width:"8%"},renderCell:function(e){return"MASTER"===e.EncryptionMode?i().createElement("span",{className:"mdi mdi-check"}):"-"},sorter:{type:"number",value:function(e){return"MASTER"===e.EncryptionMode?1:0}}}];c.filter((function(e){return!e.FlatStorage})).length||(O=O.filter((function(e){return"SyncStatus"!==e.name})));var k=O.filter((function(e){return"VersioningPolicyName"!==e.name&&"SyncStatus"!==e.name})),C=g.getLabel(),P=g.getMetadata().get("icon_class"),j=[];E("CreateDatasource")&&j.push(i().createElement(p.FlatButton,io({primary:!0,label:S.MessageHash["ajxp_admin.ws.4"],onClick:function(){return e.setState({createDialog:!0})}},d.props.header.flatButton)));var x=!w&&E("CreateVersioning");x&&j.push(i().createElement(p.FlatButton,io({primary:!0,label:S.MessageHash["ajxp_admin.ws.4b"],onClick:function(){e.openVersionPolicy()}},d.props.header.flatButton)));var T=[{name:"Name",label:l("versioning.name"),style:{width:180,fontSize:15},headerStyle:{width:180},sorter:{type:"string",default:!0}},{name:"Description",label:l("versioning.description"),sorter:{type:"string"}},{name:"KeepPeriods",hideSmall:!0,label:l("versioning.periods"),renderCell:function(e){return i().createElement(hr,{rendering:"short",policy:e,pydio:S})}},{name:"VersionsDataSourceName",style:{width:180},headerStyle:{width:180},label:l("versioning.storage"),sorter:{type:"string"},hideSmall:!0}],N=[];E("CreateDatasource")&&N.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit datasource",onClick:function(t){e.openDataSource([t])}}),N.push({iconClassName:"mdi mdi-folder-plus",tooltip:"Create workspace here",onClick:function(t){return e.createWorkspaceFromDatasource(S,l,t)}}),E("CreateDatasource")&&N.push({iconClassName:"mdi mdi-delete",tooltip:l("editor.legend.delete.button"),onClick:function(t){return e.deleteDataSource(S,l,t)}});var A=[].concat(N);c.filter((function(e){return!e.FlatStorage})).length>0&&N.push({iconClassName:"mdi mdi-sync",tooltip:l("editor.legend.resync.button"),onClick:function(t){return e.resyncDataSource(S,l,t)},disable:function(e){return e.FlatStorage}});var R=[];return R.push({iconClassName:x?"mdi mdi-pencil":"mdi mdi-eye",tooltip:x?"Edit policy":"Display policy",onClick:function(t){e.openVersionPolicy([t])}}),x&&(R.push({iconClassName:"mdi mdi-content-copy",tooltip:"Duplicate policy",onClick:function(t){return e.openVersionPolicy([t],!0)}}),R.push({iconClassName:"mdi mdi-delete",tooltip:"Delete policy",destructive:!0,onClick:function(t){return e.deleteVersionPolicy(t)}})),i().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},i().createElement("div",{className:"vertical-layout",style:{width:"100%"}},i().createElement(AdminComponents.Header,{title:C,icon:P,actions:j,reloadAction:this.load.bind(this),loading:!(this.state.dsLoaded&&this.state.versionsLoaded)}),i().createElement(eo,{open:s,onRequestClose:function(){e.setState({createDialog:!1})},onSubmit:function(t){e.createDataSource(t)}}),i().createElement("div",{className:"layout-fill"},i().createElement(AdminComponents.SubHeader,{title:l("board.ds.title"),legend:l("board.ds.legend")}),i().createElement(p.Paper,io({},m,{style:ro({},h)}),i().createElement(po,{data:c,columns:O,actions:N,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.datasources.list"})),u.length>0&&i().createElement(o.Fragment,null,i().createElement("div",{style:{padding:"0px 20px"}},l("board.ds.internal.legend")),i().createElement(p.Paper,io({},m,{style:ro({},h)}),i().createElement(po,{data:u,columns:k,actions:A,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.internalsources.list"}))),i().createElement(AdminComponents.SubHeader,{title:l("board.versioning.title"),legend:l("board.versioning.legend")}),i().createElement(p.Paper,io({},m,{style:ro({},h)}),i().createElement(po,{data:a,columns:T,actions:R,onSelectRows:this.openVersionPolicy.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:y,storageKey:"console.versioning.policies.list"})),i().createElement(AdminComponents.SubHeader,{title:l("board.enc.title"),legend:l("board.enc.legend")}),i().createElement(Jr,{pydio:S,ref:"encKeys",accessByName:E,adminStyles:d}))))}}],r&&ao(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);function bo(e){return bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bo(e)}function go(){return go=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},go.apply(null,arguments)}function vo(e,t){if(e){if("string"==typeof e)return So(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?So(e,t):void 0}}function So(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function wo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Eo(r.key),r)}}function Eo(e){var t=function(e){if("object"!=bo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=bo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==bo(t)?t:t+""}function Oo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Oo=function(){return!!e})()}function ko(e){return ko=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ko(e)}function Co(e,t){return Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Co(e,t)}ho.propTypes={dataModel:c().instanceOf(it()).isRequired,rootNode:c().instanceOf(lt()).isRequired,currentNode:c().instanceOf(lt()).isRequired,openEditor:c().func.isRequired,openRightPane:c().func.isRequired,closeRightPane:c().func.isRequired,filter:c().string,versioningReadonly:c().bool},ho=(0,m.muiThemeable)()(ho);var Po=n(509).muiThemeable,jo=d().requireLib("components").MaterialTable,xo=d().requireLib("boot").AsyncComponent,To=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=ko(t),function(e,t){if(t&&("object"==bo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Oo()?Reflect.construct(t,n||[],ko(e).constructor):t.apply(e,n))}(this,t,[e])).state={loading:!1,namespaces:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Co(e,t)}(t,e),n=t,(r=[{key:"componentWillMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading:!0}),re.loadNamespaces().then((function(t){e.setState({loading:!1,namespaces:t.Namespaces||[]})}))}},{key:"emptyNs",value:function(){var e=new E.IdmUserMetaNamespace;return e.Policies=[E.ServiceResourcePolicy.constructFromObject({Action:"READ",Subject:"*",Effect:"allow"}),E.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Subject:"*",Effect:"allow"})],e.JsonDefinition=JSON.stringify({type:"string"}),e.Indexable=!0,e}},{key:"create",value:function(){this.setState({create:!0,dialogOpen:!0,selectedNamespace:this.emptyNs()})}},{key:"deleteNs",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("delete.confirm"),destructive:[e.Namespace],validCallback:function(){re.deleteNS(e).then((function(){t.load()}))}})}},{key:"open",value:function(e){e.length&&this.setState({create:!1,dialogOpen:!0,selectedNamespace:e[0]})}},{key:"close",value:function(){this.setState({dialogOpen:!1,selectedNamespace:null})}},{key:"render",value:function(){var e=this,t=this.props,n=t.muiTheme,r=t.currentNode,o=t.pydio,a=t.accessByName,l=t.policiesBuilder,s=t.customButtons,c=void 0===s?[]:s,u=AdminComponents.AdminStyles(n.palette),d=this.state,f=d.namespaces,y=d.loading,m=d.dialogOpen,h=d.selectedNamespace,b=d.create,g=d.m,v=d.async;h||(h=this.emptyNs());var S=function(e){return function(e){if(Array.isArray(e))return So(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(new Set(f.map((function(e){return xe(e)})).filter((function(e){return e}))));f.sort((function(e,t){var n,r;return(n=e.Order||0)===(r=t.Order||0)?0:n>r?1:-1}));var w=[{name:"Order",label:g("order"),style:{width:30},headerStyle:{width:30},hideSmall:!0,renderCell:function(e){return e.Order||"0"},sorter:{type:"number"}},{name:"Namespace",label:g("namespace"),style:{fontSize:15},sorter:{type:"string"}},{name:"Label",label:g("label"),style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"Indexable",label:g("indexable"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0,renderCell:function(e){return e.Indexable?"Yes":"No"},sorter:{type:"number",value:function(e){return e.Indexable?1:0}}},{name:"JsonDefinition",label:g("definition"),hideSmall:!0,renderCell:function(e){var t=e.JsonDefinition;if(!t)return"";var n=JSON.parse(t);return re.MetaTypes[n.type]||n.type},sorter:{type:"string"}}],E={};S.length?f.map((function(e){var t=xe(e);E[t]||(E[t]=[]),E[t].push(e)})):E[""]=f;var O=r.getLabel(),k=r.getMetadata().get("icon_class"),C=[],P=[];return c&&c.forEach((function(t){if(!t.access||a(t.access)){var n=o.MessageHash[t.label]||t.label,r=function(){if(t.insert){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||vo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.insert.split("."),2),r=n[0],o=n[1];e.setState({async:{namespace:r,component:o}})}};t.icon?C.push(i().createElement(p.IconButton,go({iconClassName:"mdi mdi-"+t.icon,tooltip:n,onClick:r},u.props.header.iconButton))):C.push(i().createElement(p.FlatButton,go({label:n,onClick:r},u.props.header.flatButton)))}})),a("Create")&&(C.push(i().createElement(p.FlatButton,go({primary:!0,label:g("namespace.add"),onClick:function(){e.create()}},u.props.header.flatButton))),P.push({iconClassName:"mdi mdi-pencil",onClick:function(t){e.open([t])}},{iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteNs(t)}})),i().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},i().createElement(Re,{pydio:o,open:m,create:b,namespace:h,onRequestClose:function(){return e.close()},reloadList:function(){return e.load()},namespaces:f,readonly:!a("Create"),policiesBuilder:l}),i().createElement("div",{className:"vertical-layout",style:{width:"100%"}},i().createElement(AdminComponents.Header,{title:O,icon:k,actions:C,reloadAction:this.load.bind(this),loading:y}),v&&i().createElement(xo,{namespace:v.namespace,componentName:v.component,onDismiss:function(){return e.setState({async:null},(function(){e.load()}))}}),i().createElement("div",{className:"layout-fill"},i().createElement(AdminComponents.SubHeader,{title:g("namespaces"),legend:g("namespaces.legend")}),Object.keys(E).sort().map((function(t){return i().createElement(i().Fragment,null,t&&i().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},"["+g("group")+"] "+t),!t&&S.length>0&&i().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},g("default-group")),i().createElement(p.Paper,u.body.block.props,i().createElement(jo,{data:E[t],columns:w,actions:P,onSelectRows:e.open.bind(e),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:g("empty"),masterStyles:u.body.tableMaster,storageKey:"console.metadata.list"})))})))))}}])&&wo(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(i().Component);To=Po()(To),window.AdminWorkspaces=r})();