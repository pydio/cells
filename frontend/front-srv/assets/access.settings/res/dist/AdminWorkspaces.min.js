(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")},880:e=>{e.exports=require("pydio/http/api")},590:e=>{e.exports=require("pydio/lang/observable")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{DataSource:()=>dt,DataSourceEditor:()=>An,DataSourcesBoard:()=>Rr,MetadataBoard:()=>Fr,TemplatePath:()=>ot,TemplatePathEditor:()=>ht,VirtualNodes:()=>Ct,Workspace:()=>C,WsAutoComplete:()=>J,WsDashboard:()=>$e});const e=require("react");var t=n.n(e);const o=require("create-react-class");var i=n.n(o);const a=require("prop-types");var l=n.n(a);const s=require("pydio");var c=n.n(s);const u=require("material-ui"),d=require("pydio/util/xml");var p=n.n(d),f=n(173),y=n(880),m=n.n(y);const h=require("pydio/util/lang");var g=n.n(h),b=n(590),v=n.n(b);const S=require("cells-sdk");function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(i){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalAttributes={},t.dirty=!1,e?t.initModel(e):(t.create=!0,t.model=new S.IdmWorkspace,t.model.Scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.model.RootNodes={},t.internalAttributes={DEFAULT_RIGHTS:""},t.model.PoliciesContextEditable=!0,t.model.Attributes=JSON.stringify(t.internalAttributes)),t.observableModel=t.buildProxy(t.model),t}return t=l,r=[{key:"rootIsTemplatePath",value:function(e){return!(!e.MetaStore||!e.MetaStore.resolution)}},{key:"listWorkspaces",value:function(){var e=new S.WorkspaceServiceApi(m().getRestClient()),t=new S.RestSearchWorkspaceRequest,n=new S.IdmWorkspaceSingleQuery;return n.scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.Queries=[n],e.searchWorkspaces(t)}}],(n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;return"Slug"===n?o=g().computeStringSlug(o):"Label"===n&&t.create&&(e.Slug=g().computeStringSlug(o)),e[n]=o,t.dirty=!0,t.notify("update"),!0},get:function(e,n){var r=e[n];return"Attributes"===n&&(r=t.internalAttributes),r instanceof Array?r:r instanceof Object?t.buildProxy(r):r}})}},{key:"initModel",value:function(e){if(this.create=!1,this.dirty=!1,this.model=e,this.snapshot=JSON.parse(JSON.stringify(e)),e.Attributes){var t=JSON.parse(e.Attributes);"object"===w(t)&&Object.keys(t).length&&(this.internalAttributes=t)}else this.internalAttributes={};e.RootNodes||(e.RootNodes={})}},{key:"getModel",value:function(){return this.observableModel}},{key:"hasTemplatePath",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"hasFolderRoots",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return!l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"save",value:function(){var e=this;return this.model.Attributes=JSON.stringify(this.internalAttributes),new S.WorkspaceServiceApi(m().getRestClient()).putWorkspace(this.model.Slug,this.model).then((function(t){e.initModel(t),e.observableModel=e.buildProxy(e.model)}))}},{key:"remove",value:function(){return new S.WorkspaceServiceApi(m().getRestClient()).deleteWorkspace(this.model.Slug)}},{key:"revert",value:function(){var e=S.IdmWorkspace.constructFromObject(this.snapshot||{});this.initModel(e),this.observableModel=this.buildProxy(this.model)}},{key:"isValid",value:function(){return this.model.Slug&&this.model.Label&&Object.keys(this.model.RootNodes).length>0}},{key:"isDirty",value:function(){return this.dirty}}])&&E(t.prototype,n),r&&E(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());const P=require("lodash.debounce");var j=n.n(P);const x=require("pydio/util/path");var T=n.n(x),R=["muiTheme","children"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t,n){return(t=B(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function B(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===I(t)?t:String(t)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},K.apply(this,arguments)}var W=c().requireLib("hoc"),U=W.ModernAutoComplete,q=W.ThemedModernStyles,H=(0,f.muiThemeable)()((function(e){var n=e.muiTheme,r=e.children,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,R),i=q(n);return t().createElement("div",K({style:i.fillBlockV2Right},o),r)})),J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(i);if(a){var n=V(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.value,r=void 0===n?"":n;return t.debounced=j()((function(){var e=t.state.value;t.loadValues(e)}),300),t.state={nodes:[],value:r},t}return n=s,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.validateOnLoad,n=this.state.value;this.loadValues(n,(function(){var n=e.state,r=n.nodes,o=n.value;r.filter((function(e){return e.Path===o&&(!e.Type||"COLLECTION"==e.Type&&!e.MetaStore&&!e.MetaStore.resolution)})).map((function(t){e.loadValues(o+"/")})),t&&e.handleNewRequest(o)}))}},{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({value:e})}},{key:"handleNewRequest",value:function(e){var t,n,r=this.state.nodes,o=this.props,i=o.onChange,a=void 0===i?function(){}:i,l=o.onDelete,s=void 0===l?function(){}:l,c=o.onError,u=void 0===c?function(){}:c;if("string"==typeof e){if(""===e)return void s();t=e,(n=r.filter((function(t){return t.Path===e}))[0])||(n=r.filter((function(t){return 0===t.Path.indexOf(e)}))[0])}else"object"===I(e)&&(t=e.key,n=e.node);if(!n)return u();this.setState({value:t}),a(t,n)}},{key:"loadValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e.lastIndexOf("/"),o=e.substr(0,r);if(null===this.lastSearch||this.lastSearch!==o){this.lastSearch=o,this.setState({loading:!0});var i=new S.AdminTreeServiceApi(PydioApi.getRestClient()),a=new S.TreeListNodesRequest,l=new S.TreeNode;l.Path=o+"/",a.Node=l,i.listAdminTree(a).then((function(e){t.setState({nodes:e.Children||[],loading:!1},(function(){return n()}))})).catch((function(){t.setState({loading:!1},(function(){return n()}))}))}}},{key:"render",value:function(){var e=this,n=this.state,r=n.value,o=n.nodes,i=n.loading,a=this.props,l=a.pydio,c=a.onDelete,d=a.skipTemplates,p=a.label,f=a.zDepth,y=void 0===f?0:f,m=function(e){return l.MessageHash["ajxp_admin."+e]||e},h=[];if(o){var g={};if(o.forEach((function(e){if(!(e.MetaStore&&e.MetaStore.resolution&&"cells"===e.Uuid||T().getBasename(e.Path).startsWith("."))){var t=s.renderNode(e,m);g[t.categ]||(g[t.categ]=[]),g[t.categ].push(t)}})),Object.keys(g).length>1){h.push({key:"h1",text:"",value:t().createElement(u.MenuItem,{primaryText:m("ws.complete.datasources"),style:{fontSize:13,fontWeight:500},disabled:!0})});var b=g[Object.keys(g)[0]];if(b.sort(LangUtils.arraySorter("text")),h.push.apply(h,M(b)),!d){h.push({key:"h2",text:"",value:t().createElement(u.MenuItem,{primaryText:m("ws.complete.templates"),style:{fontSize:13,fontWeight:500},disabled:!0})});var v=g[Object.keys(g)[1]];v.sort(LangUtils.arraySorter("text")),h.push.apply(h,M(v))}}else 1===Object.keys(g).length&&h.push.apply(h,M(g[Object.keys(g)[0]]))}return t().createElement(u.Paper,{zDepth:y,style:A({display:"flex",alignItems:"center",margin:"2px 0"},this.props.style)},t().createElement("div",{style:{position:"relative",flex:1,height:60}},t().createElement("div",{style:{position:"absolute",right:0,top:30,width:30}},t().createElement(u.RefreshIndicator,{size:30,left:0,top:0,status:i?"loading":"hide"})),t().createElement(U,{fullWidth:!0,searchText:r,onUpdateInput:function(t){return e.handleUpdateInput(t)},onNewRequest:function(t){return e.handleNewRequest(t)},onClose:function(){return e.handleNewRequest(r)},dataSource:h,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},floatingLabelText:p||m("ws.complete.label"),openOnFocus:!0,menuProps:{maxHeight:200},hasRightBlock:!0})),t().createElement(H,null,t().createElement(u.IconButton,{style:{marginTop:2},iconStyle:{color:c?"#9e9e9e":"#eee"},iconClassName:"mdi mdi-delete",onClick:c,disabled:!c})))}}],o=[{key:"renderNode",value:function(e,n){var r=t().createElement("span",null,e.Path),o="mdi mdi-folder",i="folder";if(e.MetaStore&&e.MetaStore.resolution){o="mdi mdi-file-tree",i="templatePath";var a=e.MetaStore.resolution.split("\n").pop();r=t().createElement("span",null,e.Path," ",t().createElement("i",{style:{color:"#9e9e9e"}},"- ",n("ws.complete.resolves")," ",a))}else"LEAF"===e.Type&&(o="mdi mdi-file");return{key:e.Path,text:e.Path,node:e,categ:i,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:o,color:"#607d8b",style:{float:"left",marginRight:8}})," ",r)}}}],r&&_(n.prototype,r),o&&_(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);const z=require("pydio/http/resources-manager");var Y=n.n(z);function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==G(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===G(o)?o:String(o)),r)}var o}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"loadNamespaces",value:function(){return new S.UserMetaServiceApi(m().getRestClient()).listUserMetaNamespace()}},{key:"putNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("PUT"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"deleteNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("DELETE"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"clearLocalCache",value:function(){try{window.ReactMeta&&ReactMeta.Renderer.getClient().clearConfigs()}catch(e){}}}],null&&Q(t.prototype,null),n&&Q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();$.MetaTypes={string:"Text",textarea:"Long Text",integer:"Number",boolean:"Boolean",date:"Date",choice:"Selection",tags:"Extensible Tags",stars_rate:"Stars Rating",css_label:"Color Labels",json:"JSON"};const X=require("pydio/util/func");var Z=n.n(X);function ee(e,t){if(e){if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(e,t):void 0}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e,t,n){return(t=ce(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(){return ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ie.apply(this,arguments)}function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ce(r.key),r)}}function se(e,t,n){return t&&le(e.prototype,t),n&&le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ce(e){var t=function(e,t){if("object"!==ye(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ye(t)?t:String(t)}function ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fe(e);if(t){var o=fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}var me=c().requireLib("hoc"),he=me.ModernTextField,ge=me.ModernAutoComplete,be=me.ThemedModernStyles;function ve(e){try{return JSON.parse(e.JsonDefinition).groupName||""}catch(e){return""}}function Se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var n=e.split("."),r=n.shift(),o=n.join(".");return Y().loadClass(r).then((function(n){var i=Z().getFunctionByName(o,n);if(!i){if("object"===ye(n)&&n[r]){var a=Z().getFunctionByName(o,n[r]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(n){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw n}))}var we=function(n){ue(o,n);var r=pe(o);function o(e){return ae(this,o),r.call(this,e)}return se(o,[{key:"togglePolicies",value:function(e,t){var n=this.props,r=n.policies,o=void 0===r?[]:r,i=n.onChangePolicies,a=o.filter((function(t){return t.Action!==e}));a.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),"READ"===e&&t&&(a=a.filter((function(e){return"WRITE"!==e.Action}))).push(S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Effect:"allow",Subject:"profile:admin"})),i(a)}},{key:"render",value:function(){var n,r,o=this,i=this.props,a=i.readonly,l=i.policies,s=i.pydio,c=i.muiTheme,d=function(e){return s.MessageHash["ajxp_admin.metadata."+e]||e},p=be(c);return l&&l.map((function(e){"profile:admin"===e.Subject&&"READ"===e.Action&&(n=!0),"profile:admin"===e.Subject&&"WRITE"===e.Action&&(r=!0)})),t().createElement(e.Fragment,null,t().createElement("div",null,t().createElement(u.Toggle,ie({label:d("toggle.read"),disabled:a,labelPosition:"left",toggled:n,onToggle:function(e,t){o.togglePolicies("READ",t)}},p.toggleFieldV2))),t().createElement("div",null,t().createElement(u.Toggle,ie({label:d("toggle.write"),labelPosition:"left",disabled:n||a,toggled:r,onToggle:function(e,t){o.togglePolicies("WRITE",t)}},p.toggleFieldV2))))}}]),o}(t().Component);we=(0,f.muiThemeable)()(we);var Ee=function(e){ue(r,e);var n=pe(r);function r(e){var t;return ae(this,r),(t=n.call(this,e)).state={namespace:t.cloneNs(e.namespace),m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t},selectorNewKey:"",selectorNewValue:"",PoliciesBuilder:we},Y().loadClass("ReactMeta").then((function(e){t.setState({metaModule:e});var n=t.props.policiesBuilder;n&&Se(n,we).then((function(e){return t.setState({PoliciesBuilder:e})}))})),t}return se(r,[{key:"cloneNs",value:function(e){return S.IdmUserMetaNamespace.constructFromObject(JSON.parse(JSON.stringify(e)))}},{key:"componentWillReceiveProps",value:function(e){if(e.open!==this.props.open){var t=e.create,n=e.namespaces,r=this.cloneNs(e.namespace);t&&n.length&&(r.Order=n.map((function(e){return e.Order||0})).reduce((function(e,t){return Math.max(e,t)}),0)+1),this.setState({namespace:r})}}},{key:"save",value:function(){var e=this,t=this.state.namespace;$.putNS(t).then((function(){e.props.onRequestClose(),e.props.reloadList()}))}},{key:"getHideValue",value:function(){var e=this.state.namespace;try{return JSON.parse(e.JsonDefinition).hide}catch(e){return!1}}},{key:"setHideValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(re(re({},n),{},{hide:e})),this.setState({namespace:t})}},{key:"setGroupValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(re(re({},n),{},{groupName:e})),this.setState({namespace:t})}},{key:"getAdditionalData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.state.namespace;try{var n=JSON.parse(t.JsonDefinition).data||e;if(e.items&&n.split){var r=n.split(",").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split("|"),2);return{key:t[0],value:t[1]}}));return{items:r}}return n}catch(e){}return e}},{key:"setAdditionalDataKey",value:function(e,t){var n=this.state.namespace,r=JSON.parse(n.JsonDefinition),o=oe({},e,t);r.data=re(re({},r.data),o),n.JsonDefinition=JSON.stringify(r),this.setState({namespace:n})}},{key:"togglePolicies",value:function(e,t){var n=this,r=this.state.namespace,o=(r.Policies||[]).filter((function(t){return t.Action!==e}));o.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),r.Policies=o,this.setState({namespace:r},(function(){"READ"===e&&t&&n.togglePolicies("WRITE",!0)}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.create,o=n.namespaces,i=n.pydio,a=n.readonly,l=n.muiTheme,s=this.state,d=s.namespace,p=s.m,f=s.PoliciesBuilder,y=s.metaModule,h=be(l);if(!y)return null;var g,b=y.TypeEditor;g=d.Label?d.Label:p("editor.title.create");var v="string";d.JsonDefinition&&(v=JSON.parse(d.JsonDefinition).type);var w,E,O=!1;if(d.Label?d.Namespace&&"usermeta-"!==d.Namespace||(O=!0,w=p("editor.ns.error")):(O=!0,E=p("editor.label.error")),r&&o.filter((function(e){return e.Namespace===d.Namespace})).length&&(O=!0,w=p("editor.ns.exists")),"choice"===v){var k=this.getAdditionalData({items:[]}).items;k&&k.length||(O=!0)}var C,P=function(e){if(Array.isArray(e))return te(e)}(C=new Set(o.map((function(e){return ve(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(C)||ee(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();d.Policies&&d.Policies.map((function(e){"profile:admin"===e.Subject&&e.Action,"profile:admin"===e.Subject&&e.Action}));var j=[t().createElement(u.FlatButton,{primary:!0,label:i.MessageHash[54],onClick:this.props.onRequestClose}),t().createElement(u.FlatButton,{primary:!0,disabled:O||a,label:i.MessageHash[53],onClick:function(){e.save()}})];"tags"!==v||a||j.unshift(t().createElement(u.FlatButton,{primary:!1,label:p("editor.tags.reset"),onClick:function(){new S.UserMetaServiceApi(m().getRestClient()).deleteUserMetaTags(d.Namespace,"*").then((function(){i.UI.displayMessage("SUCCESS",p("editor.tags.cleared").replace("%s",d.Namespace))})).catch((function(e){i.UI.displayMessage("ERROR",e.message)}))}}));var x={section:{marginTop:10,fontWeight:500,fontSize:12}};return t().createElement(u.Dialog,{title:g,actions:j,modal:!1,contentStyle:{width:520},open:this.props.open,onRequestClose:this.props.onRequestClose,autoScrollBodyContent:!0,bodyStyle:{padding:20}},t().createElement(b,{m:p,pydio:i,namespace:d,forcePrefix:"usermeta-",onChange:function(t){return e.setState({namespace:t})},readonly:a,create:r,labelError:E,nameError:w,styles:x}),t().createElement("div",{style:x.section},c().getInstance().MessageHash[310]),t().createElement(u.Toggle,ie({label:p("toggle.list-visibility"),disabled:a,labelPosition:"left",toggled:!this.getHideValue(),onToggle:function(t,n){e.setHideValue(!n)}},h.toggleFieldV2)),t().createElement(u.Toggle,ie({label:p("toggle.index"),disabled:a,labelPosition:"left",toggled:d.Indexable,onToggle:function(t,n){d.Indexable=n,e.setState({namespace:d})}},h.toggleFieldV2)),f&&t().createElement(f,{policies:d.Policies,readonly:a,onChangePolicies:function(t){return e.setState({namespace:re(re({},d),{},{Policies:t})})},pydio:i}),t().createElement("div",{style:x.section},p("order")),t().createElement(he,{floatingLabelText:p("order"),value:d.Order?d.Order:"0",onChange:function(t,n){d.Order=parseInt(n),e.setState({namespace:d})},fullWidth:!0,type:"number",readOnly:a,variant:"v2"}),t().createElement(ge,{floatingLabelFixed:!0,fullWidth:!0,floatingLabelText:p("groupName"),filter:function(e,t){return!e.indexOf||0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,dataSource:P,searchText:ve(d)||"",onNewRequest:function(t,n){e.setGroupValue(t)},onUpdateInput:function(t){e.setGroupValue(t)},menuProps:{maxHeight:300,overflowY:"auto"}}))}}]),r}(t().Component);(Ee=(0,f.muiThemeable)()(Ee)).PropTypes={namespace:l().instanceOf(S.IdmUserMetaNamespace).isRequired,namespaces:l().arrayOf(S.IdmUserMetaNamespace),create:l().bool,reloadList:l().func,onRequestClose:l().func};const Oe=Ee;function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ce.apply(this,arguments)}function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e,t,n){return(t=Re(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Re(r.key),r)}}function Re(e){var t=function(e,t){if("object"!==ke(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ke(t)?t:String(t)}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function Ae(e){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ae(e)}var De=c().requireLib("hoc"),Me=De.ModernTextField,Le=De.ModernSelectField,Ie=De.ThemedModernStyles,_e=c().requireLib("form").InputIntegerBytes,Be=AdminComponents,Fe=Be.PaperEditorLayout,Ve=Be.AdminStyles,Ke=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ae(i);if(a){var n=Ae(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=new C(e.workspace);n.observe("update",(function(){t.forceUpdate()})),t.state={workspace:n.getModel(),container:n,newFolderKey:Math.random(),showDialog:!1};var r=t.props.policiesBuilder;return r&&Se(r,null).then((function(e){return t.setState({PoliciesBuilder:e})})).catch((function(e){})),t}return r=s,(o=[{key:"enableSync",value:function(e){e?this.setState({showDialog:"enableSync",dialogTargetValue:e}):this.setState({showDialog:"disableSync",dialogTargetValue:e})}},{key:"confirmSync",value:function(e){this.state.workspace.Attributes.ALLOW_SYNC=e,this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"revert",value:function(){var e=this,t=this.state.container;t.revert(),this.setState({workspace:t.getModel()},(function(){e.forceUpdate()}))}},{key:"save",value:function(){var e=this,t=this.state.container,n=this.props,r=n.reloadList,o=n.closeEditor;this.setState({saving:!0});var i=t.create;t.save().then((function(){r(),e.setState({workspace:t.getModel(),saving:!1},(function(){e.forceUpdate()})),i&&o()})).catch((function(){e.setState({saving:!1})}))}},{key:"remove",value:function(){var e=this.state.container,t=this.props,n=t.closeEditor,r=t.reloadList,o=t.pydio;o.UI.openConfirmDialog({message:o.MessageHash["settings.35"],destructive:[e.getModel().Label],validCallback:function(){e.remove().then((function(){r(),n()}))}})}},{key:"render",value:function(){var n=this,r=this.props,o=r.closeEditor,i=r.pydio,a=r.advanced,l=r.muiTheme,s=this.state,c=s.workspace,d=s.container,p=s.newFolderKey,f=s.saving,y=s.showDialog,m=s.dialogTargetValue,h=s.PoliciesBuilder,g=s.policiesEdit,b=Ie(l),v=function(e){return i.MessageHash["ajxp_admin."+e]||e},S=function(e){return i.MessageHash["settings."+e]||e},w=function(e){return i.MessageHash["advanced_settings."+e]||e},E=!c.PoliciesContextEditable,O=[];d.create||E||O.push(Fe.actionButton(v("plugins.6"),"mdi mdi-undo",(function(){n.revert()}),!d.isDirty())),E||O.push(Fe.actionButton(i.MessageHash[53],"mdi mdi-content-save",(function(){n.save()}),f||!(d.isDirty()&&d.isValid())));var k=Ve(this.props.muiTheme.palette),P={title:je(je({},k.body.block.headerFull),{},{margin:"0 -20px"}),legend:{padding:"16px 4px 8px"},section:je({padding:"0 20px 20px",margin:10,backgroundColor:"white"},k.body.block.container),toggleDiv:{},divider:{margin:"24px -20px 0px",height:1,border:"none",backgroundColor:"rgb(236 239 241)"}},j=c.RootNodes,x=Object.keys(j).map((function(e){var r=v("ws.editor.path.folder");return C.rootIsTemplatePath(j[e])&&(r=v("ws.editor.path.template")),t().createElement(J,{key:j[e].Uuid,pydio:i,label:r,value:j[e].Path,onDelete:function(){delete j[e],n.forceUpdate()},onChange:function(t,n){delete j[e],""!==t&&(j[n.Uuid]=n)},skipTemplates:d.hasFolderRoots()})}));return d.hasTemplatePath()||x.push(t().createElement(J,{key:p,pydio:i,value:"",onChange:function(e,t){t&&(j[t.Uuid]=t,n.setState({newFolderKey:Math.random()}))},skipTemplates:d.hasFolderRoots()})),t().createElement(Fe,{title:c.Label||S("90"),titleLeftIcon:"mdi mdi-folder-open",titleActionBar:O,closeAction:o,className:"workspace-editor",contentFill:!1},t().createElement(u.Dialog,{open:y,title:v("ws.editor.sync.warning"),onRequestClose:function(){n.confirmSync(!m)},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.confirmSync(!m)}}),t().createElement(u.FlatButton,{label:v("ws.editor.sync.warning.validate"),onClick:function(){n.confirmSync(m)}})]},"enableSync"===y&&t().createElement("div",null,v("ws.editor.sync.warning.enable")),"disableSync"===y&&t().createElement("div",null,v("ws.editor.sync.warning.disable"))),t().createElement(u.Paper,{zDepth:0,style:P.section},t().createElement("div",{style:P.title},v("ws.30")),t().createElement("div",{style:P.legend},v("ws.editor.options.legend")),t().createElement(Me,{fullWidth:!0,errorText:c.Label?"":v("ws.editor.label.legend"),floatingLabelText:S("8"),value:c.Label,onChange:function(e,t){c.Label=t},variant:"v2"}),t().createElement(Me,{fullWidth:!0,floatingLabelText:v("ws.editor.description"),value:c.Description,onChange:function(e,t){c.Description=t},variant:"v2"}),t().createElement(Me,{fullWidth:!0,errorText:c.Label&&!c.Slug?v("ws.editor.slug.legend"):"",floatingLabelText:v("ws.5"),value:c.Slug,onChange:function(e,t){c.Slug=t},variant:"v2"})),t().createElement(u.Paper,{zDepth:0,style:P.section},t().createElement("div",{style:P.title},v("ws.editor.data.title")),t().createElement("div",{style:P.legend},v("ws.editor.data.legend")," ",v("ws.editor.default_rights")),x,t().createElement(Le,{fullWidth:!0,value:c.Attributes.DEFAULT_RIGHTS||"",onChange:function(e,t,n){c.Attributes.DEFAULT_RIGHTS=n},hintText:"Default Rights",variant:"v2"},t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.none"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.read"),value:"r"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.readwrite"),value:"rw"}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.default_rights.write"),value:"w"}))),t().createElement(u.Paper,{zDepth:0,style:P.section},t().createElement("div",{style:P.title},v("ws.editor.other")),t().createElement("div",{style:je({},P.legend)},v("ws.editor.other.skiprecycle.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,Ce({label:v("ws.editor.other.skiprecycle"),labelPosition:"right",checked:c.Attributes.SKIP_RECYCLE,onCheck:function(e,t){c.Attributes.SKIP_RECYCLE=t}},b.toggleFieldV2))),a&&t().createElement(e.Fragment,null,t().createElement("hr",{style:P.divider}),t().createElement("div",{style:je({},P.legend)},v("ws.editor.other.sync.legend")),t().createElement("div",{style:P.toggleDiv},t().createElement(u.Checkbox,Ce({label:v("ws.editor.other.sync"),labelPosition:"right",checked:c.Attributes.ALLOW_SYNC,onCheck:function(e,t){!d.hasTemplatePath()&&t?n.enableSync(t):t?c.Attributes.ALLOW_SYNC=t:n.enableSync(t)}},b.toggleFieldV2))),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:je({},P.legend)},v("ws.editor.other.quota")),t().createElement(_e,{variant:"v2",attributes:{label:"Quota"},value:c.Attributes.QUOTA||0,onChange:function(e){e>0?c.Attributes.QUOTA=e+"":(c.Attributes.QUOTA="0",delete c.Attributes.QUOTA)}}),t().createElement("hr",{style:P.divider}),t().createElement("div",{style:je({},P.legend)},v("ws.editor.other.layout")),t().createElement(Le,{fullWidth:!0,floatingLabelText:v("ws.editor.other.layout"),variant:"v2",value:c.Attributes.META_LAYOUT||"",onChange:function(e,t,n){c.Attributes.META_LAYOUT=n}},t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.default"),value:""}),t().createElement(u.MenuItem,{primaryText:v("ws.editor.other.layout.easy"),value:"meta.layout_sendfile"})))),h&&t().createElement(u.Paper,{zDepth:0,style:P.section},t().createElement("div",{style:P.title},w("editor.visibility.workspace")),t().createElement("div",{style:je({},P.legend)},w("editor.visibility.warning"),!g&&t().createElement("span",{style:{fontWeight:500,cursor:"pointer"},onClick:function(){return n.setState({policiesEdit:!0})}}," - ",w("editor.visibility.edit"))),t().createElement(h,{pydio:i,policies:c.Policies,onChangePolicies:function(e){return c.Policies=e},readonly:!g,showHeader:!1,forceCustom:!0,advancedLegend:t().createElement("span",null),advancedContainerStyle:g?{paddingBottom:300}:{},allowedActions:{READ:w("policies.builder.action.read"),WRITE:w("policies.builder.action.write")}})))}}])&&Te(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(e.Component);Ke=(0,f.muiThemeable)()(Ke);const We=require("pydio/model/data-model");var Ue=n.n(We);const qe=require("pydio/model/node");var He=n.n(qe),Je=c().requireLib("components").MaterialTable;const ze=i()({displayName:"WorkspaceList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(Ue()).isRequired,rootNode:l().instanceOf(He()).isRequired,currentNode:l().instanceOf(He()).isRequired,openSelection:l().func,advanced:l().boolean},getInitialState:function(){return{workspaces:[],loading:!1}},startLoad:function(){this.props.onLoadState&&this.props.onLoadState(!0),this.setState({loading:!0})},endLoad:function(){this.props.onLoadState&&this.props.onLoadState(!1),this.setState({loading:!1})},reload:function(){var e=this;this.startLoad(),C.listWorkspaces().then((function(t){e.endLoad(),e.setState({workspaces:t.Workspaces||[]})})).catch((function(t){e.endLoad()}))},componentDidMount:function(){this.reload()},openTableRows:function(e){e.length&&this.props.openSelection(e[0].workspace)},deleteAction:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.35"],destructive:[e.Label],validCallback:function(){new C(e).remove().then((function(){t.reload()}))}})},computeTableData:function(){var e=[],t=this.props.filterString;return this.state.workspaces.map((function(n){var r="";n.RootNodes&&(r=Object.keys(n.RootNodes).map((function(e){return g().trimRight(n.RootNodes[e].Path,"/")})).join(", "));var o=!1;if(n.Attributes)try{var i=JSON.parse(n.Attributes);!0!==i.ALLOW_SYNC&&"true"!==i.ALLOW_SYNC||(o=!0)}catch(e){}if(t){var a=t.toLowerCase(),l=n.Label&&n.Label.toLowerCase().indexOf(a)>=0,s=n.Description&&n.Description.toLowerCase().indexOf(a)>=0,c=r&&r.toLowerCase().indexOf(a)>=0;if(!(l||s||c))return}e.push({workspace:n,label:n.Label,description:n.Description,slug:n.Slug,summary:r,syncable:o})})),e.sort(g().arraySorter("label",!1,!0)),e},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.editable,a=n.tableStyles,l=n.openSelection,s=function(e){return r.MessageHash["ajxp_admin."+e]},c=function(e){return r.MessageHash["settings."+e]},u=[{name:"label",label:c("8"),style:{width:"20%",fontSize:15},headerStyle:{width:"20%"},sorter:{type:"string",default:"true"}},{name:"description",label:c("103"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"summary",label:s("ws.board.summary"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}}];o&&u.push({name:"syncable",label:s("ws.board.syncable"),style:{width:"10%",textAlign:"center"},headerStyle:{width:"10%",textAlign:"center"},sorter:{type:"number",sortValue:function(e){return e.syncable?1:0}},renderCell:function(e){return t().createElement("span",{className:"mdi mdi-check",style:{fontSize:18,opacity:e.syncable?1:0}})}}),u.push({name:"slug",label:s("ws.5"),style:{width:"20%"},headerStyle:{width:"20%"},sorter:{type:"string"}});var d=this.state.loading,p=this.computeTableData(),f=[];i&&f.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit Workspace",onClick:function(e){l(e.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}});var y=r.user.getRepositoriesList();return f.push({iconClassName:"mdi mdi-open-in-new",tooltip:"Open this workspace...",onClick:function(e){r.triggerRepositoryChange(e.workspace.UUID)},disable:function(e){return!y.has(e.workspace.UUID)}}),i&&f.push({iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteAction(t.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}}),t().createElement(Je,{data:p,columns:u,actions:f,onSelectRows:i?this.openTableRows.bind(this):null,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:s(d?"loading":"ws.board.empty"),masterStyles:a,paginate:[10,25,50,100],defaultPageSize:25,storageKey:"console.workspaces.list"})}});function Ye(){return Ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ye.apply(this,arguments)}var Ge=c().requireLib("hoc").ModernTextField,Qe=i()({displayName:"WsDashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(Ue()).isRequired,rootNode:l().instanceOf(He()).isRequired,currentNode:l().instanceOf(He()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,accessByName:l().func.isRequired,advanced:l().boolean},getInitialState:function(){return{selectedNode:null,searchString:""}},dirtyEditor:function(){var e=this.props.pydio;return!(!this.refs.editor||!this.refs.editor.isDirty()||confirm(e.MessageHash["role_editor.19"]))},openWorkspace:function(e){var t=this;if(!this.dirtyEditor()){var n=Ke,r=p().XPathSelectSingleNode(this.props.pydio.getXmlRegistry(),'//client_configs/component_config[@component="AdminWorkspaces.Dashboard"]/editor');r&&(n=r.getAttribute("namespace")+"."+r.getAttribute("component"));var o=this.props,i=o.pydio,a=o.advanced,l=(o.accessByName,o.policiesBuilder),s={COMPONENT:n,PROPS:{ref:"editor",pydio:i,workspace:e,closeEditor:this.closeWorkspace,advanced:a,policiesBuilder:l,reloadList:function(){t.refs.workspacesList.reload()}}};return this.props.openRightPane(s),!0}},closeWorkspace:function(){this.dirtyEditor()||this.props.closeRightPane()},showWorkspaceCreator:function(e){var t=this,n=this.props,r=n.pydio,o=n.advanced,i={COMPONENT:Ke,PROPS:{ref:"editor",type:e,pydio:r,advanced:o,closeEditor:this.closeWorkspace,reloadList:function(){t.refs.workspacesList.reload()}}};this.props.openRightPane(i)},reloadWorkspaceList:function(){this.refs.workspacesList.reload()},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.currentNode,a=n.accessByName,l=n.muiTheme,s=this.state,c=s.searchString,d=s.loading,p=AdminComponents.AdminStyles(l.palette),f=[];a("Create")&&f.push(t().createElement(u.FlatButton,Ye({primary:!0,label:this.context.getMessage("ws.3"),onClick:this.showWorkspaceCreator},p.props.header.flatButton)));var y=t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{width:190}},t().createElement(Ge,{fullWidth:!0,hintText:this.context.getMessage("ws.filter.workspaces"),value:c,onChange:function(t,n){return e.setState({searchString:n})}})));return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout workspaces-board"},t().createElement(AdminComponents.Header,{title:i.getLabel(),icon:"mdi mdi-folder-open",actions:f,centerContent:y,reloadAction:this.reloadWorkspaceList,loading:d}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("ws.dashboard","ajxp_admin")}),t().createElement(u.Paper,Ye({},p.body.block.props,{style:p.body.block.container}),t().createElement(ze,{ref:"workspacesList",pydio:r,openSelection:this.openWorkspace,advanced:o,editable:a("Create"),onLoadState:function(t){e.setState({loading:t})},tableStyles:p.body.tableMaster,filterString:c}))))}});const $e=(0,f.muiThemeable)()(Qe);function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rt(r.key),r)}}function et(e,t){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nt(e)}function rt(e){var t=function(e,t){if("object"!==Xe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Xe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Xe(t)?t:String(t)}var ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&et(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=nt(o);if(i){var n=nt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return tt(e)}(this,e)});function l(e){var t,n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=tt(t=a.call(this)),o=void 0,(r=rt(r="data"))in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e?t.data=e:(t.data=new S.TreeNode,t.data.Type=S.TreeNodeType.constructFromObject("COLLECTION"),t.data.MetaStore={name:"",resolution:"",onDelete:"",contentType:"text/javascript"}),t}return t=l,r=[{key:"loadNodes",value:function(e){var t=new S.ConfigServiceApi(m().getRestClient());c().startLoading(),t.listVirtualNodes().then((function(t){c().endLoading();var n=[];t.Children&&t.Children.map((function(e){n.push(new l(e))})),e(n)})).catch((function(){c().endLoading()}))}}],(n=[{key:"getName",value:function(){return this.data.MetaStore.name}},{key:"setName",value:function(e){this.data.MetaStore.name=e;var t=g().computeStringSlug(e);this.data.Uuid=t,this.data.Path=t,this.notify("update")}},{key:"getValue",value:function(){return this.data.MetaStore.resolution}},{key:"setValue",value:function(e){this.data.MetaStore.resolution=e,this.notify("update")}},{key:"getOnDelete",value:function(){return this.data.MetaStore.onDelete}},{key:"setOnDelete",value:function(e){this.data.MetaStore.onDelete=e,this.notify("update")}},{key:"save",value:function(e){var t=this;Y().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVirtualNode(t.data.Uuid,t.data).then((function(){e()}))}))}},{key:"remove",value:function(e){var t=this;Y().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVirtualNode(t.data.Uuid).then((function(){e()}))}))}}])&&Ze(t.prototype,n),r&&Ze(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==it(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==it(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===it(o)?o:String(o)),r)}var o}function lt(e,t){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lt(e,t)}function st(e){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},st(e)}var ct=n(590),ut=n(880),dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lt(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=st(o);if(i){var n=st(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===it(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flat";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalInvalid=!1,t.nameInvalid=!1,t.existingNames=n,e)t.model=e,e.StorageConfiguration||(e.StorageConfiguration={}),t.snapshot=JSON.parse(JSON.stringify(e));else switch(t.model=new S.ObjectDataSource,t.model.EncryptionMode=S.ObjectEncryptionMode.constructFromObject("CLEAR"),t.model.StorageType=S.ObjectStorageType.constructFromObject("LOCAL"),r){case"flat":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!0;break;case"structured":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!1;break;case"internal":t.model.StorageConfiguration={folder:"",normalize:"false",cellsInternal:"true"},t.model.FlatStorage=!0}return t.observableModel=t.buildProxy(t.model),t}return t=l,n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;if("StorageType"===n)e.StorageConfiguration={},"LOCAL"===o?e.StorageConfiguration={folder:"",normalize:"false"}:"S3"===o?e.StorageConfiguration={customEndpoint:""}:"GCS"===o&&(e.StorageConfiguration={jsonCredentials:""}),t.internalInvalid=!1,e.ApiKey=e.ApiSecret="";else if("Name"===n)o=g().computeStringSlug(o).replace("-","").substr(0,33),t.existingNames&&t.existingNames.indexOf(o)>-1?t.nameInvalid=!0:t.nameInvalid=!1;else if("folder"===n)"/"!==o[0]&&(o="/"+o);else{if("invalid"===n)return t.internalInvalid=r,t.notify("update"),!0;"PeerAddress"===n&&"ANY"===r&&(o="")}return e[n]=o,t.notify("update"),!0},get:function(e,n){var r=e[n];return r instanceof Array?r:r instanceof Object?t.buildProxy(r):"StorageType"===n?r||"LOCAL":"PeerAddress"===n?r||"ANY":r}})}},{key:"getModel",value:function(){return this.observableModel}},{key:"isValid",value:function(){return!this.internalInvalid&&!this.nameInvalid&&("S3"===this.model.StorageType||"AZURE"===this.model.StorageType?this.model.ApiKey&&this.model.ApiSecret&&this.model.Name&&(this.model.ObjectsBucket||this.model.StorageConfiguration.bucketsRegexp):"GCS"===this.model.StorageType?this.model.Name&&this.model.ObjectsBucket&&this.model.StorageConfiguration&&this.model.StorageConfiguration.jsonCredentials:this.model.Name&&this.model.StorageConfiguration&&this.model.StorageConfiguration.folder)}},{key:"getNameError",value:function(e){return this.nameInvalid?e("name.inuse"):null}},{key:"deleteSource",value:function(){return new S.ConfigServiceApi(ut.getRestClient()).deleteDataSource(this.model.Name)}},{key:"resyncSource",value:function(){var e=new S.JobsServiceApi(ut.getRestClient()),t=new S.RestUserJobRequest;return t.JobName="datasource-resync",t.JsonParameters=JSON.stringify({dsName:this.model.Name}),e.userCreateJob("datasource-resync",t)}},{key:"revert",value:function(){return this.model=this.snapshot,this.observableModel=this.buildProxy(this.model),this.snapshot=JSON.parse(JSON.stringify(this.model)),this.observableModel}},{key:"saveSource",value:function(){var e=this;return new S.ConfigServiceApi(ut.getRestClient()).putDataSource(this.model.Name,this.model).then((function(t){e.snapshot=JSON.parse(JSON.stringify(e.model)),e.notify("update")}))}},{key:"stripPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return e;var n={};return Object.keys(e).map((function(r){n[r.replace(t,"")]=e[r]})),n}},{key:"getDataWithPrefix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.model;var n={};return Object.keys(this.model).forEach((function(r){n[t+r]=e.model[r],"EncryptionMode"!==r||e.model[r]||(n[t+r]="CLEAR")})),n}}],r=[{key:"loadDatasources",value:function(){return new S.ConfigServiceApi(ut.getRestClient()).listDataSources()}},{key:"loadVersioningPolicies",value:function(){return new S.ConfigServiceApi(ut.getRestClient()).listVersioningPolicies()}},{key:"loadStatuses",value:function(){return new S.ConfigServiceApi(ut.getRestClient()).listServices("STARTED")}},{key:"loadEncryptionKeys",value:function(){return new S.ConfigServiceApi(ut.getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest)}},{key:"loadBuckets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new S.ConfigServiceApi(ut.getRestClient()),r=new S.RestListStorageBucketsRequest;return r.DataSource=e,t&&(r.BucketsRegexp=t),n.listStorageBuckets(r)}},{key:"createBucket",value:function(e,t){var n=new S.ConfigServiceApi(ut.getRestClient()),r=new S.RestCreateStorageBucketRequest;return r.DataSource=e,n.createStorageBucket(t,r)}}],n&&at(t.prototype,n),r&&at(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(ct);function pt(e){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==pt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===pt(o)?o:String(o)),r)}var o}function yt(e,t){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yt(e,t)}function mt(e){return mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mt(e)}var ht=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yt(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mt(o);if(i){var n=mt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=a.call(this,e);var n=e.node.getValue(),r=!1;return n||(n='// Compute the Path variable that this node must resolve to. \n// Use Ctrl+Space to see the objects available for completion.\nPath = "";',r=!0),t.state={value:n,cleanOnDelete:"rename-uuid"===e.node.getOnDelete(),dirty:r},t}return n=l,(r=[{key:"onChange",value:function(e,t){this.setState({value:t,dirty:!0})}},{key:"save",value:function(){var e=this,t=this.props,n=t.node,r=t.onSave,o=void 0===r?function(){}:r,i=this.state,a=i.value,l=i.cleanOnDelete;n.setValue(a),l?n.setOnDelete("rename-uuid"):n.setOnDelete(""),n.save((function(){e.setState({dirty:!1},o)}))}},{key:"remove",value:function(){var e=this;this.props.node.remove((function(){e.props.reloadList()}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.pydio,o=n.dataSources,i=n.readonly,a=n.oneLiner,l=n.onClose,s=void 0===l?function(){}:l,c=this.state,d=c.value,p=c.dirty,f=c.cleanOnDelete,y=function(e){return r.MessageHash["ajxp_admin.virtual."+e]||e},m={};o&&o.map((function(e){m[e.Name]=e.Name}));var h={Path:"",DataSources:m,User:{Name:"",Uuid:"",GroupPath:"",GroupFlat:"",Profile:"",DisplayName:"",Email:"",AuthSource:"",Roles:[]}},g=t().createElement(AdminComponents.CodeMirrorField,{mode:"javascript",globalScope:h,value:d,onChange:this.onChange.bind(this),readOnly:i}),b=y("card.cleanOnDelete"),v=d&&d.indexOf("User.Name")>=0;return v?f||(b=t().createElement("span",null,b," ",t().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-on"))):b=t().createElement("span",null,b," ",t().createElement("span",{className:"mdi mdi-alert"})," ",y("card.cleanOnDelete-legend-off")),a?t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1,lineHeight:"40px"}},g),t().createElement("div",{style:{display:"flex"}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-content-save",onClick:this.save.bind(this),disabled:!p,tooltip:"Save"}),t().createElement(u.IconButton,{iconClassName:"mdi mdi-close",onClick:function(){return s()},tooltip:"Close"}))):t().createElement("div",{style:{backgroundColor:"#f5f5f5",paddingBottom:12}},t().createElement("div",{style:{padding:i?"16px 24px 8px":"10px 24px 0",fontWeight:500,display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1}},y("card.title")),!i&&t().createElement(u.FlatButton,{onClick:this.save.bind(this),primary:!0,disabled:!p,label:y("save")})),t().createElement("div",{style:{margin:"6px 24px 0 24px",border:"1px solid #e0e0e0"}},g),t().createElement("div",{style:{margin:"12px 24px",opacity:v?1:.4}},t().createElement(u.Checkbox,{disabled:i,checked:f,onCheck:function(t,n){e.setState({cleanOnDelete:n,dirty:!0})},label:b})))}}])&&ft(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function bt(){return bt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bt.apply(this,arguments)}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==gt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===gt(o)?o:String(o)),r)}var o}function wt(e,t){return wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wt(e,t)}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}var Ot=c().requireLib("hoc").ModernTextField,kt=c().requireLib("components").MaterialTable,Ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wt(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Et(o);if(i){var n=Et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={nodesLoaded:!1,nodes:[],dataSourcesLoaded:!1,dataSources:[]},ot.loadNodes((function(e){t.setState({nodes:e,nodesLoaded:!0})})),dt.loadDatasources().then((function(e){t.setState({dataSources:e.DataSources,dataSourcesLoaded:!0})})),t}return n=l,(r=[{key:"reload",value:function(){var e=this;this.setState({nodesLoaded:!1}),ot.loadNodes((function(t){e.setState({nodes:t,nodesLoaded:!0})}))}},{key:"createNode",value:function(){this.handleRequestClose();var e,t=this.state,n=t.newName,r=t.nodes,o=new ot;o.setName(n),this.setState({nodes:[].concat((e=r,function(e){if(Array.isArray(e))return vt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[o]),selectedNode:n,newName:null})}},{key:"handleTouchTap",value:function(e){var t=this;e.preventDefault(),this.setState({newName:"",open:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newNode&&t.refs.newNode.focus()}),300)}))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this,n=this.props,r=n.readonly,o=n.pydio,i=n.muiTheme,a=n.accessByName,l=this.state,s=l.nodes,c=l.dataSources,d=l.nodesLoaded,p=l.dataSourcesLoaded,f=l.selectedNode,y=function(e){return o.MessageHash["ajxp_admin.virtual."+e]||e},m=AdminComponents.AdminStyles(i.palette),h=s.map((function(n){return n.getName()===f?{node:n,expandedRow:t().createElement(ht,{pydio:o,dataSources:c,node:n,reloadList:e.reload.bind(e),readonly:r||!a("Create"),adminStyles:m,onSave:e.reload.bind(e)})}:{node:n}})),g=[];!r&&a("Create")&&g.push(t().createElement(u.FlatButton,bt({primary:!0,label:y("create"),onClick:this.handleTouchTap.bind(this)},m.props.header.flatButton)));var b=[{name:"id",label:y("col.id"),style:{width:"25%",fontSize:15},headerStyle:{width:"25%"},renderCell:function(e){return e.node.getName()},sorter:{type:"string"}},{name:"code",label:y("col.code"),renderCell:function(e){return t().createElement("pre",null,e.node.getValue().split("\n").pop())}}],v=[];return r?v.push({iconClassName:"mdi mdi-eye",tooltip:y("code.display"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}):(v.push({iconClassName:"mdi mdi-pencil",tooltip:y("code.edit"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}),v.push({iconClassName:"mdi mdi-delete",tooltip:y("delete"),onClick:function(t){o.UI.openConfirmDialog({message:y("delete.confirm"),destructive:[t.node.getName()],validCallback:function(){t.node.remove((function(){e.reload()}))}})},disable:function(e){return"cells"===e.node.getName()||"my-files"===e.node.getName()}})),t().createElement("div",{className:"vertical-layout workspaces-list layout-fill",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:y("title"),icon:"mdi mdi-help-network",actions:g,reloadAction:this.reload.bind(this),loading:!(d&&p)}),t().createElement(u.Popover,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{margin:"0 10px"}},t().createElement(Ot,{ref:"newNode",floatingLabelText:y("label"),value:this.state.newName,onChange:function(t,n){e.setState({newName:n})},hintText:y("label.new")})),t().createElement(u.Divider,null),t().createElement("div",{style:{textAlign:"right",padding:"4px 10px"}},t().createElement(u.FlatButton,{label:o.MessageHash[54],onClick:this.handleRequestClose.bind(this)}),t().createElement(u.RaisedButton,{primary:!0,label:y("create.button"),onClick:this.createNode.bind(this)}))),t().createElement("div",{className:"layout-fill",style:{overflowY:"auto"}},t().createElement("div",{style:{padding:20,paddingBottom:0}},y("legend.1")),d&&p&&t().createElement(u.Paper,bt({},m.body.block.props,{style:m.body.block.container}),t().createElement(kt,{columns:b,data:h,actions:v,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:m.body.tableMaster,storageKey:"console.templatepaths.list"})),(!d||!p)&&t().createElement("div",{style:{margin:16,textAlign:"center",padding:20}},o.MessageHash["ajxp_admin.loading"]),!r&&a("Create")&&t().createElement("div",{style:{padding:"0 24px",opacity:".5"}},y("legend.2"))))}}])&&St(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Pt(e){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pt(e)}function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach((function(t){Tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Tt(e,t,n){return(t=Lt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rt(e){return function(e){if(Array.isArray(e))return Nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function At(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Lt(r.key),r)}}function Mt(e,t,n){return t&&Dt(e.prototype,t),n&&Dt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lt(e){var t=function(e,t){if("object"!==Pt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Pt(t)?t:String(t)}function It(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_t(e,t)}function _t(e,t){return _t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_t(e,t)}function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vt(e);if(t){var o=Vt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ft(e)}(this,n)}}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vt(e){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vt(e)}Ct=(0,f.muiThemeable)()(Ct);var Kt=c().requireLib("hoc"),Wt=Kt.ModernTextField,Ut=Kt.ModernSelectField,qt=Kt.ModernAutoComplete,Ht=function(e){It(r,e);var n=Bt(r);function r(e){var t;return At(this,r),(t=n.call(this,e)).debounced=j()(t.loadValues.bind(Ft(t)),300),t.state={searchText:e.value,value:e.value},t}return Mt(r,[{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({searchText:e})}},{key:"handleNewRequest",value:function(e){var t,n=this.state.nodes,r=!1;if(void 0===e.key){t="/"+g().trim(e,"/");var o=!1;n.map((function(e){e.Path!==t&&0!==e.Path.indexOf(t+"/")||(o=!0)})),o&&(r=!0)}else t=e.key,r=!0;this.setState({value:t,exist:r}),this.props.onChange(t,r),this.loadValues(t)}},{key:"componentWillMount",value:function(){this.lastSearch=null;var e="";this.props.value&&(e=this.props.value),this.loadValues(e)}},{key:"componentWillReceiveProps",value:function(e){e.value&&e.value!==this.state.value&&this.setState({value:e.value,exist:!0})}},{key:"loadValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props.peerAddress,r=this.state.searchText,o=t;if(!t&&r){var i=r.lastIndexOf("/");o=r.substr(0,i)}if(null!==this.lastSearch&&this.lastSearch===o)return Promise.resolve();this.lastSearch=o;var a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestListPeerFoldersRequest;return l.PeerAddress="ANY"===n?"":n,l.Path=o,this.setState({loading:!0}),a.listPeerFolders(n,l).then((function(t){var n=t.Children||[];n=n.map((function(e){return"/"!==e.Path[0]&&(e.Path="/"+e.Path),e})),e.setState({nodes:n,loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"createFolder",value:function(e){var t=this,n=this.props,r=n.peerAddress,o=n.pydio,i=this.state.value,a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestCreatePeerFolderRequest;l.PeerAddress="ANY"===r?"":r,l.Path=i+"/"+e,a.createPeerFolder(r,l).then((function(e){t.lastSearch=null,t.loadValues(i).then((function(){t.handleNewRequest({key:l.Path}),t.setState({searchText:l.Path})}))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}},{key:"renderNode",value:function(e){var n=T().getBasename(e.Path),r=T().getDirname(e.Path),o=t().createElement("span",null,e.Path);return g().computeStringSlug(n)!==n?o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#c62828"}},n)):e.MetaStore&&e.MetaStore.symlink&&(o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#1976d2"}},n))),{key:e.Path,text:e.Path,invalid:!1,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:"mdi mdi-folder",color:"#616161",style:{float:"left",marginRight:8}})," ",o)}}},{key:"showCreateDialog",value:function(){var e=this,t=this.props.pydio,n=this.state.value,r=function(e){return t.MessageHash["ajxp_admin.ds.editor.selector."+e]||e};t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:r("mkdir"),legendId:r("mkdir.legend").replace("%s",n),fieldLabelId:r("mkdir.field"),submitValue:function(t){t&&e.createFolder(t)}})}},{key:"render",value:function(){var e=this,n=this.state,r=n.nodes,o=n.loading,i=n.exist,a=n.value,l=n.searchText,s=this.props,c=s.fieldLabel,d=s.pydio,p=[];r&&r.forEach((function(t){p.push(e.renderNode(t))}));var f=l||a;return t().createElement("div",{style:{position:"relative",marginTop:-5}},t().createElement("div",{style:{position:"absolute",right:6,top:29,width:30,zIndex:1}},t().createElement(u.RefreshIndicator,{size:25,left:0,top:0,status:o?"loading":"hide"})),a&&i&&!o&&(!l||l===a)&&t().createElement("div",{style:{position:"absolute",right:0,zIndex:1,top:18}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-folder-plus",iconStyle:{color:"#9e9e9e"},onClick:function(){return e.showCreateDialog()},tooltip:d.MessageHash["ajxp_admin.ds.editor.selector.mkdir"],tooltipPosition:"top-center"})),t().createElement(qt,{fullWidth:!0,searchText:f,onUpdateInput:this.handleUpdateInput.bind(this),onNewRequest:this.handleNewRequest.bind(this),dataSource:p,hintText:c,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,menuProps:{maxHeight:200}}))}}]),r}(t().Component),Jt=function(e){It(r,e);var n=Bt(r);function r(e){var t;return At(this,r),(t=n.call(this,e)).state={peerAddresses:[],invalid:!1,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.editor."+t]||t}},t}return Mt(r,[{key:"compareAddresses",value:function(e,t){var n=e.split("|"),r=t.split("|");return r.filter((function(e){return n.indexOf(e)>-1})).length||n.filter((function(e){return r.indexOf(e)>-1})).length}},{key:"componentDidMount",value:function(){var e=this,t=this.props.model;new S.ConfigServiceApi(m().getRestClient()).listPeersAddresses().then((function(n){var r=n.PeerAddresses||[];if(1!==r||t.PeerAddress||(t.PeerAddress=r[0]),e.setState({peerAddresses:r}),t.PeerAddress&&-1===r.indexOf(t.PeerAddress)){var o=r.filter((function(n){return e.compareAddresses(n,t.PeerAddress)}));o.length?t.PeerAddress=o[0]:e.setState({invalidAddress:t.PeerAddress})}}))}},{key:"baseIsInvalid",value:function(e){var t=this.state.m,n=!1,r=T().getBasename(e);return g().trim(e,"/").split("/").length<2?n=t("selector.error.depth"):g().computeStringSlug(r)!==r&&(n=t("selector.error.dnsname")),n}},{key:"onPathChange",value:function(e,t){var n=this.props.model,r=this.baseIsInvalid(e);n.invalid=r,n.StorageConfiguration.folder=e,t?void 0!==n.StorageConfiguration.create&&delete n.StorageConfiguration.create:n.StorageConfiguration.create="true",this.setState({invalid:r})}},{key:"onPeerChange",value:function(e){var t=this.props.model,n=this.state.invalidAddress;e!==n&&(t.PeerAddress=e,n&&this.setState({invalidAddress:null}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.model,o=n.pydio,i=n.styles,a=this.state,l=a.peerAddresses,s=a.invalidAddress,c=a.invalid,d=a.m,p=Rt(l);return p=["ANY"].concat(Rt(p)),s&&"ANY"!==s&&(p=[s].concat(Rt(p))),t().createElement("div",null,t().createElement("div",{style:{paddingBottom:8}},t().createElement("div",{style:i.subLegend},d("storage.legend.fs.peer")),t().createElement(Ut,{value:r.PeerAddress||"",variant:"v2",hintText:d("selector.peer")+" *",onChange:function(t,n,r){return e.onPeerChange(r)},fullWidth:!0},p.map((function(e){var n=d("selector.peer.any");return"ANY"!==e&&(n=d("selector.peer.word")+" : "+e.replace("|"," | ")+(e===s?" ("+d("selector.peer.invalid")+")":"")),t().createElement(u.MenuItem,{value:e,primaryText:n})})))),t().createElement("div",null,t().createElement("div",{style:xt(xt({},i.subLegend),{},{paddingBottom:6})},d("storage.legend.fs.path")),r.PeerAddress&&t().createElement(Ht,{pydio:o,value:r.StorageConfiguration.folder,peerAddress:r.PeerAddress,onChange:this.onPathChange.bind(this),fieldLabel:d("selector.completer")+(r.StorageConfiguration.create?" ("+d("selector.completer.create")+")":"")+" *",hintText:d("selector.completer.hint")}),!r.PeerAddress&&t().createElement(Wt,{style:{marginTop:-3},fullWidth:!0,variant:"v2",disabled:!0,value:r.StorageConfiguration.folder,floatingLabelText:d("selector.folder")+" *",hintText:d("selector.folder.hint")})),c&&t().createElement("div",{style:{color:"#c62828"}},c))}}]),r}(t().Component);const zt=require("pydio/util/dom");var Yt=n.n(zt);function Gt(e){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gt(e)}function Qt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Gt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Gt(o)?o:String(o)),r)}var o}function Xt(e,t,n){return t&&$t(e.prototype,t),n&&$t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&en(e,t)}function en(e,t){return en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},en(e,t)}function tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=nn(e);if(t){var o=nn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function nn(e){return nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nn(e)}var rn=function(e){Zt(r,e);var n=tn(r);function r(){return Qt(this,r),n.apply(this,arguments)}return Xt(r,[{key:"render",value:function(){var e=this.props,n=e.onSelect,r=e.selected,o=e.value,i=e.primaryText,a=e.image,l={cont:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"10px 10px 0 10px",backgroundColor:"transparent",borderBottom:"2px solid transparent",transition:Yt().getBeziersTransition()},image:{width:30,height:30,opacity:.3,transition:Yt().getBeziersTransition()},label:{margin:5,marginTop:8,fontSize:11,fontWeight:500,color:"rgba(0,0,0,.3)",textAlign:"center",transition:Yt().getBeziersTransition()}};return r&&(l.cont.borderBottom="2px solid #0e4d6d",l.image.opacity=1,l.label.color="#0e4d6d"),t().createElement("div",{zDepth:0,style:l.cont,onClick:function(e){n(o)},rounded:!1},a&&t().createElement("img",{style:l.image,src:"/plug/access.settings/res/images/"+a}),t().createElement("div",{style:l.label},i))}}]),r}(t().Component),on=function(e){Zt(r,e);var n=tn(r);function r(e){return Qt(this,r),n.call(this,e)}return Xt(r,[{key:"onChange",value:function(e){var t=this.props,n=t.values;(0,t.onChange)(null,Object.keys(n).indexOf(e),e)}},{key:"render",value:function(){var e=this,n=this.props,r=n.values,o=n.value,i=n.disabled;return t().createElement("div",{style:{display:"flex",padding:"0 1px",backgroundColor:"rgb(251, 251, 252)"}},Object.keys(r).map((function(n){return t().createElement(rn,{value:n,selected:n===o,onSelect:i?function(){}:e.onChange.bind(e),primaryText:r[n].primaryText,image:r[n].image})})))}}]),r}(t().Component);const an=require("lodash");function ln(e){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(e)}function sn(){return sn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sn.apply(this,arguments)}function cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ln(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ln(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===ln(o)?o:String(o)),r)}var o}function dn(e,t){return dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dn(e,t)}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}var fn=c().requireLib("hoc").ModernTextField,yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dn(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pn(o);if(i){var n=pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ln(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={buckets:[],selection:[],mode:t.modeFromValue(),monitorApi:e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret},e.dataSource.ObjectsBucket&&(t.state.selection=[e.dataSource.ObjectsBucket]),t.load(),t.loadSelection(),t.reloadSelection=(0,an.debounce)((function(){t.loadSelection()}),500),t.loadDebounced=(0,an.debounce)((function(){t.load()}),500),t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e){var t=e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret;t!==this.state.monitorApi&&(this.loadDebounced(),this.setState({monitorApi:t}))}},{key:"load",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?(this.setState({loading:!0}),dt.loadBuckets(t).then((function(t){var n=t.Children||[];e.setState({buckets:n.map((function(e){return e.Path})),loading:!1})})).catch((function(t){e.setState({buckets:[],loading:!1})}))):this.setState({buckets:[]})}},{key:"createBucket",value:function(){var e=this,t=this.props.dataSource,n=this.state.createBucket;this.setState({loading:!0}),dt.createBucket(t,n).then((function(){e.setState({create:!1,createBucket:""}),e.load()})).catch((function(t){e.setState({loading:!1})}))}},{key:"loadSelection",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?t.ObjectsBucket?this.setState({selection:[t.ObjectsBucket]}):(this.setState({selection:[]}),t.StorageConfiguration.bucketsRegexp&&dt.loadBuckets(t,t.StorageConfiguration.bucketsRegexp).then((function(t){var n=t.Children||[];e.setState({selection:n.map((function(e){return e.Path}))})}))):this.setState({selection:[]})}},{key:"modeFromValue",value:function(){var e="picker";return this.props.dataSource.StorageConfiguration.bucketsRegexp&&(e="regexp"),e}},{key:"toggleMode",value:function(){var e=this.state.mode,t=this.props.dataSource;"picker"===e?(t.ObjectsBucket&&(t.StorageConfiguration.bucketsRegexp=t.ObjectsBucket,t.ObjectsBucket="",this.reloadSelection()),this.setState({mode:"regexp"})):(t.StorageConfiguration.bucketsRegexp="",this.reloadSelection(),this.setState({mode:"picker"}))}},{key:"togglePicker",value:function(e){var t,n=this.props.dataSource,r=this.state.selection,o=[],i=r.indexOf(e);1===(o=-1===i?[].concat((t=r,function(e){if(Array.isArray(e))return cn(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return cn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cn(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[e]):g().arrayWithout(r,i)).length?(n.ObjectsBucket=o[0],n.StorageConfiguration.bucketsRegexp=""):(n.ObjectsBucket="",n.StorageConfiguration.bucketsRegexp=o.map((function(e){return"^"+e+"$"})).join("|")),this.setState({selection:o})}},{key:"updateRegexp",value:function(e){this.props.dataSource.StorageConfiguration.bucketsRegexp=e,this.reloadSelection()}},{key:"render",value:function(){var e=this,n=this.props.dataSource,r=this.state,o=r.buckets,i=r.selection,a=r.mode,l=r.loading,s=r.create,d=r.createBucket,p=void 0===d?"":d,f=c().getInstance().MessageHash,y=function(e){return f["ajxp_admin.ds.editor.storage."+e]||e},m={style:{width:30,height:30,padding:5},iconStyle:{width:20,height:20,color:"rgba(0,0,0,.5)",fontSize:18}},h=!n.ApiKey||!n.ApiSecret;return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginTop:20}},t().createElement("div",null,y("buckets.legend")),t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginRight:s?30:0}},s&&t().createElement("div",{style:{width:200,height:36}},t().createElement(fn,{hintText:y("buckets.create.hint"),fullWidth:!0,value:p,onChange:function(t,n){e.setState({createBucket:g().computeStringSlug(n)})}})),t().createElement(u.IconButton,sn({iconClassName:s?"mdi mdi-check":"mdi mdi-plus-circle",tooltip:y("buckets.create"),tooltipPosition:"top-left",onClick:function(){s?e.createBucket():e.setState({create:!0})},disabled:h},m)),s&&t().createElement(u.IconButton,sn({iconClassName:"mdi mdi-close",tooltip:f[54],tooltipPosition:"top-left",onClick:function(){return e.setState({create:!1,createBucket:""})},disabled:h},m))),t().createElement("div",{style:{display:"flex",alignItems:"flex-end"}},"regexp"===a&&t().createElement("div",{style:{width:200,height:36}},t().createElement(fn,{hintText:y("buckets.regexp.hint"),fullWidth:!0,value:n.StorageConfiguration.bucketsRegexp||"",onChange:function(t,n){e.updateRegexp(n)}})),t().createElement(u.IconButton,sn({iconClassName:"mdi mdi-filter",tooltip:"picker"===a?y("buckets.regexp"):"",tooltipPosition:"top-left",onClick:function(){e.toggleMode()},disabled:h},m))),t().createElement(u.IconButton,sn({iconClassName:"mdi mdi-reload",tooltip:y("buckets.reload"),tooltipPosition:"top-left",onClick:function(){e.load()},disabled:h},m))),t().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginTop:8,backgroundColor:"rgb(246 246 248)",borderRadius:"4px 4px 0 0",borderBottom:"1px solid #e0e0e0",minHeight:52,padding:2,maxHeight:275,overflowY:"auto"}},o.map((function(r){var o=-1!==i.indexOf(r),l={};return"picker"===a?l.onClick=function(){e.togglePicker(r)}:n.StorageConfiguration.bucketsRegexp||(l.onClick=function(){e.toggleMode(),e.togglePicker(r)}),t().createElement("div",{style:{margin:5}},t().createElement(u.Chip,sn({},l,{backgroundColor:o?"#03a9f4":null}),r))})),0===o.length&&t().createElement("div",{style:{paddingLeft:5,textAlign:"center",fontSize:12,color:"rgba(0,0,0,.3)"}},y(h?"buckets.cont.nokeys":l?"buckets.cont.loading":"buckets.cont.empty"))))}}])&&un(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function mn(e){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(e)}function hn(){return hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hn.apply(this,arguments)}function gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(n),!0).forEach((function(t){vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vn(e,t,n){return(t=wn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,wn(r.key),r)}}function wn(e){var t=function(e,t){if("object"!==mn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==mn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===mn(t)?t:String(t)}function En(e,t){return En=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},En(e,t)}function On(e){return On=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},On(e)}var kn=AdminComponents,Cn=kn.PaperEditorLayout,Pn=kn.AdminStyles,jn=c().requireLib("hoc"),xn=jn.ModernTextField,Tn=jn.ModernSelectField,Rn=jn.ThemedModernStyles,Nn=["main","storage","data","advanced"],An=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&En(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=On(i);if(a){var n=On(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===mn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.pydio,r=e.create,o=e.dataSource,i=e.existingNames,a=e.createStructure,c=new dt(o,i,a),u=c.getModel().StorageConfiguration||{},d=u.customEndpoint?"custom":"aws";return"custom"===d&&u.minioServer&&(d="minio"),t.state={dirty:!1,create:r,observable:c,model:c.getModel(),loaded:!1,valid:c.isValid(),encryptionKeys:[],versioningPolicies:[],s3Custom:d,m:function(e){return n.MessageHash["ajxp_admin.ds.editor."+e]||e}},dt.loadEncryptionKeys().then((function(e){t.setState({encryptionKeys:e.Keys||[]})})),dt.loadVersioningPolicies().then((function(e){t.setState({versioningPolicies:e.Policies||[]})})),t}return r=s,o=[{key:"componentWillReceiveProps",value:function(e){if(e.dataSource&&this.state.model.Name!==e.dataSource.Name)if(this.state.dirty)alert(this.props.pydio.MessageHash["role_editor.19"]);else{var t=new dt(e.dataSource);this.setState({observable:t,model:t.getModel()})}e.create&&this.state.create!==e.create&&this.setState({create:e.create})}},{key:"componentDidMount",value:function(){var e=this;this.state.observable.observe("update",(function(){e.setState({dirty:!0}),e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.observable.stopObserving("update")}},{key:"resetForm",value:function(){var e=this,t=this.state.observable.revert();this.setState({valid:!0,dirty:!1,model:t},(function(){e.forceUpdate()}))}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.observable;this.props.pydio.UI.openConfirmDialog({message:n("delete.warning"),validCallback:function(){r.deleteSource().then((function(){e.props.closeEditor(),e.props.reloadList()}))},destructive:[r.getModel().Name]})}},{key:"saveSource",value:function(){var e=this,t=this.state,n=t.observable,r=t.create;this.state.observable.saveSource().then((function(){var t=null;r&&(t=n.getModel().Name),e.setState({valid:!0,dirty:!1,create:!1}),r&&e.props.closeEditor(),e.props.reloadList(t)}))}},{key:"launchResync",value:function(){this.state.observable.resyncSource()}},{key:"toggleEncryption",value:function(e){var t=this.state.model;"VALUE_CREATE"===e?this.setState({showDialog:"enableEncryptionWithCreate",dialogTargetValue:e,newKeyName:t.Name||""}):"VALUE_CLEAR"===e?this.setState({showDialog:"disableEncryption",dialogTargetValue:e}):"MASTER"!==t.EncryptionMode?this.setState({showDialog:"enableEncryption",dialogTargetValue:e}):t.EncryptionKey=e}},{key:"confirmEncryption",value:function(e){var t=this,n=this.state,r=n.model,o=n.newKeyName;if("VALUE_CREATE"===e){var i=new S.ConfigServiceApi(m().getRestClient()),a=new S.EncryptionAdminCreateKeyRequest;return a.KeyID=o,a.Label=o,void i.createEncryptionKey(a).then((function(e){r.EncryptionMode="MASTER",r.EncryptionKey=o,t.setState({showDialog:!1,dialogTargetValue:null,encryptionKeys:[{ID:o,Label:o}]})})).catch((function(){}))}"VALUE_CLEAR"===e?(r.EncryptionMode="CLEAR",r.EncryptionKey=""):(r.EncryptionMode="MASTER",r.EncryptionKey=e),this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"toggleS3Custom",value:function(e){var t=this.state.model;"aws"===e?(t.StorageConfiguration.customEndpoint="",t.StorageConfiguration.customRegion="",t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion=""):"minio"===e?(t.StorageConfiguration.minioServer="true",t.StorageConfiguration.signatureVersion="v4"):(t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion="v4"),this.setState({s3Custom:e})}},{key:"stepperBack",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Nn.indexOf(t);n>0&&this.setState({currentPane:Nn[n-1]})}},{key:"stepperNext",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Nn.indexOf(t);n<Nn.length-1&&this.setState({currentPane:Nn[n+1]})}},{key:"render",value:function(){var n=this,r=this.props,o=r.storageTypes,i=r.pydio,a=r.readonly,l=r.muiTheme,s=this.state,c=s.currentPane,d=void 0===c?"main":c,p=s.model,f=s.create,y=s.observable,m=s.encryptionKeys,h=s.versioningPolicies,g=s.showDialog,b=s.dialogTargetValue,v=s.newKeyName,S=s.s3Custom,w=s.m,E=Rn(l),O=[];a||f||(O.push(t().createElement(u.Toggle,{style:{borderRight:"1px solid #e0e0e0",paddingRight:14,zoom:.8},labelStyle:{fontSize:17},toggled:!p.Disabled,onToggle:function(e,t){p.Disabled=!t},labelPosition:"right",label:w("options.enabled")})),O.push(Cn.actionButton(this.context.getMessage("plugins.6"),"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty)),O.push(Cn.actionButton(this.context.getMessage("plugins.5"),"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.dirty)));var k=p.Name?w("title").replace("%s",p.Name):w("new"),C=p.StorageConfiguration,P=Pn(this.props.muiTheme.palette),j={title:bn(bn({},P.body.block.headerFull),{},{margin:"0 -20px"}),legend:{},subLegend:{padding:"10px 6px 0 4px",fontSize:12,lineHeight:"16px",color:"rgba(0,0,0,0.6)",textAlign:"justify"},section:bn({padding:"0 20px 20px",margin:10,backgroundColor:"white"},P.body.block.container),storageSection:{padding:20,marginTop:-1}},x={LOCAL:{primaryText:this.context.getMessage("ds.storage.fs","ajxp_admin"),image:"fs.png"},S3:{primaryText:this.context.getMessage("ds.storage.s3","ajxp_admin"),image:"s3-compat.png"},AZURE:{primaryText:this.context.getMessage("ds.storage.azure","ajxp_admin"),image:"azure.png"},GCS:{primaryText:this.context.getMessage("ds.storage.gcs","ajxp_admin"),image:"gcs.png"}},T={};o.forEach((function(e){T[e]=x[e]})),p.StorageType&&!T[p.StorageType]&&(T[p.StorageType]=x[p.StorageType]);var R,N,A=function(e,t){return t===d?e:bn(bn({},e),{},{display:"none"})};if(f){var D={display:"flex",alignItems:"center",padding:"0 20px 0 8px",position:"absolute",height:64,zIndex:10,top:64,left:0,right:0,backgroundColor:"rgb(246 246 248)",boxShadow:"rgba(0, 0, 0, .1) 0px 1px 2px"},M=0===Nn.indexOf(d),L=Nn.indexOf(d)===Nn.length-1;("main"!==d||p.Name&&!y.getNameError(w))&&("storage"!==d||y.isValid())||(L=!0),R=t().createElement("div",{style:D},t().createElement("div",{style:{flex:1}},t().createElement(u.Stepper,{activeStep:Nn.indexOf(d)},t().createElement(u.Step,null,t().createElement(u.StepLabel,null,w("tab.identifier"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,w("tab.storage"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,w("tab.lifecycle"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,w("tab.advanced")))))),N=t().createElement("div",{style:bn(bn({},D),{},{top:null,bottom:0,backgroundColor:"white",boxShadow:"rgba(0, 0, 0, .1) 0px -1px 2px"})},t().createElement("span",{style:{flex:1}}),t().createElement(u.FlatButton,{primary:!0,label:w("tab.button-back"),onClick:function(){return n.stepperBack()},disabled:M}),t().createElement(u.FlatButton,{primary:!0,label:w("tab.button-next"),onClick:function(){return n.stepperNext()},disabled:L}),t().createElement("div",{style:{width:1,height:40,backgroundColor:"#efefef",margin:"0 5px"}}),t().createElement(u.FlatButton,{primary:!0,label:w("tab.button-create"),onClick:function(){return n.saveSource()},disabled:!y.isValid()}))}var I=t().createElement(u.Dialog,{open:g,title:w("enc.warning"),onRequestClose:function(){n.setState({showDialog:!1,dialogTargetValue:null})},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.setState({showDialog:!1,dialogTargetValue:null})}}),t().createElement(u.FlatButton,{label:w("enc.validate"),disabled:"enableEncryptionWithCreate"===g&&!v,onClick:function(){n.confirmEncryption(b)}})]},("enableEncryption"===g||"enableEncryptionWithCreate"===g)&&t().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.enable.1"),"",w("enc.dialog.enable.2")," ",t().createElement("b",{style:{fontWeight:500}},w("enc.dialog.enable.2bold")),t().createElement("br",null),w("enc.dialog.enable.3"),"enableEncryptionWithCreate"===g&&t().createElement("div",null,t().createElement(xn,{hintText:w("enc.dialog.enable.create"),fullWidth:!0,variant:"v2",value:v,onChange:function(e,t){n.setState({newKeyName:t})}}))),"disableEncryption"===g&&t().createElement("div",{style:{lineHeight:"1.6em"}},w("enc.dialog.disable"))),_=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"main")},t().createElement("div",{style:bn(bn({},j.title),{},{marginBottom:16})},w("options")),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("options.id")+" *",disabled:!f,value:p.Name,onChange:function(e,t){p.Name=t},errorText:y.getNameError(w)})),B=t().createElement(u.Paper,{zDepth:0,style:A(bn(bn({},j.section),{},{padding:0,marginBottom:f?200:null}),f?"storage":"main")},t().createElement(on,{disabled:!f,value:p.StorageType,onChange:function(e,t,n){p.StorageType=n},values:T}),"LOCAL"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.fs")),t().createElement(Jt,{model:p,pydio:this.props.pydio,styles:j}),!p.FlatStorage&&t().createElement("div",null,t().createElement(u.Checkbox,hn({labelPosition:"right",label:w("storage.fs.macos"),checked:"true"===C.normalize,onCheck:function(e,t){C.normalize=t?"true":"false"}},E.toggleFieldV2)))),"S3"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.s3")),t().createElement(Tn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint.type"),value:S,onChange:function(e,t,r){n.toggleS3Custom(r)}},t().createElement(u.MenuItem,{value:"aws",primaryText:w("storage.s3.endpoint.amazon")}),t().createElement(u.MenuItem,{value:"minio",primaryText:w("storage.s3.endpoint.minio")}),t().createElement(u.MenuItem,{value:"custom",primaryText:w("storage.s3.endpoint.custom")})),("custom"===S||"minio"===S)&&t().createElement("div",null,t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.endpoint")+" - "+w("storage.s3.endpoint.hint"),value:p.StorageConfiguration.customEndpoint,onChange:function(e,t){p.StorageConfiguration.customEndpoint=t}}),t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:3,marginRight:5}},t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.region"),value:p.StorageConfiguration.customRegion,onChange:function(e,t){p.StorageConfiguration.customRegion=t}})),t().createElement("div",{style:{flex:1}},t().createElement(Tn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.signatureVersion"),value:p.StorageConfiguration.signatureVersion,onChange:function(e,t,n){p.StorageConfiguration.signatureVersion=n}},t().createElement(u.MenuItem,{value:"v4",primaryText:"v4"}),t().createElement(u.MenuItem,{value:"v2",primaryText:"v2"}))))),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement("form",{autoComplete:"off"},t().createElement("input",{type:"hidden",value:"something"}),t().createElement(xn,{autoComplete:"off",fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.s3.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),t().createElement(yn,{dataSource:p,hintText:w("storage.s3.bucket")}),p.ObjectsBucket&&t().createElement("div",{style:{paddingTop:20}},t().createElement("div",{style:bn({},j.subLegend)},w("storage.s3.legend.bucketPathPrefix")),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.bucketPathPrefix"),value:p.ObjectsBaseFolder||"",onChange:function(e,t){p.ObjectsBaseFolder=t}})),(p.ObjectsBucket||p.StorageConfiguration.bucketsRegexp)&&t().createElement(t().Fragment,null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.storageClass")),t().createElement("div",null,t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.storageClass"),value:p.StorageConfiguration.storageClass||"",onChange:function(e,t){p.StorageConfiguration.storageClass=t}}))),p.StorageConfiguration.bucketsRegexp&&!p.ObjectsBucket&&t().createElement(t().Fragment,null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.s3.legend.tags")),t().createElement("div",null,t().createElement(xn,{fullWidth:!0,variant:"v2",disabled:!!p.ObjectsBucket,hintText:w("storage.s3.bucketsTags"),value:p.StorageConfiguration.bucketsTags||"",onChange:function(e,t){p.StorageConfiguration.bucketsTags=t}})))),"AZURE"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.azure")),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.azure.api")+" *",value:p.ApiKey,onChange:function(e,t){p.ApiKey=t}}),t().createElement(xn,{fullWidth:!0,variant:"v2",type:"password",hintText:w("storage.azure.secret")+" *",value:p.ApiSecret,onChange:function(e,t){p.ApiSecret=t}})),"GCS"===p.StorageType&&t().createElement("div",{style:j.storageSection},t().createElement("div",{style:j.legend},w("storage.legend.gcs")),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.bucket")+" *",value:p.ObjectsBucket,onChange:function(e,t){p.ObjectsBucket=t}}),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.gcs.credentials")+" *",value:p.StorageConfiguration.jsonCredentials,onChange:function(e,t){p.StorageConfiguration.jsonCredentials=t},multiLine:!0}),t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("storage.s3.path"),value:p.ObjectsBaseFolder,onChange:function(e,t){p.ObjectsBaseFolder=t}}))),F=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"data")},t().createElement("div",{style:j.title},w("datamanagement")),!p.StorageConfiguration.cellsInternal&&t().createElement(e.Fragment,null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.versioning")),t().createElement(Tn,{fullWidth:!0,variant:"v2",hintText:w("versioning"),value:p.VersioningPolicyName,onChange:function(e,t,n){p.VersioningPolicyName=n}},t().createElement(u.MenuItem,{value:void 0,primaryText:w("versioning.disabled")}),h.map((function(e){return t().createElement(u.MenuItem,{value:e.Uuid,primaryText:e.Name+" (stored in "+e.VersionsDataSourceName+")"})})))),t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.encryption")),t().createElement(Tn,{fullWidth:!0,variant:"v2",hintText:w("enc.key"),value:"MASTER"===p.EncryptionMode?p.EncryptionKey:"VALUE_CLEAR",onChange:function(e,t,r){n.toggleEncryption(r)}},t().createElement(u.MenuItem,{value:"VALUE_CLEAR",primaryText:w("enc.key.clear")}),m.map((function(e){return t().createElement(u.MenuItem,{value:e.ID,primaryText:e.Label})})),"MASTER"!==p.EncryptionMode&&0===m.length&&t().createElement(u.MenuItem,{value:"VALUE_CREATE",primaryText:w("enc.key.create")}))),V=t().createElement(u.Paper,{zDepth:0,style:A(j.section,"advanced")},t().createElement("div",{style:j.title},w("tab.advanced")),!p.StorageConfiguration.cellsInternal&&t().createElement("div",null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.flatStorage")),t().createElement(u.Checkbox,hn({label:w("storage.flatStorage"),labelPosition:"right",disabled:!f,checked:!p.FlatStorage,onCheck:function(e,t){p.FlatStorage=!t}},E.toggleFieldV2)),f&&p.FlatStorage&&t().createElement(xn,{fullWidth:!0,variant:"v2",hintText:w("initFlatFromSnapshot"),value:p.StorageConfiguration.initFromSnapshot||"",onChange:function(e,t){t?p.StorageConfiguration.initFromSnapshot=t:delete p.StorageConfiguration.initFromSnapshot}}),p.FlatStorage&&(f||p.StorageConfiguration.foldersShardingPattern)&&t().createElement(xn,{fullWidth:!0,variant:"v2",disabled:!f,hintText:w("foldersShardingPattern"),value:p.StorageConfiguration.foldersShardingPattern||"",onChange:function(e,t){t?p.StorageConfiguration.foldersShardingPattern=t:delete p.StorageConfiguration.foldersShardingPattern}})),!p.FlatStorage&&t().createElement("div",null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.skipResync")),t().createElement(u.Checkbox,hn({label:w("storage.skipResync"),labelPosition:"right",checked:p.SkipSyncOnRestart,onCheck:function(e,t){p.SkipSyncOnRestart=t}},E.toggleFieldV2))),"LOCAL"!==p.StorageType&&t().createElement("div",null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.readOnly")),t().createElement(u.Checkbox,hn({label:w("storage.readOnly"),labelPosition:"right",checked:"true"===p.StorageConfiguration.readOnly,onCheck:function(e,t){p.StorageConfiguration.readOnly=t?"true":""}},E.toggleFieldV2))),(!p.StorageConfiguration.readOnly||"true"!==p.StorageConfiguration.readOnly)&&t().createElement("div",null,t().createElement("div",{style:bn(bn({},j.subLegend),{},{paddingTop:20})},w("storage.legend.checksumMapper")),t().createElement(u.Checkbox,hn({label:w("storage.nativeEtags"),labelPosition:"right",checked:p.StorageConfiguration.nativeEtags,onCheck:function(e,t){p.StorageConfiguration.nativeEtags=t?"true":""}},E.toggleFieldV2)),!p.StorageConfiguration.nativeEtags&&t().createElement("div",null,t().createElement(u.Checkbox,hn({label:w("storage.checksumMapper"),labelPosition:"right",checked:"dao"===p.StorageConfiguration.checksumMapper,onCheck:function(e,t){p.StorageConfiguration.checksumMapper=t?"dao":""}},E.toggleFieldV2)))));return t().createElement(Cn,{title:k,titleLeftIcon:"mdi mdi-database",titleActionBar:O,closeAction:this.props.closeEditor,leftNavItems:f?null:[{label:w("tab.main"),value:"main",icon:"mdi mdi-database-plus"},{label:w("tab.lifecycle"),value:"data",icon:"mdi mdi-recycle"},{label:w("tab.advanced"),value:"advanced",icon:"mdi mdi-settings"}],leftNavSelected:d,leftNavChange:function(e){n.setState({currentPane:e})},className:"workspace-editor",contentFill:!1,rightPanelStyle:f?{paddingTop:64}:null},R,I,B,_,F,V,N)}}],o&&Sn(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Dn(e){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dn(e)}function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Dn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Dn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Dn(o)?o:String(o)),r)}var o}function Ln(e,t){return Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ln(e,t)}function In(e){return In=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},In(e)}An.contextTypes={messages:l().object,getMessage:l().func},An=(0,f.muiThemeable)()(An);var _n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ln(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=In(o);if(i){var n=In(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),a.apply(this,arguments)}return n=l,(r=[{key:"render",value:function(){var e=this.props,n=e.policy,r=e.rendering,o=e.pydio,i=function(e){return o.MessageHash["ajxp_admin.versions.period."+e]||e},a=n.KeepPeriods,l=void 0===a?[]:a,s=n.NodeDeletedStrategy;if("short"===r){var c;if(1===l.length){var d=l[0];c=-1===d.MaxNumber?i("keep-all.always"):i("keep-n").replace("%s",d.MaxNumber)}else{c=i("retentions-n").replace("%s",l.length);var p=l[l.length-1];0===p.MaxNumber||void 0===p.MaxNumber?c+=" | "+i("remove-all-after").replace("%s",p.IntervalStart):c+=" | "+i("keep-n-after").replace("%1",p.MaxNumber).replace("%2",p.IntervalStart)}return t().createElement("span",null,c)}var f,y=l.map((function(e){var n,r=e.MaxNumber,o=t().createElement(u.FontIcon,{className:"mdi mdi-ray-start-arrow"}),a={};return void 0===e.IntervalStart||"0"===e.IntervalStart?o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-start"}):n=t().createElement("span",{style:{fontWeight:500,fontSize:16}},e.IntervalStart,""),-1===e.MaxNumber?r=i("keep-all"):e.MaxNumber?r=i("max-n").replace("%s",r):(r=i("remove-all"),o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-end",style:{color:"#c62828"}}),a={color:"#c62828"}),t().createElement(u.Step,null,t().createElement(u.StepLabel,{icon:o,style:a},n,r))})),m={color:"#c62828",fontWeight:500,fontSize:16};switch(s){case"KeepLast":f="Backup last";break;case"KeepAll":default:m.color=null,f="Backup all";break;case"KeepNone":f="Clean all"}return y.push(t().createElement(u.Step,null,t().createElement(u.StepLabel,{style:m,icon:t().createElement(u.FontIcon,{className:"mdi mdi-delete",style:m})},f))),t().createElement(u.Stepper,{activeStep:l.length-1,linear:!1},y)}}])&&Mn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Bn(e){return Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(e)}function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vn(e,t,n){return(t=Wn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wn(r.key),r)}}function Wn(e){var t=function(e,t){if("object"!==Bn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Bn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Bn(t)?t:String(t)}function Un(e,t){return Un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Un(e,t)}function qn(e){return qn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qn(e)}var Hn=c().requireLib("form"),Jn=Hn.Manager,zn=Hn.FormPanel,Yn=AdminComponents,Gn=Yn.PaperEditorLayout,Qn=Yn.AdminStyles,$n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Un(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qn(i);if(a){var n=qn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Bn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dirty:!1,policy:e.versionPolicy,loaded:!0,valid:!0,parameters:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.versions.editor."+t]||t}},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){this.state.policy!==e.versionPolicy&&this.setState({policy:e.versionPolicy})}},{key:"componentDidMount",value:function(){var e=this;m().getRestClient().callApi("/config/discovery/forms/{ServiceName}","GET",{ServiceName:"pydio.grpc.versions"},{},{},{},null,[],["application/json"],["application/json"],"String").then((function(t){var n=t.data,r=p().parseXml(n);e.setState({parameters:Jn.parseParameters(r,"//param"),loaded:!0})}))}},{key:"resetForm",value:function(){this.setState({valid:!0,dirty:!1,saveValue:null})}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.policy;this.props.pydio.UI.openConfirmDialog({message:n("delete.confirm"),destructive:[r.Label],validCallback:function(){Y().loadClass("EnterpriseSDK").then((function(t){new t.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(r.Uuid).then((function(t){e.props.closeEditor()}))}))}})}},{key:"saveSource",value:function(){var e=this;if(this.state.saveValue){var t=this.state.saveValue;Y().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVersioningPolicy(t.Uuid,t).then((function(){e.props.reloadList(),e.setState({dirty:!1,policy:t,saveValue:null})}))}))}}},{key:"onFormChange",value:function(e){var t=this.state.m,n=s.valuesToTreeVersioningPolicy(e),r=n.KeepPeriods||[],o=r.findIndex((function(e){return 0===e.MaxNumber}));if(o>-1&&o<r.length-1){pydio.UI.displayMessage("ERROR",t("error.lastdelete"));for(var i=r.length-1-o;i>0;)r.pop(),i--}n.KeepPeriods=r,this.setState({saveValue:n,dirty:!0})}},{key:"updateValidStatus",value:function(e){}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.create,i=r.readonly,a=r.pydio,l=r.muiTheme,c=r.internalSources,d=this.state,p=d.loaded,f=d.policy,y=d.saveValue,m=d.m,h=this.state.parameters,g=l.palette,b=Qn(g);if(h&&p){c&&(h=h.map((function(e){return"VersionsDataSourceName"===e.name&&(e.choices+=","+c.map((function(e){return e+"|DataSource "+e})).join(",")),e})));var v=s.TreeVersioningPolicyToValues(f);y&&(v=s.TreeVersioningPolicyToValues(y)),e=t().createElement(zn,{parameters:h,values:v,className:"full-width",onChange:this.onFormChange.bind(this),onValidStatusChange:this.updateValidStatus.bind(this),disabled:i,depth:-2,variant:"v2"})}var S=[];i||(o||(S.push(Gn.actionButton(m("delete"),"mdi mdi-delete",(function(){n.deleteSource()}))),S.push(Gn.actionButton(a.MessageHash["ajxp_admin.plugins.6"],"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty))),S.push(Gn.actionButton(a.MessageHash[53],"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.valid||!this.state.dirty)));var w=y?y.Name:f.Name;return w||(w=""),t().createElement(Gn,{title:p&&h?m("title").replace("%s",w):a.MessageHash["ajxp_admin.loading"],titleLeftIcon:"mdi mdi-clock-start",titleActionBar:S,closeAction:this.props.closeEditor,className:"workspace-editor",contentFill:!0},t().createElement(u.Paper,{zDepth:0,style:{backgroundColor:b.body.block.header.backgroundColor,padding:"0px 20px",height:64,display:"flex",alignItems:"center"}},t().createElement("div",{style:{overflowX:"auto",width:"100%"}},t().createElement(_n,{pydio:a,policy:y||f}))),e,b.formSimpleCss())}}],o=[{key:"valuesToTreeVersioningPolicy",value:function(e){for(var t=[],n="IntervalStart",r="MaxNumber",o=n,i=r,a=0;void 0!==e[o]&&void 0!==e[i];){var l=new S.TreeVersioningKeepPeriod;l.IntervalStart=e[o],l.MaxNumber=e[i],t.push(l),delete e[i],delete e[o],o=n+"_"+ ++a,i=r+"_"+a}return e.KeepPeriods=t,S.TreeVersioningPolicy.constructFromObject(e)}},{key:"TreeVersioningPolicyToValues",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(n),!0).forEach((function(t){Vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if(t.KeepPeriods){var n=0;t.KeepPeriods.map((function(e){n>0?(t["IntervalStart_"+n]=e.IntervalStart||0,t["MaxNumber_"+n]=e.MaxNumber||0):(t.IntervalStart=e.IntervalStart||0,t.MaxNumber=e.MaxNumber||0),n++}))}return t.NodeDeletedStrategy||(t.NodeDeletedStrategy="KeepAll"),t}}],r&&Kn(n.prototype,r),o&&Kn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);$n=(0,f.muiThemeable)()($n);var Xn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),Zn=new Uint8Array(16);function er(){if(!Xn)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xn(Zn)}for(var tr=[],nr=0;nr<256;++nr)tr[nr]=(nr+256).toString(16).substr(1);const rr=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||er)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[r+i]=o[i];return t||function(e,t){var n=t||0,r=tr;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(o)};function or(e){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},or(e)}function ir(){return ir=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ir.apply(this,arguments)}function ar(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==or(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==or(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===or(o)?o:String(o)),r)}var o}function lr(e,t){return lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lr(e,t)}function sr(e){return sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sr(e)}var cr=c().requireLib("components").MaterialTable,ur=c().requireLib("hoc").ModernTextField;const dr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=sr(o);if(i){var n=sr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===or(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={keys:[],showDialog:!1,showExportKey:null,exportedKey:null,showCreateKey:null,showImportKey:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.encryption."+t]||t}},t}return n=l,(r=[{key:"load",value:function(){var e=this;new S.ConfigServiceApi(m().getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest).then((function(t){e.setState({keys:t.Keys||[]})}))}},{key:"componentDidMount",value:function(){this.load()}},{key:"exportKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=new S.EncryptionAdminExportKeyRequest;o.KeyID=this.state.showExportKey,o.StrPassword=this.refs["key-password-field"].getValue(),this.refs["key-password-confirm"].getValue()===o.StrPassword?r.exportEncryptionKey(o).then((function(t){e.setState({exportedKey:t.Key,showExportKey:null},(function(){e.timeout=setTimeout((function(){e.setState({exportedKey:"",showDialog:!1})}),1e4)})),e.setState({showExportKey:null})})).catch((function(r){t.UI.displayMessage("ERROR",n("key.export.fail")+" : "+r.message),e.setState({showExportKey:null})})):t.UI.displayMessage("ERROR","Warning, passwords differ!")}},{key:"createKey",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=new S.EncryptionAdminCreateKeyRequest;n.KeyID=this.refs.createKeyId.getValue(),n.Label=this.refs.createKeyLabel.getValue(),t.createEncryptionKey(n).then((function(t){e.load(),e.setState({showDialog:!1})})).catch((function(){e.setState({showDialog:!1})}))}},{key:"deleteKey",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("key.delete.warning"),destructive:[e],validCallback:function(){var n=new S.ConfigServiceApi(m().getRestClient()),r=new S.EncryptionAdminDeleteKeyRequest;r.KeyID=e,n.deleteEncryptionKey(r).then((function(e){t.load()}))}})}},{key:"importKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=this.state.showImportKey,i=!0;o.ID||((o=new S.EncryptionKey).ID=this.refs["key-import-id"].getValue(),o.Label=this.refs["key-import-label"].getValue(),i=!1),o.Content=this.refs["key-imported-field"].getValue();var a=new S.EncryptionAdminImportKeyRequest;a.StrPassword=this.refs["key-password-field"].getValue(),a.Key=o,a.Override=i,r.importEncryptionKey(a).then((function(r){r.Success?t.UI.displayMessage("SUCCESS",n("key.import.success")):t.UI.displayMessage("ERROR",n("key.import.fail")),e.load(),e.setState({showImportKey:!1,showDialog:!1})})).catch((function(){e.setState({showImportKey:!1,showDialog:!1})}))}},{key:"render",value:function(){var e=this,n=this.state,r=n.keys,o=n.showDialog,i=n.showImportKey,a=n.showExportKey,l=n.exportedKey,s=n.showCreateKey,c=n.m,d=this.props,p=d.pydio,f=d.accessByName,y=d.adminStyles,m=[{name:"Label",label:c("key.label"),style:{width:"30%",fontSize:15},headerStyle:{width:"30%"},sorter:{type:"string",default:!0}},{name:"ID",label:c("key.id"),hideSmall:!0,sorter:{type:"string"}},{name:"Owner",label:c("key.owner"),hideSmall:!0,sorter:{type:"string"}},{name:"CreationDate",label:c("key.created"),hideSmall:!0,useMoment:!0,sorter:{type:"number"}}],h=[];f("CreateEncryption")&&h.push({iconClassName:"mdi mdi-import",tooltip:c("key.import"),onClick:function(t){e.setState({showDialog:!0,showImportKey:t})}},{iconClassName:"mdi mdi-export",tooltip:c("key.export"),onClick:function(t){e.setState({showDialog:!0,showExportKey:t.ID})}},{iconClassName:"mdi mdi-delete",tooltip:c("key.delete"),onClick:function(t){e.deleteKey(t.ID)}});var g,b,v=[];a||l?(b=c("key.export"),l?(g=t().createElement(ur,{value:l.Content,fullWidth:!0,floatingLabelText:c("key.export.result.copy"),multiLine:!0,ref:"key-imported-field"}),v=[t().createElement(u.FlatButton,{label:"Close",onClick:function(){clearTimeout(e.timeout),e.setState({showExportKey:null,exportedKey:"",showDialog:!1})}})]):(g=t().createElement("div",null,t().createElement(ur,{floatingLabelText:c("key.export.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(ur,{floatingLabelText:c("key.export.confirm"),ref:"key-password-confirm",type:"password",fullWidth:!0})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showExportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.export"),primary:!0,onClick:function(){e.exportKey()}})])):i?(b=c("key.import"),g=t().createElement("div",null,!i.ID&&t().createElement("div",null,t().createElement(ur,{floatingLabelText:c("key.import.id"),ref:"key-import-id",fullWidth:!0}),t().createElement(ur,{floatingLabelText:c("key.import.label"),ref:"key-import-label",fullWidth:!0})),t().createElement(ur,{floatingLabelText:c("key.import.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(ur,{fullWidth:!0,floatingLabelText:c("key.import.content"),multiLine:!0,ref:"key-imported-field"})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showImportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.import"),primary:!0,onClick:function(){e.importKey()}})]):s&&(b="Create a Key",g=t().createElement("div",null,t().createElement(ur,{floatingLabelText:c("key.import.id"),ref:"createKeyId",fullWidth:!0}),t().createElement(ur,{floatingLabelText:c("key.import.label"),ref:"createKeyLabel",fullWidth:!0})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showCreateKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.create"),primary:!0,onClick:function(){e.createKey()}})]);var S=AdminComponents.AdminStyles().body,w=S.tableMaster,E=S.block.props,O=S.block.container;return t().createElement("div",null,t().createElement(u.Dialog,{title:b,open:o,onRequestClose:function(){e.setState({showDialog:!1,showExportKey:null,showImportKey:null,showCreateKey:!1})},modal:!0,actions:v,contentStyle:{maxWidth:340}},g),t().createElement(u.Paper,ir({},E,{style:O}),t().createElement(cr,{data:r,columns:m,actions:h,onSelectRows:function(){},showCheckboxes:!1,emptyStateString:c("key.emptyState"),masterStyles:w,storageKey:"console.encryption-keys.list"})),f("CreateEncryption")&&t().createElement("div",{style:{textAlign:"right",paddingRight:24,paddingBottom:24}},t().createElement(u.FlatButton,ir({primary:!0,label:c("key.import"),onClick:function(){e.setState({showImportKey:{},showDialog:!0})}},y.props.header.flatButton)),t().createElement("span",{style:{marginLeft:8}},t().createElement(u.FlatButton,ir({primary:!0,label:c("key.create"),onClick:function(){e.setState({showCreateKey:!0,showDialog:!0})}},y.props.header.flatButton)))))}}])&&ar(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==pr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===pr(o)?o:String(o)),r)}var o}function yr(e,t){return yr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yr(e,t)}function mr(e){return mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mr(e)}const hr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mr(o);if(i){var n=mr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={value:"flat"},t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e,t){e.open&&!this.props.open&&this.setState({value:"flat"})}},{key:"submit",value:function(){var e=this.props,t=e.onSubmit,n=e.onRequestClose;t(this.state.value),n()}},{key:"render",value:function(){var e=this,n=this.props,r=n.open,o=n.onRequestClose,i=this.state.value,a=function(e){return c().getMessages()["ajxp_admin.ds.format-picker."+e]||e},l=function(e){var n=t().createElement("div",null,t().createElement("div",null,a(e+".title")),t().createElement("div",{style:{opacity:.67,margin:"5px 0 10px"}},a(e+".legend")));return t().createElement(u.RadioButton,{value:e,label:n})},s=[t().createElement(u.FlatButton,{label:c().getMessages()[54],onClick:function(){o()},primary:!0}),t().createElement(u.FlatButton,{label:a("submit"),primary:!0,onClick:function(){return e.submit()}})];return t().createElement(u.Dialog,{open:r,title:a("title"),onRequestClose:o,actions:s},t().createElement("div",{style:{marginBottom:20}},a("legend")),t().createElement(u.RadioButtonGroup,{valueSelected:i,onChange:function(t,n){return e.setState({value:n})}},l("flat"),l("structured"),l("internal")))}}])&&fr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function gr(e){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gr(e)}function br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){Sr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sr(e,t,n){return(t=Or(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wr(){return wr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wr.apply(this,arguments)}function Er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Or(r.key),r)}}function Or(e){var t=function(e,t){if("object"!==gr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==gr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===gr(t)?t:String(t)}function kr(e,t){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kr(e,t)}function Cr(e){return Cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Cr(e)}var Pr=c().requireLib("components").MaterialTable,jr=c().requireLib("boot"),xr=jr.JobsStore,Tr=jr.moment,Rr=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kr(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Cr(i);if(a){var n=Cr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===gr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dataSources:[],resyncJobs:{},versioningPolicies:[],dsLoaded:!1,versionsLoaded:!1,showExportKey:!1,exportedKey:null,showImportKey:!1,importResult:null,keyOperationError:null,startedServices:[],peerAddresses:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.ds."+t]||t}},t}return r=s,o=[{key:"componentDidMount",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=this.props.pydio;this.statusPoller=setInterval((function(){n.WebSocketClient.getStatus()&&(dt.loadStatuses().then((function(t){e.setState({startedServices:t.Services||[]})})),t.listPeersAddresses().then((function(t){e.setState({peerAddresses:t.PeerAddresses||[]})})))}),2500),setTimeout((function(){e.syncPoller=setInterval((function(){n.WebSocketClient.getStatus()&&e.syncStatuses()}),2500)}),1250),this.load()}},{key:"componentWillUnmount",value:function(){clearInterval(this.statusPoller),clearInterval(this.syncPoller)}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setState({dsLoaded:!1,versionsLoaded:!1,newDsName:t}),dt.loadDatasources().then((function(t){e.setState({dataSources:t.DataSources||[],dsLoaded:!0},(function(){e.syncStatuses()}))})),dt.loadVersioningPolicies().then((function(t){e.setState({versioningPolicies:t.Policies||[],versionsLoaded:!0})})),dt.loadStatuses().then((function(t){e.setState({startedServices:t.Services})})),this.refs&&this.refs.encKeys&&this.refs.encKeys.load()}},{key:"syncStatuses",value:function(){var e=this,t=this.state.dataSources,n=void 0===t?[]:t;n.length&&xr.getInstance().getAdminJobs(null,null,n.map((function(e){return"resync-ds-"+e.Name})),1).then((function(t){var n={};(t.Jobs||[]).forEach((function(e){e.Tasks&&e.Tasks.length&&(n[e.ID.replace("resync-ds-","")]=e)})),e.setState({resyncJobs:n})}))}},{key:"closeEditor",value:function(){this.props.closeRightPane()}},{key:"openDataSource",value:function(e){if(e.length){var t=e[0],n=this.props,r=n.openRightPane,o=n.accessByName,i=n.pydio,a=n.storageTypes;r({COMPONENT:An,PROPS:{ref:"editor",pydio:i,dataSource:t,storageTypes:a,readonly:!o("CreateDatasource"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"makeStatusLabel",value:function(e,n){switch(e){case"error":return t().createElement("span",{style:{color:"#e53935"}},t().createElement("span",{className:"mdi mdi-alert"})," ",n);case"running":return t().createElement("span",{style:{color:"#ef6c00"}},t().createElement("span",{className:"mdi mdi-timer-sand"})," ",n);default:return t().createElement("span",{style:{color:"#1b5e20"}},t().createElement("span",{className:"mdi mdi-check"})," ",n)}}},{key:"computeStatus",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&e.Disabled)return-1;var r,o,i,a=this.state,l=a.startedServices,s=void 0===l?[]:l,c=a.peerAddresses,u=void 0===c?[]:c,d=a.m,p=a.newDsName;if(!s.length)return d("status.na");if(s.map((function(t){t.Name==="pydio.grpc.data.sync."+e.Name&&"STARTED"===t.Status?o=!0:t.Name==="pydio.grpc.data.index."+e.Name&&"STARTED"===t.Status?r=!0:t.Name==="pydio.grpc.data.objects."+e.ObjectsServiceName&&"STARTED"===t.Status&&(i=!0)})),r&&o&&i)return p&&e.Name===p&&setTimeout((function(){t.setState({newDsName:null})}),100),n?0:this.makeStatusLabel("ok",d("status.ok"));if(p&&e.Name===p)return n?1:this.makeStatusLabel("running",d("status.starting"));if(r||o||i){var f=[];return r||f.push(d("status.index")),o||f.push(d("status.sync")),i||f.push(d("status.object")),n?3:this.makeStatusLabel("error",f.join(" - "))}var y=d("status.ko");return u&&-1===u.indexOf(e.PeerAddress)&&(y=d("status.ko-peers").replace("%s",e.PeerAddress)),n?2:this.makeStatusLabel("error",y)}},{key:"computeJobStatus",value:function(e){var t=e.Tasks[0];switch(t.Status){case"Finished":return this.makeStatusLabel("ok",Tr(new Date(1e3*parseInt(t.EndTime))).fromNow());case"Running":return this.makeStatusLabel("running",t.StatusMessage||"Running...");case"Error":return this.makeStatusLabel("error",t.StatusMessage);case"Queued":return this.makeStatusLabel("running",t.StatusMessage)}return this.makeStatusLabel("ok",t.StatusMessage)}},{key:"openVersionPolicy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e||e.length){var n,r=!1;if(void 0===e){r=!0,(n=new S.TreeVersioningPolicy).Uuid=rr(),n.VersionsDataSourceName="versions",n.NodeDeletedStrategy="KeepAll";var o=new S.TreeVersioningKeepPeriod;o.IntervalStart="0",o.MaxNumber=-1,n.KeepPeriods=[o]}else n=e[0],t&&(r=!0,(n=S.TreeVersioningPolicy.constructFromObject(JSON.parse(JSON.stringify(n)))).Uuid=rr(),n.Name+=" (Copy)");var i=this.props,a=i.openRightPane,l=i.pydio,s=i.versioningReadonly,c=i.accessByName,u=this.state.dataSources;a({COMPONENT:$n,PROPS:{ref:"editor",versionPolicy:n,create:r,pydio:l,internalSources:u.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal})).map((function(e){return e.Name})),readonly:s||!c("CreateVersioning"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"deleteVersionPolicy",value:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.versions.editor.delete.confirm"],destructive:[e.Name],validCallback:function(){Y().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(e.Uuid).then((function(e){t.load()}))}))}})}},{key:"createDataSource",value:function(e){var t=this.props,n=t.pydio,r=t.storageTypes,o=this.state.dataSources;this.props.openRightPane({COMPONENT:An,PROPS:{ref:"editor",create:!0,createStructure:e,existingNames:o.map((function(e){return e.Name})),pydio:n,storageTypes:r,closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}},{key:"resyncDataSource",value:function(e,t,n){e.UI.openConfirmDialog({message:t("editor.legend.resync"),skipNext:"datasource.resync.confirm",validCallback:function(){new dt(n).resyncSource()}})}},{key:"deleteDataSource",value:function(e,t,n){var r=this;e.UI.openConfirmDialog({message:t("editor.delete.warning"),validCallback:function(){new dt(n).deleteSource().then((function(){r.load()}))},destructive:[n.Name]})}},{key:"createWorkspaceFromDatasource",value:function(e,t,n){var r=new C,o=r.getModel(),i=n.Name;o.Label=i,o.Description="Root of "+i,o.Slug=i,o.Attributes.DEFAULT_RIGHTS="";var a={Uuid:"DATASOURCE:"+i,Path:i};o.RootNodes[a.Uuid]=a,e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:t("board.wsfromds.title"),legendId:t("board.wsfromds.legend").replace("%s",i),fieldLabelId:t("board.wsfromds.field"),defaultValue:t("board.wsfromds.defaultPrefix").replace("%s",i),submitValue:function(t){o.Label=t,r.save().then((function(){e.goTo("/data/workspaces")}))}})}},{key:"render",value:function(){var n=this,r=this.state,o=r.dataSources,i=r.resyncJobs,a=r.versioningPolicies,l=r.m,s=r.createDialog;o.sort(g().arraySorter("Name"));var c=o.filter((function(e){return!(e.StorageConfiguration&&e.StorageConfiguration.cellsInternal)})),d=o.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal}));a.sort(g().arraySorter("Name"));var p=AdminComponents.AdminStyles(this.props.muiTheme.palette),f=p.body,y=f.tableMaster,m=f.block.props,h=f.block.container,b=this.props,v=b.currentNode,S=b.pydio,w=b.versioningReadonly,E=b.accessByName,O=[{name:"Name",label:l("name"),style:{fontSize:15,width:"15%"},headerStyle:{width:"15%"},sorter:{type:"string",default:!0}},{name:"StorageType",label:l("storage"),style:{width:"15%"},headerStyle:{width:"15%"},renderCell:function(e){var t="storage.fs";switch(e.StorageType){case"S3":t="storage.s3";break;case"AZURE":t="storage.azure";break;case"GCS":t="storage.gcs"}return l(t)},sorter:{type:"string"}},{name:"Status",label:l("status"),hideSmall:!0,renderCell:function(e){return e.Disabled?t().createElement("span",{style:{color:"#757575"}},t().createElement("span",{className:"mdi mdi-checkbox-blank-circle-outline"})," ",l("status.disabled")):n.computeStatus(e)},sorter:{type:"number",value:function(e){return n.computeStatus(e,!0)}}},{name:"SyncStatus",label:l("syncStatus"),hideSmall:!0,renderCell:function(e){return i&&i[e.Name]?n.computeJobStatus(i[e.Name]):"n/a"},sorter:{type:"number",value:function(e){return i&&i[e.Name]?i[e.Name].Tasks[0].EndTime:0}}},{name:"VersioningPolicyName",label:l("versioning"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,renderCell:function(e){var t=a.find((function(t){return t.Uuid===e.VersioningPolicyName}));return t?t.Name:e.VersioningPolicyName||"-"},sorter:{type:"string"}},{name:"EncryptionMode",label:l("encryption"),hideSmall:!0,style:{width:"8%",textAlign:"center"},headerStyle:{width:"8%"},renderCell:function(e){return"MASTER"===e.EncryptionMode?t().createElement("span",{className:"mdi mdi-check"}):"-"},sorter:{type:"number",value:function(e){return"MASTER"===e.EncryptionMode?1:0}}}];c.filter((function(e){return!e.FlatStorage})).length||(O=O.filter((function(e){return"SyncStatus"!==e.name})));var k=O.filter((function(e){return"VersioningPolicyName"!==e.name&&"SyncStatus"!==e.name})),C=v.getLabel(),P=v.getMetadata().get("icon_class"),j=[];E("CreateDatasource")&&j.push(t().createElement(u.FlatButton,wr({primary:!0,label:S.MessageHash["ajxp_admin.ws.4"],onClick:function(){return n.setState({createDialog:!0})}},p.props.header.flatButton)));var x=!w&&E("CreateVersioning");x&&j.push(t().createElement(u.FlatButton,wr({primary:!0,label:S.MessageHash["ajxp_admin.ws.4b"],onClick:function(){n.openVersionPolicy()}},p.props.header.flatButton)));var T=[{name:"Name",label:l("versioning.name"),style:{width:180,fontSize:15},headerStyle:{width:180},sorter:{type:"string",default:!0}},{name:"Description",label:l("versioning.description"),sorter:{type:"string"}},{name:"KeepPeriods",hideSmall:!0,label:l("versioning.periods"),renderCell:function(e){return t().createElement(_n,{rendering:"short",policy:e,pydio:S})}},{name:"VersionsDataSourceName",style:{width:180},headerStyle:{width:180},label:l("versioning.storage"),sorter:{type:"string"},hideSmall:!0}],R=[];E("CreateDatasource")&&R.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit datasource",onClick:function(e){n.openDataSource([e])}}),R.push({iconClassName:"mdi mdi-folder-plus",tooltip:"Create workspace here",onClick:function(e){return n.createWorkspaceFromDatasource(S,l,e)}}),E("CreateDatasource")&&R.push({iconClassName:"mdi mdi-delete",tooltip:l("editor.legend.delete.button"),onClick:function(e){return n.deleteDataSource(S,l,e)}});var N=[].concat(R);c.filter((function(e){return!e.FlatStorage})).length>0&&R.push({iconClassName:"mdi mdi-sync",tooltip:l("editor.legend.resync.button"),onClick:function(e){return n.resyncDataSource(S,l,e)},disable:function(e){return e.FlatStorage}});var A=[];return A.push({iconClassName:x?"mdi mdi-pencil":"mdi mdi-eye",tooltip:x?"Edit policy":"Display policy",onClick:function(e){n.openVersionPolicy([e])}}),x&&(A.push({iconClassName:"mdi mdi-content-copy",tooltip:"Duplicate policy",onClick:function(e){return n.openVersionPolicy([e],!0)}}),A.push({iconClassName:"mdi mdi-delete",tooltip:"Delete policy",destructive:!0,onClick:function(e){return n.deleteVersionPolicy(e)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:C,icon:P,actions:j,reloadAction:this.load.bind(this),loading:!(this.state.dsLoaded&&this.state.versionsLoaded)}),t().createElement(hr,{open:s,onRequestClose:function(){n.setState({createDialog:!1})},onSubmit:function(e){n.createDataSource(e)}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:l("board.ds.title"),legend:l("board.ds.legend")}),t().createElement(u.Paper,wr({},m,{style:vr({},h)}),t().createElement(Pr,{data:c,columns:O,actions:R,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.datasources.list"})),d.length>0&&t().createElement(e.Fragment,null,t().createElement("div",{style:{padding:"0px 20px"}},"Internal DataSources are used to store binaries like files versions"),t().createElement(u.Paper,wr({},m,{style:vr({},h)}),t().createElement(Pr,{data:d,columns:k,actions:N,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.internalsources.list"}))),t().createElement(AdminComponents.SubHeader,{title:l("board.versioning.title"),legend:l("board.versioning.legend")}),t().createElement(u.Paper,wr({},m,{style:vr({},h)}),t().createElement(Pr,{data:a,columns:T,actions:A,onSelectRows:this.openVersionPolicy.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:y,storageKey:"console.versioning.policies.list"})),t().createElement(AdminComponents.SubHeader,{title:l("board.enc.title"),legend:l("board.enc.legend")}),t().createElement(dr,{pydio:S,ref:"encKeys",accessByName:E,adminStyles:p}))))}}],o&&Er(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Nr(e){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nr(e)}function Ar(){return Ar=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ar.apply(this,arguments)}function Dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Nr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Nr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Nr(o)?o:String(o)),r)}var o}function Lr(e,t){return Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lr(e,t)}function Ir(e){return Ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ir(e)}Rr.propTypes={dataModel:l().instanceOf(Ue()).isRequired,rootNode:l().instanceOf(He()).isRequired,currentNode:l().instanceOf(He()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,filter:l().string,versioningReadonly:l().bool},Rr=(0,f.muiThemeable)()(Rr);var _r=n(173).muiThemeable,Br=c().requireLib("components").MaterialTable,Fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ir(o);if(i){var n=Ir(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Nr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={loading:!1,namespaces:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t}},t}return n=l,(r=[{key:"componentWillMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading:!0}),$.loadNamespaces().then((function(t){e.setState({loading:!1,namespaces:t.Namespaces||[]})}))}},{key:"emptyNs",value:function(){var e=new S.IdmUserMetaNamespace;return e.Policies=[S.ServiceResourcePolicy.constructFromObject({Action:"READ",Subject:"*",Effect:"allow"}),S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Subject:"*",Effect:"allow"})],e.JsonDefinition=JSON.stringify({type:"string"}),e.Indexable=!0,e}},{key:"create",value:function(){this.setState({create:!0,dialogOpen:!0,selectedNamespace:this.emptyNs()})}},{key:"deleteNs",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("delete.confirm"),destructive:[e.Namespace],validCallback:function(){$.deleteNS(e).then((function(){t.load()}))}})}},{key:"open",value:function(e){e.length&&this.setState({create:!1,dialogOpen:!0,selectedNamespace:e[0]})}},{key:"close",value:function(){this.setState({dialogOpen:!1,selectedNamespace:null})}},{key:"render",value:function(){var e=this,n=this.props,r=n.muiTheme,o=n.currentNode,i=n.pydio,a=n.accessByName,l=n.policiesBuilder,s=AdminComponents.AdminStyles(r.palette),c=this.state,d=c.namespaces,p=c.loading,f=c.dialogOpen,y=c.selectedNamespace,m=c.create,h=c.m;y||(y=this.emptyNs());var g,b=function(e){if(Array.isArray(e))return Dr(e)}(g=new Set(d.map((function(e){return ve(e)})).filter((function(e){return e}))))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(g)||function(e,t){if(e){if("string"==typeof e)return Dr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dr(e,t):void 0}}(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();d.sort((function(e,t){var n,r;return(n=e.Order||0)===(r=t.Order||0)?0:n>r?1:-1}));var v=[{name:"Order",label:h("order"),style:{width:30},headerStyle:{width:30},hideSmall:!0,renderCell:function(e){return e.Order||"0"},sorter:{type:"number"}},{name:"Namespace",label:h("namespace"),style:{fontSize:15},sorter:{type:"string"}},{name:"Label",label:h("label"),style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"Indexable",label:h("indexable"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0,renderCell:function(e){return e.Indexable?"Yes":"No"},sorter:{type:"number",value:function(e){return e.Indexable?1:0}}},{name:"JsonDefinition",label:h("definition"),hideSmall:!0,renderCell:function(e){var t=e.JsonDefinition;if(!t)return"";var n=JSON.parse(t);return $.MetaTypes[n.type]||n.type},sorter:{type:"string"}}],S={};b.length?d.map((function(e){var t=ve(e);S[t]||(S[t]=[]),S[t].push(e)})):S[""]=d;var w=o.getLabel(),E=o.getMetadata().get("icon_class"),O=[],k=[];return a("Create")&&(O.push(t().createElement(u.FlatButton,Ar({primary:!0,label:h("namespace.add"),onClick:function(){e.create()}},s.props.header.flatButton))),k.push({iconClassName:"mdi mdi-pencil",onClick:function(t){e.open([t])}},{iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteNs(t)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement(Oe,{pydio:i,open:f,create:m,namespace:y,onRequestClose:function(){return e.close()},reloadList:function(){return e.load()},namespaces:d,readonly:!a("Create"),policiesBuilder:l}),t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:w,icon:E,actions:O,reloadAction:this.load.bind(this),loading:p}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:h("namespaces"),legend:h("namespaces.legend")}),Object.keys(S).sort().map((function(n){return t().createElement(t().Fragment,null,n&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},"["+h("group")+"] "+n),!n&&b.length>0&&t().createElement("div",{style:{padding:20,fontWeight:500,paddingBottom:0}},h("default-group")),t().createElement(u.Paper,s.body.block.props,t().createElement(Br,{data:S[n],columns:v,actions:k,onSelectRows:e.open.bind(e),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:h("empty"),masterStyles:s.body.tableMaster,storageKey:"console.metadata.list"})))})))))}}])&&Mr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);Fr=_r()(Fr)})(),window.AdminWorkspaces=r})();