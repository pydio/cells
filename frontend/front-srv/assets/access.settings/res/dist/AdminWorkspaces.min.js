(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")},880:e=>{e.exports=require("pydio/http/api")},590:e=>{e.exports=require("pydio/lang/observable")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{DataSource:()=>De,DataSourceEditor:()=>Zt,DataSourcesBoard:()=>Qn,MetadataBoard:()=>Rr,TemplatePath:()=>Pe,TemplatePathEditor:()=>Be,VirtualNodes:()=>Je,Workspace:()=>C,WsAutoComplete:()=>U,WsDashboard:()=>ge});const e=require("react");var t=n.n(e);const o=require("create-react-class");var i=n.n(o);const a=require("prop-types");var l=n.n(a);const s=require("pydio");var c=n.n(s);const u=require("material-ui"),d=require("pydio/util/xml");var p=n.n(d),f=n(173),y=n(880),m=n.n(y);const h=require("pydio/util/lang");var g=n.n(h),b=n(590),v=n.n(b);const S=require("cells-sdk");function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(i){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalAttributes={},t.dirty=!1,e?t.initModel(e):(t.create=!0,t.model=new S.IdmWorkspace,t.model.Scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.model.RootNodes={},t.internalAttributes={DEFAULT_RIGHTS:""},t.model.PoliciesContextEditable=!0,t.model.Attributes=JSON.stringify(t.internalAttributes)),t.observableModel=t.buildProxy(t.model),t}return t=l,r=[{key:"rootIsTemplatePath",value:function(e){return!(!e.MetaStore||!e.MetaStore.resolution)}},{key:"listWorkspaces",value:function(){var e=new S.WorkspaceServiceApi(m().getRestClient()),t=new S.RestSearchWorkspaceRequest,n=new S.IdmWorkspaceSingleQuery;return n.scope=S.IdmWorkspaceScope.constructFromObject("ADMIN"),t.Queries=[n],e.searchWorkspaces(t)}}],(n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;return"Slug"===n?o=g().computeStringSlug(o):"Label"===n&&t.create&&(e.Slug=g().computeStringSlug(o)),e[n]=o,t.dirty=!0,t.notify("update"),!0},get:function(e,n){var r=e[n];return"Attributes"===n&&(r=t.internalAttributes),r instanceof Array?r:r instanceof Object?t.buildProxy(r):r}})}},{key:"initModel",value:function(e){if(this.create=!1,this.dirty=!1,this.model=e,this.snapshot=JSON.parse(JSON.stringify(e)),e.Attributes){var t=JSON.parse(e.Attributes);"object"===w(t)&&Object.keys(t).length&&(this.internalAttributes=t)}else this.internalAttributes={};e.RootNodes||(e.RootNodes={})}},{key:"getModel",value:function(){return this.observableModel}},{key:"hasTemplatePath",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"hasFolderRoots",value:function(){var e=this;return Object.keys(this.model.RootNodes).filter((function(t){return!l.rootIsTemplatePath(e.model.RootNodes[t])})).length>0}},{key:"save",value:function(){var e=this;return this.model.Attributes=JSON.stringify(this.internalAttributes),new S.WorkspaceServiceApi(m().getRestClient()).putWorkspace(this.model.Slug,this.model).then((function(t){e.initModel(t),e.observableModel=e.buildProxy(e.model)}))}},{key:"remove",value:function(){return new S.WorkspaceServiceApi(m().getRestClient()).deleteWorkspace(this.model.Slug)}},{key:"revert",value:function(){var e=S.IdmWorkspace.constructFromObject(this.snapshot||{});this.initModel(e),this.observableModel=this.buildProxy(this.model)}},{key:"isValid",value:function(){return this.model.Slug&&this.model.Label&&Object.keys(this.model.RootNodes).length>0}},{key:"isDirty",value:function(){return this.dirty}}])&&E(t.prototype,n),r&&E(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());const P=require("lodash.debounce");var j=n.n(P);const x=require("pydio/util/path");var R=n.n(x);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return(t=I(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,I(r.key),r)}}function I(e){var t=function(e,t){if("object"!==L(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===L(t)?t:String(t)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var V=c().requireLib("hoc"),K=V.ModernAutoComplete,W=V.ModernStyles,U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=F(i);if(a){var n=F(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.value,r=void 0===n?"":n;return t.debounced=j()((function(){var e=t.state.value;t.loadValues(e)}),300),t.state={nodes:[],value:r},t}return n=s,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.validateOnLoad,n=this.state.value;this.loadValues(n,(function(){var n=e.state,r=n.nodes,o=n.value;r.filter((function(e){return e.Path===o&&(!e.Type||"COLLECTION"==e.Type&&!e.MetaStore&&!e.MetaStore.resolution)})).map((function(t){e.loadValues(o+"/")})),t&&e.handleNewRequest(o)}))}},{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({value:e})}},{key:"handleNewRequest",value:function(e){var t,n,r=this.state.nodes,o=this.props,i=o.onChange,a=void 0===i?function(){}:i,l=o.onDelete,s=void 0===l?function(){}:l,c=o.onError,u=void 0===c?function(){}:c;if("string"==typeof e){if(""===e)return void s();t=e,(n=r.filter((function(t){return t.Path===e}))[0])||(n=r.filter((function(t){return 0===t.Path.indexOf(e)}))[0])}else"object"===L(e)&&(t=e.key,n=e.node);if(!n)return u();this.setState({value:t}),a(t,n)}},{key:"loadValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=e.lastIndexOf("/"),o=e.substr(0,r);if(null===this.lastSearch||this.lastSearch!==o){this.lastSearch=o,this.setState({loading:!0});var i=new S.AdminTreeServiceApi(PydioApi.getRestClient()),a=new S.TreeListNodesRequest,l=new S.TreeNode;l.Path=o+"/",a.Node=l,i.listAdminTree(a).then((function(e){t.setState({nodes:e.Children||[],loading:!1},(function(){return n()}))})).catch((function(){t.setState({loading:!1},(function(){return n()}))}))}}},{key:"render",value:function(){var e=this,n=this.state,r=n.value,o=n.nodes,i=n.loading,a=this.props,l=a.pydio,c=a.onDelete,d=a.skipTemplates,p=a.label,f=a.zDepth,y=void 0===f?0:f,m=function(e){return l.MessageHash["ajxp_admin."+e]||e},h=[];if(o){var g={};if(o.forEach((function(e){if(!(e.MetaStore&&e.MetaStore.resolution&&"cells"===e.Uuid||R().getBasename(e.Path).startsWith("."))){var t=s.renderNode(e,m);g[t.categ]||(g[t.categ]=[]),g[t.categ].push(t)}})),Object.keys(g).length>1){h.push({key:"h1",text:"",value:t().createElement(u.MenuItem,{primaryText:m("ws.complete.datasources"),style:{fontSize:13,fontWeight:500},disabled:!0})});var b=g[Object.keys(g)[0]];if(b.sort(LangUtils.arraySorter("text")),h.push.apply(h,D(b)),!d){h.push({key:"h2",text:"",value:t().createElement(u.MenuItem,{primaryText:m("ws.complete.templates"),style:{fontSize:13,fontWeight:500},disabled:!0})});var v=g[Object.keys(g)[1]];v.sort(LangUtils.arraySorter("text")),h.push.apply(h,D(v))}}else 1===Object.keys(g).length&&h.push.apply(h,D(g[Object.keys(g)[0]]))}return t().createElement(u.Paper,{zDepth:y,style:N({display:"flex",alignItems:"center",margin:"2px 0"},this.props.style)},t().createElement("div",{style:{position:"relative",flex:1,height:60}},t().createElement("div",{style:{position:"absolute",right:0,top:30,width:30}},t().createElement(u.RefreshIndicator,{size:30,left:0,top:0,status:i?"loading":"hide"})),t().createElement(K,{fullWidth:!0,searchText:r,onUpdateInput:function(t){return e.handleUpdateInput(t)},onNewRequest:function(t){return e.handleNewRequest(t)},onClose:function(){return e.handleNewRequest(r)},dataSource:h,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},floatingLabelText:p||m("ws.complete.label"),openOnFocus:!0,menuProps:{maxHeight:200},hasRightBlock:!0})),t().createElement("div",{style:W.fillBlockV2Right},t().createElement(u.IconButton,{style:{marginTop:2},iconStyle:{color:c?"#9e9e9e":"#eee"},iconClassName:"mdi mdi-delete",onClick:c,disabled:!c})))}}],o=[{key:"renderNode",value:function(e,n){var r=t().createElement("span",null,e.Path),o="mdi mdi-folder",i="folder";if(e.MetaStore&&e.MetaStore.resolution){o="mdi mdi-file-tree",i="templatePath";var a=e.MetaStore.resolution.split("\n").pop();r=t().createElement("span",null,e.Path," ",t().createElement("i",{style:{color:"#9e9e9e"}},"- ",n("ws.complete.resolves")," ",a))}else"LEAF"===e.Type&&(o="mdi mdi-file");return{key:e.Path,text:e.Path,node:e,categ:i,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:o,color:"#607d8b",style:{float:"left",marginRight:8}})," ",r)}}}],r&&_(n.prototype,r),o&&_(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H.apply(this,arguments)}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return(t=Q(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Q(r.key),r)}}function Q(e){var t=function(e,t){if("object"!==q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===q(t)?t:String(t)}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}var Z=c().requireLib("hoc"),ee=Z.ModernTextField,te=Z.ModernSelectField,ne=Z.ModernStyles,re=c().requireLib("form").InputIntegerBytes,oe=AdminComponents,ie=oe.PaperEditorLayout,ae=oe.AdminStyles,le=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(i);if(a){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=new C(e.workspace);return n.observe("update",(function(){t.forceUpdate()})),t.state={workspace:n.getModel(),container:n,newFolderKey:Math.random(),showDialog:!1},t}return r=s,(o=[{key:"enableSync",value:function(e){e?this.setState({showDialog:"enableSync",dialogTargetValue:e}):this.setState({showDialog:"disableSync",dialogTargetValue:e})}},{key:"confirmSync",value:function(e){this.state.workspace.Attributes.ALLOW_SYNC=e,this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"revert",value:function(){var e=this,t=this.state.container;t.revert(),this.setState({workspace:t.getModel()},(function(){e.forceUpdate()}))}},{key:"save",value:function(){var e=this,t=this.state.container,n=this.props,r=n.reloadList,o=n.closeEditor;this.setState({saving:!0});var i=t.create;t.save().then((function(){r(),e.setState({workspace:t.getModel(),saving:!1},(function(){e.forceUpdate()})),i&&o()})).catch((function(){e.setState({saving:!1})}))}},{key:"remove",value:function(){var e=this.state.container,t=this.props,n=t.closeEditor,r=t.reloadList,o=t.pydio;o.UI.openConfirmDialog({message:o.MessageHash["settings.35"],destructive:[e.getModel().Label],validCallback:function(){e.remove().then((function(){r(),n()}))}})}},{key:"render",value:function(){var n=this,r=this.props,o=r.closeEditor,i=r.pydio,a=r.advanced,l=this.state,s=l.workspace,c=l.container,d=l.newFolderKey,p=l.saving,f=l.showDialog,y=l.dialogTargetValue,m=function(e){return i.MessageHash["ajxp_admin."+e]||e},h=function(e){return i.MessageHash["settings."+e]||e},g=!s.PoliciesContextEditable,b=[];c.create||g||b.push(ie.actionButton(m("plugins.6"),"mdi mdi-undo",(function(){n.revert()}),!c.isDirty())),g||b.push(ie.actionButton(i.MessageHash[53],"mdi mdi-content-save",(function(){n.save()}),p||!(c.isDirty()&&c.isValid())));var v=ae(this.props.muiTheme.palette),S={title:J(J({},v.body.block.headerFull),{},{margin:"0 -20px"}),legend:{padding:"16px 4px 8px"},section:J({padding:"0 20px 20px",margin:10,backgroundColor:"white"},v.body.block.container),toggleDiv:{},divider:{margin:"24px -20px 0px",height:1,border:"none",backgroundColor:"rgb(236 239 241)"}},w=s.RootNodes,E=Object.keys(w).map((function(e){var r=m("ws.editor.path.folder");return C.rootIsTemplatePath(w[e])&&(r=m("ws.editor.path.template")),t().createElement(U,{key:w[e].Uuid,pydio:i,label:r,value:w[e].Path,onDelete:function(){delete w[e],n.forceUpdate()},onChange:function(t,n){delete w[e],""!==t&&(w[n.Uuid]=n)},skipTemplates:c.hasFolderRoots()})}));return c.hasTemplatePath()||E.push(t().createElement(U,{key:d,pydio:i,value:"",onChange:function(e,t){t&&(w[t.Uuid]=t,n.setState({newFolderKey:Math.random()}))},skipTemplates:c.hasFolderRoots()})),t().createElement(ie,{title:s.Label||h("90"),titleLeftIcon:"mdi mdi-folder-open",titleActionBar:b,closeAction:o,className:"workspace-editor",contentFill:!1},t().createElement(u.Dialog,{open:f,title:m("ws.editor.sync.warning"),onRequestClose:function(){n.confirmSync(!y)},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.confirmSync(!y)}}),t().createElement(u.FlatButton,{label:m("ws.editor.sync.warning.validate"),onClick:function(){n.confirmSync(y)}})]},"enableSync"===f&&t().createElement("div",null,m("ws.editor.sync.warning.enable")),"disableSync"===f&&t().createElement("div",null,m("ws.editor.sync.warning.disable"))),t().createElement(u.Paper,{zDepth:0,style:S.section},t().createElement("div",{style:S.title},m("ws.30")),t().createElement("div",{style:S.legend},m("ws.editor.options.legend")),t().createElement(ee,{fullWidth:!0,errorText:s.Label?"":m("ws.editor.label.legend"),floatingLabelText:h("8"),value:s.Label,onChange:function(e,t){s.Label=t},variant:"v2"}),t().createElement(ee,{fullWidth:!0,floatingLabelText:m("ws.editor.description"),value:s.Description,onChange:function(e,t){s.Description=t},variant:"v2"}),t().createElement(ee,{fullWidth:!0,errorText:s.Label&&!s.Slug?m("ws.editor.slug.legend"):"",floatingLabelText:m("ws.5"),value:s.Slug,onChange:function(e,t){s.Slug=t},variant:"v2"})),t().createElement(u.Paper,{zDepth:0,style:S.section},t().createElement("div",{style:S.title},m("ws.editor.data.title")),t().createElement("div",{style:S.legend},m("ws.editor.data.legend")," ",m("ws.editor.default_rights")),E,t().createElement(te,{fullWidth:!0,value:s.Attributes.DEFAULT_RIGHTS||"",onChange:function(e,t,n){s.Attributes.DEFAULT_RIGHTS=n},hintText:"Default Rights",variant:"v2"},t().createElement(u.MenuItem,{primaryText:m("ws.editor.default_rights.none"),value:""}),t().createElement(u.MenuItem,{primaryText:m("ws.editor.default_rights.read"),value:"r"}),t().createElement(u.MenuItem,{primaryText:m("ws.editor.default_rights.readwrite"),value:"rw"}),t().createElement(u.MenuItem,{primaryText:m("ws.editor.default_rights.write"),value:"w"}))),t().createElement(u.Paper,{zDepth:0,style:S.section},t().createElement("div",{style:S.title},m("ws.editor.other")),t().createElement("div",{style:J({},S.legend)},m("ws.editor.other.skiprecycle.legend")),t().createElement("div",{style:S.toggleDiv},t().createElement(u.Checkbox,H({label:m("ws.editor.other.skiprecycle"),labelPosition:"right",checked:s.Attributes.SKIP_RECYCLE,onCheck:function(e,t){s.Attributes.SKIP_RECYCLE=t}},ne.toggleFieldV2))),a&&t().createElement(e.Fragment,null,t().createElement("hr",{style:S.divider}),t().createElement("div",{style:J({},S.legend)},m("ws.editor.other.sync.legend")),t().createElement("div",{style:S.toggleDiv},t().createElement(u.Checkbox,H({label:m("ws.editor.other.sync"),labelPosition:"right",checked:s.Attributes.ALLOW_SYNC,onCheck:function(e,t){!c.hasTemplatePath()&&t?n.enableSync(t):t?s.Attributes.ALLOW_SYNC=t:n.enableSync(t)}},ne.toggleFieldV2))),t().createElement("hr",{style:S.divider}),t().createElement("div",{style:J({},S.legend)},m("ws.editor.other.quota")),t().createElement(re,{variant:"v2",attributes:{label:"Quota"},value:s.Attributes.QUOTA||0,onChange:function(e){e>0?s.Attributes.QUOTA=e+"":(s.Attributes.QUOTA="0",delete s.Attributes.QUOTA)}}),t().createElement("hr",{style:S.divider}),t().createElement("div",{style:J({},S.legend)},m("ws.editor.other.layout")),t().createElement(te,{fullWidth:!0,floatingLabelText:m("ws.editor.other.layout"),variant:"v2",value:s.Attributes.META_LAYOUT||"",onChange:function(e,t,n){s.Attributes.META_LAYOUT=n}},t().createElement(u.MenuItem,{primaryText:m("ws.editor.other.layout.default"),value:""}),t().createElement(u.MenuItem,{primaryText:m("ws.editor.other.layout.easy"),value:"meta.layout_sendfile"})))))}}])&&G(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(e.Component);le=(0,f.muiThemeable)()(le);const se=require("pydio/model/data-model");var ce=n.n(se);const ue=require("pydio/model/node");var de=n.n(ue),pe=c().requireLib("components").MaterialTable;const fe=i()({displayName:"WorkspaceList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(ce()).isRequired,rootNode:l().instanceOf(de()).isRequired,currentNode:l().instanceOf(de()).isRequired,openSelection:l().func,advanced:l().boolean},getInitialState:function(){return{workspaces:[],loading:!1}},startLoad:function(){this.props.onLoadState&&this.props.onLoadState(!0),this.setState({loading:!0})},endLoad:function(){this.props.onLoadState&&this.props.onLoadState(!1),this.setState({loading:!1})},reload:function(){var e=this;this.startLoad(),C.listWorkspaces().then((function(t){e.endLoad(),e.setState({workspaces:t.Workspaces||[]})})).catch((function(t){e.endLoad()}))},componentDidMount:function(){this.reload()},openTableRows:function(e){e.length&&this.props.openSelection(e[0].workspace)},deleteAction:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.35"],destructive:[e.Label],validCallback:function(){new C(e).remove().then((function(){t.reload()}))}})},computeTableData:function(){var e=[],t=this.props.filterString;return this.state.workspaces.map((function(n){var r="";n.RootNodes&&(r=Object.keys(n.RootNodes).map((function(e){return g().trimRight(n.RootNodes[e].Path,"/")})).join(", "));var o=!1;if(n.Attributes)try{var i=JSON.parse(n.Attributes);!0!==i.ALLOW_SYNC&&"true"!==i.ALLOW_SYNC||(o=!0)}catch(e){}if(t){var a=t.toLowerCase(),l=n.Label&&n.Label.toLowerCase().indexOf(a)>=0,s=n.Description&&n.Description.toLowerCase().indexOf(a)>=0,c=r&&r.toLowerCase().indexOf(a)>=0;if(!(l||s||c))return}e.push({workspace:n,label:n.Label,description:n.Description,slug:n.Slug,summary:r,syncable:o})})),e.sort(g().arraySorter("label",!1,!0)),e},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.editable,a=n.tableStyles,l=n.openSelection,s=function(e){return r.MessageHash["ajxp_admin."+e]},c=function(e){return r.MessageHash["settings."+e]},u=[{name:"label",label:c("8"),style:{width:"20%",fontSize:15},headerStyle:{width:"20%"},sorter:{type:"string",default:"true"}},{name:"description",label:c("103"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"summary",label:s("ws.board.summary"),hideSmall:!0,style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}}];o&&u.push({name:"syncable",label:s("ws.board.syncable"),style:{width:"10%",textAlign:"center"},headerStyle:{width:"10%",textAlign:"center"},sorter:{type:"number",sortValue:function(e){return e.syncable?1:0}},renderCell:function(e){return t().createElement("span",{className:"mdi mdi-check",style:{fontSize:18,opacity:e.syncable?1:0}})}}),u.push({name:"slug",label:s("ws.5"),style:{width:"20%"},headerStyle:{width:"20%"},sorter:{type:"string"}});var d=this.state.loading,p=this.computeTableData(),f=[];i&&f.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit Workspace",onClick:function(e){l(e.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}});var y=r.user.getRepositoriesList();return f.push({iconClassName:"mdi mdi-open-in-new",tooltip:"Open this workspace...",onClick:function(e){r.triggerRepositoryChange(e.workspace.UUID)},disable:function(e){return!y.has(e.workspace.UUID)}}),i&&f.push({iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteAction(t.workspace)},disable:function(e){return!e.workspace.PoliciesContextEditable}}),t().createElement(pe,{data:p,columns:u,actions:f,onSelectRows:i?this.openTableRows.bind(this):null,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:s(d?"loading":"ws.board.empty"),masterStyles:a,paginate:[10,25,50,100],defaultPageSize:25,storageKey:"console.workspaces.list"})}});function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ye.apply(this,arguments)}var me=c().requireLib("hoc").ModernTextField,he=i()({displayName:"WsDashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:l().instanceOf(ce()).isRequired,rootNode:l().instanceOf(de()).isRequired,currentNode:l().instanceOf(de()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,accessByName:l().func.isRequired,advanced:l().boolean},getInitialState:function(){return{selectedNode:null,searchString:""}},dirtyEditor:function(){var e=this.props.pydio;return!(!this.refs.editor||!this.refs.editor.isDirty()||confirm(e.MessageHash["role_editor.19"]))},openWorkspace:function(e){var t=this;if(!this.dirtyEditor()){var n=le,r=p().XPathSelectSingleNode(this.props.pydio.getXmlRegistry(),'//client_configs/component_config[@component="AdminWorkspaces.Dashboard"]/editor');r&&(n=r.getAttribute("namespace")+"."+r.getAttribute("component"));var o=this.props,i=o.pydio,a=o.advanced,l=(o.accessByName,{COMPONENT:n,PROPS:{ref:"editor",pydio:i,workspace:e,closeEditor:this.closeWorkspace,advanced:a,reloadList:function(){t.refs.workspacesList.reload()}}});return this.props.openRightPane(l),!0}},closeWorkspace:function(){this.dirtyEditor()||this.props.closeRightPane()},showWorkspaceCreator:function(e){var t=this,n=this.props,r=n.pydio,o=n.advanced,i={COMPONENT:le,PROPS:{ref:"editor",type:e,pydio:r,advanced:o,closeEditor:this.closeWorkspace,reloadList:function(){t.refs.workspacesList.reload()}}};this.props.openRightPane(i)},reloadWorkspaceList:function(){this.refs.workspacesList.reload()},render:function(){var e=this,n=this.props,r=n.pydio,o=n.advanced,i=n.currentNode,a=n.accessByName,l=n.muiTheme,s=this.state,c=s.searchString,d=s.loading,p=AdminComponents.AdminStyles(l.palette),f=[];a("Create")&&f.push(t().createElement(u.FlatButton,ye({primary:!0,label:this.context.getMessage("ws.3"),onClick:this.showWorkspaceCreator},p.props.header.flatButton)));var y=t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{width:190}},t().createElement(me,{fullWidth:!0,hintText:this.context.getMessage("ws.filter.workspaces"),value:c,onChange:function(t,n){return e.setState({searchString:n})}})));return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout workspaces-board"},t().createElement(AdminComponents.Header,{title:i.getLabel(),icon:"mdi mdi-folder-open",actions:f,centerContent:y,reloadAction:this.reloadWorkspaceList,loading:d}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("ws.dashboard","ajxp_admin")}),t().createElement(u.Paper,ye({},p.body.block.props,{style:p.body.block.container}),t().createElement(fe,{ref:"workspacesList",pydio:r,openSelection:this.openWorkspace,advanced:o,editable:a("Create"),onLoadState:function(t){e.setState({loading:t})},tableStyles:p.body.tableMaster,filterString:c}))))}});const ge=(0,f.muiThemeable)()(he),be=require("pydio/http/resources-manager");var ve=n.n(be);function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ce(r.key),r)}}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}function Ce(e){var t=function(e,t){if("object"!==Se(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Se(t)?t:String(t)}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ee(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(o);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Oe(e)}(this,e)});function l(e){var t,n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=Oe(t=a.call(this)),o=void 0,(r=Ce(r="data"))in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e?t.data=e:(t.data=new S.TreeNode,t.data.Type=S.TreeNodeType.constructFromObject("COLLECTION"),t.data.MetaStore={name:"",resolution:"",onDelete:"rename-uuid",contentType:"text/javascript"}),t}return t=l,r=[{key:"loadNodes",value:function(e){var t=new S.ConfigServiceApi(m().getRestClient());c().startLoading(),t.listVirtualNodes().then((function(t){c().endLoading();var n=[];t.Children&&t.Children.map((function(e){n.push(new l(e))})),e(n)})).catch((function(){c().endLoading()}))}}],(n=[{key:"getName",value:function(){return this.data.MetaStore.name}},{key:"setName",value:function(e){this.data.MetaStore.name=e;var t=g().computeStringSlug(e);this.data.Uuid=t,this.data.Path=t,this.notify("update")}},{key:"getValue",value:function(){return this.data.MetaStore.resolution}},{key:"setValue",value:function(e){this.data.MetaStore.resolution=e,this.notify("update")}},{key:"getOnDelete",value:function(){return this.data.MetaStore.onDelete}},{key:"setOnDelete",value:function(e){this.data.MetaStore.onDelete=e,this.notify("update")}},{key:"save",value:function(e){var t=this;ve().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVirtualNode(t.data.Uuid,t.data).then((function(){e()}))}))}},{key:"remove",value:function(e){var t=this;ve().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVirtualNode(t.data.Uuid).then((function(){e()}))}))}}])&&we(t.prototype,n),r&&we(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(v());function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==je(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===je(o)?o:String(o)),r)}var o}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Re(e,t)}function Te(e){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Te(e)}var Ne=n(590),Ae=n(880),De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}(l,e);var t,n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Te(o);if(i){var n=Te(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flat";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).internalInvalid=!1,t.nameInvalid=!1,t.existingNames=n,e)t.model=e,e.StorageConfiguration||(e.StorageConfiguration={}),t.snapshot=JSON.parse(JSON.stringify(e));else switch(t.model=new S.ObjectDataSource,t.model.EncryptionMode=S.ObjectEncryptionMode.constructFromObject("CLEAR"),t.model.StorageType=S.ObjectStorageType.constructFromObject("LOCAL"),r){case"flat":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!0;break;case"structured":t.model.StorageConfiguration={folder:"",normalize:"false"},t.model.FlatStorage=!1;break;case"internal":t.model.StorageConfiguration={folder:"",normalize:"false",cellsInternal:"true"},t.model.FlatStorage=!0}return t.observableModel=t.buildProxy(t.model),t}return t=l,n=[{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,r){var o=r;if("StorageType"===n)e.StorageConfiguration={},"LOCAL"===o?e.StorageConfiguration={folder:"",normalize:"false"}:"S3"===o?e.StorageConfiguration={customEndpoint:""}:"GCS"===o&&(e.StorageConfiguration={jsonCredentials:""}),t.internalInvalid=!1,e.ApiKey=e.ApiSecret="";else if("Name"===n)o=g().computeStringSlug(o).replace("-","").substr(0,33),t.existingNames&&t.existingNames.indexOf(o)>-1?t.nameInvalid=!0:t.nameInvalid=!1;else if("folder"===n)"/"!==o[0]&&(o="/"+o);else{if("invalid"===n)return t.internalInvalid=r,t.notify("update"),!0;"PeerAddress"===n&&"ANY"===r&&(o="")}return e[n]=o,t.notify("update"),!0},get:function(e,n){var r=e[n];return r instanceof Array?r:r instanceof Object?t.buildProxy(r):"StorageType"===n?r||"LOCAL":"PeerAddress"===n?r||"ANY":r}})}},{key:"getModel",value:function(){return this.observableModel}},{key:"isValid",value:function(){return!this.internalInvalid&&!this.nameInvalid&&("S3"===this.model.StorageType||"AZURE"===this.model.StorageType?this.model.ApiKey&&this.model.ApiSecret&&this.model.Name&&(this.model.ObjectsBucket||this.model.StorageConfiguration.bucketsRegexp):"GCS"===this.model.StorageType?this.model.Name&&this.model.ObjectsBucket&&this.model.StorageConfiguration&&this.model.StorageConfiguration.jsonCredentials:this.model.Name&&this.model.StorageConfiguration&&this.model.StorageConfiguration.folder)}},{key:"getNameError",value:function(e){return this.nameInvalid?e("name.inuse"):null}},{key:"deleteSource",value:function(){return new S.ConfigServiceApi(Ae.getRestClient()).deleteDataSource(this.model.Name)}},{key:"resyncSource",value:function(){var e=new S.JobsServiceApi(Ae.getRestClient()),t=new S.RestUserJobRequest;return t.JobName="datasource-resync",t.JsonParameters=JSON.stringify({dsName:this.model.Name}),e.userCreateJob("datasource-resync",t)}},{key:"revert",value:function(){return this.model=this.snapshot,this.observableModel=this.buildProxy(this.model),this.snapshot=JSON.parse(JSON.stringify(this.model)),this.observableModel}},{key:"saveSource",value:function(){var e=this;return new S.ConfigServiceApi(Ae.getRestClient()).putDataSource(this.model.Name,this.model).then((function(t){e.snapshot=JSON.parse(JSON.stringify(e.model)),e.notify("update")}))}},{key:"stripPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return e;var n={};return Object.keys(e).map((function(r){n[r.replace(t,"")]=e[r]})),n}},{key:"getDataWithPrefix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.model;var n={};return Object.keys(this.model).forEach((function(r){n[t+r]=e.model[r],"EncryptionMode"!==r||e.model[r]||(n[t+r]="CLEAR")})),n}}],r=[{key:"loadDatasources",value:function(){return new S.ConfigServiceApi(Ae.getRestClient()).listDataSources()}},{key:"loadVersioningPolicies",value:function(){return new S.ConfigServiceApi(Ae.getRestClient()).listVersioningPolicies()}},{key:"loadStatuses",value:function(){return new S.ConfigServiceApi(Ae.getRestClient()).listServices("STARTED")}},{key:"loadEncryptionKeys",value:function(){return new S.ConfigServiceApi(Ae.getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest)}},{key:"loadBuckets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new S.ConfigServiceApi(Ae.getRestClient()),r=new S.RestListStorageBucketsRequest;return r.DataSource=e,t&&(r.BucketsRegexp=t),n.listStorageBuckets(r)}},{key:"createBucket",value:function(e,t){var n=new S.ConfigServiceApi(Ae.getRestClient()),r=new S.RestCreateStorageBucketRequest;return r.DataSource=e,n.createStorageBucket(t,r)}}],n&&xe(t.prototype,n),r&&xe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(Ne);function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Me(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Me(o)?o:String(o)),r)}var o}function _e(e,t){return _e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_e(e,t)}function Ie(e){return Ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ie(e)}var Be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ie(o);if(i){var n=Ie(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=a.call(this,e);var n=e.node.getValue(),r=!1;return n||(n='// Compute the Path variable that this node must resolve to. \n// Use Ctrl+Space to see the objects available for completion.\nPath = "";',r=!0),t.state={value:n,cleanOnDelete:"rename-uuid"===e.node.getOnDelete(),dirty:r},t}return n=l,(r=[{key:"onChange",value:function(e,t){this.setState({value:t,dirty:!0})}},{key:"save",value:function(){var e=this,t=this.props,n=t.node,r=t.onSave,o=void 0===r?function(){}:r,i=this.state,a=i.value,l=i.cleanOnDelete;n.setValue(a),l?n.setOnDelete("rename-uuid"):n.setOnDelete(""),n.save((function(){e.setState({dirty:!1},o)}))}},{key:"remove",value:function(){var e=this;this.props.node.remove((function(){e.props.reloadList()}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.pydio,o=n.dataSources,i=n.readonly,a=n.oneLiner,l=n.onClose,s=void 0===l?function(){}:l,c=this.state,d=c.value,p=c.dirty,f=c.cleanOnDelete,y=function(e){return r.MessageHash["ajxp_admin.virtual."+e]||e},m={};o&&o.map((function(e){m[e.Name]=e.Name}));var h={Path:"",DataSources:m,User:{Name:"",Uuid:"",GroupPath:"",GroupFlat:"",Profile:"",DisplayName:"",Email:"",AuthSource:"",Roles:[]}},g=t().createElement(AdminComponents.CodeMirrorField,{mode:"javascript",globalScope:h,value:d,onChange:this.onChange.bind(this),readOnly:i});return a?t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1,lineHeight:"40px"}},g),t().createElement("div",{style:{display:"flex"}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-content-save",onClick:this.save.bind(this),disabled:!p,tooltip:"Save"}),t().createElement(u.IconButton,{iconClassName:"mdi mdi-close",onClick:function(){return s()},tooltip:"Close"}))):t().createElement("div",{style:{backgroundColor:"#f5f5f5",paddingBottom:12}},t().createElement("div",{style:{padding:i?"16px 24px 8px":"10px 24px 0",fontWeight:500,display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1}},y("card.title")),!i&&t().createElement(u.FlatButton,{onClick:this.save.bind(this),primary:!0,disabled:!p,label:y("save")})),t().createElement("div",{style:{margin:"6px 24px 0 24px",border:"1px solid #e0e0e0"}},g),t().createElement("div",{style:{margin:"12px 24px"}},t().createElement(u.Checkbox,{disabled:i,checked:f,onCheck:function(t,n){e.setState({cleanOnDelete:n,dirty:!0})},label:y("card.cleanOnDelete")})))}}])&&Le(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ve.apply(this,arguments)}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Fe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Fe(o)?o:String(o)),r)}var o}function Ue(e,t){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(e,t)}function qe(e){return qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qe(e)}var He=c().requireLib("hoc").ModernTextField,ze=c().requireLib("components").MaterialTable,Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qe(o);if(i){var n=qe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={nodesLoaded:!1,nodes:[],dataSourcesLoaded:!1,dataSources:[]},Pe.loadNodes((function(e){t.setState({nodes:e,nodesLoaded:!0})})),De.loadDatasources().then((function(e){t.setState({dataSources:e.DataSources,dataSourcesLoaded:!0})})),t}return n=l,(r=[{key:"reload",value:function(){var e=this;this.setState({nodesLoaded:!1}),Pe.loadNodes((function(t){e.setState({nodes:t,nodesLoaded:!0})}))}},{key:"createNode",value:function(){this.handleRequestClose();var e=new Pe;e.setName(this.state.newName);var t,n=this.state.nodes;this.setState({nodes:[].concat((t=n,function(e){if(Array.isArray(e))return Ke(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ke(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[e])})}},{key:"handleTouchTap",value:function(e){var t=this;e.preventDefault(),this.setState({newName:"",open:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newNode&&t.refs.newNode.focus()}),300)}))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this,n=this.props,r=n.readonly,o=n.pydio,i=n.muiTheme,a=n.accessByName,l=this.state,s=l.nodes,c=l.dataSources,d=l.nodesLoaded,p=l.dataSourcesLoaded,f=l.selectedNode,y=function(e){return o.MessageHash["ajxp_admin.virtual."+e]||e},m=AdminComponents.AdminStyles(i.palette),h=s.map((function(n){return n.getName()===f?{node:n,expandedRow:t().createElement(Be,{pydio:o,dataSources:c,node:n,reloadList:e.reload.bind(e),readonly:r||!a("Create"),adminStyles:m,onSave:e.reload.bind(e)})}:{node:n}})),g=[];!r&&a("Create")&&g.push(t().createElement(u.FlatButton,Ve({primary:!0,label:y("create"),onClick:this.handleTouchTap.bind(this)},m.props.header.flatButton)));var b=[{name:"id",label:y("col.id"),style:{width:"25%",fontSize:15},headerStyle:{width:"25%"},renderCell:function(e){return e.node.getName()},sorter:{type:"string"}},{name:"code",label:y("col.code"),renderCell:function(e){return t().createElement("pre",null,e.node.getValue().split("\n").pop())}}],v=[];return r?v.push({iconClassName:"mdi mdi-eye",tooltip:y("code.display"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}):(v.push({iconClassName:"mdi mdi-pencil",tooltip:y("code.edit"),onClick:function(t){return e.setState({selectedNode:f===t.node.getName()?null:t.node.getName()})}}),v.push({iconClassName:"mdi mdi-delete",tooltip:y("delete"),onClick:function(t){o.UI.openConfirmDialog({message:y("delete.confirm"),destructive:[t.node.getName()],validCallback:function(){t.node.remove((function(){e.reload()}))}})},disable:function(e){return"cells"===e.node.getName()||"my-files"===e.node.getName()}})),t().createElement("div",{className:"vertical-layout workspaces-list layout-fill",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:y("title"),icon:"mdi mdi-help-network",actions:g,reloadAction:this.reload.bind(this),loading:!(d&&p)}),t().createElement(u.Popover,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{margin:"0 10px"}},t().createElement(He,{ref:"newNode",floatingLabelText:y("label"),value:this.state.newName,onChange:function(t,n){e.setState({newName:n})},hintText:y("label.new")})),t().createElement(u.Divider,null),t().createElement("div",{style:{textAlign:"right",padding:"4px 10px"}},t().createElement(u.FlatButton,{label:o.MessageHash[54],onClick:this.handleRequestClose.bind(this)}),t().createElement(u.RaisedButton,{primary:!0,label:y("create.button"),onClick:this.createNode.bind(this)}))),t().createElement("div",{className:"layout-fill",style:{overflowY:"auto"}},t().createElement("div",{style:{padding:20,paddingBottom:0}},y("legend.1")),d&&p&&t().createElement(u.Paper,Ve({},m.body.block.props,{style:m.body.block.container}),t().createElement(ze,{columns:b,data:h,actions:v,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:m.body.tableMaster,storageKey:"console.templatepaths.list"})),(!d||!p)&&t().createElement("div",{style:{margin:16,textAlign:"center",padding:20}},o.MessageHash["ajxp_admin.loading"]),!r&&a("Create")&&t().createElement("div",{style:{padding:"0 24px",opacity:".5"}},y("legend.2"))))}}])&&We(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function Ye(e){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(e)}function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){$e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $e(e,t,n){return(t=rt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xe(e){return function(e){if(Array.isArray(e))return Ze(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rt(r.key),r)}}function nt(e,t,n){return t&&tt(e.prototype,t),n&&tt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function rt(e){var t=function(e,t){if("object"!==Ye(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ye(t)?t:String(t)}function ot(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&it(e,t)}function it(e,t){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},it(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=st(e);if(t){var o=st(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return lt(e)}(this,n)}}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function st(e){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},st(e)}Je=(0,f.muiThemeable)()(Je);var ct=c().requireLib("hoc"),ut=ct.ModernTextField,dt=ct.ModernSelectField,pt=(ct.ModernStyles,ct.ModernAutoComplete),ft=function(e){ot(r,e);var n=at(r);function r(e){var t;return et(this,r),(t=n.call(this,e)).debounced=j()(t.loadValues.bind(lt(t)),300),t.state={searchText:e.value,value:e.value},t}return nt(r,[{key:"handleUpdateInput",value:function(e){this.debounced(),this.setState({searchText:e})}},{key:"handleNewRequest",value:function(e){var t,n=this.state.nodes,r=!1;if(void 0===e.key){t="/"+g().trim(e,"/");var o=!1;n.map((function(e){e.Path!==t&&0!==e.Path.indexOf(t+"/")||(o=!0)})),o&&(r=!0)}else t=e.key,r=!0;this.setState({value:t,exist:r}),this.props.onChange(t,r),this.loadValues(t)}},{key:"componentWillMount",value:function(){this.lastSearch=null;var e="";this.props.value&&(e=this.props.value),this.loadValues(e)}},{key:"componentWillReceiveProps",value:function(e){e.value&&e.value!==this.state.value&&this.setState({value:e.value,exist:!0})}},{key:"loadValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props.peerAddress,r=this.state.searchText,o=t;if(!t&&r){var i=r.lastIndexOf("/");o=r.substr(0,i)}if(null!==this.lastSearch&&this.lastSearch===o)return Promise.resolve();this.lastSearch=o;var a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestListPeerFoldersRequest;return l.PeerAddress="ANY"===n?"":n,l.Path=o,this.setState({loading:!0}),a.listPeerFolders(n,l).then((function(t){var n=t.Children||[];n=n.map((function(e){return"/"!==e.Path[0]&&(e.Path="/"+e.Path),e})),e.setState({nodes:n,loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"createFolder",value:function(e){var t=this,n=this.props,r=n.peerAddress,o=n.pydio,i=this.state.value,a=new S.ConfigServiceApi(m().getRestClient()),l=new S.RestCreatePeerFolderRequest;l.PeerAddress="ANY"===r?"":r,l.Path=i+"/"+e,a.createPeerFolder(r,l).then((function(e){t.lastSearch=null,t.loadValues(i).then((function(){t.handleNewRequest({key:l.Path}),t.setState({searchText:l.Path})}))})).catch((function(e){o.UI.displayMessage("ERROR",e.message)}))}},{key:"renderNode",value:function(e){var n=R().getBasename(e.Path),r=R().getDirname(e.Path),o=t().createElement("span",null,e.Path);return g().computeStringSlug(n)!==n?o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#c62828"}},n)):e.MetaStore&&e.MetaStore.symlink&&(o=t().createElement("span",null,t().createElement("span",null,r),"/",t().createElement("span",{style:{color:"#1976d2"}},n))),{key:e.Path,text:e.Path,invalid:!1,value:t().createElement(u.MenuItem,null,t().createElement(u.FontIcon,{className:"mdi mdi-folder",color:"#616161",style:{float:"left",marginRight:8}})," ",o)}}},{key:"showCreateDialog",value:function(){var e=this,t=this.props.pydio,n=this.state.value,r=function(e){return t.MessageHash["ajxp_admin.ds.editor.selector."+e]||e};t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:r("mkdir"),legendId:r("mkdir.legend").replace("%s",n),fieldLabelId:r("mkdir.field"),submitValue:function(t){t&&e.createFolder(t)}})}},{key:"render",value:function(){var e=this,n=this.state,r=n.nodes,o=n.loading,i=n.exist,a=n.value,l=n.searchText,s=this.props,c=s.fieldLabel,d=s.pydio,p=[];r&&r.forEach((function(t){p.push(e.renderNode(t))}));var f=l||a;return t().createElement("div",{style:{position:"relative",marginTop:-5}},t().createElement("div",{style:{position:"absolute",right:6,top:29,width:30,zIndex:1}},t().createElement(u.RefreshIndicator,{size:25,left:0,top:0,status:o?"loading":"hide"})),a&&i&&!o&&(!l||l===a)&&t().createElement("div",{style:{position:"absolute",right:0,zIndex:1,top:18}},t().createElement(u.IconButton,{iconClassName:"mdi mdi-folder-plus",iconStyle:{color:"#9e9e9e"},onClick:function(){return e.showCreateDialog()},tooltip:d.MessageHash["ajxp_admin.ds.editor.selector.mkdir"],tooltipPosition:"top-center"})),t().createElement(pt,{fullWidth:!0,searchText:f,onUpdateInput:this.handleUpdateInput.bind(this),onNewRequest:this.handleNewRequest.bind(this),dataSource:p,hintText:c,filter:function(e,t){return 0===t.toLowerCase().indexOf(e.toLowerCase())},openOnFocus:!0,menuProps:{maxHeight:200}}))}}]),r}(t().Component),yt=function(e){ot(r,e);var n=at(r);function r(e){var t;return et(this,r),(t=n.call(this,e)).state={peerAddresses:[],invalid:!1,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.editor."+t]||t}},t}return nt(r,[{key:"compareAddresses",value:function(e,t){var n=e.split("|"),r=t.split("|");return r.filter((function(e){return n.indexOf(e)>-1})).length||n.filter((function(e){return r.indexOf(e)>-1})).length}},{key:"componentDidMount",value:function(){var e=this,t=this.props.model;new S.ConfigServiceApi(m().getRestClient()).listPeersAddresses().then((function(n){var r=n.PeerAddresses||[];if(1!==r||t.PeerAddress||(t.PeerAddress=r[0]),e.setState({peerAddresses:r}),t.PeerAddress&&-1===r.indexOf(t.PeerAddress)){var o=r.filter((function(n){return e.compareAddresses(n,t.PeerAddress)}));o.length?t.PeerAddress=o[0]:e.setState({invalidAddress:t.PeerAddress})}}))}},{key:"baseIsInvalid",value:function(e){var t=this.state.m,n=!1,r=R().getBasename(e);return g().trim(e,"/").split("/").length<2?n=t("selector.error.depth"):g().computeStringSlug(r)!==r&&(n=t("selector.error.dnsname")),n}},{key:"onPathChange",value:function(e,t){var n=this.props.model,r=this.baseIsInvalid(e);n.invalid=r,n.StorageConfiguration.folder=e,t?void 0!==n.StorageConfiguration.create&&delete n.StorageConfiguration.create:n.StorageConfiguration.create="true",this.setState({invalid:r})}},{key:"onPeerChange",value:function(e){var t=this.props.model,n=this.state.invalidAddress;e!==n&&(t.PeerAddress=e,n&&this.setState({invalidAddress:null}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.model,o=n.pydio,i=n.styles,a=this.state,l=a.peerAddresses,s=a.invalidAddress,c=a.invalid,d=a.m,p=Xe(l);return p=["ANY"].concat(Xe(p)),s&&"ANY"!==s&&(p=[s].concat(Xe(p))),t().createElement("div",null,t().createElement("div",{style:{paddingBottom:8}},t().createElement("div",{style:i.subLegend},d("storage.legend.fs.peer")),t().createElement(dt,{value:r.PeerAddress||"",variant:"v2",hintText:d("selector.peer")+" *",onChange:function(t,n,r){return e.onPeerChange(r)},fullWidth:!0},p.map((function(e){var n=d("selector.peer.any");return"ANY"!==e&&(n=d("selector.peer.word")+" : "+e.replace("|"," | ")+(e===s?" ("+d("selector.peer.invalid")+")":"")),t().createElement(u.MenuItem,{value:e,primaryText:n})})))),t().createElement("div",null,t().createElement("div",{style:Qe(Qe({},i.subLegend),{},{paddingBottom:6})},d("storage.legend.fs.path")),r.PeerAddress&&t().createElement(ft,{pydio:o,value:r.StorageConfiguration.folder,peerAddress:r.PeerAddress,onChange:this.onPathChange.bind(this),fieldLabel:d("selector.completer")+(r.StorageConfiguration.create?" ("+d("selector.completer.create")+")":"")+" *",hintText:d("selector.completer.hint")}),!r.PeerAddress&&t().createElement(ut,{style:{marginTop:-3},fullWidth:!0,variant:"v2",disabled:!0,value:r.StorageConfiguration.folder,floatingLabelText:d("selector.folder")+" *",hintText:d("selector.folder.hint")})),c&&t().createElement("div",{style:{color:"#c62828"}},c))}}]),r}(t().Component);const mt=require("pydio/util/dom");var ht=n.n(mt);function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function bt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==gt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===gt(o)?o:String(o)),r)}var o}function St(e,t,n){return t&&vt(e.prototype,t),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function wt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Et(e,t)}function Et(e,t){return Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Et(e,t)}function Ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=kt(e);if(t){var o=kt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}var Ct=function(e){wt(r,e);var n=Ot(r);function r(){return bt(this,r),n.apply(this,arguments)}return St(r,[{key:"render",value:function(){var e=this.props,n=e.onSelect,r=e.selected,o=e.value,i=e.primaryText,a=e.image,l={cont:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"10px 10px 0 10px",backgroundColor:"transparent",borderBottom:"2px solid transparent",transition:ht().getBeziersTransition()},image:{width:30,height:30,opacity:.3,transition:ht().getBeziersTransition()},label:{margin:5,marginTop:8,fontSize:11,fontWeight:500,color:"rgba(0,0,0,.3)",textAlign:"center",transition:ht().getBeziersTransition()}};return r&&(l.cont.borderBottom="2px solid #0e4d6d",l.image.opacity=1,l.label.color="#0e4d6d"),t().createElement("div",{zDepth:0,style:l.cont,onClick:function(e){n(o)},rounded:!1},a&&t().createElement("img",{style:l.image,src:"/plug/access.settings/res/images/"+a}),t().createElement("div",{style:l.label},i))}}]),r}(t().Component),Pt=function(e){wt(r,e);var n=Ot(r);function r(e){return bt(this,r),n.call(this,e)}return St(r,[{key:"onChange",value:function(e){var t=this.props,n=t.values;(0,t.onChange)(null,Object.keys(n).indexOf(e),e)}},{key:"render",value:function(){var e=this,n=this.props,r=n.values,o=n.value,i=n.disabled;return t().createElement("div",{style:{display:"flex",padding:"0 1px",backgroundColor:"rgb(251, 251, 252)"}},Object.keys(r).map((function(n){return t().createElement(Ct,{value:n,selected:n===o,onSelect:i?function(){}:e.onChange.bind(e),primaryText:r[n].primaryText,image:r[n].image})})))}}]),r}(t().Component);const jt=require("lodash");function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function Rt(){return Rt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Rt.apply(this,arguments)}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==xt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==xt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===xt(o)?o:String(o)),r)}var o}function At(e,t){return At=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},At(e,t)}function Dt(e){return Dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dt(e)}var Mt=c().requireLib("hoc").ModernTextField,Lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&At(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Dt(o);if(i){var n=Dt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===xt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={buckets:[],selection:[],mode:t.modeFromValue(),monitorApi:e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret},e.dataSource.ObjectsBucket&&(t.state.selection=[e.dataSource.ObjectsBucket]),t.load(),t.loadSelection(),t.reloadSelection=(0,jt.debounce)((function(){t.loadSelection()}),500),t.loadDebounced=(0,jt.debounce)((function(){t.load()}),500),t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e){var t=e.dataSource.ApiKey+"-"+e.dataSource.ApiSecret;t!==this.state.monitorApi&&(this.loadDebounced(),this.setState({monitorApi:t}))}},{key:"load",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?(this.setState({loading:!0}),De.loadBuckets(t).then((function(t){var n=t.Children||[];e.setState({buckets:n.map((function(e){return e.Path})),loading:!1})})).catch((function(t){e.setState({buckets:[],loading:!1})}))):this.setState({buckets:[]})}},{key:"createBucket",value:function(){var e=this,t=this.props.dataSource,n=this.state.createBucket;this.setState({loading:!0}),De.createBucket(t,n).then((function(){e.setState({create:!1,createBucket:""}),e.load()})).catch((function(t){e.setState({loading:!1})}))}},{key:"loadSelection",value:function(){var e=this,t=this.props.dataSource;t.ApiKey&&t.ApiSecret?t.ObjectsBucket?this.setState({selection:[t.ObjectsBucket]}):(this.setState({selection:[]}),t.StorageConfiguration.bucketsRegexp&&De.loadBuckets(t,t.StorageConfiguration.bucketsRegexp).then((function(t){var n=t.Children||[];e.setState({selection:n.map((function(e){return e.Path}))})}))):this.setState({selection:[]})}},{key:"modeFromValue",value:function(){var e="picker";return this.props.dataSource.StorageConfiguration.bucketsRegexp&&(e="regexp"),e}},{key:"toggleMode",value:function(){var e=this.state.mode,t=this.props.dataSource;"picker"===e?(t.ObjectsBucket&&(t.StorageConfiguration.bucketsRegexp=t.ObjectsBucket,t.ObjectsBucket="",this.reloadSelection()),this.setState({mode:"regexp"})):(t.StorageConfiguration.bucketsRegexp="",this.reloadSelection(),this.setState({mode:"picker"}))}},{key:"togglePicker",value:function(e){var t,n=this.props.dataSource,r=this.state.selection,o=[],i=r.indexOf(e);1===(o=-1===i?[].concat((t=r,function(e){if(Array.isArray(e))return Tt(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[e]):g().arrayWithout(r,i)).length?(n.ObjectsBucket=o[0],n.StorageConfiguration.bucketsRegexp=""):(n.ObjectsBucket="",n.StorageConfiguration.bucketsRegexp=o.map((function(e){return"^"+e+"$"})).join("|")),this.setState({selection:o})}},{key:"updateRegexp",value:function(e){this.props.dataSource.StorageConfiguration.bucketsRegexp=e,this.reloadSelection()}},{key:"render",value:function(){var e=this,n=this.props.dataSource,r=this.state,o=r.buckets,i=r.selection,a=r.mode,l=r.loading,s=r.create,d=r.createBucket,p=void 0===d?"":d,f=c().getInstance().MessageHash,y=function(e){return f["ajxp_admin.ds.editor.storage."+e]||e},m={style:{width:30,height:30,padding:5},iconStyle:{width:20,height:20,color:"rgba(0,0,0,.5)",fontSize:18}},h=!n.ApiKey||!n.ApiSecret;return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginTop:20}},t().createElement("div",null,y("buckets.legend")),t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{display:"flex",alignItems:"flex-end",marginRight:s?30:0}},s&&t().createElement("div",{style:{width:200,height:36}},t().createElement(Mt,{hintText:y("buckets.create.hint"),fullWidth:!0,value:p,onChange:function(t,n){e.setState({createBucket:g().computeStringSlug(n)})}})),t().createElement(u.IconButton,Rt({iconClassName:s?"mdi mdi-check":"mdi mdi-plus-circle",tooltip:y("buckets.create"),tooltipPosition:"top-left",onClick:function(){s?e.createBucket():e.setState({create:!0})},disabled:h},m)),s&&t().createElement(u.IconButton,Rt({iconClassName:"mdi mdi-close",tooltip:f[54],tooltipPosition:"top-left",onClick:function(){return e.setState({create:!1,createBucket:""})},disabled:h},m))),t().createElement("div",{style:{display:"flex",alignItems:"flex-end"}},"regexp"===a&&t().createElement("div",{style:{width:200,height:36}},t().createElement(Mt,{hintText:y("buckets.regexp.hint"),fullWidth:!0,value:n.StorageConfiguration.bucketsRegexp||"",onChange:function(t,n){e.updateRegexp(n)}})),t().createElement(u.IconButton,Rt({iconClassName:"mdi mdi-filter",tooltip:"picker"===a?y("buckets.regexp"):"",tooltipPosition:"top-left",onClick:function(){e.toggleMode()},disabled:h},m))),t().createElement(u.IconButton,Rt({iconClassName:"mdi mdi-reload",tooltip:y("buckets.reload"),tooltipPosition:"top-left",onClick:function(){e.load()},disabled:h},m))),t().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginTop:8,backgroundColor:"rgb(246 246 248)",borderRadius:"4px 4px 0 0",borderBottom:"1px solid #e0e0e0",minHeight:52,padding:2,maxHeight:275,overflowY:"auto"}},o.map((function(r){var o=-1!==i.indexOf(r),l={};return"picker"===a?l.onClick=function(){e.togglePicker(r)}:n.StorageConfiguration.bucketsRegexp||(l.onClick=function(){e.toggleMode(),e.togglePicker(r)}),t().createElement("div",{style:{margin:5}},t().createElement(u.Chip,Rt({},l,{backgroundColor:o?"#03a9f4":null}),r))})),0===o.length&&t().createElement("div",{style:{paddingLeft:5,textAlign:"center",fontSize:12,color:"rgba(0,0,0,.3)"}},y(h?"buckets.cont.nokeys":l?"buckets.cont.loading":"buckets.cont.empty"))))}}])&&Nt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function _t(e){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t(e)}function It(){return It=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},It.apply(this,arguments)}function Bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(n),!0).forEach((function(t){Vt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vt(e,t,n){return(t=Wt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wt(r.key),r)}}function Wt(e){var t=function(e,t){if("object"!==_t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==_t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===_t(t)?t:String(t)}function Ut(e,t){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ut(e,t)}function qt(e){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qt(e)}var Ht=AdminComponents,zt=Ht.PaperEditorLayout,Jt=Ht.AdminStyles,Yt=c().requireLib("hoc"),Gt=Yt.ModernTextField,Qt=Yt.ModernSelectField,$t=Yt.ModernStyles,Xt=["main","storage","data","advanced"],Zt=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ut(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qt(i);if(a){var n=qt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===_t(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n=e.pydio,r=e.create,o=e.dataSource,i=e.existingNames,a=e.createStructure,c=new De(o,i,a),u=c.getModel().StorageConfiguration||{},d=u.customEndpoint?"custom":"aws";return"custom"===d&&u.minioServer&&(d="minio"),t.state={dirty:!1,create:r,observable:c,model:c.getModel(),loaded:!1,valid:c.isValid(),encryptionKeys:[],versioningPolicies:[],s3Custom:d,m:function(e){return n.MessageHash["ajxp_admin.ds.editor."+e]||e}},De.loadEncryptionKeys().then((function(e){t.setState({encryptionKeys:e.Keys||[]})})),De.loadVersioningPolicies().then((function(e){t.setState({versioningPolicies:e.Policies||[]})})),t}return r=s,o=[{key:"componentWillReceiveProps",value:function(e){if(e.dataSource&&this.state.model.Name!==e.dataSource.Name)if(this.state.dirty)alert(this.props.pydio.MessageHash["role_editor.19"]);else{var t=new De(e.dataSource);this.setState({observable:t,model:t.getModel()})}e.create&&this.state.create!==e.create&&this.setState({create:e.create})}},{key:"componentDidMount",value:function(){var e=this;this.state.observable.observe("update",(function(){e.setState({dirty:!0}),e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.observable.stopObserving("update")}},{key:"resetForm",value:function(){var e=this,t=this.state.observable.revert();this.setState({valid:!0,dirty:!1,model:t},(function(){e.forceUpdate()}))}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.observable;this.props.pydio.UI.openConfirmDialog({message:n("delete.warning"),validCallback:function(){r.deleteSource().then((function(){e.props.closeEditor(),e.props.reloadList()}))},destructive:[r.getModel().Name]})}},{key:"saveSource",value:function(){var e=this,t=this.state,n=t.observable,r=t.create;this.state.observable.saveSource().then((function(){var t=null;r&&(t=n.getModel().Name),e.setState({valid:!0,dirty:!1,create:!1}),r&&e.props.closeEditor(),e.props.reloadList(t)}))}},{key:"launchResync",value:function(){this.state.observable.resyncSource()}},{key:"toggleEncryption",value:function(e){var t=this.state.model;"VALUE_CREATE"===e?this.setState({showDialog:"enableEncryptionWithCreate",dialogTargetValue:e,newKeyName:t.Name||""}):"VALUE_CLEAR"===e?this.setState({showDialog:"disableEncryption",dialogTargetValue:e}):"MASTER"!==t.EncryptionMode?this.setState({showDialog:"enableEncryption",dialogTargetValue:e}):t.EncryptionKey=e}},{key:"confirmEncryption",value:function(e){var t=this,n=this.state,r=n.model,o=n.newKeyName;if("VALUE_CREATE"===e){var i=new S.ConfigServiceApi(m().getRestClient()),a=new S.EncryptionAdminCreateKeyRequest;return a.KeyID=o,a.Label=o,void i.createEncryptionKey(a).then((function(e){r.EncryptionMode="MASTER",r.EncryptionKey=o,t.setState({showDialog:!1,dialogTargetValue:null,encryptionKeys:[{ID:o,Label:o}]})})).catch((function(){}))}"VALUE_CLEAR"===e?(r.EncryptionMode="CLEAR",r.EncryptionKey=""):(r.EncryptionMode="MASTER",r.EncryptionKey=e),this.setState({showDialog:!1,dialogTargetValue:null})}},{key:"toggleS3Custom",value:function(e){var t=this.state.model;"aws"===e?(t.StorageConfiguration.customEndpoint="",t.StorageConfiguration.customRegion="",t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion=""):"minio"===e?(t.StorageConfiguration.minioServer="true",t.StorageConfiguration.signatureVersion="v4"):(t.StorageConfiguration.minioServer="",t.StorageConfiguration.signatureVersion="v4"),this.setState({s3Custom:e})}},{key:"stepperBack",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Xt.indexOf(t);n>0&&this.setState({currentPane:Xt[n-1]})}},{key:"stepperNext",value:function(){var e=this.state.currentPane,t=void 0===e?"main":e,n=Xt.indexOf(t);n<Xt.length-1&&this.setState({currentPane:Xt[n+1]})}},{key:"render",value:function(){var n=this,r=this.props,o=r.storageTypes,i=r.pydio,a=r.readonly,l=this.state,s=l.currentPane,c=void 0===s?"main":s,d=l.model,p=l.create,f=l.observable,y=l.encryptionKeys,m=l.versioningPolicies,h=l.showDialog,g=l.dialogTargetValue,b=l.newKeyName,v=l.s3Custom,S=l.m,w=[];a||p||(w.push(t().createElement(u.Toggle,{style:{borderRight:"1px solid #e0e0e0",paddingRight:14,zoom:.8},labelStyle:{fontSize:17},toggled:!d.Disabled,onToggle:function(e,t){d.Disabled=!t},labelPosition:"right",label:S("options.enabled")})),w.push(zt.actionButton(this.context.getMessage("plugins.6"),"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty)),w.push(zt.actionButton(this.context.getMessage("plugins.5"),"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.dirty))),this.context.getMessage("ws.75"),this.context.getMessage("ws.76"),p&&"LOCAL"===d.StorageType&&(u.Divider,S("legend.local"),S("legend.local.li.1"),S("legend.local.li.2"),S("legend.local.li.3")),p&&"S3"===d.StorageType&&(u.Divider,S("legend.s3.1"),S("legend.s3.2")),!p&&(u.Divider,S("legend.resync"),u.RaisedButton,S("legend.resync.button"),this.launchResync.bind(this)),!p&&!a&&(u.Divider,S("legend.delete.1"),S("legend.delete.2"),u.RaisedButton,S("legend.delete.button"),this.deleteSource.bind(this));var E=d.Name?S("title").replace("%s",d.Name):S("new"),O=d.StorageConfiguration,k=Jt(this.props.muiTheme.palette),C={title:Ft(Ft({},k.body.block.headerFull),{},{margin:"0 -20px"}),legend:{},subLegend:{padding:"10px 6px 0 4px",fontSize:12,lineHeight:"16px",color:"rgba(0,0,0,0.6)",textAlign:"justify"},section:Ft({padding:"0 20px 20px",margin:10,backgroundColor:"white"},k.body.block.container),storageSection:{padding:20,marginTop:-1}},P={LOCAL:{primaryText:this.context.getMessage("ds.storage.fs","ajxp_admin"),image:"fs.png"},S3:{primaryText:this.context.getMessage("ds.storage.s3","ajxp_admin"),image:"s3-compat.png"},AZURE:{primaryText:this.context.getMessage("ds.storage.azure","ajxp_admin"),image:"azure.png"},GCS:{primaryText:this.context.getMessage("ds.storage.gcs","ajxp_admin"),image:"gcs.png"}},j={};o.forEach((function(e){j[e]=P[e]})),d.StorageType&&!j[d.StorageType]&&(j[d.StorageType]=P[d.StorageType]);var x,R,T=function(e,t){return t===c?e:Ft(Ft({},e),{},{display:"none"})};if(p){var N={display:"flex",alignItems:"center",padding:"0 20px 0 8px",position:"absolute",height:64,zIndex:10,top:64,left:0,right:0,backgroundColor:"rgb(246 246 248)",boxShadow:"rgba(0, 0, 0, .1) 0px 1px 2px"},A=0===Xt.indexOf(c),D=Xt.indexOf(c)===Xt.length-1;("main"!==c||d.Name&&!f.getNameError(S))&&("storage"!==c||f.isValid())||(D=!0),x=t().createElement("div",{style:N},t().createElement("div",{style:{flex:1}},t().createElement(u.Stepper,{activeStep:Xt.indexOf(c)},t().createElement(u.Step,null,t().createElement(u.StepLabel,null,S("tab.identifier"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,S("tab.storage"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,S("tab.lifecycle"))),t().createElement(u.Step,null,t().createElement(u.StepLabel,null,S("tab.advanced")))))),R=t().createElement("div",{style:Ft(Ft({},N),{},{top:null,bottom:0,backgroundColor:"white",boxShadow:"rgba(0, 0, 0, .1) 0px -1px 2px"})},t().createElement("span",{style:{flex:1}}),t().createElement(u.FlatButton,{primary:!0,label:S("tab.button-back"),onClick:function(){return n.stepperBack()},disabled:A}),t().createElement(u.FlatButton,{primary:!0,label:S("tab.button-next"),onClick:function(){return n.stepperNext()},disabled:D}),t().createElement("div",{style:{width:1,height:40,backgroundColor:"#efefef",margin:"0 5px"}}),t().createElement(u.FlatButton,{primary:!0,label:S("tab.button-create"),onClick:function(){return n.saveSource()},disabled:!f.isValid()}))}var M=t().createElement(u.Dialog,{open:h,title:S("enc.warning"),onRequestClose:function(){n.setState({showDialog:!1,dialogTargetValue:null})},actions:[t().createElement(u.FlatButton,{label:i.MessageHash[54],onClick:function(){n.setState({showDialog:!1,dialogTargetValue:null})}}),t().createElement(u.FlatButton,{label:S("enc.validate"),disabled:"enableEncryptionWithCreate"===h&&!b,onClick:function(){n.confirmEncryption(g)}})]},("enableEncryption"===h||"enableEncryptionWithCreate"===h)&&t().createElement("div",{style:{lineHeight:"1.6em"}},S("enc.dialog.enable.1"),"",S("enc.dialog.enable.2")," ",t().createElement("b",{style:{fontWeight:500}},S("enc.dialog.enable.2bold")),t().createElement("br",null),S("enc.dialog.enable.3"),"enableEncryptionWithCreate"===h&&t().createElement("div",null,t().createElement(Gt,{hintText:S("enc.dialog.enable.create"),fullWidth:!0,variant:"v2",value:b,onChange:function(e,t){n.setState({newKeyName:t})}}))),"disableEncryption"===h&&t().createElement("div",{style:{lineHeight:"1.6em"}},S("enc.dialog.disable"))),L=t().createElement(u.Paper,{zDepth:0,style:T(C.section,"main")},t().createElement("div",{style:Ft(Ft({},C.title),{},{marginBottom:16})},S("options")),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("options.id")+" *",disabled:!p,value:d.Name,onChange:function(e,t){d.Name=t},errorText:f.getNameError(S)})),_=t().createElement(u.Paper,{zDepth:0,style:T(Ft(Ft({},C.section),{},{padding:0,marginBottom:p?200:null}),p?"storage":"main")},t().createElement(Pt,{disabled:!p,value:d.StorageType,onChange:function(e,t,n){d.StorageType=n},values:j}),"LOCAL"===d.StorageType&&t().createElement("div",{style:C.storageSection},t().createElement("div",{style:C.legend},S("storage.legend.fs")),t().createElement(yt,{model:d,pydio:this.props.pydio,styles:C}),!d.FlatStorage&&t().createElement("div",null,t().createElement(u.Checkbox,It({labelPosition:"right",label:S("storage.fs.macos"),checked:"true"===O.normalize,onCheck:function(e,t){O.normalize=t?"true":"false"}},$t.toggleFieldV2)))),"S3"===d.StorageType&&t().createElement("div",{style:C.storageSection},t().createElement("div",{style:C.legend},S("storage.legend.s3")),t().createElement(Qt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.endpoint.type"),value:v,onChange:function(e,t,r){n.toggleS3Custom(r)}},t().createElement(u.MenuItem,{value:"aws",primaryText:S("storage.s3.endpoint.amazon")}),t().createElement(u.MenuItem,{value:"minio",primaryText:S("storage.s3.endpoint.minio")}),t().createElement(u.MenuItem,{value:"custom",primaryText:S("storage.s3.endpoint.custom")})),("custom"===v||"minio"===v)&&t().createElement("div",null,t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.endpoint")+" - "+S("storage.s3.endpoint.hint"),value:d.StorageConfiguration.customEndpoint,onChange:function(e,t){d.StorageConfiguration.customEndpoint=t}}),t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:3,marginRight:5}},t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.region"),value:d.StorageConfiguration.customRegion,onChange:function(e,t){d.StorageConfiguration.customRegion=t}})),t().createElement("div",{style:{flex:1}},t().createElement(Qt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.signatureVersion"),value:d.StorageConfiguration.signatureVersion,onChange:function(e,t,n){d.StorageConfiguration.signatureVersion=n}},t().createElement(u.MenuItem,{value:"v4",primaryText:"v4"}),t().createElement(u.MenuItem,{value:"v2",primaryText:"v2"}))))),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.api")+" *",value:d.ApiKey,onChange:function(e,t){d.ApiKey=t}}),t().createElement("form",{autoComplete:"off"},t().createElement("input",{type:"hidden",value:"something"}),t().createElement(Gt,{autoComplete:"off",fullWidth:!0,variant:"v2",type:"password",hintText:S("storage.s3.secret")+" *",value:d.ApiSecret,onChange:function(e,t){d.ApiSecret=t}})),t().createElement(Lt,{dataSource:d,hintText:S("storage.s3.bucket")}),d.ObjectsBucket&&t().createElement("div",{style:{paddingTop:20}},t().createElement("div",{style:Ft({},C.subLegend)},S("storage.s3.legend.bucketPathPrefix")),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.bucketPathPrefix"),value:d.ObjectsBaseFolder||"",onChange:function(e,t){d.ObjectsBaseFolder=t}})),(d.ObjectsBucket||d.StorageConfiguration.bucketsRegexp)&&t().createElement(t().Fragment,null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.s3.legend.storageClass")),t().createElement("div",null,t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.storageClass"),value:d.StorageConfiguration.storageClass||"",onChange:function(e,t){d.StorageConfiguration.storageClass=t}}))),d.StorageConfiguration.bucketsRegexp&&!d.ObjectsBucket&&t().createElement(t().Fragment,null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.s3.legend.tags")),t().createElement("div",null,t().createElement(Gt,{fullWidth:!0,variant:"v2",disabled:!!d.ObjectsBucket,hintText:S("storage.s3.bucketsTags"),value:d.StorageConfiguration.bucketsTags||"",onChange:function(e,t){d.StorageConfiguration.bucketsTags=t}})))),"AZURE"===d.StorageType&&t().createElement("div",{style:C.storageSection},t().createElement("div",{style:C.legend},S("storage.legend.azure")),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.azure.bucket")+" *",value:d.ObjectsBucket,onChange:function(e,t){d.ObjectsBucket=t}}),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.azure.api")+" *",value:d.ApiKey,onChange:function(e,t){d.ApiKey=t}}),t().createElement(Gt,{fullWidth:!0,variant:"v2",type:"password",hintText:S("storage.azure.secret")+" *",value:d.ApiSecret,onChange:function(e,t){d.ApiSecret=t}})),"GCS"===d.StorageType&&t().createElement("div",{style:C.storageSection},t().createElement("div",{style:C.legend},S("storage.legend.gcs")),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.gcs.bucket")+" *",value:d.ObjectsBucket,onChange:function(e,t){d.ObjectsBucket=t}}),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.gcs.credentials")+" *",value:d.StorageConfiguration.jsonCredentials,onChange:function(e,t){d.StorageConfiguration.jsonCredentials=t},multiLine:!0}),t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("storage.s3.path"),value:d.ObjectsBaseFolder,onChange:function(e,t){d.ObjectsBaseFolder=t}}))),I=t().createElement(u.Paper,{zDepth:0,style:T(C.section,"data")},t().createElement("div",{style:C.title},S("datamanagement")),!d.StorageConfiguration.cellsInternal&&t().createElement(e.Fragment,null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.versioning")),t().createElement(Qt,{fullWidth:!0,variant:"v2",hintText:S("versioning"),value:d.VersioningPolicyName,onChange:function(e,t,n){d.VersioningPolicyName=n}},t().createElement(u.MenuItem,{value:void 0,primaryText:S("versioning.disabled")}),m.map((function(e){return t().createElement(u.MenuItem,{value:e.Uuid,primaryText:e.Name+" (stored in "+e.VersionsDataSourceName+")"})})))),t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.encryption")),t().createElement(Qt,{fullWidth:!0,variant:"v2",hintText:S("enc.key"),value:"MASTER"===d.EncryptionMode?d.EncryptionKey:"VALUE_CLEAR",onChange:function(e,t,r){n.toggleEncryption(r)}},t().createElement(u.MenuItem,{value:"VALUE_CLEAR",primaryText:S("enc.key.clear")}),y.map((function(e){return t().createElement(u.MenuItem,{value:e.ID,primaryText:e.Label})})),"MASTER"!==d.EncryptionMode&&0===y.length&&t().createElement(u.MenuItem,{value:"VALUE_CREATE",primaryText:S("enc.key.create")}))),B=t().createElement(u.Paper,{zDepth:0,style:T(C.section,"advanced")},t().createElement("div",{style:C.title},S("tab.advanced")),!d.StorageConfiguration.cellsInternal&&t().createElement("div",null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.flatStorage")),t().createElement(u.Checkbox,It({label:S("storage.flatStorage"),labelPosition:"right",disabled:!p,checked:!d.FlatStorage,onCheck:function(e,t){d.FlatStorage=!t}},$t.toggleFieldV2)),p&&d.FlatStorage&&t().createElement(Gt,{fullWidth:!0,variant:"v2",hintText:S("initFlatFromSnapshot"),value:d.StorageConfiguration.initFromSnapshot||"",onChange:function(e,t){t?d.StorageConfiguration.initFromSnapshot=t:delete d.StorageConfiguration.initFromSnapshot}}),d.FlatStorage&&(p||d.StorageConfiguration.foldersShardingPattern)&&t().createElement(Gt,{fullWidth:!0,variant:"v2",disabled:!p,hintText:S("foldersShardingPattern"),value:d.StorageConfiguration.foldersShardingPattern||"",onChange:function(e,t){t?d.StorageConfiguration.foldersShardingPattern=t:delete d.StorageConfiguration.foldersShardingPattern}})),!d.FlatStorage&&t().createElement("div",null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.skipResync")),t().createElement(u.Checkbox,It({label:S("storage.skipResync"),labelPosition:"right",checked:d.SkipSyncOnRestart,onCheck:function(e,t){d.SkipSyncOnRestart=t}},$t.toggleFieldV2))),"LOCAL"!==d.StorageType&&t().createElement("div",null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.readOnly")),t().createElement(u.Checkbox,It({label:S("storage.readOnly"),labelPosition:"right",checked:"true"===d.StorageConfiguration.readOnly,onCheck:function(e,t){d.StorageConfiguration.readOnly=t?"true":""}},$t.toggleFieldV2))),(!d.StorageConfiguration.readOnly||"true"!==d.StorageConfiguration.readOnly)&&t().createElement("div",null,t().createElement("div",{style:Ft(Ft({},C.subLegend),{},{paddingTop:20})},S("storage.legend.checksumMapper")),t().createElement(u.Checkbox,It({label:S("storage.nativeEtags"),labelPosition:"right",checked:d.StorageConfiguration.nativeEtags,onCheck:function(e,t){d.StorageConfiguration.nativeEtags=t?"true":""}},$t.toggleFieldV2)),!d.StorageConfiguration.nativeEtags&&t().createElement("div",null,t().createElement(u.Checkbox,It({label:S("storage.checksumMapper"),labelPosition:"right",checked:"dao"===d.StorageConfiguration.checksumMapper,onCheck:function(e,t){d.StorageConfiguration.checksumMapper=t?"dao":""}},$t.toggleFieldV2)))));return t().createElement(zt,{title:E,titleLeftIcon:"mdi mdi-database",titleActionBar:w,closeAction:this.props.closeEditor,leftNavItems:p?null:[{label:S("tab.main"),value:"main",icon:"mdi mdi-database-plus"},{label:S("tab.lifecycle"),value:"data",icon:"mdi mdi-recycle"},{label:S("tab.advanced"),value:"advanced",icon:"mdi mdi-settings"}],leftNavSelected:c,leftNavChange:function(e){n.setState({currentPane:e})},className:"workspace-editor",contentFill:!1,rightPanelStyle:p?{paddingTop:64}:null},x,M,_,L,I,B,R)}}],o&&Kt(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function en(e){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},en(e)}function tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==en(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==en(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===en(o)?o:String(o)),r)}var o}function nn(e,t){return nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nn(e,t)}function rn(e){return rn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},rn(e)}Zt.contextTypes={messages:l().object,getMessage:l().func},Zt=(0,f.muiThemeable)()(Zt);var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nn(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rn(o);if(i){var n=rn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===en(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),a.apply(this,arguments)}return n=l,(r=[{key:"render",value:function(){var e=this.props,n=e.policy,r=e.rendering,o=e.pydio,i=function(e){return o.MessageHash["ajxp_admin.versions.period."+e]||e},a=n.KeepPeriods,l=void 0===a?[]:a,s=n.NodeDeletedStrategy;if("short"===r){var c;if(1===l.length){var d=l[0];c=-1===d.MaxNumber?i("keep-all.always"):i("keep-n").replace("%s",d.MaxNumber)}else{c=i("retentions-n").replace("%s",l.length);var p=l[l.length-1];0===p.MaxNumber||void 0===p.MaxNumber?c+=" | "+i("remove-all-after").replace("%s",p.IntervalStart):c+=" | "+i("keep-n-after").replace("%1",p.MaxNumber).replace("%2",p.IntervalStart)}return t().createElement("span",null,c)}var f,y=l.map((function(e){var n,r=e.MaxNumber,o=t().createElement(u.FontIcon,{className:"mdi mdi-ray-start-arrow"}),a={};return void 0===e.IntervalStart||"0"===e.IntervalStart?o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-start"}):n=t().createElement("span",{style:{fontWeight:500,fontSize:16}},e.IntervalStart,""),-1===e.MaxNumber?r=i("keep-all"):e.MaxNumber?r=i("max-n").replace("%s",r):(r=i("remove-all"),o=t().createElement(u.FontIcon,{className:"mdi mdi-clock-end",style:{color:"#c62828"}}),a={color:"#c62828"}),t().createElement(u.Step,null,t().createElement(u.StepLabel,{icon:o,style:a},n,r))})),m={color:"#c62828",fontWeight:500,fontSize:16};switch(s){case"KeepLast":f="Backup last";break;case"KeepAll":default:m.color=null,f="Backup all";break;case"KeepNone":f="Clean all"}return y.push(t().createElement(u.Step,null,t().createElement(u.StepLabel,{style:m,icon:t().createElement(u.FontIcon,{className:"mdi mdi-delete",style:m})},f))),t().createElement(u.Stepper,{activeStep:l.length-1,linear:!1},y)}}])&&tn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function ln(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sn(e,t,n){return(t=un(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,un(r.key),r)}}function un(e){var t=function(e,t){if("object"!==an(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==an(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===an(t)?t:String(t)}function dn(e,t){return dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dn(e,t)}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}var fn=c().requireLib("form"),yn=AdminComponents,mn=yn.PaperEditorLayout,hn=yn.AdminStyles,gn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dn(e,t)}(s,e);var n,r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pn(i);if(a){var n=pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===an(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dirty:!1,policy:e.versionPolicy,loaded:!0,valid:!0,parameters:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.versions.editor."+t]||t}},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){this.state.policy!==e.versionPolicy&&this.setState({policy:e.versionPolicy})}},{key:"componentDidMount",value:function(){var e=this;m().getRestClient().callApi("/config/discovery/forms/{ServiceName}","GET",{ServiceName:"pydio.grpc.versions"},{},{},{},null,[],["application/json"],["application/json"],"String").then((function(t){var n=t.data,r=p().parseXml(n);e.setState({parameters:fn.Manager.parseParameters(r,"//param"),loaded:!0})}))}},{key:"resetForm",value:function(){this.setState({valid:!0,dirty:!1,saveValue:null})}},{key:"deleteSource",value:function(){var e=this,t=this.state,n=t.m,r=t.policy;this.props.pydio.UI.openConfirmDialog({message:n("delete.confirm"),destructive:[r.Label],validCallback:function(){ve().loadClass("EnterpriseSDK").then((function(t){new t.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(r.Uuid).then((function(t){e.props.closeEditor()}))}))}})}},{key:"saveSource",value:function(){var e=this;if(this.state.saveValue){var t=this.state.saveValue;ve().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).putVersioningPolicy(t.Uuid,t).then((function(){e.props.reloadList(),e.setState({dirty:!1,policy:t,saveValue:null})}))}))}}},{key:"onFormChange",value:function(e){var t=this.state.m,n=s.valuesToTreeVersioningPolicy(e),r=n.KeepPeriods||[],o=r.findIndex((function(e){return 0===e.MaxNumber}));if(o>-1&&o<r.length-1){pydio.UI.displayMessage("ERROR",t("error.lastdelete"));for(var i=r.length-1-o;i>0;)r.pop(),i--}n.KeepPeriods=r,this.setState({saveValue:n,dirty:!0})}},{key:"updateValidStatus",value:function(e){}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.create,i=r.readonly,a=r.pydio,l=r.muiTheme,c=r.internalSources,d=this.state,p=d.loaded,f=d.policy,y=d.saveValue,m=d.m,h=this.state.parameters,g=l.palette,b=hn(g);if(h&&p){c&&(h=h.map((function(e){return"VersionsDataSourceName"===e.name&&(e.choices+=","+c.map((function(e){return e+"|DataSource "+e})).join(",")),e})));var v=s.TreeVersioningPolicyToValues(f);y&&(v=s.TreeVersioningPolicyToValues(y)),e=t().createElement(fn.FormPanel,{parameters:h,values:v,className:"full-width",onChange:this.onFormChange.bind(this),onValidStatusChange:this.updateValidStatus.bind(this),disabled:i,depth:-2,variant:"v2"})}var S=[];i||(o||(S.push(mn.actionButton(m("delete"),"mdi mdi-delete",(function(){n.deleteSource()}))),S.push(mn.actionButton(a.MessageHash["ajxp_admin.plugins.6"],"mdi mdi-undo",(function(){n.resetForm()}),!this.state.dirty))),S.push(mn.actionButton(a.MessageHash[53],"mdi mdi-content-save",(function(){n.saveSource()}),!this.state.valid||!this.state.dirty)));var w=y?y.Name:f.Name;return w||(w=""),t().createElement(mn,{title:p&&h?m("title").replace("%s",w):a.MessageHash["ajxp_admin.loading"],titleLeftIcon:"mdi mdi-clock-start",titleActionBar:S,closeAction:this.props.closeEditor,className:"workspace-editor",contentFill:!0},t().createElement(u.Paper,{zDepth:0,style:{backgroundColor:b.body.block.header.backgroundColor,padding:"0px 20px",height:64,display:"flex",alignItems:"center"}},t().createElement("div",{style:{overflowX:"auto",width:"100%"}},t().createElement(on,{pydio:a,policy:y||f}))),e,b.formSimpleCss())}}],o=[{key:"valuesToTreeVersioningPolicy",value:function(e){for(var t=[],n="IntervalStart",r="MaxNumber",o=n,i=r,a=0;void 0!==e[o]&&void 0!==e[i];){var l=new S.TreeVersioningKeepPeriod;l.IntervalStart=e[o],l.MaxNumber=e[i],t.push(l),delete e[i],delete e[o],o=n+"_"+ ++a,i=r+"_"+a}return e.KeepPeriods=t,S.TreeVersioningPolicy.constructFromObject(e)}},{key:"TreeVersioningPolicyToValues",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ln(Object(n),!0).forEach((function(t){sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ln(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if(t.KeepPeriods){var n=0;t.KeepPeriods.map((function(e){n>0?(t["IntervalStart_"+n]=e.IntervalStart||0,t["MaxNumber_"+n]=e.MaxNumber||0):(t.IntervalStart=e.IntervalStart||0,t.MaxNumber=e.MaxNumber||0),n++}))}return t.NodeDeletedStrategy||(t.NodeDeletedStrategy="KeepAll"),t}}],r&&cn(n.prototype,r),o&&cn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);gn=(0,f.muiThemeable)()(gn);var bn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),vn=new Uint8Array(16);function Sn(){if(!bn)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return bn(vn)}for(var wn=[],En=0;En<256;++En)wn[En]=(En+256).toString(16).substr(1);const On=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||Sn)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[r+i]=o[i];return t||function(e,t){var n=t||0,r=wn;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(o)};function kn(e){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(e)}function Cn(){return Cn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cn.apply(this,arguments)}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==kn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===kn(o)?o:String(o)),r)}var o}function jn(e,t){return jn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jn(e,t)}function xn(e){return xn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xn(e)}var Rn=c().requireLib("components").MaterialTable,Tn=c().requireLib("hoc").ModernTextField;const Nn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jn(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=xn(o);if(i){var n=xn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===kn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={keys:[],showDialog:!1,showExportKey:null,exportedKey:null,showCreateKey:null,showImportKey:null,m:function(t){return e.pydio.MessageHash["ajxp_admin.ds.encryption."+t]||t}},t}return n=l,(r=[{key:"load",value:function(){var e=this;new S.ConfigServiceApi(m().getRestClient()).listEncryptionKeys(new S.EncryptionAdminListKeysRequest).then((function(t){e.setState({keys:t.Keys||[]})}))}},{key:"componentDidMount",value:function(){this.load()}},{key:"exportKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=new S.EncryptionAdminExportKeyRequest;o.KeyID=this.state.showExportKey,o.StrPassword=this.refs["key-password-field"].getValue(),this.refs["key-password-confirm"].getValue()===o.StrPassword?r.exportEncryptionKey(o).then((function(t){e.setState({exportedKey:t.Key,showExportKey:null},(function(){e.timeout=setTimeout((function(){e.setState({exportedKey:"",showDialog:!1})}),1e4)})),e.setState({showExportKey:null})})).catch((function(r){t.UI.displayMessage("ERROR",n("key.export.fail")+" : "+r.message),e.setState({showExportKey:null})})):t.UI.displayMessage("ERROR","Warning, passwords differ!")}},{key:"createKey",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=new S.EncryptionAdminCreateKeyRequest;n.KeyID=this.refs.createKeyId.getValue(),n.Label=this.refs.createKeyLabel.getValue(),t.createEncryptionKey(n).then((function(t){e.load(),e.setState({showDialog:!1})})).catch((function(){e.setState({showDialog:!1})}))}},{key:"deleteKey",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("key.delete.warning"),destructive:[e],validCallback:function(){var n=new S.ConfigServiceApi(m().getRestClient()),r=new S.EncryptionAdminDeleteKeyRequest;r.KeyID=e,n.deleteEncryptionKey(r).then((function(e){t.load()}))}})}},{key:"importKey",value:function(){var e=this,t=this.props.pydio,n=this.state.m,r=new S.ConfigServiceApi(m().getRestClient()),o=this.state.showImportKey,i=!0;o.ID||((o=new S.EncryptionKey).ID=this.refs["key-import-id"].getValue(),o.Label=this.refs["key-import-label"].getValue(),i=!1),o.Content=this.refs["key-imported-field"].getValue();var a=new S.EncryptionAdminImportKeyRequest;a.StrPassword=this.refs["key-password-field"].getValue(),a.Key=o,a.Override=i,r.importEncryptionKey(a).then((function(r){r.Success?t.UI.displayMessage("SUCCESS",n("key.import.success")):t.UI.displayMessage("ERROR",n("key.import.fail")),e.load(),e.setState({showImportKey:!1,showDialog:!1})})).catch((function(){e.setState({showImportKey:!1,showDialog:!1})}))}},{key:"render",value:function(){var e=this,n=this.state,r=n.keys,o=n.showDialog,i=n.showImportKey,a=n.showExportKey,l=n.exportedKey,s=n.showCreateKey,c=n.m,d=this.props,p=d.pydio,f=d.accessByName,y=d.adminStyles,m=[{name:"Label",label:c("key.label"),style:{width:"30%",fontSize:15},headerStyle:{width:"30%"},sorter:{type:"string",default:!0}},{name:"ID",label:c("key.id"),hideSmall:!0,sorter:{type:"string"}},{name:"Owner",label:c("key.owner"),hideSmall:!0,sorter:{type:"string"}},{name:"CreationDate",label:c("key.created"),hideSmall:!0,useMoment:!0,sorter:{type:"number"}}],h=[];f("CreateEncryption")&&h.push({iconClassName:"mdi mdi-import",tooltip:c("key.import"),onClick:function(t){e.setState({showDialog:!0,showImportKey:t})}},{iconClassName:"mdi mdi-export",tooltip:c("key.export"),onClick:function(t){e.setState({showDialog:!0,showExportKey:t.ID})}},{iconClassName:"mdi mdi-delete",tooltip:c("key.delete"),onClick:function(t){e.deleteKey(t.ID)}});var g,b,v=[];a||l?(b=c("key.export"),l?(g=t().createElement(Tn,{value:l.Content,fullWidth:!0,floatingLabelText:c("key.export.result.copy"),multiLine:!0,ref:"key-imported-field"}),v=[t().createElement(u.FlatButton,{label:"Close",onClick:function(){clearTimeout(e.timeout),e.setState({showExportKey:null,exportedKey:"",showDialog:!1})}})]):(g=t().createElement("div",null,t().createElement(Tn,{floatingLabelText:c("key.export.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(Tn,{floatingLabelText:c("key.export.confirm"),ref:"key-password-confirm",type:"password",fullWidth:!0})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showExportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.export"),primary:!0,onClick:function(){e.exportKey()}})])):i?(b=c("key.import"),g=t().createElement("div",null,!i.ID&&t().createElement("div",null,t().createElement(Tn,{floatingLabelText:c("key.import.id"),ref:"key-import-id",fullWidth:!0}),t().createElement(Tn,{floatingLabelText:c("key.import.label"),ref:"key-import-label",fullWidth:!0})),t().createElement(Tn,{floatingLabelText:c("key.import.password"),ref:"key-password-field",type:"password",fullWidth:!0}),t().createElement(Tn,{fullWidth:!0,floatingLabelText:c("key.import.content"),multiLine:!0,ref:"key-imported-field"})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showImportKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.import"),primary:!0,onClick:function(){e.importKey()}})]):s&&(b="Create a Key",g=t().createElement("div",null,t().createElement(Tn,{floatingLabelText:c("key.import.id"),ref:"createKeyId",fullWidth:!0}),t().createElement(Tn,{floatingLabelText:c("key.import.label"),ref:"createKeyLabel",fullWidth:!0})),v=[t().createElement(u.FlatButton,{label:p.MessageHash[54],onClick:function(){e.setState({showCreateKey:null,showDialog:!1})}}),t().createElement(u.FlatButton,{label:c("key.create"),primary:!0,onClick:function(){e.createKey()}})]);var S=AdminComponents.AdminStyles().body,w=S.tableMaster,E=S.block.props,O=S.block.container;return t().createElement("div",null,t().createElement(u.Dialog,{title:b,open:o,onRequestClose:function(){e.setState({showDialog:!1,showExportKey:null,showImportKey:null,showCreateKey:!1})},modal:!0,actions:v,contentStyle:{maxWidth:340}},g),t().createElement(u.Paper,Cn({},E,{style:O}),t().createElement(Rn,{data:r,columns:m,actions:h,onSelectRows:function(){},showCheckboxes:!1,emptyStateString:c("key.emptyState"),masterStyles:w,storageKey:"console.encryption-keys.list"})),f("CreateEncryption")&&t().createElement("div",{style:{textAlign:"right",paddingRight:24,paddingBottom:24}},t().createElement(u.FlatButton,Cn({primary:!0,label:c("key.import"),onClick:function(){e.setState({showImportKey:{},showDialog:!0})}},y.props.header.flatButton)),t().createElement("span",{style:{marginLeft:8}},t().createElement(u.FlatButton,Cn({primary:!0,label:c("key.create"),onClick:function(){e.setState({showCreateKey:!0,showDialog:!0})}},y.props.header.flatButton)))))}}])&&Pn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function An(e){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},An(e)}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==An(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==An(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===An(o)?o:String(o)),r)}var o}function Mn(e,t){return Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mn(e,t)}function Ln(e){return Ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ln(e)}const _n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mn(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ln(o);if(i){var n=Ln(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===An(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={value:"flat"},t}return n=l,(r=[{key:"componentWillReceiveProps",value:function(e,t){e.open&&!this.props.open&&this.setState({value:"flat"})}},{key:"submit",value:function(){var e=this.props,t=e.onSubmit,n=e.onRequestClose;t(this.state.value),n()}},{key:"render",value:function(){var e=this,n=this.props,r=n.open,o=n.onRequestClose,i=this.state.value,a=function(e){return c().getMessages()["ajxp_admin.ds.format-picker."+e]||e},l=function(e){var n=t().createElement("div",null,t().createElement("div",null,a(e+".title")),t().createElement("div",{style:{opacity:.67,margin:"5px 0 10px"}},a(e+".legend")));return t().createElement(u.RadioButton,{value:e,label:n})},s=[t().createElement(u.FlatButton,{label:c().getMessages()[54],onClick:function(){o()},primary:!0}),t().createElement(u.FlatButton,{label:a("submit"),primary:!0,onClick:function(){return e.submit()}})];return t().createElement(u.Dialog,{open:r,title:a("title"),onRequestClose:o,actions:s},t().createElement("div",{style:{marginBottom:20}},a("legend")),t().createElement(u.RadioButtonGroup,{valueSelected:i,onChange:function(t,n){return e.setState({value:n})}},l("flat"),l("structured"),l("internal")))}}])&&Dn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);function In(e){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(e)}function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(n),!0).forEach((function(t){Vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vn(e,t,n){return(t=Un(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kn(){return Kn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Kn.apply(this,arguments)}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Un(r.key),r)}}function Un(e){var t=function(e,t){if("object"!==In(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==In(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===In(t)?t:String(t)}function qn(e,t){return qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},qn(e,t)}function Hn(e){return Hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Hn(e)}var zn=c().requireLib("components").MaterialTable,Jn=c().requireLib("boot"),Yn=Jn.JobsStore,Gn=Jn.moment,Qn=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qn(e,t)}(s,n);var r,o,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Hn(i);if(a){var n=Hn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===In(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={dataSources:[],resyncJobs:{},versioningPolicies:[],dsLoaded:!1,versionsLoaded:!1,showExportKey:!1,exportedKey:null,showImportKey:!1,importResult:null,keyOperationError:null,startedServices:[],peerAddresses:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.ds."+t]||t}},t}return r=s,o=[{key:"componentDidMount",value:function(){var e=this,t=new S.ConfigServiceApi(m().getRestClient()),n=this.props.pydio;this.statusPoller=setInterval((function(){n.WebSocketClient.getStatus()&&(De.loadStatuses().then((function(t){e.setState({startedServices:t.Services||[]})})),t.listPeersAddresses().then((function(t){e.setState({peerAddresses:t.PeerAddresses||[]})})))}),2500),setTimeout((function(){e.syncPoller=setInterval((function(){n.WebSocketClient.getStatus()&&e.syncStatuses()}),2500)}),1250),this.load()}},{key:"componentWillUnmount",value:function(){clearInterval(this.statusPoller),clearInterval(this.syncPoller)}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setState({dsLoaded:!1,versionsLoaded:!1,newDsName:t}),De.loadDatasources().then((function(t){e.setState({dataSources:t.DataSources||[],dsLoaded:!0},(function(){e.syncStatuses()}))})),De.loadVersioningPolicies().then((function(t){e.setState({versioningPolicies:t.Policies||[],versionsLoaded:!0})})),De.loadStatuses().then((function(t){e.setState({startedServices:t.Services})})),this.refs&&this.refs.encKeys&&this.refs.encKeys.load()}},{key:"syncStatuses",value:function(){var e=this,t=this.state.dataSources,n=void 0===t?[]:t;n.length&&Yn.getInstance().getAdminJobs(null,null,n.map((function(e){return"resync-ds-"+e.Name})),1).then((function(t){var n={};(t.Jobs||[]).forEach((function(e){e.Tasks&&e.Tasks.length&&(n[e.ID.replace("resync-ds-","")]=e)})),e.setState({resyncJobs:n})}))}},{key:"closeEditor",value:function(){this.props.closeRightPane()}},{key:"openDataSource",value:function(e){if(e.length){var t=e[0],n=this.props,r=n.openRightPane,o=n.accessByName,i=n.pydio,a=n.storageTypes;r({COMPONENT:Zt,PROPS:{ref:"editor",pydio:i,dataSource:t,storageTypes:a,readonly:!o("CreateDatasource"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"makeStatusLabel",value:function(e,n){switch(e){case"error":return t().createElement("span",{style:{color:"#e53935"}},t().createElement("span",{className:"mdi mdi-alert"})," ",n);case"running":return t().createElement("span",{style:{color:"#ef6c00"}},t().createElement("span",{className:"mdi mdi-timer-sand"})," ",n);default:return t().createElement("span",{style:{color:"#1b5e20"}},t().createElement("span",{className:"mdi mdi-check"})," ",n)}}},{key:"computeStatus",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&e.Disabled)return-1;var r,o,i,a=this.state,l=a.startedServices,s=void 0===l?[]:l,c=a.peerAddresses,u=void 0===c?[]:c,d=a.m,p=a.newDsName;if(!s.length)return d("status.na");if(s.map((function(t){t.Name==="pydio.grpc.data.sync."+e.Name&&"STARTED"===t.Status?o=!0:t.Name==="pydio.grpc.data.index."+e.Name&&"STARTED"===t.Status?r=!0:t.Name==="pydio.grpc.data.objects."+e.ObjectsServiceName&&"STARTED"===t.Status&&(i=!0)})),r&&o&&i)return p&&e.Name===p&&setTimeout((function(){t.setState({newDsName:null})}),100),n?0:this.makeStatusLabel("ok",d("status.ok"));if(p&&e.Name===p)return n?1:this.makeStatusLabel("running",d("status.starting"));if(r||o||i){var f=[];return r||f.push(d("status.index")),o||f.push(d("status.sync")),i||f.push(d("status.object")),n?3:this.makeStatusLabel("error",f.join(" - "))}var y=d("status.ko");return u&&-1===u.indexOf(e.PeerAddress)&&(y=d("status.ko-peers").replace("%s",e.PeerAddress)),n?2:this.makeStatusLabel("error",y)}},{key:"computeJobStatus",value:function(e){var t=e.Tasks[0];switch(t.Status){case"Finished":return this.makeStatusLabel("ok",Gn(new Date(1e3*parseInt(t.EndTime))).fromNow());case"Running":return this.makeStatusLabel("running",t.StatusMessage||"Running...");case"Error":return this.makeStatusLabel("error",t.StatusMessage);case"Queued":return this.makeStatusLabel("running",t.StatusMessage)}return this.makeStatusLabel("ok",t.StatusMessage)}},{key:"openVersionPolicy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e||e.length){var n,r=!1;if(void 0===e){r=!0,(n=new S.TreeVersioningPolicy).Uuid=On(),n.VersionsDataSourceName="versions",n.NodeDeletedStrategy="KeepAll";var o=new S.TreeVersioningKeepPeriod;o.IntervalStart="0",o.MaxNumber=-1,n.KeepPeriods=[o]}else n=e[0],t&&(r=!0,(n=S.TreeVersioningPolicy.constructFromObject(JSON.parse(JSON.stringify(n)))).Uuid=On(),n.Name+=" (Copy)");var i=this.props,a=i.openRightPane,l=i.pydio,s=i.versioningReadonly,c=i.accessByName,u=this.state.dataSources;a({COMPONENT:gn,PROPS:{ref:"editor",versionPolicy:n,create:r,pydio:l,internalSources:u.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal})).map((function(e){return e.Name})),readonly:s||!c("CreateVersioning"),closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}}},{key:"deleteVersionPolicy",value:function(e){var t=this,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.versions.editor.delete.confirm"],destructive:[e.Name],validCallback:function(){ve().loadClass("EnterpriseSDK").then((function(n){new n.EnterpriseConfigServiceApi(m().getRestClient()).deleteVersioningPolicy(e.Uuid).then((function(e){t.load()}))}))}})}},{key:"createDataSource",value:function(e){var t=this.props,n=t.pydio,r=t.storageTypes,o=this.state.dataSources;this.props.openRightPane({COMPONENT:Zt,PROPS:{ref:"editor",create:!0,createStructure:e,existingNames:o.map((function(e){return e.Name})),pydio:n,storageTypes:r,closeEditor:this.closeEditor.bind(this),reloadList:this.load.bind(this)}})}},{key:"resyncDataSource",value:function(e,t,n){e.UI.openConfirmDialog({message:t("editor.legend.resync"),skipNext:"datasource.resync.confirm",validCallback:function(){new De(n).resyncSource()}})}},{key:"deleteDataSource",value:function(e,t,n){var r=this;e.UI.openConfirmDialog({message:t("editor.delete.warning"),validCallback:function(){new De(n).deleteSource().then((function(){r.load()}))},destructive:[n.Name]})}},{key:"createWorkspaceFromDatasource",value:function(e,t,n){var r=new C,o=r.getModel(),i=n.Name;o.Label=i,o.Description="Root of "+i,o.Slug=i,o.Attributes.DEFAULT_RIGHTS="";var a={Uuid:"DATASOURCE:"+i,Path:i};o.RootNodes[a.Uuid]=a,e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitle:t("board.wsfromds.title"),legendId:t("board.wsfromds.legend").replace("%s",i),fieldLabelId:t("board.wsfromds.field"),defaultValue:t("board.wsfromds.defaultPrefix").replace("%s",i),submitValue:function(t){o.Label=t,r.save().then((function(){e.goTo("/data/workspaces")}))}})}},{key:"render",value:function(){var n=this,r=this.state,o=r.dataSources,i=r.resyncJobs,a=r.versioningPolicies,l=r.m,s=r.createDialog;o.sort(g().arraySorter("Name"));var c=o.filter((function(e){return!(e.StorageConfiguration&&e.StorageConfiguration.cellsInternal)})),d=o.filter((function(e){return e.StorageConfiguration&&e.StorageConfiguration.cellsInternal}));a.sort(g().arraySorter("Name"));var p=AdminComponents.AdminStyles(this.props.muiTheme.palette),f=p.body,y=f.tableMaster,m=f.block.props,h=f.block.container,b=this.props,v=b.currentNode,S=b.pydio,w=b.versioningReadonly,E=b.accessByName,O=[{name:"Name",label:l("name"),style:{fontSize:15,width:"15%"},headerStyle:{width:"15%"},sorter:{type:"string",default:!0}},{name:"StorageType",label:l("storage"),style:{width:"15%"},headerStyle:{width:"15%"},renderCell:function(e){var t="storage.fs";switch(e.StorageType){case"S3":t="storage.s3";break;case"AZURE":t="storage.azure";break;case"GCS":t="storage.gcs"}return l(t)},sorter:{type:"string"}},{name:"Status",label:l("status"),hideSmall:!0,renderCell:function(e){return e.Disabled?t().createElement("span",{style:{color:"#757575"}},t().createElement("span",{className:"mdi mdi-checkbox-blank-circle-outline"})," ",l("status.disabled")):n.computeStatus(e)},sorter:{type:"number",value:function(e){return n.computeStatus(e,!0)}}},{name:"SyncStatus",label:l("syncStatus"),hideSmall:!0,renderCell:function(e){return i&&i[e.Name]?n.computeJobStatus(i[e.Name]):"n/a"},sorter:{type:"number",value:function(e){return i&&i[e.Name]?i[e.Name].Tasks[0].EndTime:0}}},{name:"VersioningPolicyName",label:l("versioning"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,renderCell:function(e){var t=a.find((function(t){return t.Uuid===e.VersioningPolicyName}));return t?t.Name:e.VersioningPolicyName||"-"},sorter:{type:"string"}},{name:"EncryptionMode",label:l("encryption"),hideSmall:!0,style:{width:"8%",textAlign:"center"},headerStyle:{width:"8%"},renderCell:function(e){return"MASTER"===e.EncryptionMode?t().createElement("span",{className:"mdi mdi-check"}):"-"},sorter:{type:"number",value:function(e){return"MASTER"===e.EncryptionMode?1:0}}}];c.filter((function(e){return!e.FlatStorage})).length||(O=O.filter((function(e){return"SyncStatus"!==e.name})));var k=O.filter((function(e){return"VersioningPolicyName"!==e.name&&"SyncStatus"!==e.name})),C=v.getLabel(),P=v.getMetadata().get("icon_class"),j=[];E("CreateDatasource")&&j.push(t().createElement(u.FlatButton,Kn({primary:!0,label:S.MessageHash["ajxp_admin.ws.4"],onClick:function(){return n.setState({createDialog:!0})}},p.props.header.flatButton)));var x=!w&&E("CreateVersioning");x&&j.push(t().createElement(u.FlatButton,Kn({primary:!0,label:S.MessageHash["ajxp_admin.ws.4b"],onClick:function(){n.openVersionPolicy()}},p.props.header.flatButton)));var R=[{name:"Name",label:l("versioning.name"),style:{width:180,fontSize:15},headerStyle:{width:180},sorter:{type:"string",default:!0}},{name:"Description",label:l("versioning.description"),sorter:{type:"string"}},{name:"KeepPeriods",hideSmall:!0,label:l("versioning.periods"),renderCell:function(e){return t().createElement(on,{rendering:"short",policy:e,pydio:S})}},{name:"VersionsDataSourceName",style:{width:180},headerStyle:{width:180},label:l("versioning.storage"),sorter:{type:"string"},hideSmall:!0}],T=[];E("CreateDatasource")&&T.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit datasource",onClick:function(e){n.openDataSource([e])}}),T.push({iconClassName:"mdi mdi-folder-plus",tooltip:"Create workspace here",onClick:function(e){return n.createWorkspaceFromDatasource(S,l,e)}}),E("CreateDatasource")&&T.push({iconClassName:"mdi mdi-delete",tooltip:l("editor.legend.delete.button"),onClick:function(e){return n.deleteDataSource(S,l,e)}});var N=[].concat(T);c.filter((function(e){return!e.FlatStorage})).length>0&&T.push({iconClassName:"mdi mdi-sync",tooltip:l("editor.legend.resync.button"),onClick:function(e){return n.resyncDataSource(S,l,e)},disable:function(e){return e.FlatStorage}});var A=[];return A.push({iconClassName:x?"mdi mdi-pencil":"mdi mdi-eye",tooltip:x?"Edit policy":"Display policy",onClick:function(e){n.openVersionPolicy([e])}}),x&&(A.push({iconClassName:"mdi mdi-content-copy",tooltip:"Duplicate policy",onClick:function(e){return n.openVersionPolicy([e],!0)}}),A.push({iconClassName:"mdi mdi-delete",tooltip:"Delete policy",destructive:!0,onClick:function(e){return n.deleteVersionPolicy(e)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:C,icon:P,actions:j,reloadAction:this.load.bind(this),loading:!(this.state.dsLoaded&&this.state.versionsLoaded)}),t().createElement(_n,{open:s,onRequestClose:function(){n.setState({createDialog:!1})},onSubmit:function(e){n.createDataSource(e)}}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:l("board.ds.title"),legend:l("board.ds.legend")}),t().createElement(u.Paper,Kn({},m,{style:Fn({},h)}),t().createElement(zn,{data:c,columns:O,actions:T,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.datasources.list"})),d.length>0&&t().createElement(e.Fragment,null,t().createElement("div",{style:{padding:"0px 20px"}},"Internal DataSources are used to store binaries like files versions"),t().createElement(u.Paper,Kn({},m,{style:Fn({},h)}),t().createElement(zn,{data:d,columns:k,actions:N,onSelectRows:this.openDataSource.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:l("emptyState"),masterStyles:y,storageKey:"console.internalsources.list"}))),t().createElement(AdminComponents.SubHeader,{title:l("board.versioning.title"),legend:l("board.versioning.legend")}),t().createElement(u.Paper,Kn({},m,{style:Fn({},h)}),t().createElement(zn,{data:a,columns:R,actions:A,onSelectRows:this.openVersionPolicy.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:y,storageKey:"console.versioning.policies.list"})),t().createElement(AdminComponents.SubHeader,{title:l("board.enc.title"),legend:l("board.enc.legend")}),t().createElement(Nn,{pydio:S,ref:"encKeys",accessByName:E,adminStyles:p}))))}}],o&&Wn(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function $n(e){return $n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$n(e)}function Xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==$n(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==$n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===$n(o)?o:String(o)),r)}var o}Qn.propTypes={dataModel:l().instanceOf(ce()).isRequired,rootNode:l().instanceOf(de()).isRequired,currentNode:l().instanceOf(de()).isRequired,openEditor:l().func.isRequired,openRightPane:l().func.isRequired,closeRightPane:l().func.isRequired,filter:l().string,versioningReadonly:l().bool},Qn=(0,f.muiThemeable)()(Qn);var Zn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"loadNamespaces",value:function(){return new S.UserMetaServiceApi(m().getRestClient()).listUserMetaNamespace()}},{key:"putNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("PUT"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"deleteNS",value:function(t){var n=new S.UserMetaServiceApi(m().getRestClient()),r=new S.IdmUpdateUserMetaNamespaceRequest;return r.Operation=S.UpdateUserMetaNamespaceRequestUserMetaNsOp.constructFromObject("DELETE"),r.Namespaces=[t],e.clearLocalCache(),n.updateUserMetaNamespace(r)}},{key:"clearLocalCache",value:function(){try{window.ReactMeta&&ReactMeta.Renderer.getClient().clearConfigs()}catch(e){}}}],null&&Xn(t.prototype,null),n&&Xn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();Zn.MetaTypes={string:"Text",textarea:"Long Text",integer:"Number",boolean:"Boolean",date:"Date",choice:"Selection",tags:"Extensible Tags",stars_rate:"Stars Rating",css_label:"Color Labels",json:"JSON"};const er=require("pydio/util/func");var tr=n.n(er);function nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(n),!0).forEach((function(t){ir(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ir(e,t,n){return(t=ur(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ar(){return ar=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ar.apply(this,arguments)}function lr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ur(r.key),r)}}function cr(e,t,n){return t&&sr(e.prototype,t),n&&sr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ur(e){var t=function(e,t){if("object"!==mr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==mr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===mr(t)?t:String(t)}function dr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pr(e,t)}function pr(e,t){return pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pr(e,t)}function fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=yr(e);if(t){var o=yr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===mr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function yr(e){return yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yr(e)}function mr(e){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mr(e)}var hr=c().requireLib("hoc"),gr=hr.ModernTextField,br=hr.ModernStyles,vr=function(n){dr(o,n);var r=fr(o);function o(e){return lr(this,o),r.call(this,e)}return cr(o,[{key:"togglePolicies",value:function(e,t){var n=this.props,r=n.policies,o=void 0===r?[]:r,i=n.onChangePolicies,a=o.filter((function(t){return t.Action!==e}));a.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),"READ"===e&&t&&(a=a.filter((function(e){return"WRITE"!==e.Action}))).push(S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Effect:"allow",Subject:"profile:admin"})),i(a)}},{key:"render",value:function(){var n,r,o=this,i=this.props,a=i.readonly,l=i.policies,s=i.pydio,c=function(e){return s.MessageHash["ajxp_admin.metadata."+e]||e};return l&&l.map((function(e){"profile:admin"===e.Subject&&"READ"===e.Action&&(n=!0),"profile:admin"===e.Subject&&"WRITE"===e.Action&&(r=!0)})),t().createElement(e.Fragment,null,t().createElement("div",null,t().createElement(u.Toggle,ar({label:c("toggle.read"),disabled:a,labelPosition:"left",toggled:n,onToggle:function(e,t){o.togglePolicies("READ",t)}},br.toggleFieldV2))),t().createElement("div",null,t().createElement(u.Toggle,ar({label:c("toggle.write"),labelPosition:"left",disabled:n||a,toggled:r,onToggle:function(e,t){o.togglePolicies("WRITE",t)}},br.toggleFieldV2))))}}]),o}(t().Component),Sr=function(e){dr(r,e);var n=fr(r);function r(e){var t;return lr(this,r),(t=n.call(this,e)).state={namespace:t.cloneNs(e.namespace),m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]||t},selectorNewKey:"",selectorNewValue:"",PoliciesBuilder:vr},ve().loadClass("ReactMeta").then((function(e){t.setState({metaModule:e});var n=t.props.policiesBuilder;n&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var n=e.split("."),r=n.shift(),o=n.join(".");return ve().loadClass(r).then((function(n){var i=tr().getFunctionByName(o,n);if(!i){if("object"===mr(n)&&n[r]){var a=tr().getFunctionByName(o,n[r]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(n){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw n}))}(n,vr).then((function(e){return t.setState({PoliciesBuilder:e})}))})),t}return cr(r,[{key:"cloneNs",value:function(e){return S.IdmUserMetaNamespace.constructFromObject(JSON.parse(JSON.stringify(e)))}},{key:"componentWillReceiveProps",value:function(e){if(e.open!==this.props.open){var t=e.create,n=e.namespaces,r=this.cloneNs(e.namespace);t&&n.length&&(r.Order=n.map((function(e){return e.Order||0})).reduce((function(e,t){return Math.max(e,t)}),0)+1),this.setState({namespace:r})}}},{key:"save",value:function(){var e=this,t=this.state.namespace;Zn.putNS(t).then((function(){e.props.onRequestClose(),e.props.reloadList()}))}},{key:"getHideValue",value:function(){var e=this.state.namespace;try{return JSON.parse(e.JsonDefinition).hide}catch(e){return!1}}},{key:"setHideValue",value:function(e){var t=this.state.namespace,n=JSON.parse(t.JsonDefinition);t.JsonDefinition=JSON.stringify(or(or({},n),{},{hide:e})),this.setState({namespace:t})}},{key:"getAdditionalData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.state.namespace;try{var n=JSON.parse(t.JsonDefinition).data||e;if(e.items&&n.split){var r=n.split(",").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return nr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split("|"),2);return{key:t[0],value:t[1]}}));return{items:r}}return n}catch(e){}return e}},{key:"setAdditionalDataKey",value:function(e,t){var n=this.state.namespace,r=JSON.parse(n.JsonDefinition),o=ir({},e,t);r.data=or(or({},r.data),o),n.JsonDefinition=JSON.stringify(r),this.setState({namespace:n})}},{key:"togglePolicies",value:function(e,t){var n=this,r=this.state.namespace,o=(r.Policies||[]).filter((function(t){return t.Action!==e}));o.push(S.ServiceResourcePolicy.constructFromObject({Action:e,Effect:"allow",Subject:t?"profile:admin":"*"})),r.Policies=o,this.setState({namespace:r},(function(){"READ"===e&&t&&n.togglePolicies("WRITE",!0)}))}},{key:"render",value:function(){var e=this,n=this.props,r=n.create,o=n.namespaces,i=n.pydio,a=n.readonly,l=this.state,s=l.namespace,d=l.m,p=l.PoliciesBuilder,f=l.metaModule;if(!f)return null;var y,h=f.TypeEditor;y=s.Label?s.Label:d("editor.title.create");var g="string";s.JsonDefinition&&(g=JSON.parse(s.JsonDefinition).type);var b,v,w=!1;if(s.Label?s.Namespace&&"usermeta-"!==s.Namespace||(w=!0,b=d("editor.ns.error")):(w=!0,v=d("editor.label.error")),r&&o.filter((function(e){return e.Namespace===s.Namespace})).length&&(w=!0,b=d("editor.ns.exists")),"choice"===g){var E=this.getAdditionalData({items:[]}).items;E&&E.length||(w=!0)}s.Policies&&s.Policies.map((function(e){"profile:admin"===e.Subject&&e.Action,"profile:admin"===e.Subject&&e.Action}));var O=[t().createElement(u.FlatButton,{primary:!0,label:i.MessageHash[54],onClick:this.props.onRequestClose}),t().createElement(u.FlatButton,{primary:!0,disabled:w||a,label:i.MessageHash[53],onClick:function(){e.save()}})];"tags"!==g||a||O.unshift(t().createElement(u.FlatButton,{primary:!1,label:d("editor.tags.reset"),onClick:function(){new S.UserMetaServiceApi(m().getRestClient()).deleteUserMetaTags(s.Namespace,"*").then((function(){i.UI.displayMessage("SUCCESS",d("editor.tags.cleared").replace("%s",s.Namespace))})).catch((function(e){i.UI.displayMessage("ERROR",e.message)}))}}));var k={section:{marginTop:10,fontWeight:500,fontSize:12}};return t().createElement(u.Dialog,{title:y,actions:O,modal:!1,contentStyle:{width:520},open:this.props.open,onRequestClose:this.props.onRequestClose,autoScrollBodyContent:!0,bodyStyle:{padding:20}},t().createElement(h,{m:d,pydio:i,namespace:s,forcePrefix:"usermeta-",onChange:function(t){return e.setState({namespace:t})},readonly:a,create:r,labelError:v,nameError:b,styles:k}),t().createElement("div",{style:k.section},c().getInstance().MessageHash[310]),t().createElement(u.Toggle,ar({label:d("toggle.list-visibility"),disabled:a,labelPosition:"left",toggled:!this.getHideValue(),onToggle:function(t,n){e.setHideValue(!n)}},br.toggleFieldV2)),t().createElement(u.Toggle,ar({label:d("toggle.index"),disabled:a,labelPosition:"left",toggled:s.Indexable,onToggle:function(t,n){s.Indexable=n,e.setState({namespace:s})}},br.toggleFieldV2)),p&&t().createElement(p,{policies:s.Policies,readonly:a,onChangePolicies:function(t){return e.setState({namespace:or(or({},s),{},{Policies:t})})},pydio:i}),t().createElement("div",{style:k.section},d("order")),t().createElement(gr,{floatingLabelText:d("order"),value:s.Order?s.Order:"0",onChange:function(t,n){s.Order=parseInt(n),e.setState({namespace:s})},fullWidth:!0,type:"number",readOnly:a,variant:"v2"}))}}]),r}(t().Component);Sr.PropTypes={namespace:l().instanceOf(S.IdmUserMetaNamespace).isRequired,namespaces:l().arrayOf(S.IdmUserMetaNamespace),create:l().bool,reloadList:l().func,onRequestClose:l().func};const wr=Sr;function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function Or(){return Or=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Or.apply(this,arguments)}function kr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Er(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Er(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Er(o)?o:String(o)),r)}var o}function Cr(e,t){return Cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Cr(e,t)}function Pr(e){return Pr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pr(e)}var jr=n(173).muiThemeable,xr=c().requireLib("components").MaterialTable,Rr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cr(e,t)}(l,e);var n,r,o,i,a=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pr(o);if(i){var n=Pr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Er(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={loading:!1,namespaces:[],m:function(t){return e.pydio.MessageHash["ajxp_admin.metadata."+t]}},t}return n=l,(r=[{key:"componentWillMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading:!0}),Zn.loadNamespaces().then((function(t){e.setState({loading:!1,namespaces:t.Namespaces||[]})}))}},{key:"emptyNs",value:function(){var e=new S.IdmUserMetaNamespace;return e.Policies=[S.ServiceResourcePolicy.constructFromObject({Action:"READ",Subject:"*",Effect:"allow"}),S.ServiceResourcePolicy.constructFromObject({Action:"WRITE",Subject:"*",Effect:"allow"})],e.JsonDefinition=JSON.stringify({type:"string"}),e.Indexable=!0,e}},{key:"create",value:function(){this.setState({create:!0,dialogOpen:!0,selectedNamespace:this.emptyNs()})}},{key:"deleteNs",value:function(e){var t=this,n=this.props.pydio,r=this.state.m;n.UI.openConfirmDialog({message:r("delete.confirm"),destructive:[e.Namespace],validCallback:function(){Zn.deleteNS(e).then((function(){t.load()}))}})}},{key:"open",value:function(e){e.length&&this.setState({create:!1,dialogOpen:!0,selectedNamespace:e[0]})}},{key:"close",value:function(){this.setState({dialogOpen:!1,selectedNamespace:null})}},{key:"render",value:function(){var e=this,n=this.props,r=n.muiTheme,o=n.currentNode,i=n.pydio,a=n.accessByName,l=n.policiesBuilder,s=AdminComponents.AdminStyles(r.palette),c=this.state,d=c.namespaces,p=c.loading,f=c.dialogOpen,y=c.selectedNamespace,m=c.create,h=c.m;y||(y=this.emptyNs()),d.sort((function(e,t){var n=e.Order||0,r=t.Order||0;return n===r?0:n>r?1:-1}));var g=[{name:"Order",label:h("order"),style:{width:30},headerStyle:{width:30},hideSmall:!0,renderCell:function(e){return e.Order||"0"},sorter:{type:"number"}},{name:"Namespace",label:h("namespace"),style:{fontSize:15},sorter:{type:"string"}},{name:"Label",label:h("label"),style:{width:"25%"},headerStyle:{width:"25%"},sorter:{type:"string"}},{name:"Indexable",label:h("indexable"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0,renderCell:function(e){return e.Indexable?"Yes":"No"},sorter:{type:"number",value:function(e){return e.Indexable?1:0}}},{name:"JsonDefinition",label:h("definition"),hideSmall:!0,renderCell:function(e){var t=e.JsonDefinition;if(!t)return"";var n=JSON.parse(t);return Zn.MetaTypes[n.type]||n.type},sorter:{type:"string"}}],b=o.getLabel(),v=o.getMetadata().get("icon_class"),S=[],w=[];return a("Create")&&(S.push(t().createElement(u.FlatButton,Or({primary:!0,label:h("namespace.add"),onClick:function(){e.create()}},s.props.header.flatButton))),w.push({iconClassName:"mdi mdi-pencil",onClick:function(t){e.open([t])}},{iconClassName:"mdi mdi-delete",onClick:function(t){e.deleteNs(t)}})),t().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},t().createElement(wr,{pydio:i,open:f,create:m,namespace:y,onRequestClose:function(){return e.close()},reloadList:function(){return e.load()},namespaces:d,readonly:!a("Create"),policiesBuilder:l}),t().createElement("div",{className:"vertical-layout",style:{width:"100%"}},t().createElement(AdminComponents.Header,{title:b,icon:v,actions:S,reloadAction:this.load.bind(this),loading:p}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{title:h("namespaces"),legend:h("namespaces.legend")}),t().createElement(u.Paper,s.body.block.props,t().createElement(xr,{data:d,columns:g,actions:w,onSelectRows:this.open.bind(this),deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:h("empty"),masterStyles:s.body.tableMaster,storageKey:"console.metadata.list"})))))}}])&&kr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),l}(t().Component);Rr=jr()(Rr)})(),window.AdminWorkspaces=r})();