(()=>{"use strict";var e={509:e=>{e.exports=require("material-ui/styles")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};r.r(n),r.d(n,{Callbacks:()=>Nr,Dashboard:()=>Yr,Editor:()=>Yo,Forms:()=>Xo,PoliciesBoard:()=>Gn,RolesDashboard:()=>cn,TreeGroupsDialog:()=>so});const o=require("react");var i=r.n(o);const a=require("create-react-class");var s=r.n(a);const l=require("prop-types");var c=r.n(l);const u=require("material-ui"),p=require("pydio");var f=r.n(p);const d=require("pydio/lang/observable");var y=r.n(d);const m=require("pydio/http/api");var h=r.n(m);const b=require("cells-sdk");var g="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),v=new Uint8Array(16);function O(){if(!g)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(v)}for(var P=[],w=0;w<256;++w)P[w]=(w+256).toString(16).substr(1);const S=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||O)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||function(e,t){var r=t||0,n=P;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}(o)};function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function j(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function A(e){var t=function(e){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:t+""}function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(C=function(){return!!e})()}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}var N=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=x(t),function(e,t){if(t&&("object"==E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,C()?Reflect.construct(t,r||[],x(e).constructor):t.apply(e,r))}(this,t)).acls=[],r.dirty=!1,r.parentRoles=n,r.parentAcls={},r.showUniqueRole=void 0,e?r.idmRole=e:(r.idmRole=new b.IdmRole,r.idmRole.Uuid=S()),r.makeSnapshot(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(t,e),r=t,n=[{key:"load",value:function(){return this.loadAcls()}},{key:"isDirty",value:function(){return this.dirty}},{key:"getIdmRole",value:function(){return this.buildProxy(this.idmRole)}},{key:"makeSnapshot",value:function(){var e=this;this.snapshot=b.IdmRole.constructFromObject(JSON.parse(JSON.stringify(this.idmRole))),this.aclSnapshot=[],this.acls.forEach((function(t){e.aclSnapshot.push(b.IdmACL.constructFromObject(JSON.parse(JSON.stringify(t))))}))}},{key:"updateParentRoles",value:function(e){var t=this;this.parentRoles=e,this.loadAcls(!0).then((function(){t.notify("update")}))}},{key:"setUniqueRoleDisplay",value:function(e){this.showUniqueRole=e,this.notify("update")}},{key:"getUniqueRoleDisplay",value:function(){return this.showUniqueRole}},{key:"loadAcls",value:function(){var e,r=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=new b.ACLServiceApi(h().getRestClient()),i=new b.RestSearchACLRequest;i.Queries=[];var a=new b.IdmACLSingleQuery;return a.RoleIDs=[],n||(a.RoleIDs=[this.idmRole.Uuid]),(e=a.RoleIDs).push.apply(e,j(this.parentRoles.map((function(e){return e.Uuid})))),i.Queries.push(a),o.searchAcls(i).then((function(e){var o=t.FormatPolicyAclFromStore(e.ACLs||[]);r.parentRoles.length?(n||(r.acls=o.filter((function(e){return e.RoleID===r.idmRole.Uuid}))),r.parentRoles.forEach((function(e){r.parentAcls[e.Uuid]=o.filter((function(t){return t.RoleID===e.Uuid}))}))):r.acls=o,n||r.makeSnapshot()}))}},{key:"revert",value:function(){this.idmRole=this.snapshot,this.acls=this.aclSnapshot,this.dirty=!1,this.makeSnapshot(),this.notify("update")}},{key:"save",value:function(){var e=this,r=new b.RoleServiceApi(h().getRestClient()),n=new b.ACLServiceApi(h().getRestClient());return r.setRole(this.idmRole.Uuid,this.idmRole).then((function(r){e.idmRole=r;var o=new b.RestSearchACLRequest;o.Queries=[];var i=new b.IdmACLSingleQuery;return i.RoleIDs=[e.idmRole.Uuid],o.Queries.push(i),n.searchAcls(o).then((function(r){var i=r.ACLs||[],a=t.FormatPolicyAclToStore(e.acls),s=e.diffAcls(i,a),l=s.inserts,c=s.deletes;return Promise.all(c.map((function(e){return n.deleteAcl(e)}))).then((function(){return Promise.all(l.map((function(e){return n.putAcl(e)}))).then((function(r){return n.searchAcls(o).then((function(r){e.acls=t.FormatPolicyAclFromStore(r.ACLs||[]),e.makeSnapshot(),e.dirty=!1,e.notify("update")}))}))}))}))}))}},{key:"diffAcls",value:function(e,t){var r=this,n=e.filter((function(e){return!t.find((function(t){return r.equals(e,t)}))}));return{inserts:t.filter((function(t){return!e.find((function(e){return r.equals(t,e)}))})),deletes:n}}},{key:"equals",value:function(e,t){return e.NodeID===t.NodeID&&e.Action.Name===t.Action.Name&&e.Action.Value===t.Action.Value&&e.WorkspaceID===t.WorkspaceID}},{key:"setParameter",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PYDIO_REPO_SCOPE_ALL",o=this.acls.filter((function(t){return t.Action.Name===e&&t.WorkspaceID===n}));if(o.length){var i=o[0],a=void 0;this.parentRoles.forEach((function(t){a=r.getAclValue(r.parentAcls[t.Uuid],e,n,a)})),void 0!==a&&a===t?this.acls=this.acls.filter((function(e){return e!==i})):i.Action.Value=JSON.stringify(t)}else{var s=new b.IdmACL;s.RoleID=this.idmRole.Uuid,s.WorkspaceID=n,s.Action=new b.IdmACLAction,s.Action.Name=e,s.Action.Value=JSON.stringify(t),this.acls.push(s)}this.dirty=!0,this.notify("update")}},{key:"deleteParameter",value:function(e){this.acls=this.acls.filter((function(t){return t!==e})),this.dirty=!0,this.notify("update")}},{key:"getParameterValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PYDIO_REPO_SCOPE_ALL",n=void 0;return this.parentRoles.forEach((function(o){n=t.getAclValue(t.parentAcls[o.Uuid],e,r,n)})),this.getAclValue(this.acls,e,r,n)}},{key:"listParametersAndActions",value:function(){var e=this,t=function(e){return e.Action.Name&&(0===e.Action.Name.indexOf("parameter:")||0===e.Action.Name.indexOf("action:"))},r=this.acls||[];return r=r.filter(t),this.parentRoles.forEach((function(n){var o=e.parentAcls[n.Uuid]||[];o=o.filter(t).filter((function(e){return!r.filter((function(t){return t.Action.Name===e.Action.Name})).length})).map((function(e){var t=b.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.INHERITED=!0,t})),r=[].concat(j(r),j(o))})),r}},{key:"getAclValue",value:function(e,t,r,n){if(!e)return n;var o=e.filter((function(e){return e.Action.Name===t&&e.WorkspaceID===r}));try{return JSON.parse(o[0].Action.Value)}catch(e){return n}}},{key:"getAclString",value:function(e,t){var r,n,o,i,a,s=this,l=!1;if(e){var c=e.RootNodes,u=c[Object.keys(c).shift()];r=e.UUID,n=u.Uuid}else n=t;if(this.showUniqueRole?a=this._aclStringForAcls(this.parentAcls[this.showUniqueRole],r,n):(this.parentRoles.forEach((function(e){var t=s._aclStringForAcls(s.parentAcls[e.Uuid],r,n);void 0!==t&&(i=t)})),a=this._aclStringForAcls(this.acls,r,n)),void 0!==a)o=a;else{if(void 0===i)return{aclString:""};o=i,l=!0}return{aclString:Object.keys(o).filter((function(e){return o[e]})).join(","),inherited:l}}},{key:"_aclStringForAcls",value:function(e,t,r){if(e){var n={read:!1,write:!1,deny:!1},o=e.filter((function(e){return e.Action.Name&&0===e.Action.Name.indexOf("policy:")&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value}));return o.length?(n[o[0].Action.Name]=!0,n):(Object.keys(n).forEach((function(o){e.filter((function(e){return e.Action.Name===o&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value})).length&&(n[o]|=!0)})),n.read||n.write||n.deny?n:void 0)}}},{key:"updateAcl",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=[],a=!1;t?(i=[t],a=o&&Object.keys(o.RootNodes).indexOf(t)>-1):i=Object.keys(e.RootNodes),this.acls=e?this.acls.filter((function(t){return!(("read"===t.Action.Name||"write"===t.Action.Name||"deny"===t.Action.Name||t.Action.Name&&0===t.Action.Name.indexOf("policy:"))&&t.WorkspaceID===e.UUID&&i.indexOf(t.NodeID)>-1&&"1"===t.Action.Value)})):this.acls.filter((function(e){return!(("read"===e.Action.Name||"write"===e.Action.Name||"deny"===e.Action.Name||e.Action.Name&&0===e.Action.Name.indexOf("policy:"))&&e.NodeID===t&&"1"===e.Action.Value)})),""!==r&&r.split(",").forEach((function(t){i.forEach((function(r){var i=new b.IdmACL;i.NodeID=r,e?i.WorkspaceID=e.UUID:a&&(i.WorkspaceID=o.UUID),i.RoleID=n.idmRole.Uuid,i.Action=b.IdmACLAction.constructFromObject({Name:t,Value:"1"}),n.acls.push(i)}))})),this.dirty=!0,this.notify("update")}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],o=[{key:"FormatPolicyAclFromStore",value:function(e){return e.map((function(e){return e.Action&&"policy"===e.Action.Name&&(e.Action.Name="policy:"+e.Action.Value,e.Action.Value="1"),e}))}},{key:"FormatPolicyAclToStore",value:function(e){return e.map((function(e){if(e.Action&&0===e.Action.Name.indexOf("policy:")){var t=b.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.Action.Name="policy",t.Action.Value=e.Action.Name.split(":")[1],t}return e}))}}],n&&k(r.prototype,n),o&&k(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(y());function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function T(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,U(n.key),n)}}function U(e){var t=function(e){if("object"!=I(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(L=function(){return!!e})()}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}var q=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=B(t),function(e,t){if(t&&("object"==I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,r||[],B(e).constructor):t.apply(e,r))}(this,t)).acls=[];var n=[];return e?(r.idmUser=e,r.idmUser.Roles&&(r.idmRole=r.idmUser.Roles.filter((function(e){return e.Uuid===r.idmUser.Uuid}))[0],r.idmUser.IsGroup||(n=r.idmUser.Roles.filter((function(e){return e.Uuid!==r.idmUser.Uuid})))),r.idmUser.Attributes||(r.idmUser.Attributes={})):(r.idmUser=new b.IdmUser,r.idmUser.Uuid=S(),r.idmRole=b.IdmRole.constructFromObject({Uuid:r.idmUser.Uuid}),r.idmUser.Roles=[r.idmRole],r.idmUser.Attributes={}),r.role=new N(r.idmRole,n),r.role.observe("update",(function(){r.dirty|=r.role.isDirty(),r.notify("update")})),r.makeSnapshot(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(t,e),r=t,n=[{key:"load",value:function(){var e=this;this.role.load().then((function(){e.notify("update")}))}},{key:"isDirty",value:function(){return this.dirty}},{key:"save",value:function(){var e=this;return PydioApi.getRestClient().getIdmApi().updateIdmUser(this.idmUser).then((function(t){return e.idmUser=t,e.role.isDirty()?e.role.save().then((function(){e.makeSnapshot(),e.dirty=!1,e.notify("update")})):(e.makeSnapshot(),e.dirty=!1,e.notify("update"),Promise.resolve(e))}))}},{key:"revert",value:function(){var e=this;if(this.idmUser=this.snapshot,this.makeSnapshot(),this.dirty=!1,this.role.revert(),this.idmUser.Roles&&(this.idmRole=this.idmUser.Roles.filter((function(t){return t.Uuid===e.idmUser.Uuid}))[0],!this.idmUser.IsGroup)){var t=this.idmUser.Roles.filter((function(t){return t.Uuid!==e.idmUser.Uuid}));this.role.updateParentRoles(t)}this.notify("update")}},{key:"makeSnapshot",value:function(){this.snapshot=b.IdmUser.constructFromObject(JSON.parse(JSON.stringify(this.idmUser)))}},{key:"getRole",value:function(){return this.role}},{key:"addRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(e){return e.Uuid!==t.idmUser.Uuid}));r=[].concat(T(r.filter((function(t){return t.Uuid!==e.Uuid}))),[e]),this.idmUser.Roles=[].concat(T(r),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(r)}},{key:"removeRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(r){return r.Uuid!==t.idmUser.Uuid&&r.Uuid!==e.Uuid}));this.idmUser.Roles=[].concat(T(r),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(r)}},{key:"switchRoles",value:function(e,t){for(var r,n,o,i=this,a=this.idmUser.Roles.filter((function(e){return e.Uuid!==i.idmUser.Uuid})),s=0;s<a.length;s++)a[s].Uuid===e?(r=s,o=a[s]):a[s].Uuid===t&&(n=s);a[r]=a[n],a[n]=o,this.idmUser.Roles=[].concat(T(a),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(a)}},{key:"getIdmUser",value:function(){return this.buildProxy(this.idmUser)}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],n&&D(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(y());const H=require("pydio/util/lang");var W=r.n(H);function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V.apply(null,arguments)}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,K(n.key),n)}}function K(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}function J(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(J=function(){return!!e})()}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function Y(e){return function(t){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),function(e,t,r){return t=Q(t),function(e,t){if(t&&("object"==G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,J()?Reflect.construct(t,r||[],Q(e).constructor):t.apply(e,r))}(this,r,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(r,t),n=r,o=[{key:"render",value:function(){var t=this.props.pydio;t||(t=f().getInstance());var r=t.MessageHash;return i().createElement(e,V({},this.props,{getMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return r[t+(t?".":"")+e]||e},getPydioRoleMessage:function(e){return r["role_editor."+e]||e},getRootMessage:function(e){return r[e]||e},getAdminMessage:function(e){return r["ajxp_admin."+e]||e}}))}}],o&&z(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(o.Component)}function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ee(n.key),n)}}function ee(e){var t=function(e){if("object"!=X(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==X(t)?t:t+""}function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(te=function(){return!!e})()}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}const oe=Y(function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=re(t),function(e,t){if(t&&("object"==X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,te()?Reflect.construct(t,r||[],re(e).constructor):t.apply(e,r))}(this,t,[e])).state={acl:e.acl},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(t,e),r=t,(n=[{key:"componentWillReceiveProps",value:function(e){this.setState({acl:e.acl})}},{key:"getAcl",value:function(){return this.state.acl}},{key:"updateAcl",value:function(){if(!this.props.disabled){var e,t=this.refs.deny&&this.refs.deny.isChecked(),r=!t&&this.refs.read&&this.refs.read.isChecked(),n=!t&&this.refs.write&&this.refs.write.isChecked(),o=[];t?o.push("deny"):(r&&o.push("read"),n&&o.push("write")),e=o.join(","),this.props.onChange&&this.props.onChange(e,this.props.acl),this.setState({acl:e})}}},{key:"handleChangePolicy",value:function(e,t){var r="policy:"+t;this.props.onChange?this.props.onChange(r,this.props.acl):this.setState({acl:r})}},{key:"render",value:function(){var e=this.props,t=e.hideDeny,r=e.hideWrite,n=e.hideLabels,o=e.disabled,a=e.getMessage,s=this.state.acl||"",l=r?92:132;if(s.startsWith("policy:"))return i().createElement("div",{style:{display:"flex",alignItems:"center",width:l,height:33}},"Custom policy");var c={width:44};return i().createElement("div",{style:{display:"flex",alignItems:"center",width:l,height:33}},i().createElement(u.Checkbox,{ref:"read",label:n?"":a("react.5a","ajxp_admin"),value:"read",onCheck:this.updateAcl.bind(this),disabled:o||s.indexOf("deny")>-1,checked:-1===s.indexOf("deny")&&-1!==s.indexOf("read"),style:c}),!r&&i().createElement(u.Checkbox,{ref:"write",label:n?"":a("react.5b","ajxp_admin"),value:"write",onCheck:this.updateAcl.bind(this),disabled:o||s.indexOf("deny")>-1,checked:-1===s.indexOf("deny")&&-1!==s.indexOf("write"),style:c}),!t&&i().createElement(u.Checkbox,{ref:"deny",label:n?"":a("react.5","ajxp_admin"),value:"-",disabled:o,onCheck:this.updateAcl.bind(this),checked:-1!==s.indexOf("deny"),style:c}))}}])&&Z(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component));function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,se(n.key),n)}}function se(e){var t=function(e){if("object"!=ie(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ie(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ie(t)?t:t+""}function le(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(le=function(){return!!e})()}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}var pe=f().requireLib("components").ListEntry;const fe=Y(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){return t=ce(t),function(e,t){if(t&&("object"==ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,le()?Reflect.construct(t,r||[],ce(e).constructor):t.apply(e,r))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ue(e,t)}(t,e),r=t,(n=[{key:"onAclChange",value:function(e,t){var r=this.props,n=r.role,o=r.workspace;n.updateAcl(o,null,e)}},{key:"render",value:function(){var e=this.props,t=e.workspace,r=e.role,n=e.pageAcl,o=e.getPydioRoleMessage;if(!t.RootNodes||!Object.keys(t.RootNodes).length)return i().createElement(pe,{className:"workspace-acl-entry",firstLine:i().createElement("span",{style:{textDecoration:"line-through",color:"#ef9a9a"}},t.Label+" ("+o("workspace.roots.invalid")+")")});var a=r.getAclString(t),s=a.aclString,l=a.inherited,c=!!r.getUniqueRoleDisplay(),u=i().createElement(oe,{acl:s,onChange:this.onAclChange.bind(this),hideLabels:!0,hideWrite:n,disabled:c}),p=t.Label+(l?" ("+o("38")+")":"");return t.Description&&(p=i().createElement("span",{title:t.Description},p)),i().createElement(pe,{className:(l?"workspace-acl-entry-inherited ":"")+"workspace-acl-entry",firstLine:p,actions:u})}}])&&ae(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component));function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,me(n.key),n)}}function me(e){var t=function(e){if("object"!=de(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=de(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==de(t)?t:t+""}function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},be(e)}function ge(e,t){return ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ge(e,t)}var ve=f().requireLib("components").MaterialTable,Oe=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=be(t),function(e,t){if(t&&("object"==de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,he()?Reflect.construct(t,r||[],be(e).constructor):t.apply(e,r))}(this,t,[e])).state={loading:!0,workspaces:[]};var n=new b.WorkspaceServiceApi(h().getRestClient()),o=new b.RestSearchWorkspaceRequest;return o.Queries=[b.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],n.searchWorkspaces(o).then((function(e){var t=e.Workspaces||[];t.sort(W().arraySorter("Label",!1,!0)),r.setState({workspaces:t,loading:!1})})).catch((function(e){r.setState({loading:!1})})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ge(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.role,r=e.advancedAcl,n=this.state,o=n.workspaces,a=n.loading;if(!t)return i().createElement("div",null);var s=[{name:"acl",label:"",style:{paddingLeft:0,paddingRight:0},renderCell:function(e){return i().createElement(fe,{workspace:e,role:t,advancedAcl:r})}}];return i().createElement("div",{style:{clear:"both"},className:"material-list"},i().createElement(ve,{data:o,columns:s,hideHeaders:!0,paginate:[10,25,50,100],defaultPageSize:25,showCheckboxes:!1,emptyStateString:a?f().getInstance().MessageHash["ajxp_admin.loading"]:""}))}}])&&ye(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Se(n.key),n)}}function Se(e){var t=function(e){if("object"!=Pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pe(t)?t:t+""}function Ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ee=function(){return!!e})()}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Re(e,t)}var ke=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t,r){return t=je(t),function(e,t){if(t&&("object"==Pe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ee()?Reflect.construct(t,r||[],je(e).constructor):t.apply(e,r))}(this,t,[e]);var n=function(t){return e.pydio.MessageHash["pydio_role."+t]||t},o=[],i=new b.IdmWorkspace;i.UUID="homepage",i.Label=n("workspace.statics.home.title"),i.Description=n("workspace.statics.home.description"),i.Slug="homepage",i.RootNodes={"homepage-ROOT":b.TreeNode.constructFromObject({Uuid:"homepage-ROOT"})},o.push(i);var a=new b.IdmWorkspace;if(a.UUID="directory",a.Label=n("workspace.statics.directory.title"),a.Description=n("workspace.statics.directory.description"),a.Slug="directory",a.RootNodes={"directory-ROOT":b.TreeNode.constructFromObject({Uuid:"directory-ROOT"})},o.push(a),e.showSettings){var s=new b.IdmWorkspace;s.UUID="settings",s.Label=n("workspace.statics.settings.title"),s.Description=n("workspace.statics.settings.description"),s.Slug="settings",s.RootNodes={"settings-ROOT":b.TreeNode.constructFromObject({Uuid:"settings-ROOT"})},o.push(s)}return o.sort(W().arraySorter("Label",!1,!0)),r.state={workspaces:o},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}(t,e),r=t,n=[{key:"render",value:function(){var e=this.props.role,t=this.state.workspaces;return e?i().createElement("div",{style:{backgroundColor:"white",clear:"both"},className:"material-list"},t.map((function(r,n){var o={};return n<t.length-1&&(o={borderBottom:"1px solid #e0e0e0"}),i().createElement("div",{style:o},i().createElement(fe,{workspace:r,role:e,pageAcl:!0}))}))):i().createElement("div",null)}}],n&&we(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);const Ae=require("pydio/util/path");var Ce=r.n(Ae),xe=r(509);function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Te(n.key),n)}}function Te(e){var t=function(e){if("object"!=Me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Me(t)?t:t+""}function _e(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_e=function(){return!!e})()}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}function Ue(e,t){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(e,t)}var Le=f().requireLib("form").FormPanel,Be=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=De(t),function(e,t){if(t&&("object"==Me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_e()?Reflect.construct(t,r||[],De(e).constructor):t.apply(e,r))}(this,t,[e])).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters("//global_param[contains(@scope,'role')]|//param[contains(@scope,'role')]").then((function(e){r.setState({parameters:e})})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(t,e),r=t,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.role,o=n.getIdmRole();if("applies"===e)o.AutoApplies=t.split(",");else if("roleLabel"===e)o.Label=t;else if("roleForceOverride"===e)o.ForceOverride=t;else if("roleType"===e)o.IsTeam="team"===t;else{var i=this.getParameterByName(e);i.aclKey&&n.setParameter(i.aclKey,t)}}},{key:"getParameterByName",value:function(e){return this.state.parameters.filter((function(t){return t.name===e}))[0]}},{key:"render",value:function(){var e=this.props,t=e.role,r=e.pydio,n=this.state.parameters;if(!n)return i().createElement("div",null,r.MessageHash["ajxp_admin.loading"]);var o,a={admin:"157",standard:"156",shared:"158",anon:"159"},s=Object.keys(a).map((function(e){return e+"|"+r.MessageHash["settings."+a[e]]})).join(","),l={applies:[]},c=!1,u=this.getPydioRoleMessage("roleType.admin.description").replace(",","").replace("|",""),p=this.getPydioRoleMessage("roleType.IsTeam.description").replace(",","").replace("|",""),f={name:"roleType",label:this.getPydioRoleMessage("roleType"),description:this.getPydioRoleMessage("roleType.description"),type:"select",choices:"admin|".concat(u,",team|").concat(p)};if(t){var d=t.getIdmRole();d.GroupRole||d.UserRole?(f.readonly=!0,f.type="string",o=this.getPydioRoleMessage("roleType."+(d.GroupRole?h().RoleTypeGroup:h().RoleTypeUser)+".description"),c=!0):o=d.IsTeam?"team":"admin";var y=d.AutoApplies||[];l={roleId:d.Uuid,applies:y.filter((function(e){return!!e})),roleLabel:d.Label,roleType:o,roleForceOverride:d.ForceOverride||!1},n.map((function(e){e.aclKey&&t.getParameterValue(e.aclKey)&&(l[e.name]=t.getParameterValue(e.aclKey))}))}var m=[{name:"roleId",label:this.getPydioRoleMessage("31"),type:"string",readonly:!0,description:this.getPydioRoleMessage("role.id.description")},f,{name:"roleLabel",label:this.getPydioRoleMessage("32"),type:"string",description:this.getPydioRoleMessage("role.label.description")},!c&&{name:"applies",label:this.getPydioRoleMessage("33"),type:"select",multiple:!0,choices:s,description:this.getPydioRoleMessage("role.autoapply.description")},!c&&{name:"roleForceOverride",label:this.getPydioRoleMessage("role.override.label"),type:"boolean",description:this.getPydioRoleMessage("role.override.description")}].concat(function(e){return function(e){if(Array.isArray(e))return Ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ne(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ne(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n)).filter((function(e){return e}));return i().createElement("div",{className:"paper-right-block"},i().createElement(Le,{parameters:m,onParameterChange:this.onParameterChange.bind(this),values:l,depth:-2,variant:"v2",variantShowLegend:!0}))}}])&&Ie(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Fe(){return Fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fe.apply(null,arguments)}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function We(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ge(e,t,r){return(t=Ke(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ke(n.key),n)}}function Ke(e){var t=function(e){if("object"!=Ve(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ve(t)?t:t+""}function Je(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Je=function(){return!!e})()}function Qe(e){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qe(e)}function $e(e,t){return $e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$e(e,t)}Be.PropTypes={pydio:c().instanceOf(f()).isRequired,pluginsRegistry:c().instanceOf(XMLDocument),role:c().instanceOf(N)};var Ye=f().requireLib("form").FormPanel,Xe=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Qe(t),function(e,t){if(t&&("object"==Ve(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Je()?Reflect.construct(t,r||[],Qe(e).constructor):t.apply(e,r))}(this,t,[e])).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"user")]|//param[contains(@scope,"user")]').then((function(e){r.setState({parameters:e})})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}(t,e),r=t,n=[{key:"getBinaryContext",value:function(){var e=this.props.user;return"user_id="+e.getIdmUser().Login+(e.getIdmUser().Attributes&&e.getIdmUser().Attributes.avatar?"?"+e.getIdmUser().Attributes.avatar:"")}},{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.user,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e||"avatar"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"buttonCallback",value:function(e){var t=this.props.user;if("update_user_pwd"===e)this.props.pydio.UI.openComponentInModal("AdminPeople","Editor.User.UserPasswordDialog",{user:t});else{var r=t.getIdmUser(),n="user_set_lock-lock"===e?"logout":"pass_change",o=[];if(r.Attributes.locks){var i=JSON.parse(r.Attributes.locks);i&&"object"===Ve(i)&&(o=i)}o.indexOf(n)>-1?(o=o.filter((function(e){return e!==n})),"user_set_lock-lock"===e&&delete r.Attributes.failedConnections):o.push(n),r.Attributes.locks=JSON.stringify(o),t.save()}}},{key:"render",value:function(){var e=this,t=this.props,r=t.user,n=t.pydio,o=t.adminStyles,a=this.state.parameters;if(!a)return i().createElement("div",null,"Loading...");var s,l={profiles:[]},c=[];if(r){var p=r.getIdmUser(),f=r.getRole();if(s="true"===p.Attributes.hidden,p.Attributes.locks&&"object"===Ve(c=JSON.parse(p.Attributes.locks)||[])&&void 0===c.length){var d=[];Object.keys(c).forEach((function(e){!0===c[e]&&d.push(e)})),c=d}var y=p.Attributes||{};l=We(We({},l),{},{avatar:y.avatar,displayName:y.displayName,email:y.email,profile:y.profile,login:p.Login}),a.map((function(e){e.aclKey&&f.getParameterValue(e.aclKey)&&(l[e.name]=f.getParameterValue(e.aclKey))}))}var m=["admin","standard","shared"].map((function(e){return e+"|"+Qr(e,(function(e){return n.MessageHash["settings."+e]||e}))})).join(","),h=[{name:"login",label:this.getPydioRoleMessage("21"),description:n.MessageHash["pydio_role.31"],type:"string",readonly:!0},{name:"profile",label:this.getPydioRoleMessage("22"),description:n.MessageHash["pydio_role.32"],type:"select",choices:m}].concat(function(e){return function(e){if(Array.isArray(e))return qe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(a));if(s){var b=["login","avatar"];h=h.filter((function(e){return b.indexOf(e.name)>-1}))}var g=r.getIdmUser().Login===n.user.id,v=[{label:"25",callback:"update_user_pwd"},{label:c.indexOf("logout")>-1?"27":"26",callback:"user_set_lock-lock",active:c.indexOf("logout")>-1},{label:c.indexOf("pass_change")>-1?"28b":"28",callback:"user_set_lock-pass_change",active:c.indexOf("pass_change")>-1}];return i().createElement("div",null,i().createElement("h3",{className:"paper-right-title"},n.MessageHash["pydio_role.24"],i().createElement("div",{className:"section-legend"},n.MessageHash["pydio_role.54"])),!g&&i().createElement("div",{style:{padding:"10px 16px 0"}},v.map((function(t){var r=t.active?{backgroundColor:"#e53935"}:{};return i().createElement(u.FlatButton,Fe({disabled:g,label:e.getPydioRoleMessage(t.label),onClick:function(){return e.buttonCallback(t.callback)}},o.props.header.flatButton,r))}))),i().createElement("div",{className:"paper-right-block",style:{padding:"6px 6px 2px"}},i().createElement(Ye,{parameters:h,onParameterChange:this.onParameterChange.bind(this),values:l,depth:-2,variant:"v2",variantShowLegend:!0,binary_context:this.getBinaryContext()})))}}],n&&ze(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rt(n.key),n)}}function rt(e){var t=function(e){if("object"!=Ze(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ze(t)?t:t+""}function nt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(nt=function(){return!!e})()}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(e)}function it(e,t){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},it(e,t)}Xe.PropTypes={pydio:c().instanceOf(f()).isRequired,pluginsRegistry:c().instanceOf(XMLDocument),user:c().instanceOf(q)};var at=f().requireLib("form").FormPanel,st=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=ot(t),function(e,t){if(t&&("object"==Ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nt()?Reflect.construct(t,r||[],ot(e).constructor):t.apply(e,r))}(this,t,[e])).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"group")]|//param[contains(@scope,"group")]').then((function(e){r.setState({parameters:e})})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&it(e,t)}(t,e),r=t,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.group,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"render",value:function(){var e=this.props,t=e.group,r=(e.pydio,this.state.parameters);if(!r)return i().createElement("div",null,"Loading...");var n={};if(t){var o=t.getIdmUser(),a=t.getRole(),s=o.GroupLabel;o.Attributes&&o.Attributes.displayName&&(s=o.Attributes.displayName),n={groupPath:LangUtils.trimRight(o.GroupPath,"/")+"/"+o.GroupLabel,displayName:s},r.map((function(e){e.aclKey&&a.getParameterValue(e.aclKey)&&(n[e.name]=a.getParameterValue(e.aclKey))}))}var l=[{name:"groupPath",label:this.getPydioRoleMessage("34"),type:"string",readonly:!0},{name:"displayName",label:this.getPydioRoleMessage("35"),type:"string"}].concat(function(e){return function(e){if(Array.isArray(e))return et(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return et(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?et(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(r));return i().createElement("div",{className:"paper-right-block"},i().createElement(at,{parameters:l,onParameterChange:this.onParameterChange.bind(this),values:n,variant:"v2",depth:-2,variantShowLegend:!0}))}}])&&tt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);st.PropTypes={pydio:c().instanceOf(f()).isRequired,pluginsRegistry:c().instanceOf(XMLDocument),group:c().instanceOf(q)};const lt=require("pydio/util/xml");var ct=r.n(lt);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(r),!0).forEach((function(t){dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function dt(e,t,r){return(t=gt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yt(){return yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yt.apply(null,arguments)}function mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function bt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gt(n.key),n)}}function gt(e){var t=function(e){if("object"!=ut(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ut(t)?t:t+""}function vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vt=function(){return!!e})()}function Ot(e){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ot(e)}function Pt(e,t){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pt(e,t)}var wt=f().requireLib("form"),St=wt.Manager,Et=wt.createFormElement;const jt=Y(function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Ot(t),function(e,t){if(t&&("object"==ut(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vt()?Reflect.construct(t,r||[],Ot(e).constructor):t.apply(e,r))}(this,t,[e])).state={editMode:!1},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pt(e,t)}(t,e),r=t,(n=[{key:"onChangeParameter",value:function(e,t){if(e!==t){var r=this.props,n=r.role,o=r.acl,i=o.Action.Name;n.setParameter(i,e,o.WorkspaceID)}}},{key:"deleteParameter",value:function(){var e=this.props,t=e.role,r=e.acl;t.deleteParameter(r)}},{key:"overrideParameter",value:function(){var e=this.props,t=e.role,r=e.acl,n=r.Action.Name,o=mt(n.split(":"),3),i=o[0],a=(o[1],o[2],"");"action"===i&&(a=!1),t.setParameter(n,a,r.WorkspaceID)}},{key:"onInputEditMode",value:function(e){this.setState({editMode:e})}},{key:"toggleEditMode",value:function(){this.refs.formElement&&this.refs.formElement.toggleEditMode()}},{key:"toggleActionStatus",value:function(e,t){var r=this.props,n=r.role,o=r.acl;n.setParameter(o.Action.Name,t,o.WorkspaceID)}},{key:"render",value:function(){var e,t=this.props,r=t.acl,n=t.actions,o=t.parameters,a=t.pydio,s=t.getMessage,l=t.getPydioRoleMessage,c=mt(r.Action.Name.split(":"),3),p=c[0],f=c[1],d=c[2];e="DEFAULT_START_REPOSITORY"===d?r.Action.Value:JSON.parse(r.Action.Value);var y,m,h,b=r.INHERITED,g=d;if("parameter"===p&&o[f]){var v=o[f].filter((function(e){return e.parameter===d}));v.length&&(y=v[0])}else if("action"===p&&n[f]){var O=n[f].filter((function(e){return e.action===d}));O.length&&(y=O[0])}if("parameter"===p){var P={type:"string",label:g,name:d};if(y&&(P=St.parameterNodeToHash(y.xmlNode)),"user"===P.scope)return null;g=P.label,m=Et({ref:"formElement",attributes:P,name:d,value:e,onChange:this.onChangeParameter.bind(this),disabled:b,onChangeEditMode:this.onInputEditMode.bind(this),displayContext:"grid"})}else y&&(g=ct().XPathGetSingleNodeText(y.xmlNode,"gui/@text")||g,a.MessageHash[g]&&(g=a.MessageHash[g])),m=i().createElement("div",{className:"role-action-toggle"},i().createElement(u.Toggle,{name:this.props.name,onToggle:this.toggleActionStatus.bind(this),toggled:!!e,label:s(e?"2":"3"),labelPosition:"right"}));var w={style:{opacity:.2,zoom:.8},hoveredStyle:{opacity:1}};return"parameter"===p?this.state.editMode?h=i().createElement(u.IconButton,yt({iconClassName:"mdi mdi-content-save",tooltip:s("6"),onClick:this.toggleEditMode.bind(this)},w)):(h=i().createElement(u.IconButton,yt({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},w)),b&&(h=i().createElement(u.IconButton,yt({iconClassName:"mdi mdi-content-copy",tooltip:s("5"),onClick:this.overrideParameter.bind(this)},w)))):h=b?i().createElement("div",{style:{width:48,height:48}}):i().createElement(u.IconButton,yt({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},w)),i().createElement("tr",{className:(b?"inherited":"")+(this.state.editMode?" edit-mode":""),style:ft({},this.props.style)},i().createElement("td",{style:{width:"40%",paddingLeft:12}},b?"["+l("38")+"]":""," ",g),i().createElement("td",{style:{wordBreak:"break-all"}},m),i().createElement("td",{style:{width:50}},h))}}])&&bt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component));function Rt(e){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rt(e)}function kt(){return kt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kt.apply(null,arguments)}function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Ct(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xt(n.key),n)}}function xt(e){var t=function(e){if("object"!=Rt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rt(t)?t:t+""}function Mt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Mt=function(){return!!e})()}function Nt(e){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nt(e)}function It(e,t){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},It(e,t)}var Tt=f().requireLib("hoc").ModernSelectField,_t=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Nt(t),function(e,t){if(t&&("object"==Rt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Mt()?Reflect.construct(t,r||[],Nt(e).constructor):t.apply(e,r))}(this,t,[e])).state={actions:{},parameters:{},workspaces:{}};var n=new b.WorkspaceServiceApi(PydioApi.getRestClient()),o=new b.RestSearchWorkspaceRequest;return o.Queries=[b.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],n.searchWorkspaces(o).then((function(e){var t=e.Workspaces||[],n={};t.forEach((function(e){n[e.UUID]=e})),r.setState({workspaces:n})})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&It(e,t)}(t,e),r=t,n=[{key:"componentDidMount",value:function(){var e=this;AdminComponents.PluginsLoader.getInstance(this.props.pydio).allPluginsActionsAndParameters().then((function(t){e.setState({actions:t.ACTIONS,parameters:t.PARAMETERS})}))}},{key:"onCreateParameter",value:function(e,t,r,n,o){var i,a=this.props.role,s=t+":"+r+":"+n;if("action"===t)i=!1;else if(o&&o.xmlNode){var l=o.xmlNode;i=l.getAttribute("default")?l.getAttribute("default"):"","boolean"===l.getAttribute("type")?i="true"===i:"integer"===l.getAttribute("type")&&(i=parseInt(i))}a.setParameter(s,i,e)}},{key:"addParameter",value:function(e){var t=this,r=this.props,n=r.pydio,o=r.roleType,i=this.state,a=i.actions,s=i.parameters;n.UI.openComponentInModal("AdminPeople","Editor.Params.ParameterCreate",{pydio:n,actions:a,parameters:s,workspaceScope:e,createParameter:function(r,n,o,i){t.onCreateParameter(e,r,n,o,i)},roleType:o})}},{key:"render",value:function(){var e=this,t=this.props,r=t.role,n=t.roleType,o=t.pydio;if(!r)return null;var a=this.state.workspaces,s=function(e){return o.MessageHash["pydio_role."+e]||e},l=r.listParametersAndActions(),c={PYDIO_REPO_SCOPE_ALL:{},PYDIO_REPO_SCOPE_SHARED:{}};l.forEach((function(e){c[e.WorkspaceID]||(c[e.WorkspaceID]={});var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return At(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?At(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.Action.Name.split(":"),3),r=(t[0],t[1],t[2]);c[e.WorkspaceID][r]=e}));var p=[i().createElement(u.MenuItem,{primaryText:s("parameters.scope.selector.title"),value:1}),i().createElement(u.MenuItem,{primaryText:s("parameters.scope.all"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_ALL")}}),i().createElement(u.MenuItem,{primaryText:s("parameters.scope.shared"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_SHARED")}}),i().createElement(u.Divider,null)].concat(Object.keys(a).map((function(t){return i().createElement(u.MenuItem,{primaryText:a[t].Label,onClick:function(){e.addParameter(t)}})})));return i().createElement("div",null,i().createElement("h3",{className:"paper-right-title",style:{display:"flex"}},i().createElement("span",{style:{flex:1,paddingRight:20}},s("application-params.title"),i().createElement("div",{className:"section-legend"},s("application-params.legend"),"user"===n&&i().createElement("div",null,i().createElement("span",{className:"mdi mdi-alert"})," ",s("application-params.legend.user-disclaimer")))),i().createElement("div",{style:{width:260}},i().createElement(Tt,{variant:"compact",fullWidth:!0,value:1},p))),i().createElement("div",{className:"paper-right-block"},Object.keys(c).map((function(t,n){var l,p,f=!1;return l="PYDIO_REPO_SCOPE_ALL"===t?s("parameters.scope.all"):"PYDIO_REPO_SCOPE_SHARED"===t?s("parameters.scope.shared"):a[t]?s("parameters.scope.workspace").replace("%s",a[t].Label):s("parameters.scope.workspace").replace("%s",t),p=Object.keys(c[t]).length?Object.keys(c[t]).map((function(n){var a={backgroundColor:f?"#FAFAFA":"white"};return f=!f,i().createElement(jt,kt({pydio:o,acl:c[t][n],role:r},e.state,{style:a}))})):i().createElement("tr",null,i().createElement("td",{colSpan:3,style:{padding:"14px 12px"}},s("parameters.empty"))),i().createElement("table",{style:{width:"100%",marginBottom:n<Object.keys(c).length-1?40:0}},i().createElement("tr",{style:{borderBottom:"1px solid #e0e0e0"}},i().createElement("td",{colSpan:2,style:{padding:"16px 12px",fontSize:16}},l),i().createElement("td",{style:{width:50}},i().createElement(u.IconButton,{iconClassName:"mdi mdi-plus",onClick:function(){e.addParameter(t)},tooltip:s("parameters.custom.add"),style:{zoom:.8}}))),p)}))))}}],n&&Ct(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function Ut(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(r),!0).forEach((function(t){Bt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ut(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Bt(e,t,r){return(t=Wt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wt(n.key),n)}}function Ht(e,t,r){return t&&qt(e.prototype,t),r&&qt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wt(e){var t=function(e){if("object"!=Dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Dt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dt(t)?t:t+""}function Gt(e,t,r){return t=zt(t),function(e,t){if(t&&("object"==Dt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Vt()?Reflect.construct(t,r||[],zt(e).constructor):t.apply(e,r))}function Vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Vt=function(){return!!e})()}function zt(e){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zt(e)}function Kt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Jt(e,t)}function Jt(e,t){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Jt(e,t)}var Qt=f().requireLib("components").SortableList,$t=f().requireLib("hoc").ModernAutoComplete,Yt=function(e){function t(e){var r;return Ft(this,t),(r=Gt(this,t,[e])).state={value:"",roles:[]},r.load(),r}return Kt(t,e),Ht(t,[{key:"load",value:function(){var e=this,t=this.state.value,r=this.props.userRoles,n=t?"*"+t+"*":"";h().getRestClient().getIdmApi().listRolesV2(0,50,[h().RoleTypeAdmin,h().RoleTypeTeam],n).then((function(t){e.setState({roles:t.filter((function(e){return 0===r.filter((function(t){return e.Uuid===t.Uuid})).length}))})}))}},{key:"handleNewRequest",value:function(e){var t=this,r=this.props.onAddRole;e&&e.payload&&(r(e.payload),this.setState({value:""},(function(){return t.load()})))}},{key:"render",value:function(){var e,t=this,r=this.props.getMessage,n=this.state,o=n.value,a=n.roles,s=n.focus,l=a.map((function(e){return{value:i().createElement(u.MenuItem,{primaryText:e.Label,onKeyDown:function(r){"Enter"===r.key&&t.handleNewRequest({payload:e})},leftIcon:i().createElement(u.FontIcon,{style:{zoom:.9,top:0},className:"mdi mdi-"+(e.IsTeam?"account-group-outline":"card-account-details-outline")})}),key:e.Uuid,text:e.Label,payload:e}}));return s||(e={backgroundColor:"transparent",cursor:"pointer"}),i().createElement($t,{fullWidth:!0,hintText:r(s?"roles.picker.hint":"roles.picker.add"),variant:"compact",onFocus:function(){return t.setState({focus:!0})},onBlur:function(){return t.setState({focus:!1})},inputStyle:Lt({paddingLeft:2,borderRadius:2},e),hintStyle:{paddingLeft:2,textTransform:"capitalize",color:s?"#bbb":"rgb(5, 169, 244)",cursor:"pointer"},filter:function(e,t){return!e.indexOf||t.toLowerCase().indexOf(e.toLowerCase())>=0},openOnFocus:!0,dataSource:l,searchText:o,onNewRequest:function(e,r){t.handleNewRequest(e)},onUpdateInput:function(e){t.setState({value:e},(function(){return t.load()}))},desktop:!0,menuProps:{maxHeight:300,overflowY:"auto",desktop:!0}})}}])}(o.Component),Xt=function(e){function t(e){var r;return Ft(this,t),(r=Gt(this,t,[e])).state={open:!1},r}return Kt(t,e),Ht(t,[{key:"onChange",value:function(e,t,r){-1!==r&&this.props.user.addRole(r)}},{key:"remove",value:function(e){var t=this.props.user,r=t.getIdmUser().Roles.filter((function(t){return t.Uuid===e}))[0];t.removeRole(r)}},{key:"orderUpdated",value:function(e,t,r){this.props.user.switchRoles(e,t)}},{key:"displayUniqueRole",value:function(e){var t=this.props.user,r=t.getRole().getUniqueRoleDisplay();t.getRole().setUniqueRoleDisplay(r===e?null:e)}},{key:"render",value:function(){var e=this,t=[],r=[],n=this.props,a=n.user,s=n.loadingMessage,l=n.getMessage,c=n.buildGroupPath,u=this.state.open,p=a.getIdmUser(),f=p.Attributes&&p.Attributes.displayName||p.Login,d=p.Attributes&&p.Attributes.profile||"",y=p.Roles,m=a.getRole().getUniqueRoleDisplay(),h=function(t){var r=t.payload,n=t.icon,o=t.text,a=t.removable,s=void 0!==a&&a,l=t.noClick,c=t.className,u=void 0===c?"":c,p=r===m,f=l?null:function(){return e.displayUniqueRole(r)},d=["role-item"];return u&&d.push(u),s&&d.push("role-item-sortable"),p&&d.push("role-item-selected"),l&&d.push("role-item-noclick"),i().createElement("div",{className:d.join(" "),style:{display:"flex",alignItems:"center"},key:r},n&&i().createElement("span",{onClick:f,className:"left-icon mdi mdi-"+n}),i().createElement("div",{style:{flex:1},onClick:f},o,!l&&i().createElement("span",{className:"toggle-select mdi mdi-pin-"+(p?"off-":"")+"outline",onClick:f})),s&&i().createElement("span",{className:"right-icon mdi mdi-close",onClick:function(){return e.remove(r)}}))};y.forEach((function(e){if(!e.UserRole)if(e.GroupRole){var n="folder-account-outline";if("ROOT_GROUP"===e.Uuid)t.push({payload:e.Uuid,text:"/",icon:n});else{var o=c(e.Uuid);t.push({payload:e.Uuid,text:o||l("user.26","ajxp_admin").replace("%s",e.Label||e.Uuid),icon:n})}}else{var i=e.IsTeam?"account-group-outline":"card-account-details-outline";e.AutoApplies&&-1!==e.AutoApplies.indexOf(d)?t.push({payload:e.Uuid,text:e.Label+" [auto]",icon:i}):r.push({payload:e.Uuid,text:e.Label,removable:!0,icon:i})}}));var b=function(){return e.setState({open:!u})};return i().createElement("div",{className:"user-roles-picker paper-right-block",style:{padding:"8px 0"}},i().createElement("div",{style:{paddingLeft:16,display:"flex",alignItems:"center",height:40}},i().createElement("div",{style:{fontSize:20,cursor:"pointer"},onClick:b,className:"mdi mdi-chevron-"+(u?"down":"right")}),i().createElement("div",{style:{flex:1,fontSize:16,cursor:"pointer"},onClick:b},l("roles.picker.title")," ",s?" ("+l("21")+")":"")),u&&i().createElement(o.Fragment,null,i().createElement("div",{className:"roles-list"+(m?" has-selection":"")+(r.length>1?" has-sortable":""),style:{margin:"0 12px",paddingBottom:1}},t.map((function(e){return h(e)})),i().createElement(Qt,{key:"sortable",values:r,removable:!0,onRemove:this.remove.bind(this),onOrderUpdated:this.orderUpdated.bind(this),renderItem:h}),i().createElement("div",{className:"role-item role-item-add no-click",style:{height:44,padding:"0 8px",display:"flex",alignItems:"center"}},i().createElement("span",{className:"left-icon mdi mdi-account-multiple-plus-outline",style:{color:"rgb(5, 169, 244)",cursor:"pointer"}}),i().createElement(Yt,{userRoles:y,getMessage:l,onAddRole:function(e){return a.addRole(e)}}))),i().createElement("div",{className:"roles-list"+(m?" has-selection":""),style:{margin:"-2px 10px -8px",padding:"0px 2px 0",borderTop:"2px solid #b3b3b3"}},h({icon:"account-edit-outline",text:l("roles.picker.effective").replace("%s",f),removable:!1,noClick:!0,className:" effective"}))))}}])}(o.Component);const Zt=Xt=Y(Xt);function er(e){return er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},er(e)}function tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rr(n.key),n)}}function rr(e){var t=function(e){if("object"!=er(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=er(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==er(t)?t:t+""}function nr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(nr=function(){return!!e})()}function or(e){return or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},or(e)}function ir(e,t){return ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ir(e,t)}var ar=AdminComponents,sr=ar.PaperEditorLayout,lr=ar.PluginsLoader,cr=ar.AdminStyles,ur=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t,r){return t=or(t),function(e,t){if(t&&("object"==er(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nr()?Reflect.construct(t,r||[],or(e).constructor):t.apply(e,r))}(this,t,[e,r]),e.node?n.state=n.nodeToState(e.node):e.idmRole&&(n.state={idmRole:e.idmRole,roleType:"role",currentPane:"workspaces"},n.loadRoleData(!0)),lr.getInstance(n.props.pydio).loadPlugins().then((function(e){n.setState({pluginsRegistry:e})})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ir(e,t)}(t,e),n=t,o=[{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props,n=r.node,o=r.idmRole;e.node===n&&e.idmRole===o||(e.node?this.setState(this.nodeToState(e.node)):e.idmRole&&this.setState({idmRole:e.idmRole,roleType:"role",currentPane:"workspaces"},(function(){t.loadRoleData(!0)})))}},{key:"componentDidMount",value:function(){var e=this;this.loadRoleData(!0),this.props.registerCloseCallback&&this.props.registerCloseCallback((function(){if(e.state&&e.state.dirty&&!r.g.confirm(e.getPydioRoleMessage("19")))return!1}))}},{key:"componentWillUnmount",value:function(){this._websocketObserver&&this.props.pydio.stopObserving("websocket_event:idm",this._websocketObserver)}},{key:"nodeToState",value:function(e){var t,r=this,n=this.props.pydio,o="group"===e.getAjxpMime()?"group":"user",i=e.getMetadata().get("IdmUser");return(t=new q(i)).observe("update",(function(){r.forceUpdate()})),t.load(),this._websocketObserver&&n.stopObserving("websocket_event:idm",this._websocketObserver),this._websocketObserver=function(e){if(e.User&&"UPDATE"===e.Type&&e.User.Uuid===i.Uuid){if(e.Attributes&&e.Attributes.ctx_username===n.user.id)return;var t=r.state.observableUser;if(t.isDirty()&&!confirm("User was modified externally, you should revert your changes (click OK to reload)"))return void t.save();var o=new q(e.User);o.observe("update",(function(){r.forceUpdate()})),o.load(),r.setState({observableUser:o})}},n.observe("websocket_event:idm",this._websocketObserver),{observableUser:t,roleLabel:Ce().getBasename(e.getPath()),roleType:o,dirty:!1,currentPane:"user"===o?"info":"workspaces",localModalContent:{}}}},{key:"loadRoleData",value:function(e){var t=this;e&&this.setState({loadingMessage:this.getMessage("loading","ajxp_admin")});var r=this.state.idmRole,n=new N(r);n.load().then((function(){t.setState({loadingMessage:null,observableRole:n}),n.observe("update",(function(){t.forceUpdate()}))}))}},{key:"getChildContext",value:function(){var e=this.context.pydio.MessageHash;return{messages:e,getMessage:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return e[r+(r?".":"")+t]||t},getPydioRoleMessage:function(t){return e["role_editor."+t]||t},getRootMessage:function(t){return e[t]||t}}}},{key:"getMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return this.getChildContext().getMessage(e,t)}},{key:"getPydioRoleMessage",value:function(e){return this.getChildContext().getMessage(e,"role_editor")}},{key:"getRootMessage",value:function(e){return this.getChildContext().getMessage(e,"")}},{key:"setSelectedPane",value:function(e){this.setState({currentPane:e})}},{key:"showModal",value:function(e){this.setState({modal:e})}},{key:"hideModal",value:function(){this.setState({modal:null})}},{key:"logAction",value:function(e){this.setState({snackbar:e,snackOpen:!0})}},{key:"hideSnackBar",value:function(){this.setState({snackOpen:!1})}},{key:"buildGroupPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=this.props,r=t.node,n=t.dataModel;if(!r.getParent()&&!(r=r.findInArbo(n.getRootNode())))return"";for(var o=[];r.getParent();){var i=r.getParent();if(e&&i.getMetadata().has("IdmUser")&&i.getMetadata().get("IdmUser").Uuid===e&&(o=[]),"/idm/users"===i.getPath())break;o.push(i.getLabel()),r=i}return o.push(""),o.reverse().join("/")}},{key:"render",value:function(){var e,t,r,n=this,o=this.props,a=o.advancedAcl,s=o.pydio,l=o.node,c=o.dataModel,p=o.muiTheme,f=this.state,d=f.observableRole,y=f.observableUser,m=f.pluginsRegistry,h=f.currentPane,b=f.modal,g=f.roleType,v="",O="",P=!1,w="account-circle";if("user"===g){var S=y.getIdmUser();v=S.Attributes&&S.Attributes.displayName?S.Attributes.displayName:S.Login,r=S.Attributes&&"true"===S.Attributes.hidden,""!==S.GroupPath&&"/"!==S.GroupPath&&(v=i().createElement("div",null,i().createElement("div",null,v),i().createElement("div",{style:{fontSize:13,lineHeight:"18px",opacity:.7}},this.buildGroupPath()))),P="admin"===S.Attributes.profile,t=i().createElement(Xe,{user:y,pydio:s,pluginsRegistry:m,adminStyles:cr(p.palette)}),e=[{subHeader:this.getMessage("section.user-info")},{value:"info",label:this.getMessage("24"),icon:"mdi mdi-account-circle"},{value:"workspaces",label:this.getMessage("section.permissions"),icon:"mdi mdi-folder-lock-open-outline"},{subHeader:this.getMessage("section.advanced")},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"}],r&&(e=[{subHeader:"User Info"},{value:"info",label:this.getMessage("24"),icon:"mdi mdi-account-circle"}])}else if("group"===g)w="folder-account",O=this.getMessage("26"),v=y.getIdmUser().GroupLabel,y.getIdmUser().Attributes&&y.getIdmUser().Attributes.displayName&&(v=y.getIdmUser().Attributes.displayName),t=i().createElement(st,{group:y,pydio:s,pluginsRegistry:m,adminStyles:cr(p.palette)}),e=[{subHeader:this.getMessage("section.permissions")},{value:"workspaces",label:this.getMessage("35"),icon:"mdi mdi-folder-lock-open-outline"},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"},{subHeader:this.getMessage("section.advanced")},{value:"info",label:this.getMessage("27"),icon:"mdi mdi-account-circle"}];else if("role"===g){var E=d&&d.getIdmRole();v=E?E.Label:"...",w="card-account-details-outline",E&&(E.IsTeam?w="account-group-outline":E.UserRole?w="clipboard-account":E.GroupRole&&(w="folder-account")),O=this.getMessage("28"),P=!0,t=i().createElement(Be,{role:d,pydio:s,pluginsRegistry:m,adminStyles:cr(p.palette)}),e=[{subHeader:this.getMessage("section.permissions")},{value:"workspaces",label:this.getMessage("35"),icon:"mdi mdi-folder-lock-open-outline"},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"},{subHeader:this.getMessage("section.advanced")},{value:"info",label:this.getMessage("29"),icon:"mdi mdi-account-circle"}]}var j=!0,R=function(){},k=function(){};y?(j=!y.isDirty(),R=function(){y.save().then(n.props.afterSave)},k=function(){y.revert()}):d&&(j=!d.isDirty(),R=function(){d.save(n.props.afterSave)},k=function(){d.revert()});var A=[sr.actionButton(this.getMessage("plugins.6","ajxp_admin"),"mdi mdi-undo",k,j),sr.actionButton(this.getRootMessage("53"),"mdi mdi-content-save",R,j)],C=[],x=function(e){return h===e?"layout-fill":""},M=function(e){return h===e?{overflowY:"auto",overflowX:"hidden"}:{height:0,overflow:"hidden"}};C.push(i().createElement("div",{key:"info",className:"avatar-provider "+x("info"),style:M("info")},O&&!this.state.loadingMessage?i().createElement("h3",{className:"paper-right-title"},O):null,t)),"workspaces"===h?C.push(i().createElement("div",{key:"workspaces",className:x("workspaces"),style:M("workspaces")},i().createElement("h3",{className:"paper-right-title"},this.getRootMessage("250"),i().createElement("div",{className:"section-legend"},this.getMessage("permissions.legend."+g))),"user"===g&&y&&y.getIdmUser()&&i().createElement(Zt,{node:l,dataModel:c,user:y,buildGroupPath:this.buildGroupPath.bind(this)}),i().createElement("div",{className:"paper-right-block"},i().createElement("div",{className:"read-write-header",style:{textAlign:"right",paddingRight:16}},i().createElement("span",{className:"header-read"},this.getMessage("react.5a","ajxp_admin")),i().createElement("span",{className:"header-write"},this.getMessage("react.5b","ajxp_admin")),i().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),i().createElement(Oe,{key:"workspaces-list",role:y?y.getRole():d,roleType:this.state.roleType,advancedAcl:a,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this)})))):"pages"===h?C.push(i().createElement("div",{key:"pages",className:x("pages"),style:M("pages")},i().createElement("h3",{className:"paper-right-title"},this.getMessage("44"),i().createElement("div",{className:"section-legend"},this.getMessage("45"))),i().createElement("div",{className:"paper-right-block"},i().createElement("div",{className:"read-write-header",style:{textAlign:"right",paddingRight:16}},i().createElement("span",{className:"header-read"},this.getMessage("react.5c","ajxp_admin")),i().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),i().createElement(ke,{key:"pages-list",role:y?y.getRole():d,roleType:this.state.roleType,advancedAcl:a,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this),showSettings:P,pydio:s})))):"params"===h&&C.push(i().createElement("div",{key:"params",className:x("params"),style:M("params")},i().createElement(_t,{pydio:s,role:y?y.getRole():d,roleType:this.state.roleType})));var N=null;return this.state.loadingMessage&&(N=i().createElement("div",{className:"loader-container layout-fill vertical-layout"},i().createElement("div",{className:"loader-message",style:{margin:"auto",color:"rgba(0,0,0,0.33)",fontWeight:"500",fontSize:16}},this.state.loadingMessage))),i().createElement(sr,{title:v,titleLeftIcon:"mdi mdi-"+w,titleActionBar:A,closeAction:function(){n.props.onRequestTabClose()},contentFill:!0,leftNavItems:e,leftNavSelected:h,leftNavChange:function(e){n.setSelectedPane(e)},className:"edit-object-"+this.state.roleType},i().createElement(u.Snackbar,{message:this.state.snackbar||"",open:this.state.snackOpen,autoHideDuration:4e3,ref:"snack",action:"Dismiss",onRequestClose:this.hideSnackBar.bind(this)}),b,N,C,cr(p.palette).formSimpleCss())}}],o&&tr(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(i().Component);ur.contextTypes={pydio:c().instanceOf(f())},ur.childContextTypes={messages:c().object,getMessage:c().func,getPydioRoleMessage:c().func,getRootMessage:c().func},ur.propTypes={node:c().instanceOf(AjxpNode),closeEditor:c().func,registerCloseCallback:c().func},ur=(0,xe.muiThemeable)()(ur);const pr=require("pydio/model/data-model");var fr=r.n(pr);const dr=require("lodash.debounce");var yr=r.n(dr);const mr=require("pydio/model/node");var hr=r.n(mr);function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function gr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gr(Object(r),!0).forEach((function(t){Or(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Or(e,t,r){return(t=wr(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wr(n.key),n)}}function wr(e){var t=function(e){if("object"!=br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==br(t)?t:t+""}function Sr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Sr=function(){return!!e})()}function Er(e){return Er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Er(e)}function jr(e,t){return jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jr(e,t)}var Rr=f().requireLib("hoc").ModernTextField,kr=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t,r){return t=Er(t),function(e,t){if(t&&("object"==br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Sr()?Reflect.construct(t,r||[],Er(e).constructor):t.apply(e,r))}(this,t,[e]);var n=new(fr());return n.setRootNode(new(hr())),r.state={dataModel:n,displayResult:e.displayResultsState,crtValue:""},r.searchDebounced=yr()(r.triggerSearch,350),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jr(e,t)}(t,e),r=t,(n=[{key:"displayResultsState",value:function(){this.setState({displayResult:!0})}},{key:"hideResultsState",value:function(){this.setState({displayResult:!1}),this.props.hideResults()}},{key:"triggerSearch",value:function(){var e=this,t=this.state.crtValue;if(t){var r=this.state.dataModel,n=this.props,o=n.limit,i=void 0===o?100:o,a=n.filterQueries;r.getRootNode().setChildren([]);var s=h().getRestClient().getIdmApi().listGroups("/",t,!0,0,i),l=h().getRestClient().getIdmApi().listUsers("/",t,!0,0,i,a);Promise.all([s,l]).then((function(n){var o=n[0],i=n[1];o.Groups.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.GroupLabel,n=new(hr())("/idm/users"+W().trimRight(e.GroupPath,"/")+"/"+e.GroupLabel,!1,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","group"),r.getRootNode().addChild(n)})),i.Users.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.Login,n=new(hr())("/idm/users/"+e.Login,!0,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","user_editable"),r.getRootNode().addChild(n)})),r.getRootNode().setLoaded(!0),e.displayResultsState(),e.props.displayResults(t,r,(function(){return e.triggerSearch()}),(function(){return e.setState({crtValue:""})}))}))}else{this.hideResultsState();try{this.refs.query.refs.input.blur()}catch(e){}}}},{key:"keyDown",value:function(e){"Enter"===e.key?(e.preventDefault(),this.triggerSearch()):this.searchDebounced()}},{key:"render",value:function(){var e=this,t=this.state.crtValue,r=this.props.filterButton;return i().createElement("div",{className:this.props.className?this.props.className:"",style:vr({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},i().createElement("div",{style:{flex:1,maxWidth:420}},i().createElement("form",{autoComplete:"off"},i().createElement(Rr,{ref:"query",onKeyDown:this.keyDown.bind(this),hintText:this.props.textLabel,fullWidth:!0,value:t,onChange:function(t,r){e.setState({crtValue:r})},variant:"compact"}))),r)}}])&&Pr(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function Cr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xr(n.key),n)}}function xr(e){var t=function(e){if("object"!=Ar(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Ar(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ar(t)?t:t+""}kr.PropTypes={textLabel:c().string,displayResults:c().func,hideResults:c().func,displayResultsState:c().bool,limit:c().number,style:c().object};var Mr=f().requireLib("components").DNDActionParameter,Nr=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"deleteAction",value:function(e,t,r){var n,o,i=(n=t&&t.length?t[0]:pydio.getUserSelection()).getUniqueNode();switch(i.getMetadata().get("ajxp_mime")){case"user_editable":o="settings.34";break;case"group":o="settings.126"}var a=function(){};if(r)a=r;else if(i.getParent()){var s=i.getParent();a=function(){s.reload(null,!0)}}pydio.UI.openConfirmDialog({message:MessageHash[o],validCallback:function(){var e=n.getSelectedNodes(),t=function(){if(e.length){var r=e.shift();h().getRestClient().getIdmApi().deleteIdmUser(r.getMetadata().get("IdmUser")).then((function(){a(),t()})).catch((function(e){f().getInstance().UI.displayMessage("ERROR",e.message),t()}))}};t()}})}},{key:"applyDND",value:function(e,t){t.getStep()===Mr.STEP_CAN_DROP?AdminComponents.DNDActionsManager.canDropNodeOnNode(t.getSource(),t.getTarget()):t.getStep()===Mr.STEP_END_DRAG&&AdminComponents.DNDActionsManager.dropNodeOnNode(t.getSource(),t.getTarget())}},{key:"bulkMoveAction",value:function(e,t){var r=f().getInstance(),n=t[0].getSelectedNodes();r.UI.openComponentInModal("AdminPeople","TreeGroupsDialog",{pydio:r,dataModel:r.getContextHolder(),submitValue:function(e,t){var r=function(){if(n.length){var e=n.shift();AdminComponents.DNDActionsManager.dropNodeOnNode(e,t),r()}};r()}})}}],null&&Cr(e.prototype,null),t&&Cr(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const Ir=require("pydio/util/func");var Tr=r.n(Ir);const _r=require("pydio/http/resources-manager");var Dr=r.n(_r);function Ur(e){return Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ur(e)}function Lr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var r=e.split("."),n=r.shift(),o=r.join(".");return Dr().loadClass(n).then((function(r){var i=Tr().getFunctionByName(o,r);if(!i){if("object"===Ur(r)&&r[n]){var a=Tr().getFunctionByName(o,r[n]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(r){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw r}))}function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Fr(){return Fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fr.apply(null,arguments)}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Wr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hr(Object(r),!0).forEach((function(t){Gr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Gr(e,t,r){return(t=function(e){var t=function(e){if("object"!=Br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Br(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Vr=f().requireLib("boot").JobsStore,zr=f().requireLib("components"),Kr=zr.DNDTreeView,Jr=zr.SimpleList,Qr=function(e,t){switch(e){case"admin":return t(157,"settings");case"shared":return t(158,"settings");case"standard":return t(156,"settings");default:return e}},$r="#E53934",Yr=s()({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:c().instanceOf(fr()).isRequired,rootNode:c().instanceOf(hr()).isRequired,currentNode:c().instanceOf(hr()).isRequired,accessByName:c().func.isRequired,openEditor:c().func.isRequired},getInitialState:function(){var e=this.props,t=e.currentNode,r=e.dataModel,n=this.findUsersRoot(t),o={};return n&&n.getMetadata().has("dashboardFilter")&&(o.filter=n.getMetadata().get("dashboardFilter"),o.filterActive=n.getMetadata().get("dashboardFilterActive"),o.filterQueries=n.getMetadata().get("userProfileFilter")),Wr({searchResultData:!1,currentNode:t,dataModel:r,showAnon:!1},o)},componentDidMount:function(){var e=this,t=Vr.getInstance();this._jStoreObserver=function(r){r&&0===r.indexOf("delete-group-")&&t.getJobs().then((function(t){try{"Finished"===t.get(r).Tasks[0].Status&&e.reloadList()}catch(e){}}))},t.observe("tasks_updated",this._jStoreObserver)},componentWillUnmounnt:function(){Vr.getInstance().stopObserving("tasks_updated",this._jStoreObserver)},componentWillReceiveProps:function(e){!this.state.searchResultData&&e.currentNode&&0===e.currentNode.getPath().indexOf("/idm/users")&&this.setState({currentNode:e.currentNode,dataModel:e.dataModel})},reloadList:function(){var e=this.state.searchResultData;e?e.reload():this.refs.mainlist&&this.refs.mainlist.reload()},renderListUserAvatar:function(e){var t={backgroundColor:"#9e9e9e",color:"white",borderRadius:"50%",margin:16,width:33,height:33,fontSize:18,padding:6,textAlign:"center"};if("role"===e.getAjxpMime())return t.backgroundColor="#607d8b",i().createElement(u.FontIcon,{className:"mdi mdi-account-card-details",style:t});var r=e.getMetadata().get("IdmUser"),n=this.props.pydio;if(r.Attributes&&r.Attributes.avatar){var o=n.Parameters.get("ENDPOINT_REST_API")+"/frontend/binaries/USER/"+r.Login+"?"+r.Attributes.avatar+"&dim=33";return i().createElement("div",{style:{width:33,height:33,backgroundImage:"url("+o+")",backgroundSize:"cover",borderRadius:"50%",backgroundPosition:"center",margin:16}})}var a=e.isLeaf()?"mdi mdi-account":"mdi mdi-folder-account";return t.backgroundColor=e.isLeaf()?"#9e9e9e":"#607d8b",i().createElement(u.FontIcon,{className:a,style:t})},renderListEntryFirstLine:function(e){if("role"===e.getAjxpMime())return i().createElement("span",null,e.getMetadata().get("IdmRole").Label);var t,r=e.getMetadata().get("IdmUser"),n=r.Attributes?r.Attributes.profile:"",o=[],a={display:"inline-block",marginLeft:5,fontSize:14};return"shared"===n?o.push(i().createElement("span",{className:"mdi mdi-share-variant",style:Wr(Wr({},a),{},{color:"#009688"}),title:this.context.getMessage("user.13")})):"admin"===n&&o.push(i().createElement("span",{className:"mdi mdi-security",style:Wr(Wr({},a),{},{color:"#03a9f4"})})),r.Attributes&&r.Attributes.locks&&r.Attributes.locks.indexOf("logout")>-1&&o.push(i().createElement("span",{className:"mdi mdi-lock",style:Wr(Wr({},a),{},{color:$r})})),r.Attributes&&"true"===r.Attributes.hidden&&(t=this.context.getMessage("user.type.hidden")+" "),i().createElement("span",null,t,e.getLabel()," ",o)},renderListEntrySecondLine:function(e){var t=this.state.searchResultData;if("role"===e.getAjxpMime())return i().createElement("span",null,this.context.getMessage("user.rootgroup.legend"));var r=e.getMetadata().get("IdmUser");if(e.isLeaf()){if("/idm/users"===e.getPath())return this.context.getMessage("user.8");var n=[];n.push(r.Login),t&&"/"!==r.GroupPath&&n.push(this.context.getMessage("user.12")+": "+Ce().getDirname(r.GroupPath));var o=r.Attributes||{};o.profile&&n.push(Qr(o.profile,this.context.getMessage)),o.last_connection_readable&&n.push(this.context.getMessage("user.9")+" "+o.last_connection_readable);var a=r.Roles;return a&&a.length&&n.push(this.context.getMessage("user.11").replace("%i",a.length)),n.join(" - ")}return this.context.getMessage("user.12")+": "+e.getPath().replace("/idm/users","")},renderListEntrySelector:function(e){return"/idm/users"!==e.getPath()&&"role"!==e.getAjxpMime()&&e.isLeaf()},displaySearchResults:function(e,t,r,n){var o=this;this.setState({searchResultTerm:e,searchResultData:{term:e,toggleState:function(){n(),o.hideSearchResults()},reload:r},currentNode:t.getContextNode(),dataModel:t})},hideSearchResults:function(){var e=this;this.setState({searchResultData:!1,currentNode:this.props.currentNode,dataModel:this.props.dataModel},(function(){return e.reloadList()}))},createUserAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateUserForm",{dataModel:this.props.dataModel,openRoleEditor:this.openRoleEditor.bind(this)})},createGroupAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"group",openRoleEditor:this.openRoleEditor.bind(this)})},openUsersImporter:function(){pydio.UI.openComponentInModal("EnterprisePeople","UsersImportDialog",{dataModel:this.props.dataModel})},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps,s=this.state.dataModel;if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"]))return!1;var l=Wr({ref:"editor",node:e,dataModel:s,pydio:o,initialEditSection:r,onRequestTabClose:this.closeRoleEditor,afterSave:function(){t.reloadList()}},a);"role"===e.getAjxpMime()&&(delete l.node,l.idmRole=e.getMetadata().get("IdmRole")),Lr(i,ur).then((function(e){t.props.openRightPane({COMPONENT:e,PROPS:l})})).catch((function(e){console.log(e)}))},closeRoleEditor:function(){if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"]))return!1;this.props.closeRightPane()},deleteAction:function(e){var t=this,r=new(fr());r.setSelectedNodes([e]),Nr.deleteAction(null,[r],(function(){t.reloadList()}))},renderNodeActions:function(e){var t=this,r=this.props,n=(r.dataModel,r.rootNode,this.state.searchResultData,e.getAjxpMime());if(e.getMetadata().has("IdmUser")&&!e.getMetadata().get("IdmUser").PoliciesContextEditable)return i().createElement("div",null);var o={color:"inherit",opacity:.5,fontSize:20},a=[];return a.push(i().createElement(u.IconButton,{key:"edit",iconClassName:"mdi mdi-pencil",onClick:function(r){r.stopPropagation(),t.openRoleEditor(e)},iconStyle:o})),"user_editable"===n||"group"===n?a.push(i().createElement(u.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",onClick:function(r){r.stopPropagation(),t.deleteAction(e)},iconStyle:o})):"user"!==n&&"role"!==n||a.push(i().createElement(u.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",disabled:!0,iconStyle:{color:"inherit",opacity:.15,fontSize:20},onClick:function(e){e.stopPropagation()}})),i().createElement("div",null,a)},filterNodes:function(e){if(!e.getMetadata().has("IdmUser"))return!0;var t=this.state,r=t.showAnon;return!(!t.searchResultData&&!r)||"anon"!==(e.getMetadata().get("IdmUser").Attributes||{}).profile},findUsersRoot:function(e){for(var t=e;"/idm/users"!==t.getPath();)if(!(t=t.getParent()))return null;return t},applyFilter:function(e){var t,r,n=this,o=(t=e.split(":"),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(t,r)||function(e,t){if(e){if("string"==typeof e)return qr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qr(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1],s=this.state,l=s.filter,c=void 0===l?{}:l,u=s.showAnon;switch(i){case"toggle-anon":return void this.setState({showAnon:!u});case"profile":c.profile=a;break;case"attr":c.attrs||(c.attrs={}),c.attrs[a]=!c.attrs[a]}("standard"===c.profile||"admin"===c.profile)&&c.attrs&&c.attrs.hidden&&delete c.attrs.hidden;var p=c.attrs||{},f=c.profile||Object.keys(p).filter((function(e){return p[e]})).length>0,d=this.filterToQueries(c);this.setState({filter:c,filterActive:f,filterQueries:d},(function(){return n.computeFilter(d,c,f)}))},filterToQueries:function(e){var t=e.profile,r=e.attrs,n=[];if(t){var o=!1;"!"===t[0]&&(o=!0,t=t.substring(1)),n.push({name:"profile",value:t,not:o})}return r&&Object.keys(r).length&&Object.keys(r).filter((function(e){return r[e]})).map((function(e){switch(e){case"locks":n.push({name:"locks",value:"*logout*"});break;case"hidden":n.push({name:"hidden",value:"true"})}})),n.length>0&&!n.filter((function(e){return"hidden"===e.name})).length&&n.push({name:"hidden",value:"true",not:!0}),n},computeFilter:function(e,t,r){var n=this,o=this.props.currentNode,i=this.findUsersRoot(o);i&&(i.getMetadata().delete("userProfileFilter"),i.getMetadata().delete("dashboardFilter"),i.getMetadata().delete("dashboardFilterActive"),e.length&&(i.getMetadata().set("userProfileFilter",e),i.getMetadata().set("dashboardFilter",t),i.getMetadata().set("dashboardFilterActive",r)),o.getMetadata().delete("paginationData"),this.setState({currentNode:o},(function(){n.reloadList()})))},render:function(){var e=this,t=this.props,r=t.accessByName,n=t.muiTheme,o=t.rootNode,a=t.pydio,s=this.state,l=s.searchResultData,c=s.currentNode,p=s.dataModel,f=s.showAnon,d=s.filter,y=void 0===d?{}:d,m=s.filterActive,h=void 0!==m&&m,b=s.filterQueries,g=AdminComponents.AdminStyles(n.palette),v=[],O=function(){return[]},P=null,w=[];r("Create")&&(O=this.renderNodeActions.bind(this),w=[a.Controller.getActionByName("move"),a.Controller.getActionByName("delete")],P=this.openRoleEditor.bind(this),v=[i().createElement(u.FlatButton,Fr({primary:!0,label:this.context.getMessage("user.1"),onClick:this.createUserAction},g.props.header.flatButton)),i().createElement(u.FlatButton,Fr({primary:!0,label:this.context.getMessage("user.2"),onClick:this.createGroupAction},g.props.header.flatButton))]);var S="profile:"+(y.profile||""),E=y.attrs&&y.attrs.locks,j=y.attrs&&y.attrs.hidden,R={zoom:.8,top:0},k=Wr({},R),A=Wr({},R);E&&(k=Wr(Wr({},R),{},{color:$r})),f&&(A=Wr(Wr({},R),{},{color:"#03a9f4"}));var C={};h&&(C={backgroundColor:n.palette.accent1Color});var x=i().createElement(u.IconMenu,{iconButtonElement:i().createElement(u.IconButton,{iconClassName:h?"mdi mdi-filter-variant-plus":"mdi mdi-filter-variant",tooltip:this.context.getMessage("user.filter.tooltip"),tooltipPosition:"bottom-left",style:Wr(Wr({},g.props.header.iconButton.style),C),iconStyle:g.props.header.iconButton.iconStyle}),anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},value:S,onChange:function(t,r){e.applyFilter(r)},desktop:!0,clickCloseDelay:0},i().createElement(u.Subheader,{style:{lineHeight:"28px"}},this.context.getMessage("22","role_editor")),i().createElement(u.MenuItem,{value:"profile:",primaryText:this.context.getMessage("user.filter.all"),rightIcon:i().createElement(u.FontIcon,{style:R,className:"mdi mdi-"+(j||"profile:"!==S?"checkbox-blank-outline":"checkbox-marked-outline")})}),i().createElement(u.MenuItem,{value:"profile:admin",primaryText:this.context.getMessage("user.filter.admins"),rightIcon:i().createElement(u.FontIcon,{style:R,className:"mdi mdi-"+("profile:admin"===S?"checkbox-marked-outline":"checkbox-blank-outline")})}),i().createElement(u.MenuItem,{value:"profile:standard",primaryText:this.context.getMessage("user.filter.internal"),rightIcon:i().createElement(u.FontIcon,{style:R,className:"mdi mdi-"+("profile:standard"===S?"checkbox-marked-outline":"checkbox-blank-outline")})}),i().createElement(u.MenuItem,{value:"profile:shared",primaryText:this.context.getMessage("user.filter.shared"),rightIcon:i().createElement(u.FontIcon,{style:R,className:"mdi mdi-"+(j||"profile:shared"!==S?"checkbox-blank-outline":"checkbox-marked-outline")})}),i().createElement(u.MenuItem,{value:"attr:hidden",primaryText:this.context.getMessage("user.filter.hidden"),disabled:"profile:standard"===S||"profile:admin"===S,rightIcon:i().createElement(u.FontIcon,{style:R,className:"mdi mdi-"+(j?"checkbox-marked-outline":"checkbox-blank-outline")})}),i().createElement(u.Divider,null),i().createElement(u.Subheader,{style:{lineHeight:"28px"}},this.context.getMessage("user.filter.status")),i().createElement(u.MenuItem,{value:"attr:locks",primaryText:this.context.getMessage("user.filter.locks"),rightIcon:i().createElement(u.FontIcon,{style:Wr({},k),className:"mdi mdi-"+(E?"lock-check-outline":"lock-outline")})}),i().createElement(u.MenuItem,{value:"toggle-anon",primaryText:this.context.getMessage("user.filter.anon"),rightIcon:i().createElement(u.FontIcon,{style:A,className:"mdi mdi-"+(f?"incognito":"incognito-off")})})),M=g.body,N=M.block.props,I=M.block.container,T=Wr(Wr({height:48,lineHeight:"48px",fontSize:14,fontWeight:500},M.block.header),{},{borderBottom:"1px solid "+M.tableMaster.row.borderBottomColor,padding:"0 20px"}),_={width:250,borderRight:"1px solid"+M.tableMaster.row.borderBottomColor,overflowY:"auto",flex:"none"};return!1!==l&&(_=Wr(Wr({},_),{},{opacity:.6})),i().createElement("div",{className:"main-layout-nav-to-stack vertical-layout people-dashboard"},i().createElement(AdminComponents.Header,{title:this.context.getMessage("2","settings"),icon:"mdi mdi-account-multiple",actions:v,centerContent:i().createElement(kr,{displayResults:this.displaySearchResults,displayResultsState:l,hideResults:this.hideSearchResults,limit:50,textLabel:this.context.getMessage("user.7"),className:"media-small-hide",filterButton:x,filterQueries:b})}),i().createElement(u.Paper,Fr({},N,{style:I,className:"horizontal-layout layout-fill"}),i().createElement("div",{className:"hide-on-vertical-layout vertical-layout tab-vertical-layout",style:_},i().createElement("div",{style:{flex:1}},i().createElement("div",{style:T},this.context.getMessage("user.3")),i().createElement(Kr,{showRoot:!0,rootLabel:this.context.getMessage("user.5"),node:o,dataModel:this.props.dataModel,className:"users-groups-tree",paddingOffset:10,noPaginator:!0}))),i().createElement("div",{zDepth:0,className:"layout-fill vertical-layout people-list"},i().createElement(Jr,{ref:"mainlist",pydio:a,node:c,dataModel:p,clearSelectionOnReload:!1,openEditor:P,entryRenderIcon:this.renderListUserAvatar.bind(this),entryRenderFirstLine:this.renderListEntryFirstLine.bind(this),entryRenderSecondLine:this.renderListEntrySecondLine.bind(this),entryEnableSelector:this.renderListEntrySelector.bind(this),entryRenderActions:O,searchResultData:l,elementHeight:Jr.HEIGHT_TWO_LINES,hideToolbar:!1,toolbarStyle:{backgroundColor:M.block.header.backgroundColor,height:48,borderBottom:T.borderBottom},multipleActions:w,filterNodes:this.filterNodes.bind(this)}))))}});function Xr(e){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xr(e)}function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function en(){return en=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},en.apply(null,arguments)}function tn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(r),!0).forEach((function(t){nn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function nn(e,t,r){return(t=function(e){var t=function(e){if("object"!=Xr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Xr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xr(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Yr=(0,xe.muiThemeable)()(Yr);var on=r(509).muiThemeable,an=f().requireLib("components").MaterialTable,sn=f().requireLib("hoc").ModernTextField,ln={admin:"card-account-details-outline",IsUserRole:"clipboard-account",IsGroupRole:"folder-account",IsTeam:"account-group-outline"},cn=s()({displayName:"RolesDashboard",mixins:[AdminComponents.MessagesConsumerMixin],getInitialState:function(){return{roles:[],loading:!1,showTechnical:!1,types:[h().RoleTypeAdmin]}},load:function(){var e=this,t=this.state.types;this.setState({loading:!0});var r=h().getRestClient().getIdmApi();f().startLoading(),r.listRolesV2(0,-1,t).then((function(t){f().endLoading(),e.setState({roles:t,loading:!1})})).catch((function(t){f().endLoading(),e.setState({loading:!1})}))},componentDidMount:function(){this.load()},openTableRows:function(e){e.length&&e[0].role.PoliciesContextEditable&&this.openRoleEditor(e[0].role)},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"])||(Lr(i,ur).then((function(n){t.props.openRightPane({COMPONENT:n,PROPS:rn({ref:"editor",idmRole:e,pydio:o,initialEditSection:r,onRequestTabClose:t.closeRoleEditor},a)})})).catch((function(e){console.log(e)})),0))},closeRoleEditor:function(){return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"])||(this.props.closeRightPane(),0))},deleteAction:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.126"],destructive:[r||e],validCallback:function(){h().getRestClient().getIdmApi().deleteRole(e).then((function(){t.load()}))}})},createRoleAction:function(){var e=this;pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"role",roleNode:this.state.currentNode,openRoleEditor:this.openRoleEditor.bind(this),roles:this.state.roles,reload:function(){e.load()}})},computeTableData:function(e){var t=this,r=this.state.roles,n=[];return r.map((function(r){var o=r.Label;if(!e||-1!==o.toLowerCase().indexOf(e.toLowerCase())){var a=h().RoleTypeAdmin;r.UserRole?a=h().RoleTypeUser:r.GroupRole?a=h().RoleTypeGroup:r.IsTeam&&(a=h().RoleTypeTeam),n.push({role:r,roleId:r.Uuid,roleLabel:i().createElement("span",{style:{display:"flex",alignItems:"flex-end"}},i().createElement("span",{style:{fontSize:22,marginRight:12,marginLeft:-8,opacity:.7},title:t.context.getMessage("roleType."+a,"role_editor"),className:"mdi mdi-"+ln[a]}),o),sorterValue:"ROOT_GROUP"===r.Uuid?"0000000":o,isDefault:r.AutoApplies.join(", ")||"-",lastUpdated:r.LastUpdated,roleType:t.context.getMessage("roleType."+a,"role_editor")})}})),n},render:function(){var e=this,t=this.props,r=t.pydio,n=t.muiTheme,o=t.accessByName,a=AdminComponents.AdminStyles(n.palette),s=this.state,l=s.searchRoleString,c=(s.showTechnical,s.types),p=o("Create"),f=[h().RoleTypeAdmin,h().RoleTypeTeam,h().RoleTypeGroup,h().RoleTypeUser],d=null,y=[];p&&(y.push(i().createElement(u.FlatButton,en({},a.props.header.flatButton,{primary:!0,label:this.context.getMessage("user.6"),onClick:this.createRoleAction.bind(this)}))),d=this.openTableRows.bind(this));var m=i().createElement(u.IconMenu,{iconButtonElement:i().createElement(u.IconButton,en({tooltip:this.context.getMessage("dashboard.filterByType","role_editor"),iconClassName:"mdi mdi-filter-variant"},a.props.header.iconButton)),anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},onChange:function(t,n){var o,i;0!==(o=c.indexOf(n)>-1?c.filter((function(e){return e!==n})):[].concat((i=c,function(e){if(Array.isArray(e))return Zr(e)}(i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(e,t){if(e){if("string"==typeof e)return Zr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zr(e,t):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[n])).length?e.setState({types:o},(function(){e.load()})):r.UI.displayMessage("ERROR",e.context.getMessage("dashboard.filterSelectOne","role_editor"))},desktop:!0,clickCloseDelay:0},f.map((function(t){var r=c.indexOf(t)>-1?"checkbox-marked-outline":"checkbox-blank-outline";return i().createElement(u.MenuItem,{primaryText:e.context.getMessage("dashboard.typeFilter."+t,"role_editor"),value:t,leftIcon:i().createElement(u.FontIcon,{className:"mdi mdi-"+ln[t],style:{zoom:.9,top:0}}),rightIcon:i().createElement(u.FontIcon,{className:"mdi mdi-"+r,style:{zoom:.9,top:0}})})}))),b=i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},i().createElement("div",{style:{flex:1,maxWidth:380}},i().createElement(sn,{fullWidth:!0,hintText:this.context.getMessage("47","role_editor")+"...",value:l||"",onChange:function(t,r){return e.setState({searchRoleString:r})},variant:"compact"})),m),g=[{name:"roleLabel",label:this.context.getMessage("32","role_editor"),style:{width:"40%",fontSize:15},headerStyle:{width:"40%"},sorter:{type:"string",default:!0,value:function(e){return e.sorterValue}}},{name:"roleType",label:this.context.getMessage("roleType","role_editor"),style:{width:140},headerStyle:{width:140},hideSmall:!0,sorter:{type:"string"}},{name:"lastUpdated",useMoment:!0,label:this.context.getMessage("last_update","role_editor"),hideSmall:!0,sorter:{type:"number"}},{name:"isDefault",label:this.context.getMessage("114","settings"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,sorter:{type:"string"}}],v=[];p&&(v.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit",onClick:function(t){e.openRoleEditor(t.role)},disable:function(e){return!e.role.PoliciesContextEditable}}),v.push({iconClassName:"mdi mdi-delete",tooltip:"Delete",onClick:function(t){e.deleteAction(t.role.Uuid,t.role.Label)},disable:function(e){return!e.role.PoliciesContextEditable}}));var O=this.computeTableData(l),P=AdminComponents.AdminStyles().body,w=P.tableMaster,S=P.block.props,E=P.block.container;return i().createElement("div",{className:"main-layout-nav-to-stack vertical-layout"},i().createElement(AdminComponents.Header,{title:this.context.getMessage("69","settings"),icon:"mdi mdi-account-multiple",actions:y,centerContent:b,reloadAction:function(){e.load()},loading:this.state.loading}),i().createElement("div",{className:"layout-fill"},i().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("dashboard.description","role_editor")}),i().createElement(u.Paper,en({},S,{style:E}),i().createElement(an,{data:O,columns:g,actions:v,onSelectRows:d,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:w,paginate:[25,50,100],storageKey:"console.roles.list"}))))}});function un(e){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(e)}function pn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fn(n.key),n)}}function fn(e){var t=function(e){if("object"!=un(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=un(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==un(t)?t:t+""}function dn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(dn=function(){return!!e})()}function yn(e){return yn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yn(e)}function mn(e,t){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mn(e,t)}cn=on()(cn);var hn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){return t=yn(t),function(e,t){if(t&&("object"==un(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,dn()?Reflect.construct(t,r||[],yn(e).constructor):t.apply(e,r))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mn(e,t)}(t,e),r=t,n=[{key:"componentDidMount",value:function(){this.props.create&&this.openEditor(!0)}},{key:"openEditor",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.props,n=r.pydio,o=r.policy,i=r.rule,a=r.openRightPane,s=r.rulesEditorClass;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(n.MessageHash["role_editor.19"])||!s||(Lr(s,null).then((function(r){a({COMPONENT:r,PROPS:{ref:"editor",policy:o,rule:i,pydio:n,create:t,saveRule:e.props.onRuleChange,onRequestTabClose:e.closeEditor.bind(e)}})})).catch((function(e){console.error(e)})),0))}},{key:"closeEditor",value:function(e){var t=this.props,r=t.pydio,n=t.closeRightPane;if(e&&e.isDirty()){if(e.isCreate())return this.props.onRemoveRule(this.props.rule,!0),n(),!0;if(!window.confirm(r.MessageHash["role_editor.19"]))return!1}return n(),!0}},{key:"removeRule",value:function(){var e=this.props,t=e.pydio,r=e.onRemoveRule,n=e.rule;t.UI.openConfirmDialog({message:t.MessageHash["ajxp_admin.policies.rule.delete.confirm"],destructive:[n.description],validCallback:function(){r(n)}})}},{key:"render",value:function(){var e=this,t=this.props,r=t.rule,n=t.readonly,o=t.isLast,a=t.create,s="allow"===r.effect?"#33691e":"#d32f2f",l=[];return n||(l=[i().createElement("span",{className:"mdi mdi-pencil",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:function(t){return e.openEditor()}}),i().createElement("span",{className:"mdi mdi-delete",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:function(t){return e.removeRule()}})]),i().createElement("div",{style:{display:"flex",padding:"6px 0 5px",borderBottom:o?null:"1px solid white"}},i().createElement(u.FontIcon,{className:"mdi mdi-traffic-light",color:s,style:{fontSize:16,marginRight:10}}),i().createElement("div",{style:{flex:1}},a&&i().createElement("span",null,"[NEW] "),r.description,l))}}],n&&pn(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function bn(e){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bn(e)}function gn(){return gn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gn.apply(null,arguments)}function vn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function On(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(r),!0).forEach((function(t){Pn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Pn(e,t,r){return(t=Sn(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sn(n.key),n)}}function Sn(e){var t=function(e){if("object"!=bn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=bn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==bn(t)?t:t+""}function En(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(En=function(){return!!e})()}function jn(e){return jn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jn(e)}function Rn(e,t){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rn(e,t)}var kn=f().requireLib("hoc").ModernTextField,An=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=jn(t),function(e,t){if(t&&("object"==bn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,En()?Reflect.construct(t,r||[],jn(e).constructor):t.apply(e,r))}(this,t,[e])).state={policy:e.policy},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rn(e,t)}(t,e),r=t,n=[{key:"componentWillReceiveProps",value:function(e){this.setState({policy:e.policy})}},{key:"componentDidMount",value:function(){this.props.newPolicyWithRule&&this.onAddRule(null,this.props.newPolicyWithRule)}},{key:"onNameChange",value:function(e){var t=On({},this.state.policy);t.Name=e,this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"onDescriptionChange",value:function(e){var t=On({},this.state.policy);t.Description=e,this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"saveLabels",value:function(){var e=this.state,t=e.pName,r=e.pDesc,n=e.policy;t&&(n.Name=t),r&&(n.Description=r),this.setState({pName:null,pDesc:null,createRule:null}),this.props.savePolicy(n)}},{key:"onRuleChange",value:function(e){var t=On({},this.state.policy);t.Policies?(t.Policies=t.Policies.filter((function(t){return t.id!==e.id})),t.Policies.push(e)):t.Policies=[e],this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"onRemoveRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=On({},this.state.policy);r.Policies=r.Policies.filter((function(t){return t.id!==e.id})),this.setState({createRule:null}),this.props.savePolicy(r,t)}},{key:"onAddRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=On({},this.state.policy);r.Policies||(r.Policies=[]);var n=S(),o=[],i=[];"acl"===r.ResourceGroup?(o=["policy:"+r.Uuid],i=["acl"]):"oidc"===r.ResourceGroup&&(i=["oidc"]),r.Policies.push({id:n,description:t,actions:[],subjects:o,resources:i,effect:"deny"}),this.setState({policy:r,createRule:n},(function(){}))}},{key:"render",value:function(){var e,t=this,r=this.props,n=r.readonly,o=r.pydio,a=this.state,s=a.policy,l=a.createRule,c=function(e){return o.MessageHash["ajxp_admin.policies."+e]||e},p=s.Policies.sort((function(e,t){return e.id===l?-1:t.id===l?1:e.description.localeCompare(t.description)})).map((function(e,r){return i().createElement(hn,gn({},t.props,{key:e.description,rule:e,isLast:r===s.Policies.length-1,create:l===e.id,onRuleChange:t.onRuleChange.bind(t),onRemoveRule:t.onRemoveRule.bind(t)}))})),f={iconStyle:{fontSize:18,color:"rgba(0,0,0,.33)"},style:{padding:8,width:36,height:36},tooltipPosition:"top-right"},d=i().createElement("div",{style:{display:"flex",alignItems:"center"}},i().createElement("div",{style:{fontSize:14,fontWeight:500}},"Rules"),!n&&i().createElement(u.IconButton,gn({iconClassName:"mdi mdi-plus",tooltip:c("rule.create"),onClick:this.onAddRule.bind(this)},f,{tooltipPosition:"bottom-right"})));if(!n){var y=this.state,m=y.showLabels,h=y.pName,b=y.pDesc,g=h&&h!==s.Name||b&&b!==s.Description;e=i().createElement("div",{style:{marginTop:10,paddingTop:10}},i().createElement("div",{style:{display:"flex",alignItems:"center"}},i().createElement("div",{style:{fontSize:14,fontWeight:500}},"Edit Labels"),i().createElement(u.IconButton,gn({iconClassName:"mdi mdi-chevron-"+(m?"down":"right"),tooltip:c("policy.editLabels"),onClick:function(){return t.setState({showLabels:!m})}},f))),i().createElement("div",{style:{display:m?"flex":"none"}},i().createElement("div",{style:{marginRight:6,flex:1}},i().createElement(kn,{value:h||s.Name,fullWidth:!0,onChange:function(e,r){t.setState({pName:r})}})),i().createElement("div",{style:{marginLeft:6,flex:1}},i().createElement(kn,{value:b||s.Description,fullWidth:!0,onChange:function(e,r){t.setState({pDesc:r})}})),i().createElement("div",{style:{width:80}},i().createElement(u.IconButton,{disabled:!g,iconClassName:"mdi mdi-content-save",tooltip:c("policy.saveLabels"),tooltipPosition:"top-center",onClick:function(){t.saveLabels()},iconStyle:{fontSize:20,color:"rgba(0,0,0,"+(g?".43":".10")+")"},style:{padding:14}}))))}return i().createElement("div",{style:{padding:"12px 24px",backgroundColor:"#f5f5f5"}},d,p,e)}}],n&&wn(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);const Cn=[{Icon:"shield-lock-outline",Uuid:"sample-acl-policy",Name:"ACLSample1.Title",Description:"ACLSample1.Description",ResourceGroup:"acl",Policies:[{id:"acl-complex-rule1",description:"ACLSample1.Rule1",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-complex-rule2",description:"ACLSample1.Rule2",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["write"],effect:"deny",conditions:{NodeMetaName:{type:"StringMatchCondition",jsonOptions:'{"matches":"target"}'},RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}},{id:"acl-complex-rule3",description:"ACLSample1.Rule3",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["read"],effect:"deny",conditions:{NodeMetaName:{type:"StringMatchCondition",jsonOptions:'{"matches":"(.+)\\\\.png"}'},RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}}]},{Icon:"wall-fire",Uuid:"no-external-access-acl-policy",Name:"ACLSampleExternalIP.Title",Description:"ACLSampleExternalIP.Description",ResourceGroup:"acl",Policies:[{id:"acl-complex-rule4",description:"ACLSampleExternalIP.Rule1",subjects:["policy:no-external-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-complex-rule5",description:"ACLSampleExternalIP.Rule2",subjects:["policy:no-external-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"deny",conditions:{RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}}]},{Icon:"timer-lock-outline",Uuid:"limited-period-access-acl-policy2",Name:"ACLSamplePeriod.Title",Description:"ACLSamplePeriod.Description",ResourceGroup:"acl",Policies:[{id:"acl-temporary-access2",description:"ACLSamplePeriod.Rule1",subjects:["policy:limited-period-access-acl-policy2"],resources:["acl"],actions:["write","read"],effect:"allow",conditions:{ClientTime:{type:"WithinPeriodCondition",jsonOptions:'{"matches":"2018-02-01T00:00+0100/2018-04-01T00:00+0100"}'}}}]},{Icon:"calendar-lock-outline",Uuid:"no-access-after-acl-policy",Name:"ACLSampleDateDisable.Title",Description:"ACLSampleDateDisable.Description",ResourceGroup:"acl",Policies:[{id:"acl-date-rule1",description:"ACLSampleDateDisable.Rule1",subjects:["policy:no-access-after-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-date-rule2",description:"ACLSampleDateDisable.Rule2",subjects:["policy:no-access-after-acl-policy"],resources:["acl"],actions:["write","read"],effect:"deny",conditions:{ServerTime:{type:"DateAfterCondition",jsonOptions:'{"matches":"2018-02-28T23:59+0100"}'}}}]},{Icon:"clock-check-outline",Uuid:"office-hours-access-acl-policy",Name:"ACLSampleBusinessHours.Title",Description:"ACLSampleBusinessHours.Description",ResourceGroup:"acl",Policies:[{id:"acl-office-hours-rule",description:"ACLSampleBusinessHours.Rule1",subjects:["policy:office-hours-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow",conditions:{ClientTime:{type:"OfficeHoursCondition",jsonOptions:'{"matches":"Monday-Friday/09:00/18:30"}'}}}]}];var xn=["Icon"];function Mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Nn=f().requireLib("components").Stepper,In=Nn.Dialog,Tn=Nn.PanelBigButtons,_n=function(e){var t,r,n=e.open,a=e.onRequestClose,s=e.onPick,l=e.m,c=function(e){return f().getMessages()["tpl_policies.PolicyGroup."+e]||e},u=(t=(0,o.useState)(""),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(t,r)||function(e,t){if(e){if("string"==typeof e)return Mn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Mn(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=u[0],d=u[1],y={Sections:[]},m={title:c("Create.Manual"),Actions:[{title:l("type.acl.title"),description:l("type.acl.legend"),icon:"mdi mdi-folder-lock-open-outline",tint:"#607d8b",value:{manual:!0,ResourceGroup:"acl"}},{title:l("type.rest.title"),description:l("type.rest.legend"),icon:"mdi mdi-api",tint:"#607d8b",value:{manual:!0,ResourceGroup:"rest"}}]};y.Sections.push(m);var h={title:c("Create.Templates"),Actions:Cn.map((function(e){var t=e.Icon,r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,xn);return r.Name=c(r.Name),r.Description=c(r.Description),r.Policies.forEach((function(e){e.description=c(e.description)})),{title:r.Name,description:r.Description,icon:"mdi mdi-"+t,tag:"preset",value:{template:r}}})).filter((function(e){return!p||e.title.toLowerCase().indexOf(p.toLowerCase())>-1||e.description.toLowerCase().indexOf(p.toLowerCase())>-1}))};return h.Actions.length&&y.Sections.push(h),i().createElement(In,{title:c("Create"),open:n,dialogProps:{bodyStyle:{overflowY:"auto"}},onDismiss:function(){a()},onFilter:d,filterHint:c("Filter")},i().createElement(Tn,{model:y,onPick:function(e){s(e)}}))};function Dn(e){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dn(e)}function Un(){return Un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Un.apply(null,arguments)}function Ln(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Bn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ln(Object(r),!0).forEach((function(t){Fn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ln(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Fn(e,t,r){return(t=function(e){var t=function(e){if("object"!=Dn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Dn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var qn=f().requireLib("components").MaterialTable,Hn=f().requireLib("hoc").ModernTextField,Wn=["acl","rest","oidc"],Gn=s()({displayName:"PoliciesBoard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:c().instanceOf(fr()).isRequired,rootNode:c().instanceOf(hr()).isRequired,currentNode:c().instanceOf(hr()).isRequired,openEditor:c().func.isRequired,openRightPane:c().func.isRequired,closeRightPane:c().func.isRequired,readonly:c().bool},componentWillMount:function(){this.listPolicies()},getInitialState:function(){return{policies:{},popoverOpen:!1,anchorEl:null}},groupByResourcesGroups:function(e){var t=[],r=new RegExp("-ro$|-rw$|-wo$");return Wn.map((function(n){var o=e.PolicyGroups.filter((function(e){var t=e.ResourceGroup||"rest";return!e.Uuid.match(r)&&t===n}));o.length&&(o.sort((function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:e.Name.toLowerCase()===t.Name.toLowerCase()?0:1})),t[n]=o)})),t},listPolicies:function(){var e=this;this.setState({loading:!0});var t=new b.PolicyServiceApi(h().getRestClient());f().startLoading(),t.listPolicies(new b.IdmListPolicyGroupsRequest).then((function(t){f().endLoading();var r=e.groupByResourcesGroups(t);e.setState({policies:r,loading:!1})})).catch((function(t){f().endLoading(),e.setState({error:t,loading:!1})}))},pickCreatePolicy:function(e){if(e.template){var t=S(),r=Bn(Bn({},e.template),{},{Uuid:t});r.Policies.forEach((function(e){e.id=S(),e.subjects=["policy:"+t]})),this.savePolicy(r,!1)}else this.setState({newPolicyType:e.ResourceGroup})},savePolicy:function(e,t){var r=this;this.setState({newPolicyId:null}),t?this.listPolicies():Dr().loadClass("EnterpriseSDK").then((function(t){new t.EnterprisePolicyServiceApi(h().getRestClient()).putPolicy(e).then((function(){r.listPolicies()})).catch((function(e){r.setState({error:e})}))}))},deletePolicy:function(e){var t=this,r=this.props.pydio;r.UI.openConfirmDialog({message:r.MessageHash["ajxp_admin.policies.policy.delete.confirm"],destructive:[e.Name],validCallback:function(){Dr().loadClass("EnterpriseSDK").then((function(r){new r.EnterprisePolicyServiceApi(h().getRestClient()).deletePolicy(e.Uuid).then((function(){t.listPolicies()})).catch((function(e){t.setState({error:e})}))}))}})},createPolicy:function(e){var t=this.state,r=t.newPolicyType,n=t.newPolicyName,o=t.newPolicyDescription,i=S(),a={Uuid:i,Name:n,Description:o,ResourceGroup:r,Policies:[]},s=Bn({},this.state.policies);s[r]||(s[r]=[]),s[r].push(a),this.setState({policies:s,popoverOpen:!1,newPolicyId:i,selectedPolicy:i,newPolicyType:null,newPolicyName:"",newPolicyDescription:""})},selectRows:function(e){if(e.length&&e[0]){var t=e[0],r=this.state.selectedPolicy;this.setState({selectedPolicy:r===t.Uuid?null:t.Uuid})}},render:function(){var e=this,t=this.props,r=t.muiTheme,n=t.currentNode,o=t.pydio,a=t.accessByName,s=this.props.readonly;s=s||!a("Create");var l=this.state,c=l.policies,p=l.selectedPolicy,f=l.newPolicyId,d=l.newPolicyName,y=l.newPolicyDescription,m=l.openPicker,h=l.newPolicyType,b=function(e){return o.MessageHash["ajxp_admin.policies."+e]||e},g=AdminComponents.AdminStyles(r.palette),v=[{name:"Name",label:b("policy.name"),style:{fontSize:15},sorter:{type:"string",default:!0}},{name:"Rules",label:b("policy.rules"),style:{width:80,textAlign:"center"},headerStyle:{width:80,textAlign:"center"},renderCell:function(e){return e.Policies.length},sorter:{type:"number"}},{name:"Description",label:b("policy.description"),sorter:{type:"string"}}],O=[];s?O.push({iconClassName:"mdi mdi-eye",tooltip:b("policy.display"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}):(O.push({iconClassName:"mdi mdi-pencil",tooltip:b("policy.edit"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}),O.push({iconClassName:"mdi mdi-delete",tooltip:b("policy.delete"),onClick:function(t){e.deletePolicy(t)}}));var P=Wn.map((function(t){if(s&&"acl"===t)return null;var r=c[t]||[];if(s&&!r.length)return null;var n=r.map((function(t){return t.Uuid===p?Bn(Bn({},t),{},{expandedRow:i().createElement(An,Un({},e.props,{readonly:s,key:t.Name,policy:t,savePolicy:e.savePolicy.bind(e),deletePolicy:e.deletePolicy.bind(e),newPolicyWithRule:f===t.Uuid?t.Name:null}))}):t})),o=b("type."+t+".title"),a=b("type."+t+".legend"),l="oidc"===t?O.filter((function(e){return"mdi mdi-delete"!==e.iconClassName})):O;return i().createElement("div",null,i().createElement(AdminComponents.SubHeader,{title:o,legend:a}),i().createElement(u.Paper,Un({},g.body.block.props,{style:g.body.block.container}),i().createElement(qn,{data:n,columns:v,actions:l,onSelectRows:function(t){return e.selectRows(t)},deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:g.body.tableMaster,storageKey:"console.policies."+t+".list",emptyStateString:i().createElement("span",{onClick:function(){return e.setState({openPicker:!0})},style:{cursor:"pointer"}},b("acl.empty-string"))})))})),w=i().createElement("div",null,i().createElement(u.FlatButton,Un({},g.props.header.flatButton,{primary:!0,onClick:function(){return e.setState({openPicker:!0})},label:b("policy.new")})));return i().createElement("div",{className:"vertical-layout",style:{height:"100%"}},i().createElement(AdminComponents.Header,{title:n.getLabel(),icon:n.getMetadata().get("icon_class"),actions:s?null:w,reloadAction:this.listPolicies.bind(this),loading:this.state.loading}),i().createElement("div",{className:"layout-fill"},P),!s&&i().createElement(_n,{m:b,open:m,onPick:function(t){e.pickCreatePolicy(t),e.setState({openPicker:!1})},onRequestClose:function(){return e.setState({openPicker:!1})}}),!s&&i().createElement(u.Dialog,{title:b("policy.new"),actions:[i().createElement(u.FlatButton,{label:o.MessageHash[54],onClick:function(){return e.setState({newPolicyType:null})}}),i().createElement(u.FlatButton,{label:b("policy.create"),onClick:this.createPolicy.bind(this)})],modal:!1,open:h,contentStyle:{width:320}},i().createElement(Hn,{fullWidth:!0,hintText:b("policy.name"),value:d,focusOnMount:!0,onChange:function(t,r){return e.setState({newPolicyName:r})},variant:"v2"}),i().createElement(Hn,{fullWidth:!0,hintText:b("policy.description"),value:y,onChange:function(t,r){return e.setState({newPolicyDescription:r})},variant:"v2"})))}});Gn=(0,xe.muiThemeable)()(Gn);const Vn=require("pydio/util/pass");var zn=r.n(Vn);function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function Jn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qn(e,t,r){return(t=function(e){var t=function(e){if("object"!=Kn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $n=f().requireLib("hoc").ModernTextField,Yn=s()({displayName:"CreateUserForm",propTypes:{dataModel:c().instanceOf(PydioDataModel),openRoleEditor:c().func},mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.ActionDialogMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogSize:"sm",dialogTitleId:"ajxp_admin.user.19"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(r),!0).forEach((function(t){Qn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({step:1},zn().getState())},checkPassword:function(){var e=this.refs.pass.getValue(),t=this.refs.passconf.getValue();this.setState(zn().getState(e,t,this.state))},checkLogin:function(e,t){var r=zn().isValidLogin(t);this.setState({loginErrorText:r})},submit:function(){var e=this;if(this.state.valid&&!this.state.loginErrorText){var t=this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode(),r=t.getPath();r.startsWith("/idm/users")&&(r=r.substr(10));var n=this.refs.user_id.getValue(),o=this.refs.pass.getValue();h().getRestClient().getIdmApi().createUser(r,n,o).then((function(o){e.dismiss(),t.reload();var i=new(hr())(r+"/"+n,!0);i.getMetadata().set("ajxp_mime","user"),i.getMetadata().set("IdmUser",o),e.props.openRoleEditor(i)}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText||this.state.loginErrorText)},render:function(){var e,t=(this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode()).getPath();return t.startsWith("/idm/users")&&(e=t.substr(10))&&(e=i().createElement("div",null,this.context.getMessage("ajxp_admin.user.20").replace("%s",e))),i().createElement("div",{style:{width:"100%"}},e,i().createElement("form",{autoComplete:"off"},i().createElement("div",{style:{width:"100%"}},i().createElement($n,{ref:"user_id",onChange:this.checkLogin,fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.21"),errorText:this.state.loginErrorText,autoComplete:"nope",variant:"v2"})),i().createElement("div",null,i().createElement($n,{ref:"pass",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.22"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.passErrorText||this.state.passHintText,autoComplete:"new-password",variant:"v2"})),i().createElement("div",null,i().createElement($n,{ref:"passconf",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.23"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.confirmErrorText,autoComplete:"confirm-password",variant:"v2"}))))}}),Xn=f().requireLib("hoc").ModernTextField,Zn=s()({displayName:"CreateRoleOrGroupForm",mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],propTypes:{type:c().oneOf(["group","user","role"]),roleNode:c().instanceOf(hr()),openRoleEditor:c().func},getTitle:function(){return"group"===this.props.type?this.context.getMessage("ajxp_admin.user.15"):this.context.getMessage("ajxp_admin.user.14")},getPadding:function(){return!0},getSize:function(){return"sm"},dismiss:function(){return this.props.onDismiss()},getInitialState:function(){return{groupId:"",groupIdError:"",groupLabel:"",groupLabelError:"",roleId:"",roleLabel:"",roleLabelError:""}},submit:function(){var e,t=this,r=this.props,n=r.type,o=r.pydio,i=r.reload,a=r.openRoleEditor,s=this.state,l=s.groupId,c=s.groupIdError,u=s.groupLabel,p=s.groupLabelError,f=s.roleId,d=s.roleIdError,y=s.roleLabel,m=s.roleLabelError;if("group"===n){if(c||p)return;var b=(e=o.getContextHolder().getSelectedNodes().length?o.getContextHolder().getSelectedNodes()[0]:o.getContextNode()).getPath().replace("/idm/users",""),g=h().getRestClient().getIdmApi();g.userOrGroupByIdentifier(b,l).then((function(r){r?t.setState({groupIdError:"Found group or user with same identifier!"}):g.createGroup(b||"/",l,u).then((function(){t.dismiss(),e.reload()}))}))}else if("role"===n){if(m||d)return;h().getRestClient().getIdmApi().createRole(y,f).then((function(e){t.dismiss(),i&&i(),a&&a(e)}))}},update:function(e){if(void 0!==e.groupId)new RegExp(/^[0-9A-Z\-_.:\+]+$/i).test(e.groupId)?""===e.groupId?e.groupIdError=this.context.getMessage("ajxp_admin.user.16.empty"):e.groupIdError="":e.groupIdError=this.context.getMessage("ajxp_admin.user.16.format");else if(void 0!==e.groupLabel)if(""===e.groupLabel)e.groupLabelError=this.context.getMessage("ajxp_admin.user.17.empty");else{e.groupLabelError="";var t=this.state,r=t.groupId,n=t.groupLabel;""!==r&&W().computeStringSlug(n)!==r||(e.groupId=W().computeStringSlug(e.groupLabel),e.groupIdError="")}else if(void 0!==e.roleLabel)""===e.roleLabel?e.roleLabelError=this.context.getMessage("ajxp_admin.user.18.empty"):e.roleLabelError="";else if(e.roleId){var o=this.props.roles;(void 0===o?[]:o).filter((function(t){return t.Uuid===e.roleId})).length>0?e.roleIdError=this.context.getMessage("role_editor.31.exists"):e.roleIdError="",e.roleId=W().computeStringSlug(e.roleId)}this.setState(e)},render:function(){var e=this,t=this.state,r=t.groupId,n=t.groupIdError,o=t.groupLabel,a=t.groupLabelError,s=t.roleId,l=t.roleIdError,c=t.roleLabel,u=t.roleLabelError;return"group"===this.props.type?i().createElement("div",{style:{width:"100%"}},i().createElement(Xn,{value:o,errorText:a,onChange:function(t,r){e.update({groupLabel:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.17"),onKeyPress:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),i().createElement(Xn,{value:r,errorText:n,onChange:function(t,r){e.update({groupId:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.16"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"})):i().createElement("div",{style:{width:"100%"}},i().createElement(Xn,{fullWidth:!0,value:c,errorText:u,onChange:function(t,r){e.update({roleLabel:r})},floatingLabelText:this.context.getMessage("role_editor.32"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),i().createElement(Xn,{fullWidth:!0,value:s,errorText:l,floatingLabelText:this.context.getMessage("role_editor.31.hint"),onChange:function(t,r){e.update({roleId:r})},onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}))}}),eo=f().requireLib("hoc"),to=eo.ModernTextField,ro=(eo.ModernSelectField,f().requireLib("components").FoldersTree),no=f().requireLib("boot"),oo=no.ActionDialogMixin,io=no.CancelButtonProviderMixin,ao=no.SubmitButtonProviderMixin,so=s()({displayName:"TreeGroupsDialog",propTypes:{dataModel:c().instanceOf(fr()),submitValue:c().func.isRequired},mixins:[oo,io,ao],getDefaultProps:function(){return{dialogTitle:"Move",dialogIsModal:!0,dialogScrollBody:!0}},submit:function(){var e=this.state,t=e.selectedNode,r=e.selectedPath;this.props.submitValue(r,t),this.dismiss()},getInitialState:function(){return{selectedNode:this.props.dataModel.getContextNode(),selectedPath:"/"}},onNodeSelected:function(e){var t=this.props.dataModel;e.load(t.getAjxpNodeProvider());var r=t.getContextNode().getPath(),n=new RegExp("^"+r),o=e.getPath().replace(n,"");this.setState({selectedNode:e,selectedPath:o})},render:function(){var e=this.state.selectedPath;return i().createElement("div",{style:{width:"100%"}},i().createElement("div",{style:{fontSize:13}},f().getMessages()["ajxp_admin.user.moveto.hint"]),i().createElement(u.Paper,{zDepth:0,style:{height:300,overflowX:"auto",color:"#546E7A",fontSize:14,padding:"6px 0px",backgroundColor:"rgb(246, 246, 248)",marginTop:4}},i().createElement("div",{style:{marginTop:-41,marginLeft:-21}},i().createElement(ro,{pydio:this.props.pydio,dataModel:this.props.dataModel,rootNode:this.props.dataModel.getContextNode(),onNodeSelected:this.onNodeSelected,showRoot:!0,draggable:!1}))),i().createElement("div",null,i().createElement(to,{variant:"v2",fullWidth:!0,hintText:this.props.pydio.MessageHash[373],ref:"input",value:e,disabled:!1,onChange:function(){}})))}});function lo(e){return lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lo(e)}function co(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uo(n.key),n)}}function uo(e){var t=function(e){if("object"!=lo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=lo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==lo(t)?t:t+""}function po(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(po=function(){return!!e})()}function fo(e){return fo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fo(e)}function yo(e,t){return yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yo(e,t)}const mo=Y(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){return t=fo(t),function(e,t){if(t&&("object"==lo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,po()?Reflect.construct(t,r||[],fo(e).constructor):t.apply(e,r))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yo(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e,t=this.props.getMessage;switch(this.props.acl){case"read,write":e=t("8");break;case"read":e=t("9");break;case"write":e=t("10");break;case"PYDIO_VALUE_CLEAR":e=t("11");break;default:e=t("12")}return i().createElement("span",{className:"summary-rights summary"},e)}}])&&co(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component));var ho={PagesAcls:ke,RightsSelector:oe,RightsSummary:mo,WorkspacesAcls:Oe,WorkspaceAcl:fe},bo={GroupInfo:st,RoleInfo:Be,UserInfo:Xe},go={Role:N,User:q};function vo(e){return vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vo(e)}function Oo(e){return function(e){if(Array.isArray(e))return Po(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Po(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Po(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Po(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function wo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function So(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wo(Object(r),!0).forEach((function(t){Eo(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Eo(e,t,r){return(t=Ro(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ro(n.key),n)}}function Ro(e){var t=function(e){if("object"!=vo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=vo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==vo(t)?t:t+""}function ko(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ko=function(){return!!e})()}function Ao(e){return Ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ao(e)}function Co(e,t){return Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Co(e,t)}var xo=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Ao(t),function(e,t){if(t&&("object"==vo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ko()?Reflect.construct(t,r||[],Ao(e).constructor):t.apply(e,r))}(this,t,[So({actionsPrefix:"[a] ",parametersPrefix:""},e)])).state={filter:null},r.props.initialSelection&&(r.state=So({filter:r.props.initialSelection.paramName},r.props.initialSelection)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Co(e,t)}(t,e),r=t,(n=[{key:"filter",value:function(e){this.setState({filter:e.target.value.toLowerCase()})}},{key:"select",value:function(e,t,r,n){this.props.onSelection(e,t,r,n),this.setState({pluginName:e,type:t,paramName:r})}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.refs.input.focus()}),150)}},{key:"render",value:function(){var e=this,t=this.props,r=t.pydio,n=t.allParameters,o=t.allActions,a=this.state.filter,s=this.state.paramName,l=this.state.pluginName,c=this.state.type,p=function(e){return!a||-1!==e.toLowerCase().indexOf(a)},f=function(e){if(!a)return e;var t=e.toLowerCase().indexOf(a),r=e.substr(0,t),n=e.substr(t,a.length),o=e.substr(t+a.length);return i().createElement("span",null,r,i().createElement("span",{className:"highlight"},n),o)},d=[],y={};return Object.keys(n).forEach((function(e){var t;y[e]||(y[e]={name:e,label:e,actions:[],params:[]}),(t=y[e].params).push.apply(t,Oo(n[e]))})),Object.keys(o).forEach((function(e){var t;y[e]||(y[e]={name:e,label:e,actions:[],params:[]}),(t=y[e].actions).push.apply(t,Oo(o[e]))})),W().objectValues(y).map((function(t){var n=[],o=!1,a=t.label||t.name;(p(a)||p(t.name))&&(o=!0,p(a)?a=f(a):p(t.name)&&(a=i().createElement("span",null,a," (",f(t.name),")"))),t.params.concat(t.actions).map((function(a){var u=a.action||a.parameter,d=a.label||u,y="";a.action?(d=ct().XPathGetSingleNodeText(a.xmlNode,"gui/@text")||d,y=e.props.actionsPrefix):(d=a.xmlNode.getAttribute("label")||d,e.props.parametersPrefix&&(y=e.props.parametersPrefix)),r.MessageHash[d]&&(d=r.MessageHash[d]);var m=p(d),h=p(u);if(m||h||o){var b=("*"===l||l===t.name)&&a[c]&&s===u,g=d;m?g=f(d):h&&(g=i().createElement("span",null,d," (",f(u),") ")),n.push(i().createElement("li",{onClick:function(){return e.select(t.name,a.action?"action":"parameter",u,a)},className:(b?"selected ":"")+"parameters-param",key:t.name+"-"+(a.action?"action":"parameter")+"-"+u},y," ",g))}})),n.length&&d.push(i().createElement("li",{className:"parameters-plugin",key:t.name},a,i().createElement("ul",null,n)))})),i().createElement("div",null,i().createElement("div",{style:{padding:"0 24px",borderBottom:"1px solid #e0e0e0"}},i().createElement(u.TextField,{ref:"input",floatingLabelText:this.props.getMessage("13"),onChange:this.filter.bind(this),fullWidth:!0,underlineShow:!1})),i().createElement("div",{className:"parameters-tree-scroller"},i().createElement("ul",{className:"parameters-tree"},d)))}}])&&jo(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);function Mo(e){return Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mo(e)}function No(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Io(n.key),n)}}function Io(e){var t=function(e){if("object"!=Mo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Mo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mo(t)?t:t+""}function To(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(To=function(){return!!e})()}function _o(e){return _o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_o(e)}function Do(e,t){return Do=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Do(e,t)}var Uo=f().requireLib("boot"),Lo=Uo.ActionDialogMixin,Bo=Uo.CancelButtonProviderMixin,Fo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){return t=_o(t),function(e,t){if(t&&("object"==Mo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,To()?Reflect.construct(t,r||[],_o(e).constructor):t.apply(e,r))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Do(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.getMessage,r=e.muiTheme,n=r.palette.mui3?r.palette.mui3["secondary-container"]:r.palette.primary1Color,o=r.palette.mui3?r.palette.mui3["on-secondary-container"]:"white",a=r.borderRadius;return i().createElement("div",{style:{backgroundColor:n,color:o,borderRadius:"".concat(a,"px ").concat(a,"px 0 0"),padding:24}},i().createElement("h3",{style:{color:o,fontSize:20,marginBottom:16}},t("14")),i().createElement("div",{className:"legend"},t("15")))}}])&&No(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(i().Component);Fo=(0,xe.muiThemeable)()(Fo);var qo=s()({displayName:"ParameterCreate",mixins:[Lo,Bo],propTypes:{workspaceScope:c().string,showModal:c().func,hideModal:c().func,pluginsFilter:c().func,roleType:c().oneOf(["user","group","role"]),createParameter:c().func},getDefaultProps:function(){return{dialogPadding:0,dialogTitle:"",dialogSize:"md"}},getInitialState:function(){return{step:1,workspaceScope:this.props.workspaceScope,pluginName:null,paramName:null,actions:{},parameters:{}}},setSelection:function(e,t,r,n){this.setState({pluginName:e,type:t,paramName:r,attributes:n},this.createParameter)},createParameter:function(){this.props.createParameter(this.state.type,this.state.pluginName,this.state.paramName,this.state.attributes),this.props.onDismiss()},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return r.MessageHash[t+(t?".":"")+e]||e},t=this.props,r=t.pydio,n=t.actions,o=t.parameters;return i().createElement("div",{className:"picker-list"},i().createElement(Fo,{getMessage:e}),i().createElement(xo,{pydio:r,allActions:n,allParameters:o,onSelection:this.setSelection,getMessage:e}))}}),Ho={ParametersPicker:xo,ParameterCreate:qo,ParametersPanel:_t,ParameterEntry:jt};function Wo(e){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(e)}function Go(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Vo(e,t,r){return(t=function(e){var t=function(e){if("object"!=Wo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Wo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Wo(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zo=f().requireLib("boot"),Ko=zo.ActionDialogMixin,Jo=zo.CancelButtonProviderMixin,Qo=zo.SubmitButtonProviderMixin,$o=f().requireLib("hoc").ModernTextField,Yo={Model:go,Info:bo,ACL:ho,Params:Ho,User:{UserPasswordDialog:s()({displayName:"UserPasswordDialog",mixins:[AdminComponents.MessagesConsumerMixin,Ko,Jo,Qo],propTypes:{pydio:c().instanceOf(f()),user:c().instanceOf(q)},getDefaultProps:function(){return{dialogTitle:pydio.MessageHash["role_editor.25"],dialogSize:"sm"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Go(Object(r),!0).forEach((function(t){Vo(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Go(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},zn().getState())},onChange:function(e,t){var r=this.refs.pass.getValue(),n=this.refs.confirm.getValue(),o=zn().getState(r,n,this.state);this.setState(o)},submit:function(){var e=this;if(this.state.valid){var t=this.refs.pass.getValue(),r=this.props.user;r.getIdmUser().Password=t,r.save().then((function(){e.dismiss()}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText)},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.g.pydio.MessageHash[t+(t?".":"")+e]||e};return i().createElement("div",{style:{width:"100%"}},i().createElement("form",{autoComplete:"off"},i().createElement($o,{ref:"pass",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("523"),errorText:this.state.passErrorText,hintText:this.state.passHintText,variant:"v2",autoComplete:"whatever"}),i().createElement($o,{ref:"confirm",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("199"),errorText:this.state.confirmErrorText,variant:"v2",autoComplete:"no-thanks"})))}}),UserRolesPicker:Zt},Util:{EditorCache:{CACHE:null},withRoleMessages:Y,loadEditorClass:Lr}},Xo={CreateUserForm:Yn,CreateRoleOrGroupForm:Zn};window.AdminPeople=n})();