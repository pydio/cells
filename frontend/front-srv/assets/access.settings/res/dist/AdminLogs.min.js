(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Dashboard:()=>De,LogTools:()=>we});const n=require("react");var r=e.n(n);const o=require("material-ui"),i=require("prop-types");var a=e.n(i);const l=require("pydio/model/data-model");var s=e.n(l);const c=require("pydio");var u=e.n(c);const d=require("pydio/lang/observable");var p=e.n(d);const f=require("pydio/http/api");var m=e.n(f);const h=require("pydio/http/resources-manager");var y=e.n(h);const g=require("cells-sdk");function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==v(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===v(o)?o:String(o)),r)}var o}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var j=["ERROR","WARN","INFO","DEBUG"],E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(o){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,n=[{key:"buildQuery",value:function(e,t,n,r,o,i){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,l=[];if(e&&l.push('+Msg:"*'+e+'*"'),t&&l.push("+Logger:*"+t+"*"),n)if(0===n.indexOf("<")){var s=j.indexOf(n.replace("<","")),c=j.filter((function(e,t){return t<=s})).map((function(e){return"Level:"+e}));l.push.apply(l,function(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(c))}else l.push("+Level:"+n);if(r&&l.push("+RemoteAddress:*"+r+"*"),o&&l.push("+UserName:*"+o+"*"),i){var u=i,d=new Date(u);a?d=a:d.setDate(u.getDate()+1),l.push("+Ts:>"+Math.floor(u/1e3)),l.push("+Ts:<"+Math.floor(d/1e3))}return l.join(" ")}},{key:"buildTsQuery",value:function(e,t){var n=[];return n.push("+Ts:>"+(e-60*t)),n.push("+Ts:<"+(e+60*t)),n.join(" ")}},{key:"loadLogs",value:function(e,t,n,r,o){var i=new g.LogListLogRequest;return i.Query=t,i.Page=n,i.Size=r,i.Format=g.ListLogRequestLogFormat.constructFromObject(o),"syslog"===e?new g.LogServiceApi(m().getRestClient()).syslog(i):"audit"===e?y().loadClass("EnterpriseSDK").then((function(e){return new e.EnterpriseLogServiceApi(m().getRestClient()).audit(i)})):Promise.reject("Unknown service name, must be 'syslog' or 'audit'")}},{key:"downloadLogs",value:function(e,t,n){var r=new g.LogListLogRequest;return r.Query=t,r.Page=0,r.Size=1e5,r.Format=g.ListLogRequestLogFormat.constructFromObject(n),a.auditExportWithHttpInfo(r,e).then((function(e){return e.response.body}))}},{key:"auditExportWithHttpInfo",value:function(e,t){var n=e;if(null==e)throw new Error("Missing the required parameter 'body' when calling auditExport");return m().getRestClient().callApi("/log/"+t+"/export","POST",{},{},{},{},n,[],["application/json"],["application/json"],"Blob")}}],null&&S(t.prototype,null),n&&S(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(p());const x=require("react-dom");var C=e.n(x);const P=require("clipboard");var k=e.n(P);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return(t=F(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,F(r.key),r)}}function I(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function F(e){var t=function(e,t){if("object"!==T(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===T(t)?t:String(t)}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=B(e);if(t){var o=B(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}var U=u().requireLib("components").UserAvatar,q=function(e){A(n,e);var t=z(n);function n(){return L(this,n),t.apply(this,arguments)}return I(n,[{key:"render",value:function(){var e=this.props,t=e.iconClassName,n=e.legend,i=e.data,a=(e.selectable,{icon:{fontSize:20,margin:"0px 16px 0",lineHeight:"16px"},legend:{textAlign:"right",color:"#666",fontWeight:500,width:130,userSelect:"text"},data:{flex:1,paddingRight:6,overflow:"hidden",textOverflow:"ellipsis",userSelect:"text"}});return r().createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:8,overflow:"hidden",fontWeight:"initial"}},r().createElement("div",{style:a.legend},n),r().createElement("div",{style:{width:64}},r().createElement(o.FontIcon,{color:"#ccc",className:t,style:a.icon})),r().createElement("div",{style:a.data},i))}}]),n}(r().Component),H=function(e){A(i,e);var t=z(i);function i(e){var n;return L(this,i),(n=t.call(this,e)).state={copySuccess:!1},n}return I(i,[{key:"componentDidMount",value:function(){this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.detachClipboard()}},{key:"attachClipboard",value:function(){var e=this.props,t=e.log;e.pydio,this.detachClipboard(),this.refs["copy-button"]&&(this._clip=new(k())(C().findDOMNode(this.refs["copy-button"]),{text:function(e){var n=[];return Object.keys(t).map((function(e){var r=t[e];r&&("RoleUuids"===e&&(r=r.join(",")),n.push(e+" : "+r))})),n.join("\n")}.bind(this)}),this._clip.on("success",function(){var e=this;this.setState({copySuccess:!0},(function(){setTimeout((function(){e.setState({copySuccess:!1})}),3e3)}))}.bind(this)),this._clip.on("error",function(){}.bind(this)))}},{key:"detachClipboard",value:function(){this._clip&&this._clip.destroy()}},{key:"focusPeriod",value:function(){var e=this.props;(0,e.onSelectPeriod)(e.log.Ts)}},{key:"unfocusPeriod",value:function(){var e=this.props,t=e.onSelectPeriod;e.focus&&t(null)}},{key:"render",value:function(){var e,t=this,i=this.props,a=i.log,l=i.pydio,s=i.onRequestClose,c=i.onSelectPeriod,u=i.style,d=i.focus,p=i.darkTheme,f=i.timeOffset,m=void 0===f?0:f,h=i.userDisplay,y=void 0===h?"avatar":h,g=this.state.copySuccess,v={divider:{marginTop:5,marginBottom:5},userLegend:{marginTop:-16,paddingBottom:10,textAlign:"center",color:"#9E9E9E",fontWeight:500},buttons:{position:"absolute",top:6,right:6,display:"flex"},button:{height:36,width:36,padding:8},buttonIcon:{fontSize:20,color:p?"white":null}};if(a.Profile||a.RoleUuids||a.GroupPath){var b=[];a.Profile&&b.push("Profile: "+a.Profile),a.GroupPath&&b.push("Group: "+a.GroupPath),a.RoleUuids&&b.push("Roles: "+a.RoleUuids.join(",")),e=b.join(" - ")}var S=a.Msg;"error"===a.Level&&(S=r().createElement("span",{style:{color:"#e53935"}},a.Msg));var O={};if(a.JsonZaps){var w=JSON.parse(a.JsonZaps);Object.keys(w).map((function(e){O[e]=JSON.stringify(w[e])}))}var j=function(e){return l.MessageHash["ajxp_admin.logs.details."+e]||e};return r().createElement("div",{style:D({fontSize:13,color:"rgba(0,0,0,.87)",paddingBottom:10},u)},r().createElement(o.Paper,{zDepth:1,style:{backgroundColor:"#f5f5f5",marginBottom:10,position:"relative"}},r().createElement("div",{style:v.buttons},r().createElement(o.IconButton,{style:v.button,iconStyle:v.buttonIcon,iconClassName:g?"mdi mdi-check":"mdi mdi-content-copy",tooltip:j("copy"),tooltipPosition:"bottom-left",ref:"copy-button"}),c&&r().createElement(o.IconButton,{style:v.button,iconStyle:D(D({},v.buttonIcon),{},{color:d?"#ff5722":v.buttonIcon.color}),iconClassName:"mdi mdi-clock",onClick:d?this.unfocusPeriod.bind(this):this.focusPeriod.bind(this),tooltip:j("show-focus"),tooltipPosition:"bottom-left"}),r().createElement(o.IconButton,{style:v.button,iconStyle:v.buttonIcon,iconClassName:"mdi mdi-close",onClick:function(){t.unfocusPeriod(),s()},tooltip:j("close"),tooltipPosition:"bottom-left"})),"avatar"===y&&a.UserName&&r().createElement(U,{pydio:l,userId:a.UserName,richCard:!0,displayLabel:!0,displayAvatar:!0,noActionsPanel:!0}),"avatar"===y&&e&&r().createElement("div",{style:v.userLegend},e)),a.UserName&&"inline"===y&&r().createElement(n.Fragment,null,r().createElement(q,{iconClassName:"mdi mdi-account",legend:j("user"),data:a.UserName}),e&&r().createElement(q,{iconClassName:"mdi mdi-account-multiple",legend:j("user-attributes"),data:e}),r().createElement(o.Divider,{style:v.divider})),r().createElement(q,{iconClassName:"mdi mdi-calendar",legend:j("date"),data:new Date(1e3*(a.Ts+m)).toLocaleString()}),r().createElement(q,{iconClassName:"mdi mdi-comment-text",legend:j("msg"),data:S}),r().createElement(q,{iconClassName:"mdi mdi-server-network",legend:j("service"),data:a.Logger}),(a.RemoteAddress||a.UserAgent||a.HttpProtocol)&&r().createElement(o.Divider,{style:v.divider}),a.RemoteAddress&&r().createElement(q,{iconClassName:"mdi mdi-cast-connected",legend:j("connection"),data:a.RemoteAddress}),a.UserAgent&&r().createElement(q,{iconClassName:"mdi mdi-cellphone-link",legend:j("agent"),data:a.UserAgent}),a.HttpProtocol&&r().createElement(q,{iconClassName:"mdi mdi-open-in-app",legend:j("protocol"),data:a.HttpProtocol}),a.NodePath&&r().createElement(n.Fragment,null,r().createElement(o.Divider,{style:v.divider}),r().createElement(q,{iconClassName:"mdi mdi-file-tree",legend:j("node"),data:a.NodePath}),a.TransferSize&&r().createElement(q,{iconClassName:"mdi mdi-file",legend:j("transfer-size"),data:a.TransferSize}),r().createElement(q,{iconClassName:"mdi mdi-folder-open",legend:j("workspace"),data:a.WsUuid})),Object.keys(O).length>0&&r().createElement(n.Fragment,null,r().createElement(o.Divider,{style:v.divider}),Object.keys(O).map((function(e){return r().createElement(q,{iconClassName:"mdi mdi-tag",legend:e,data:O[e]})}))))}}]),i}(r().Component);function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},J.apply(this,arguments)}function Q(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){V(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e,t,n){return(t=$(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$(r.key),r)}}function $(e){var t=function(e,t){if("object"!==W(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===W(t)?t:String(t)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}H.PropTypes={pydio:a().instanceOf(u()),log:a().instanceOf(g.LogLogMessage)};var te=u().requireLib("components").MaterialTable,ne=u().requireLib("boot").moment,re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ee(i);if(a){var n=ee(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={logs:[],loading:!1,rootSpans:{},selectedRows:[]},t}return t=s,(n=[{key:"initRootSpans",value:function(e){if(!e||!e.length)return{logs:[],rootSpans:{}};for(var t={},n=e.map((function(e,n){return e.SpanUuid||(e.SpanUuid="span-"+n),e.SpanRootUuid||(t[e.SpanUuid]={open:!0,children:[]}),e})),r=[],o=0;o<n.length;o++){var i=n[o];if(i.SpanRootUuid&&t[i.SpanRootUuid])t[i.SpanRootUuid].children.push(i),i.HasRoot=!0;else if(!i.SpanRootUuid||t[i.SpanRootUuid])r.push(i);else{var a=Y({},i);a.SpanUuid=i.SpanRootUuid,i.HasRoot=!0,t[i.SpanRootUuid]={open:!0,children:[i]},r.push(a)}}return{logs:r,rootSpans:t}}},{key:"openSpans",value:function(){for(var e=this.state,t=e.logs,n=e.rootSpans,r=[],o=0;o<t.length;o++){var i=t[o],a=n[i.SpanUuid];if(a.children.length&&(i.HasChildren=!0,i.IsOpen=a.open,!i.RemoteAddress)){var l=a.children.filter((function(e){return e.RemoteAddress}));l.length&&(i.RemoteAddress=l[0].RemoteAddress)}r.push(i),a.open&&(r=[].concat(Q(r),Q(a.children)))}return r}},{key:"load",value:function(e,t,n,r,o,i){var a=this,l=this.state.logs;i&&(this.setState({loading:!0}),i(!0,l.length)),u().startLoading(),E.loadLogs(e,t,n,r,o).then((function(e){u().endLoading();var t=a.initRootSpans(e.Logs),n=t.logs,r=t.rootSpans;a.setState({logs:n,rootSpans:r,loading:!1},(function(){i&&i(!1,e.Logs?e.Logs.length:0)}))})).catch((function(e){u().endLoading(),i&&(a.setState({loading:!1}),i(!1,l.length))}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.service,n=e.page,r=e.size,o=e.onLoadingStatusChange;this.load(t,"",n,r,"JSON",o)}},{key:"componentWillReceiveProps",value:function(e){var t=e.service,n=e.query,r=e.page,o=e.size,i=e.onLoadingStatusChange,a=e.z;n===this.props.query&&o===this.props.size&&r===this.props.page&&a===this.props.z||this.load(t,n,r,o,"JSON",i)}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,i=t.rootSpans,a=t.selectedRows,l=this.props,s=l.pydio,c=l.onTimestampContext,u=l.query,d=l.focus,p=l.darkTheme,f=l.timeOffset,m=void 0===f?0:f,h=this.props,y=h.onPageNext,g=h.onPagePrev,v=h.nextDisabled,b=h.prevDisabled,S=h.onPageSizeChange,O=h.page,w=h.size,j=h.pageSizes,E=this.openSpans();if(a.length){var x={paddingBottom:20,paddingLeft:10,backgroundColor:p?"rgba(255,255,255,.17)":"#fafafa",color:p?"white":null,marginTop:-10,paddingTop:10},C=a[0];C.expandedRow&&delete C.expandedRow;var P=JSON.stringify(C);E=E.map((function(t){return JSON.stringify(t)===P?Y(Y({},t),{},{expandedRow:r().createElement(H,{style:x,userDisplay:"inline",pydio:s,log:t,focus:d,darkTheme:p,timeOffset:m,onSelectPeriod:c,onRequestClose:function(){return e.setState({selectedRows:[]})}})}):t}))}var k=s.MessageHash,T=AdminComponents.AdminStyles().body.tableMaster;T.row.transition="all 750ms cubic-bezier(0.23, 1, 0.32, 1) 0ms";var R={},D={};p&&(R={fontFamily:"monospace",fontWeight:"bold",height:24,paddingTop:4,paddingBottom:4},(T=Y(Y({},T),{},{row:{transition:T.row.transition,backgroundColor:"rgba(0,0,0,.87)",color:"rgba(255,255,255,.87)",height:24,borderBottomColor:"rgba(0,0,0,.87)",cursor:"pointer"}})).expandedRow=T.row,T.expanderRow={backgroundColor:"rgba(0,0,0,.5)"},D={style:{width:24,height:24,padding:0},iconStyle:{color:T.row.color}});var _,L=[{name:"Root",label:"",style:Y(Y({},R),{},{width:20,paddingLeft:0,paddingRight:0,overflow:"visible"}),headerStyle:{width:20,paddingLeft:0,paddingRight:0},renderCell:function(t){return t.HasChildren?r().createElement(o.IconButton,J({iconClassName:t.IsOpen?"mdi mdi-menu-down":"mdi mdi-menu-right",onClick:function(){i[t.SpanUuid].open=!i[t.SpanUuid].open,e.setState({rootSpans:i})}},D)):null}},{name:"Ts",label:s.MessageHash["settings.17"],renderCell:function(e){var t,n=ne(1e3*(e.Ts+m)).utc().local();return t=n.isSame(Date.now(),"day")?n.format("HH:mm:ss"):n.toLocaleString(),e.HasRoot?r().createElement("span",{style:{display:"flex",alignItems:"center",color:T.row.color,fontFamily:T.row.fontFamily}},r().createElement(o.FontIcon,{className:"mdi mdi-play-circle-outline",style:{fontSize:12,marginRight:5,color:T.row.color}})," ",t):t},style:Y(Y({},R),{},{width:130,padding:"4px 12px"}),headerStyle:{width:130,padding:12}},{name:"Level",label:k["ajxp_admin.logs.level"]||"logs.level",hideSmall:!0,renderCell:function(e){var t=null;return"info"===e.Level?t="#1976D0":"error"===e.Level?t="#E53935":"warn"===e.Level?t="#fb8c00":"debug"===e.Level&&(t="#673AB7"),r().createElement("span",{style:{color:t,fontFamily:R.fontFamily}},e.Level)},style:Y(Y({},R),{},{width:55,padding:"4px 0",textTransform:"uppercase",fontWeight:500}),headerStyle:{width:55,padding:"12px 0"}},{name:"Logger",label:k["ajxp_admin.logs.service"],hideSmall:!0,renderCell:function(e){return e.Logger?e.Logger.replace("pydio.",""):"n/a"},style:Y(Y({},R),{},{width:130,padding:"4px 0"}),headerStyle:{width:130,padding:"12px 0"}},{name:"Msg",label:k["ajxp_admin.logs.message"],style:R,renderCell:function(e){var t=e.Msg;return e.NodePath?t+=" [".concat(e.NodePath,"]"):e.NodeUuid&&(t+=" [".concat(e.NodeUuid,"]")),t}}];return y&&(_={page:O+1,pageSize:w,pageSizes:j,onPageNext:function(e){return y(e-1)},onPagePrev:function(e){return g(e-1)},onPageSizeChange:S,nextDisabled:v,prevDisabled:b}),r().createElement(te,{data:E,columns:L,onSelectRows:function(t){e.setState({selectedRows:t}),e.props.onTimestampContext&&e.props.onTimestampContext(null)},deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:n?k["settings.33"]:u?k["ajxp_admin.logs.noresults"]:k["ajxp_admin.logs.noentries"],computeRowStyle:function(e){var t={};return!p&&e.HasRoot&&(t.backgroundColor="#F5F5F5"),t},masterStyles:T,pagination:_})}}])&&Z(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(r().Component);const oe=require("lodash.debounce");var ie=e.n(oe);const ae=require("material-ui/styles");function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function se(){return se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},se.apply(this,arguments)}function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){de(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function de(e,t,n){return(t=fe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fe(r.key),r)}}function fe(e){var t=function(e,t){if("object"!==le(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===le(t)?t:String(t)}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ye(e)}var ge=u().requireLib("hoc"),ve=ge.ModernTextField,be=ge.ModernSelectField,Se=ge.ThemedModernStyles,Oe=u().requireLib("boot").moment,we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ye(i);if(a){var n=ye(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return he(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n,r=u().getInstance().Parameters.get("backend").ServerOffset,o=60*(new Date).getTimezoneOffset();try{n=JSON.parse(localStorage.getItem("pydio.logs.ux-state"))}catch(e){}return t.state=ue({filter:"",filterMode:"fulltext",levelShow:!1,serviceFilterShow:!1,darkTheme:!1,serverOffset:r+o,timeOffset:0},n),t.publishStateChange=ie()(t.publishStateChange.bind(he(t)),250),t}return t=s,n=[{key:"componentDidMount",value:function(){try{var e=JSON.parse(localStorage.getItem("pydio.logs.ux-state"));this.setState(e,this.publishStateChange.bind(this))}catch(e){}}},{key:"publishStateChange",value:function(){var e=this.state,t=e.filter,n=e.serviceFilter,r=e.level,o=e.remoteAddress,i=e.userName,a=e.date,l=e.endDate,s=e.darkTheme,c=e.timeOffset,u=e.dateShow,d=e.endDateShow,p=e.serviceFilterShow,f=e.levelShow,m=e.userNameShow,h=e.remoteAddressShow,y=E.buildQuery(t,n,r,o,i,a,l),g={darkTheme:s,timeOffset:c,dateShow:u,endDateShow:d,serviceFilterShow:p,levelShow:f,userNameShow:m,remoteAddressShow:h};localStorage.setItem("pydio.logs.ux-state",JSON.stringify(g)),this.props.onStateChange({query:y,darkTheme:s,timeOffset:c})}},{key:"handleToggleShow",value:function(e){var t=e+"Show",n=this.state[t],r=de({},t,!n);n?("date"===e||"endDate"===e?(r.date=null,r.endDate=null,r.dateShow=!1,r.endDateShow=!1):r[e]=null,r.page=0):"date"===e&&this.state.endDateShow&&(r.endDate=null,r.endDateShow=!1),this.setState(r,this.publishStateChange.bind(this))}},{key:"toggleDarkTheme",value:function(){var e=this.state.darkTheme;this.setState({darkTheme:!e},this.publishStateChange.bind(this))}},{key:"toggleUseServerOffset",value:function(){var e=this.state,t=e.serverOffset,n=e.timeOffset;this.setState({timeOffset:n?0:t},this.publishStateChange.bind(this))}},{key:"handleFilterChange",value:function(e,t){var n;this.setState((de(n={},t,e),de(n,"page",0),n),this.publishStateChange.bind(this))}},{key:"handleLevelChange",value:function(e){var t=(0===this.state.level.indexOf("<")?"<":"")+e;this.handleFilterChange(t,"level")}},{key:"handleLevelCompChange",value:function(e){var t=this.state.level,n=void 0===t?"":t;n=e+n.replace("<",""),this.handleFilterChange(n,"level")}},{key:"handleDateChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&e.setHours(t.getHours(),t.getMinutes());var n=this.state,r=n.endDate;if(n.endDateShow&&!r&&void 0!==e){var o=new Date;o.setHours(23,59,59),this.setState({endDate:o})}this.setState({date:e,page:0},this.publishStateChange.bind(this))}},{key:"handleEndDateChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&e.setHours(t.getHours(),t.getMinutes()),this.setState({endDate:e,page:0},this.publishStateChange.bind(this))}},{key:"handleExport",value:function(e){var t=this,n=this.state,r=n.filter,o=n.serviceFilter,i=n.level,a=n.remoteAddress,l=n.userName,s=n.date,c=n.endDate,u=this.props.service,d=s?s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate():"",p=E.buildQuery(r,o,i,a,l,s,c);E.downloadLogs(u||"sys",p,e).then((function(n){var r=window.URL.createObjectURL(n),o="cells-logs-";if(o+=d||"filtered",o+="."+e.toLowerCase(),navigator.userAgent.toLowerCase().indexOf("firefox")>-1)t.setState({exportUrl:r,exportFilename:o,exportOnClick:function(){setTimeout((function(){window.URL.revokeObjectURL(r)}),100),t.setState({exportUrl:null,exportFilename:null})}});else{var i=document.createElement("a");i.href=r,i.download=o,i.click(),setTimeout((function(){window.URL.revokeObjectURL(r)}),100)}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.pydio,i=t.disableExport,a=t.muiTheme,l=t.focus,s=AdminComponents.AdminStyles(a.palette),c=Se(a),u=this.state,d=u.filter,p=u.date,f=u.dateShow,m=u.endDate,h=u.endDateShow,y=u.serviceFilter,g=u.serviceFilterShow,v=u.level,b=void 0===v?"":v,S=u.levelShow,O=u.userName,w=u.userNameShow,j=u.remoteAddress,E=u.remoteAddressShow,x=u.exportUrl,C=u.exportFilename,P=u.exportOnClick,k=u.serverOffset,T=u.timeOffset,R=n.MessageHash,D=d||y||p||m||b||O||j,_=r().createElement(o.FontIcon,{style:{top:0,fontSize:20},className:"mdi mdi-check"}),L=R["ajxp_admin.logs.level.exact"],N=R["ajxp_admin.logs.level.greaterthan"],I={style:{lineHeight:"32px"}},F=function(e){var t={};return e&&(t={backgroundColor:a.palette.primary1Color,color:"white"}),{style:{minHeight:29,lineHeight:"29px",paddingTop:2,paddingBottom:2},innerDivStyle:ue({padding:"0px 10px",borderRadius:20,margin:"0 10px",fontSize:13},t)}};return r().createElement("div",{style:{display:"flex",alignItems:"center",width:"100%"}},l&&r().createElement("div",{style:{backgroundColor:"#FBE9E7",height:32,lineHeight:"32px",fontSize:13,padding:"0 10px",marginRight:5,color:"#FF5722",borderRadius:20}},"Focus on +/- 5 minutes at ",Oe(new Date(1e3*(l+T))).format("HH:mm:ss")),r().createElement("div",{style:{marginRight:5,width:140}},r().createElement(ve,{hintText:R["ajxp_admin.logs.3"],onChange:function(t,n){return e.handleFilterChange(n,"filter")},fullWidth:!0,variant:"compact"})),S&&r().createElement("div",{style:{marginRight:5,marginTop:-2,width:170}},r().createElement(be,{hintText:R["ajxp_admin.logs.level"],fullWidth:!0,value:b,onChange:function(t,n,r){return e.handleFilterChange(r,"level")},variant:"compact"},r().createElement(o.MenuItem,{primaryText:""}),r().createElement(o.MenuItem,{primaryText:"ERROR",value:"ERROR",innerDivStyle:{color:"#E53935",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"WARN "+L,value:"WARN",innerDivStyle:{color:"#FB8C00",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"WARN "+N,value:"<WARN",innerDivStyle:{color:"#FB8C00",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"INFO "+L,value:"INFO",innerDivStyle:{color:"#1976D0",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"INFO "+N,value:"<INFO",innerDivStyle:{color:"#1976D0",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"DEBUG "+L,value:"DEBUG",innerDivStyle:{color:"#673AB7",fontWeight:500,fontSize:14}}),r().createElement(o.MenuItem,{primaryText:"DEBUG "+N,value:"<DEBUG",innerDivStyle:{color:"#673AB7",fontWeight:500,fontSize:14}}))),g&&r().createElement("div",{style:{marginRight:5,width:80}},r().createElement(ve,{hintText:R["ajxp_admin.logs.service"],fullWidth:!0,value:y,onChange:function(t,n){return e.handleFilterChange(n,"serviceFilter")},variant:"compact"})),E&&r().createElement("div",{style:{marginRight:5,width:80}},r().createElement(ve,{hintText:R["ajxp_admin.logs.filter.ip"],fullWidth:!0,onChange:function(t,n){return e.handleFilterChange(n,"remoteAddress")},variant:"compact"})),w&&r().createElement("div",{style:{marginRight:5,width:80}},r().createElement(ve,{hintText:R["ajxp_admin.logs.filter.login"],fullWidth:!0,onChange:function(t,n){return e.handleFilterChange(n,"userName")},variant:"compact"})),f&&!h&&r().createElement("div",{style:{display:"flex",alignItems:"center"}},r().createElement(o.DatePicker,se({hintText:R["ajxp_admin.logs.2"],onChange:function(t,n){return e.handleDateChange(n)},autoOk:!0,maxDate:new Date,value:p,showYearSelector:!0,style:{width:120},textFieldStyle:{width:120}},c.textFieldCompact)),r().createElement(o.IconButton,se({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){e.handleDateChange(void 0)}},s.props.header.iconButton))),h&&r().createElement("div",{style:{display:"flex",alignItems:"center"}},r().createElement(o.DatePicker,se({hintText:R["ajxp_admin.logs.filter.period.from"],onChange:function(t,n){return e.handleDateChange(n)},autoOk:!0,maxDate:new Date,value:p,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),r().createElement(o.TimePicker,se({hintText:R["ajxp_admin.logs.filter.period.time"],disabled:!p,onChange:function(t,n){return e.handleDateChange(p,n)},autoOk:!0,value:p,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),r().createElement(o.DatePicker,se({hintText:R["ajxp_admin.logs.filter.period.to"],onChange:function(t,n){return e.handleEndDateChange(n)},autoOk:!0,minDate:this.state.date,maxDate:new Date,value:m,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),r().createElement(o.TimePicker,se({hintText:R["ajxp_admin.logs.filter.period.time"],disabled:!m,onChange:function(t,n){return e.handleEndDateChange(m,n)},autoOk:!0,value:m,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),r().createElement(o.IconButton,se({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){e.handleDateChange(void 0),e.handleEndDateChange(void 0)}},s.props.header.iconButton))),r().createElement(o.IconMenu,{iconButtonElement:r().createElement(o.IconButton,se({iconClassName:"mdi mdi-filter-variant-plus",tooltip:R["ajxp_admin.logs.3"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0,clickCloseDelay:0},r().createElement(o.Subheader,I,R["ajxp_admin.logs.filter.legend"]),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.level"],onClick:function(){e.handleToggleShow("level")}},F(S))),r().createElement(o.Divider,null),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.2"],onClick:function(){e.handleToggleShow("date")}},F(f&&!h))),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.filter.period"],onClick:function(){e.handleToggleShow("endDate")}},F(h))),r().createElement(o.Divider,null),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.service"],onClick:function(){e.handleToggleShow("serviceFilter")}},F(g))),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.filter.login"],onClick:function(){e.handleToggleShow("userName")}},F(w))),r().createElement(o.MenuItem,se({primaryText:R["ajxp_admin.logs.filter.ip"],onClick:function(){e.handleToggleShow("remoteAddress")}},F(E)))),0!==k&&r().createElement(o.IconMenu,{iconButtonElement:r().createElement(o.IconButton,se({iconClassName:"mdi mdi-alarm"+(T?"-snooze":""),tooltip:R["ajxp_admin.logs.tz.tooltip"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},r().createElement(o.MenuItem,{primaryText:R["ajxp_admin.logs.tz.local"],rightIcon:T?null:_,onClick:function(){e.toggleUseServerOffset()}}),r().createElement(o.MenuItem,{primaryText:R["ajxp_admin.logs.tz.server"],rightIcon:T?_:null,onClick:function(){e.toggleUseServerOffset()}})),!i&&r().createElement(o.IconMenu,{iconButtonElement:r().createElement(o.IconButton,se({iconClassName:"mdi mdi-download",tooltip:R["ajxp_admin.logs.11"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},!D&&r().createElement(o.Subheader,I,R["ajxp_admin.logs.export.disabled"]),D&&r().createElement(o.Subheader,I,R["ajxp_admin.logs.11"]),r().createElement(o.MenuItem,{primaryText:"CSV",rightIcon:r().createElement(o.FontIcon,{style:{top:0},className:"mdi mdi-file-delimited"}),onClick:function(){e.handleExport("CSV")},disabled:!D}),r().createElement(o.MenuItem,{primaryText:"XLSX",rightIcon:r().createElement(o.FontIcon,{style:{top:0},className:"mdi mdi-file-excel"}),onClick:function(){e.handleExport("XLSX")},disabled:!D}),x&&r().createElement(o.Subheader,null,r().createElement("a",{href:x,download:C},C))),r().createElement(o.Dialog,{open:!!x,modal:!0,title:R["ajxp_admin.logs.11"],actions:[r().createElement(o.FlatButton,{label:R[54],onClick:P})]},r().createElement("span",{style:{fontSize:13}},R["ajxp_admin.logs.export.clicklink"],": ",r().createElement("a",{style:{textDecoration:"underline"},href:x,download:C,onClick:P},C))),r().createElement(o.IconButton,{iconClassName:"mdi mdi-brightness-6",tooltip:R["ajxp_admin.logs.toggleTheme"],onClick:function(){return e.toggleDarkTheme()},style:s.props.header.iconButton.style,iconStyle:ue(ue({},s.props.header.iconButton.iconStyle),{},{transform:this.state.darkTheme?"rotate(180deg)":""})}))}}],n&&pe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(r().Component);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ee.apply(this,arguments)}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e,t,n){return(t=ke(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ke(r.key),r)}}function ke(e){var t=function(e,t){if("object"!==je(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===je(t)?t:String(t)}function Te(e,t){return Te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Te(e,t)}function Re(e){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Re(e)}we=(0,ae.muiThemeable)()(we);var De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Te(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Re(i);if(a){var n=Re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={page:0,size:100,query:"",contentType:"JSON",loading:!1,results:0},t}return t=s,n=[{key:"handleLogToolsChange",value:function(e){this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){Ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))}},{key:"componentWillReceiveProps",value:function(e){void 0!==e.query&&e.query!==this.state.query&&this.setState({query:e.query,page:0}),void 0!==e.darkTheme&&this.setState({darkTheme:e.darkTheme}),void 0!==e.timeOffset&&this.setState({timeOffset:e.timeOffset})}},{key:"handleReload",value:function(){this.setState({z:Math.random()})}},{key:"handleDecrPage",value:function(){this.setState({page:Math.max(this.state.page-1,0)})}},{key:"handleIncrPage",value:function(){this.setState({page:this.state.page+1})}},{key:"handleTimestampContext",value:function(e){if(e){var t=E.buildTsQuery(e,5);this.setState({tmpQuery:t,focus:e})}else this.setState({tmpQuery:null,focus:null})}},{key:"handleLoadingStatusChange",value:function(e,t){this.props.onLoadingStatusChange?this.props.onLoadingStatusChange(e):this.setState({loading:e}),this.setState({results:t})}},{key:"render",value:function(){var e,t=this,n=this.props,i=n.pydio,a=n.noHeader,l=n.service,s=n.disableExport,c=n.currentNode,u=this.state,d=u.page,p=u.size,f=u.query,m=u.tmpQuery,h=u.focus,y=u.contentType,g=u.z,v=u.results,b=u.darkTheme,S=u.timeOffset,O=void 0===S?0:S,w=i.MessageHash["ajxp_admin.logs.1"],j=r().createElement(we,{pydio:i,service:l,focus:h,onStateChange:this.handleLogToolsChange.bind(this),disableExport:s}),E=AdminComponents.AdminStyles().body,x=E.block.props,C=E.block.container,P=0===d,k=[50,100,500,1e3];P&&v<k[0]||h||(e={pageSizes:k,prevDisabled:P,nextDisabled:v<p,onPageNext:this.handleIncrPage.bind(this),onPagePrev:this.handleDecrPage.bind(this),onPageSizeChange:function(e){t.setState({size:e,page:0})}});var T=r().createElement(o.Paper,Ee({},x,{style:C}),r().createElement(re,Ee({pydio:i,service:l||"syslog",page:d,size:p,query:m||f,focus:h,contentType:y,darkTheme:b,timeOffset:O,z:g,onLoadingStatusChange:this.handleLoadingStatusChange.bind(this),onTimestampContext:this.handleTimestampContext.bind(this)},e)));return a?T:r().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},r().createElement("div",{className:"vertical-layout",style:{width:"100%"}},r().createElement(AdminComponents.Header,{title:w,icon:c.getMetadata().get("icon_class"),actions:j,reloadAction:this.handleReload.bind(this),loading:this.state.loading}),r().createElement("div",{className:"layout-fill"},T)))}}],n&&Pe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(r().Component);De.propTypes={dataModel:a().instanceOf(s()).isRequired},window.AdminLogs=t})();