(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Dashboard:()=>Pe,LogTools:()=>be});const n=require("react");var o=e.n(n);const r=require("material-ui"),i=require("prop-types");var a=e.n(i);const l=require("pydio/model/data-model");var s=e.n(l);const c=require("pydio");var u=e.n(c);const d=require("pydio/lang/observable");var p=e.n(d);const f=require("pydio/http/api");var h=e.n(f);const m=require("pydio/http/resources-manager");var g=e.n(m);const y=require("cells-sdk");function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t){return O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},O(e,t)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var x=["ERROR","WARN","INFO","DEBUG"],E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=w(o);if(r){var a=w(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==v(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,n=[{key:"buildQuery",value:function(e,t,n,o,r,i){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,l=[];if(e&&l.push('+Msg:"*'+e+'*"'),t&&l.push("+Logger:*"+t+"*"),n)if(0===n.indexOf("<")){var s=x.indexOf(n.replace("<","")),c=x.filter((function(e,t){return t<=s})).map((function(e){return"Level:"+e}));l.push.apply(l,function(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(c))}else l.push("+Level:"+n);if(o&&l.push("+RemoteAddress:*"+o+"*"),r&&l.push("+UserName:*"+r+"*"),i){var u=i,d=new Date(u);a?d=a:d.setDate(u.getDate()+1),l.push("+Ts:>"+Math.floor(u/1e3)),l.push("+Ts:<"+Math.floor(d/1e3))}return l.join(" ")}},{key:"buildTsQuery",value:function(e,t){var n=[];return n.push("+Ts:>"+(e-60*t)),n.push("+Ts:<"+(e+60*t)),n.join(" ")}},{key:"loadLogs",value:function(e,t,n,o,r){var i=new y.LogListLogRequest;return i.Query=t,i.Page=n,i.Size=o,i.Format=y.ListLogRequestLogFormat.constructFromObject(r),"syslog"===e?new y.LogServiceApi(h().getRestClient()).syslog(i):"audit"===e?g().loadClass("EnterpriseSDK").then((function(e){return new e.EnterpriseLogServiceApi(h().getRestClient()).audit(i)})):Promise.reject("Unknown service name, must be 'syslog' or 'audit'")}},{key:"downloadLogs",value:function(e,t,n){var o=new y.LogListLogRequest;return o.Query=t,o.Page=0,o.Size=1e5,o.Format=y.ListLogRequestLogFormat.constructFromObject(n),a.auditExportWithHttpInfo(o,e).then((function(e){return e.response.body}))}},{key:"auditExportWithHttpInfo",value:function(e,t){var n=e;if(null==e)throw new Error("Missing the required parameter 'body' when calling auditExport");return h().getRestClient().callApi("/log/"+t+"/export","POST",{},{},{},{},n,[],["application/json"],["application/json"],"Blob")}}],null&&S(t.prototype,null),n&&S(t,n),a}(p());const C=require("react-dom");var j=e.n(C);const P=require("clipboard");var k=e.n(P);function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),e}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}function A(e,t){return A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},A(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o,r,i=z(e);if(t){var a=z(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o=this,!(r=n)||"object"!==R(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o):r}}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var B=u().requireLib("components").UserAvatar,U=function(e){F(n,e);var t=M(n);function n(){return L(this,n),t.apply(this,arguments)}return I(n,[{key:"render",value:function(){var e=this.props,t=e.iconClassName,n=e.legend,i=e.data,a=(e.selectable,{icon:{fontSize:20,margin:"0px 16px 0",lineHeight:"16px"},legend:{textAlign:"right",color:"#666",fontWeight:500,width:130,userSelect:"text"},data:{flex:1,paddingRight:6,overflow:"hidden",textOverflow:"ellipsis",userSelect:"text"}});return o().createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:8,overflow:"hidden",fontWeight:"initial"}},o().createElement("div",{style:a.legend},n),o().createElement("div",{style:{width:64}},o().createElement(r.FontIcon,{color:"#ccc",className:t,style:a.icon})),o().createElement("div",{style:a.data},i))}}]),n}(o().Component),q=function(e){F(i,e);var t=M(i);function i(e){var n;return L(this,i),(n=t.call(this,e)).state={copySuccess:!1},n}return I(i,[{key:"componentDidMount",value:function(){this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.detachClipboard()}},{key:"attachClipboard",value:function(){var e=this.props,t=e.log;e.pydio,this.detachClipboard(),this.refs["copy-button"]&&(this._clip=new(k())(j().findDOMNode(this.refs["copy-button"]),{text:function(e){var n=[];return Object.keys(t).map((function(e){var o=t[e];o&&("RoleUuids"===e&&(o=o.join(",")),n.push(e+" : "+o))})),n.join("\n")}.bind(this)}),this._clip.on("success",function(){var e=this;this.setState({copySuccess:!0},(function(){setTimeout((function(){e.setState({copySuccess:!1})}),3e3)}))}.bind(this)),this._clip.on("error",function(){}.bind(this)))}},{key:"detachClipboard",value:function(){this._clip&&this._clip.destroy()}},{key:"focusPeriod",value:function(){var e=this.props;(0,e.onSelectPeriod)(e.log.Ts)}},{key:"unfocusPeriod",value:function(){var e=this.props,t=e.onSelectPeriod;e.focus&&t(null)}},{key:"render",value:function(){var e,t=this,i=this.props,a=i.log,l=i.pydio,s=i.onRequestClose,c=i.onSelectPeriod,u=i.style,d=i.focus,p=i.darkTheme,f=i.timeOffset,h=void 0===f?0:f,m=i.userDisplay,g=void 0===m?"avatar":m,y=this.state.copySuccess,v={divider:{marginTop:5,marginBottom:5},userLegend:{marginTop:-16,paddingBottom:10,textAlign:"center",color:"#9E9E9E",fontWeight:500},buttons:{position:"absolute",top:6,right:6,display:"flex"},button:{height:36,width:36,padding:8},buttonIcon:{fontSize:20,color:p?"white":null}};if(a.Profile||a.RoleUuids||a.GroupPath){var b=[];a.Profile&&b.push("Profile: "+a.Profile),a.GroupPath&&b.push("Group: "+a.GroupPath),a.RoleUuids&&b.push("Roles: "+a.RoleUuids.join(",")),e=b.join(" - ")}var S=a.Msg;"error"===a.Level&&(S=o().createElement("span",{style:{color:"#e53935"}},a.Msg));var O={};if(a.JsonZaps){var w=JSON.parse(a.JsonZaps);Object.keys(w).map((function(e){O[e]=JSON.stringify(w[e])}))}var x=function(e){return l.MessageHash["ajxp_admin.logs.details."+e]||e};return o().createElement("div",{style:D({fontSize:13,color:"rgba(0,0,0,.87)",paddingBottom:10},u)},o().createElement(r.Paper,{zDepth:1,style:{backgroundColor:"#f5f5f5",marginBottom:10,position:"relative"}},o().createElement("div",{style:v.buttons},o().createElement(r.IconButton,{style:v.button,iconStyle:v.buttonIcon,iconClassName:y?"mdi mdi-check":"mdi mdi-content-copy",tooltip:x("copy"),tooltipPosition:"bottom-left",ref:"copy-button"}),c&&o().createElement(r.IconButton,{style:v.button,iconStyle:D(D({},v.buttonIcon),{},{color:d?"#ff5722":v.buttonIcon.color}),iconClassName:"mdi mdi-clock",onClick:d?this.unfocusPeriod.bind(this):this.focusPeriod.bind(this),tooltip:x("show-focus"),tooltipPosition:"bottom-left"}),o().createElement(r.IconButton,{style:v.button,iconStyle:v.buttonIcon,iconClassName:"mdi mdi-close",onClick:function(){t.unfocusPeriod(),s()},tooltip:x("close"),tooltipPosition:"bottom-left"})),"avatar"===g&&a.UserName&&o().createElement(B,{pydio:l,userId:a.UserName,richCard:!0,displayLabel:!0,displayAvatar:!0,noActionsPanel:!0}),"avatar"===g&&e&&o().createElement("div",{style:v.userLegend},e)),a.UserName&&"inline"===g&&o().createElement(n.Fragment,null,o().createElement(U,{iconClassName:"mdi mdi-account",legend:x("user"),data:a.UserName}),e&&o().createElement(U,{iconClassName:"mdi mdi-account-multiple",legend:x("user-attributes"),data:e}),o().createElement(r.Divider,{style:v.divider})),o().createElement(U,{iconClassName:"mdi mdi-calendar",legend:x("date"),data:new Date(1e3*(a.Ts+h)).toLocaleString()}),o().createElement(U,{iconClassName:"mdi mdi-comment-text",legend:x("msg"),data:S}),o().createElement(U,{iconClassName:"mdi mdi-server-network",legend:x("service"),data:a.Logger}),(a.RemoteAddress||a.UserAgent||a.HttpProtocol)&&o().createElement(r.Divider,{style:v.divider}),a.RemoteAddress&&o().createElement(U,{iconClassName:"mdi mdi-cast-connected",legend:x("connection"),data:a.RemoteAddress}),a.UserAgent&&o().createElement(U,{iconClassName:"mdi mdi-cellphone-link",legend:x("agent"),data:a.UserAgent}),a.HttpProtocol&&o().createElement(U,{iconClassName:"mdi mdi-open-in-app",legend:x("protocol"),data:a.HttpProtocol}),a.NodePath&&o().createElement(n.Fragment,null,o().createElement(r.Divider,{style:v.divider}),o().createElement(U,{iconClassName:"mdi mdi-file-tree",legend:x("node"),data:a.NodePath}),a.TransferSize&&o().createElement(U,{iconClassName:"mdi mdi-file",legend:x("transfer-size"),data:a.TransferSize}),o().createElement(U,{iconClassName:"mdi mdi-folder-open",legend:x("workspace"),data:a.WsUuid})),Object.keys(O).length>0&&o().createElement(n.Fragment,null,o().createElement(r.Divider,{style:v.divider}),Object.keys(O).map((function(e){return o().createElement(U,{iconClassName:"mdi mdi-tag",legend:e,data:O[e]})}))))}}]),i}(o().Component);function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function W(){return W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},W.apply(this,arguments)}function J(e){return function(e){if(Array.isArray(e))return Q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Z(e,t){return Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Z(e,t)}function $(e){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},$(e)}q.PropTypes={pydio:a().instanceOf(u()),log:a().instanceOf(y.LogLogMessage)};var K=u().requireLib("components").MaterialTable,ee=u().requireLib("boot").moment,te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,o=$(i);if(a){var r=$(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return t=this,!(n=e)||"object"!==H(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={logs:[],loading:!1,rootSpans:{},selectedRows:[]},t}return t=s,(n=[{key:"initRootSpans",value:function(e){if(!e||!e.length)return{logs:[],rootSpans:{}};for(var t={},n=e.map((function(e,n){return e.SpanUuid||(e.SpanUuid="span-"+n),e.SpanRootUuid||(t[e.SpanUuid]={open:!0,children:[]}),e})),o=[],r=0;r<n.length;r++){var i=n[r];if(i.SpanRootUuid&&t[i.SpanRootUuid])t[i.SpanRootUuid].children.push(i),i.HasRoot=!0;else if(!i.SpanRootUuid||t[i.SpanRootUuid])o.push(i);else{var a=X({},i);a.SpanUuid=i.SpanRootUuid,i.HasRoot=!0,t[i.SpanRootUuid]={open:!0,children:[i]},o.push(a)}}return{logs:o,rootSpans:t}}},{key:"openSpans",value:function(){for(var e=this.state,t=e.logs,n=e.rootSpans,o=[],r=0;r<t.length;r++){var i=t[r],a=n[i.SpanUuid];if(a.children.length&&(i.HasChildren=!0,i.IsOpen=a.open,!i.RemoteAddress)){var l=a.children.filter((function(e){return e.RemoteAddress}));l.length&&(i.RemoteAddress=l[0].RemoteAddress)}o.push(i),a.open&&(o=[].concat(J(o),J(a.children)))}return o}},{key:"load",value:function(e,t,n,o,r,i){var a=this,l=this.state.logs;i&&(this.setState({loading:!0}),i(!0,l.length)),u().startLoading(),E.loadLogs(e,t,n,o,r).then((function(e){u().endLoading();var t=a.initRootSpans(e.Logs),n=t.logs,o=t.rootSpans;a.setState({logs:n,rootSpans:o,loading:!1},(function(){i&&i(!1,e.Logs?e.Logs.length:0)}))})).catch((function(e){u().endLoading(),i&&(a.setState({loading:!1}),i(!1,l.length))}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.service,n=e.page,o=e.size,r=e.onLoadingStatusChange;this.load(t,"",n,o,"JSON",r)}},{key:"componentWillReceiveProps",value:function(e){var t=e.service,n=e.query,o=e.page,r=e.size,i=e.onLoadingStatusChange,a=e.z;n===this.props.query&&r===this.props.size&&o===this.props.page&&a===this.props.z||this.load(t,n,o,r,"JSON",i)}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,i=t.rootSpans,a=t.selectedRows,l=this.props,s=l.pydio,c=l.onTimestampContext,u=l.query,d=l.focus,p=l.darkTheme,f=l.timeOffset,h=void 0===f?0:f,m=this.props,g=m.onPageNext,y=m.onPagePrev,v=m.nextDisabled,b=m.prevDisabled,S=m.onPageSizeChange,O=m.page,w=m.size,x=m.pageSizes,E=this.openSpans();if(a.length){var C={paddingBottom:20,paddingLeft:10,backgroundColor:p?"rgba(255,255,255,.17)":"#fafafa",color:p?"white":null,marginTop:-10,paddingTop:10},j=a[0];j.expandedRow&&delete j.expandedRow;var P=JSON.stringify(j);E=E.map((function(t){return JSON.stringify(t)===P?X(X({},t),{},{expandedRow:o().createElement(q,{style:C,userDisplay:"inline",pydio:s,log:t,focus:d,darkTheme:p,timeOffset:h,onSelectPeriod:c,onRequestClose:function(){return e.setState({selectedRows:[]})}})}):t}))}var k=s.MessageHash,R=AdminComponents.AdminStyles().body.tableMaster;R.row.transition="all 750ms cubic-bezier(0.23, 1, 0.32, 1) 0ms";var T={whiteSpace:"initial",paddingTop:6,paddingBottom:6},D={},_={lineHeight:"16px",fontSize:11,fontWeight:500};p&&(T={whiteSpace:"initial",fontFamily:"monospace",fontWeight:"bold",verticalAlign:"top",height:24,paddingTop:4,paddingBottom:4},_.lineHeight=null,(R=X(X({},R),{},{row:{transition:R.row.transition,backgroundColor:"rgba(0,0,0,.87)",color:"rgba(255,255,255,.87)",height:24,borderBottom:0,cursor:"pointer"}})).expandedRow=R.row,R.expanderRow={backgroundColor:"rgba(0,0,0,.5)"},D={style:{width:24,height:24,padding:0},iconStyle:{color:R.row.color}});var L,N=[{name:"Root",label:"",style:X(X({},T),{},{width:20,paddingLeft:0,paddingRight:0,overflow:"visible"}),headerStyle:{width:20,paddingLeft:0,paddingRight:0},renderCell:function(t){return t.HasChildren?o().createElement(r.IconButton,W({style:{width:20,padding:"11px 0"},iconStyle:{color:"#9e9e9e"},iconClassName:t.IsOpen?"mdi mdi-menu-down":"mdi mdi-menu-right",onClick:function(n){n.stopPropagation(),i[t.SpanUuid].open=!i[t.SpanUuid].open,e.setState({rootSpans:i})}},D)):null}},{name:"Ts",label:s.MessageHash["settings.17"],renderCell:function(e){var t,n=ee(1e3*(e.Ts+h)).utc().local();return t=n.isSame(Date.now(),"day")?n.format("HH:mm:ss"):n.format(n.localeData().longDateFormat("LLL")),e.HasRoot?o().createElement("span",{style:{display:"flex",alignItems:"center",color:R.row.color,fontFamily:R.row.fontFamily}},o().createElement(r.FontIcon,{className:"mdi mdi-chevron-right",style:{fontSize:12,marginRight:5,color:R.row.color}})," ",t):t},style:X(X(X({},T),_),{},{width:130,padding:"4px 12px 4px 0"}),headerStyle:{width:130,paddingRight:12,paddingLeft:0}},{name:"Level",label:k["ajxp_admin.logs.level"]||"logs.level",hideSmall:!0,renderCell:function(e){var t=null;return"info"===e.Level?t="#1976D0":"error"===e.Level?t="#E53935":"warn"===e.Level?t="#fb8c00":"debug"===e.Level&&(t="#673AB7"),o().createElement("span",{style:{color:t,fontFamily:T.fontFamily}},e.Level)},style:X(X({},T),{},{width:55,padding:"4px 0",textTransform:"uppercase",fontWeight:500}),headerStyle:{width:55,padding:"12px 0"}},{name:"Logger",label:k["ajxp_admin.logs.service"],hideSmall:!0,renderCell:function(e){return e.Logger?e.Logger.replace("pydio.",""):"n/a"},style:X(X({},T),{},{width:130,padding:"4px 0"}),headerStyle:{width:130,padding:"12px 0"}},{name:"Msg",label:k["ajxp_admin.logs.message"],style:T,renderCell:function(e){var t=e.Msg;return e.NodePath?t+=" [".concat(e.NodePath,"]"):e.NodeUuid&&(t+=" [".concat(e.NodeUuid,"]")),t}}];return g&&(L={page:O+1,pageSize:w,pageSizes:x,onPageNext:function(e){return g(e-1)},onPagePrev:function(e){return y(e-1)},onPageSizeChange:S,nextDisabled:v,prevDisabled:b}),o().createElement(K,{data:E,columns:N,onSelectRows:function(t){e.setState({selectedRows:t}),e.props.onTimestampContext&&e.props.onTimestampContext(null)},deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:n?k["settings.33"]:u?k["ajxp_admin.logs.noresults"]:k["ajxp_admin.logs.noentries"],computeRowStyle:function(e){var t={};return!p&&e.HasRoot&&(t.backgroundColor="#F5F5F5"),t},masterStyles:R,pagination:L})}}])&&V(t.prototype,n),s}(o().Component);const ne=require("lodash.debounce");var oe=e.n(ne);const re=require("material-ui/styles");function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ae(){return ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ae.apply(this,arguments)}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function de(e,t){return de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},de(e,t)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}var he=u().requireLib("hoc"),me=he.ModernTextField,ge=he.ModernSelectField,ye=he.ThemedModernStyles,ve=u().requireLib("boot").moment,be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,o=fe(i);if(a){var r=fe(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return t=this,!(n=e)||"object"!==ie(n)&&"function"!=typeof n?pe(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=l.call(this,e);var n,o=u().getInstance().Parameters.get("backend").ServerOffset,r=60*(new Date).getTimezoneOffset();try{n=JSON.parse(localStorage.getItem("pydio.logs.ux-state"))}catch(e){}return t.state=se({filter:"",filterMode:"fulltext",levelShow:!1,serviceFilterShow:!1,darkTheme:!1,serverOffset:o+r,timeOffset:0},n),t.publishStateChange=oe()(t.publishStateChange.bind(pe(t)),250),t}return t=s,n=[{key:"componentDidMount",value:function(){try{var e=JSON.parse(localStorage.getItem("pydio.logs.ux-state"));this.setState(e,this.publishStateChange.bind(this))}catch(e){}}},{key:"publishStateChange",value:function(){var e=this.state,t=e.filter,n=e.serviceFilter,o=e.level,r=e.remoteAddress,i=e.userName,a=e.date,l=e.endDate,s=e.darkTheme,c=e.timeOffset,u=e.dateShow,d=e.endDateShow,p=e.serviceFilterShow,f=e.levelShow,h=e.userNameShow,m=e.remoteAddressShow,g=E.buildQuery(t,n,o,r,i,a,l),y={darkTheme:s,timeOffset:c,dateShow:u,endDateShow:d,serviceFilterShow:p,levelShow:f,userNameShow:h,remoteAddressShow:m};localStorage.setItem("pydio.logs.ux-state",JSON.stringify(y)),this.props.onStateChange({query:g,darkTheme:s,timeOffset:c})}},{key:"handleToggleShow",value:function(e){var t=e+"Show",n=this.state[t],o=ce({},t,!n);n?("date"===e||"endDate"===e?(o.date=null,o.endDate=null,o.dateShow=!1,o.endDateShow=!1):o[e]=null,o.page=0):"date"===e&&this.state.endDateShow&&(o.endDate=null,o.endDateShow=!1),this.setState(o,this.publishStateChange.bind(this))}},{key:"toggleDarkTheme",value:function(){var e=this.state.darkTheme;this.setState({darkTheme:!e},this.publishStateChange.bind(this))}},{key:"toggleUseServerOffset",value:function(){var e=this.state,t=e.serverOffset,n=e.timeOffset;this.setState({timeOffset:n?0:t},this.publishStateChange.bind(this))}},{key:"handleFilterChange",value:function(e,t){var n;this.setState((ce(n={},t,e),ce(n,"page",0),n),this.publishStateChange.bind(this))}},{key:"handleLevelChange",value:function(e){var t=(0===this.state.level.indexOf("<")?"<":"")+e;this.handleFilterChange(t,"level")}},{key:"handleLevelCompChange",value:function(e){var t=this.state.level,n=void 0===t?"":t;n=e+n.replace("<",""),this.handleFilterChange(n,"level")}},{key:"handleDateChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&e.setHours(t.getHours(),t.getMinutes());var n=this.state,o=n.endDate;if(n.endDateShow&&!o&&void 0!==e){var r=new Date;r.setHours(23,59,59),this.setState({endDate:r})}this.setState({date:e,page:0},this.publishStateChange.bind(this))}},{key:"handleEndDateChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&e.setHours(t.getHours(),t.getMinutes()),this.setState({endDate:e,page:0},this.publishStateChange.bind(this))}},{key:"handleExport",value:function(e){var t=this,n=this.state,o=n.filter,r=n.serviceFilter,i=n.level,a=n.remoteAddress,l=n.userName,s=n.date,c=n.endDate,u=this.props.service,d=s?s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate():"",p=E.buildQuery(o,r,i,a,l,s,c);E.downloadLogs(u||"sys",p,e).then((function(n){var o=window.URL.createObjectURL(n),r="cells-logs-";if(r+=d||"filtered",r+="."+e.toLowerCase(),navigator.userAgent.toLowerCase().indexOf("firefox")>-1)t.setState({exportUrl:o,exportFilename:r,exportOnClick:function(){setTimeout((function(){window.URL.revokeObjectURL(o)}),100),t.setState({exportUrl:null,exportFilename:null})}});else{var i=document.createElement("a");i.href=o,i.download=r,i.click(),setTimeout((function(){window.URL.revokeObjectURL(o)}),100)}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.pydio,i=t.disableExport,a=t.muiTheme,l=t.focus,s=AdminComponents.AdminStyles(a.palette),c=ye(a),u=this.state,d=u.filter,p=u.date,f=u.dateShow,h=u.endDate,m=u.endDateShow,g=u.serviceFilter,y=u.serviceFilterShow,v=u.level,b=void 0===v?"":v,S=u.levelShow,O=u.userName,w=u.userNameShow,x=u.remoteAddress,E=u.remoteAddressShow,C=u.exportUrl,j=u.exportFilename,P=u.exportOnClick,k=u.serverOffset,R=u.timeOffset,T=n.MessageHash,D=d||g||p||h||b||O||x,_=o().createElement(r.FontIcon,{style:{top:0,fontSize:20},className:"mdi mdi-check"}),L=T["ajxp_admin.logs.level.exact"],N=T["ajxp_admin.logs.level.greaterthan"],I={style:{lineHeight:"32px"}},F=function(e){var t={};return e&&(t={backgroundColor:a.palette.primary1Color,color:"white"}),{style:{minHeight:29,lineHeight:"29px",paddingTop:2,paddingBottom:2},innerDivStyle:se({padding:"0px 10px",borderRadius:20,margin:"0 10px",fontSize:13},t)}};return o().createElement("div",{style:{display:"flex",alignItems:"center",width:"100%"}},l&&o().createElement("div",{style:{backgroundColor:"#FBE9E7",height:32,lineHeight:"32px",fontSize:13,padding:"0 10px",marginRight:5,color:"#FF5722",borderRadius:20}},"Focus on +/- 5 minutes at ",ve(new Date(1e3*(l+R))).format("HH:mm:ss")),o().createElement("div",{style:{marginRight:5,width:140}},o().createElement(me,{hintText:T["ajxp_admin.logs.3"],onChange:function(t,n){return e.handleFilterChange(n,"filter")},fullWidth:!0,variant:"compact"})),S&&o().createElement("div",{style:{marginRight:5,marginTop:-2,width:170}},o().createElement(ge,{hintText:T["ajxp_admin.logs.level"],fullWidth:!0,value:b,onChange:function(t,n,o){return e.handleFilterChange(o,"level")},variant:"compact"},o().createElement(r.MenuItem,{primaryText:""}),o().createElement(r.MenuItem,{primaryText:"ERROR",value:"ERROR",innerDivStyle:{color:"#E53935",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"WARN "+L,value:"WARN",innerDivStyle:{color:"#FB8C00",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"WARN "+N,value:"<WARN",innerDivStyle:{color:"#FB8C00",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"INFO "+L,value:"INFO",innerDivStyle:{color:"#1976D0",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"INFO "+N,value:"<INFO",innerDivStyle:{color:"#1976D0",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"DEBUG "+L,value:"DEBUG",innerDivStyle:{color:"#673AB7",fontWeight:500,fontSize:14}}),o().createElement(r.MenuItem,{primaryText:"DEBUG "+N,value:"<DEBUG",innerDivStyle:{color:"#673AB7",fontWeight:500,fontSize:14}}))),y&&o().createElement("div",{style:{marginRight:5,width:80}},o().createElement(me,{hintText:T["ajxp_admin.logs.service"],fullWidth:!0,value:g,onChange:function(t,n){return e.handleFilterChange(n,"serviceFilter")},variant:"compact"})),E&&o().createElement("div",{style:{marginRight:5,width:80}},o().createElement(me,{hintText:T["ajxp_admin.logs.filter.ip"],fullWidth:!0,onChange:function(t,n){return e.handleFilterChange(n,"remoteAddress")},variant:"compact"})),w&&o().createElement("div",{style:{marginRight:5,width:80}},o().createElement(me,{hintText:T["ajxp_admin.logs.filter.login"],fullWidth:!0,onChange:function(t,n){return e.handleFilterChange(n,"userName")},variant:"compact"})),f&&!m&&o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement(r.DatePicker,ae({hintText:T["ajxp_admin.logs.2"],onChange:function(t,n){return e.handleDateChange(n)},autoOk:!0,maxDate:new Date,value:p,showYearSelector:!0,style:{width:120},textFieldStyle:{width:120}},c.textFieldCompact)),o().createElement(r.IconButton,ae({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){e.handleDateChange(void 0)}},s.props.header.iconButton))),m&&o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement(r.DatePicker,ae({hintText:T["ajxp_admin.logs.filter.period.from"],onChange:function(t,n){return e.handleDateChange(n)},autoOk:!0,maxDate:new Date,value:p,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),o().createElement(r.TimePicker,ae({hintText:T["ajxp_admin.logs.filter.period.time"],disabled:!p,onChange:function(t,n){return e.handleDateChange(p,n)},autoOk:!0,value:p,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),o().createElement(r.DatePicker,ae({hintText:T["ajxp_admin.logs.filter.period.to"],onChange:function(t,n){return e.handleEndDateChange(n)},autoOk:!0,minDate:this.state.date,maxDate:new Date,value:h,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),o().createElement(r.TimePicker,ae({hintText:T["ajxp_admin.logs.filter.period.time"],disabled:!h,onChange:function(t,n){return e.handleEndDateChange(h,n)},autoOk:!0,value:h,style:{width:100},textFieldStyle:{width:96}},c.textFieldCompact)),o().createElement(r.IconButton,ae({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){e.handleDateChange(void 0),e.handleEndDateChange(void 0)}},s.props.header.iconButton))),o().createElement(r.IconMenu,{iconButtonElement:o().createElement(r.IconButton,ae({iconClassName:"mdi mdi-filter-variant-plus",tooltip:T["ajxp_admin.logs.3"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0,clickCloseDelay:0},o().createElement(r.Subheader,I,T["ajxp_admin.logs.filter.legend"]),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.level"],onClick:function(){e.handleToggleShow("level")}},F(S))),o().createElement(r.Divider,null),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.2"],onClick:function(){e.handleToggleShow("date")}},F(f&&!m))),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.filter.period"],onClick:function(){e.handleToggleShow("endDate")}},F(m))),o().createElement(r.Divider,null),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.service"],onClick:function(){e.handleToggleShow("serviceFilter")}},F(y))),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.filter.login"],onClick:function(){e.handleToggleShow("userName")}},F(w))),o().createElement(r.MenuItem,ae({primaryText:T["ajxp_admin.logs.filter.ip"],onClick:function(){e.handleToggleShow("remoteAddress")}},F(E)))),0!==k&&o().createElement(r.IconMenu,{iconButtonElement:o().createElement(r.IconButton,ae({iconClassName:"mdi mdi-alarm"+(R?"-snooze":""),tooltip:T["ajxp_admin.logs.tz.tooltip"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},o().createElement(r.MenuItem,{primaryText:T["ajxp_admin.logs.tz.local"],rightIcon:R?null:_,onClick:function(){e.toggleUseServerOffset()}}),o().createElement(r.MenuItem,{primaryText:T["ajxp_admin.logs.tz.server"],rightIcon:R?_:null,onClick:function(){e.toggleUseServerOffset()}})),!i&&o().createElement(r.IconMenu,{iconButtonElement:o().createElement(r.IconButton,ae({iconClassName:"mdi mdi-download",tooltip:T["ajxp_admin.logs.11"]},s.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},!D&&o().createElement(r.Subheader,I,T["ajxp_admin.logs.export.disabled"]),D&&o().createElement(r.Subheader,I,T["ajxp_admin.logs.11"]),o().createElement(r.MenuItem,{primaryText:"CSV",rightIcon:o().createElement(r.FontIcon,{style:{top:0},className:"mdi mdi-file-delimited"}),onClick:function(){e.handleExport("CSV")},disabled:!D}),o().createElement(r.MenuItem,{primaryText:"XLSX",rightIcon:o().createElement(r.FontIcon,{style:{top:0},className:"mdi mdi-file-excel"}),onClick:function(){e.handleExport("XLSX")},disabled:!D}),C&&o().createElement(r.Subheader,null,o().createElement("a",{href:C,download:j},j))),o().createElement(r.Dialog,{open:!!C,modal:!0,title:T["ajxp_admin.logs.11"],actions:[o().createElement(r.FlatButton,{label:T[54],onClick:P})]},o().createElement("span",{style:{fontSize:13}},T["ajxp_admin.logs.export.clicklink"],": ",o().createElement("a",{style:{textDecoration:"underline"},href:C,download:j,onClick:P},j))),o().createElement(r.IconButton,{iconClassName:"mdi mdi-brightness-6",tooltip:T["ajxp_admin.logs.toggleTheme"],onClick:function(){return e.toggleDarkTheme()},style:s.props.header.iconButton.style,iconStyle:se(se({},s.props.header.iconButton.iconStyle),{},{transform:this.state.darkTheme?"rotate(180deg)":""})}))}}],n&&ue(t.prototype,n),s}(o().Component);function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function Oe(){return Oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Oe.apply(this,arguments)}function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ee(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ce(e,t){return Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ce(e,t)}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}be=(0,re.muiThemeable)()(be);var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(s,e);var t,n,i,a,l=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,o=je(i);if(a){var r=je(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return t=this,!(n=e)||"object"!==Se(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=l.call(this,e)).state={page:0,size:100,query:"",contentType:"JSON",loading:!1,results:0},t}return t=s,n=[{key:"handleLogToolsChange",value:function(e){this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))}},{key:"componentWillReceiveProps",value:function(e){void 0!==e.query&&e.query!==this.state.query&&this.setState({query:e.query,page:0}),void 0!==e.darkTheme&&this.setState({darkTheme:e.darkTheme}),void 0!==e.timeOffset&&this.setState({timeOffset:e.timeOffset})}},{key:"handleReload",value:function(){this.setState({z:Math.random()})}},{key:"handleDecrPage",value:function(){this.setState({page:Math.max(this.state.page-1,0)})}},{key:"handleIncrPage",value:function(){this.setState({page:this.state.page+1})}},{key:"handleTimestampContext",value:function(e){if(e){var t=E.buildTsQuery(e,5);this.setState({tmpQuery:t,focus:e})}else this.setState({tmpQuery:null,focus:null})}},{key:"handleLoadingStatusChange",value:function(e,t){this.props.onLoadingStatusChange?this.props.onLoadingStatusChange(e):this.setState({loading:e}),this.setState({results:t})}},{key:"render",value:function(){var e,t=this,n=this.props,i=n.pydio,a=n.noHeader,l=n.service,s=n.disableExport,c=n.currentNode,u=this.state,d=u.page,p=u.size,f=u.query,h=u.tmpQuery,m=u.focus,g=u.contentType,y=u.z,v=u.results,b=u.darkTheme,S=u.timeOffset,O=void 0===S?0:S,w=i.MessageHash["ajxp_admin.logs.1"],x=o().createElement(be,{pydio:i,service:l,focus:m,onStateChange:this.handleLogToolsChange.bind(this),disableExport:s}),E=AdminComponents.AdminStyles().body,C=E.block.props,j=E.block.container,P=0===d,k=[50,100,500,1e3];P&&v<k[0]||m||(e={pageSizes:k,prevDisabled:P,nextDisabled:v<p,onPageNext:this.handleIncrPage.bind(this),onPagePrev:this.handleDecrPage.bind(this),onPageSizeChange:function(e){t.setState({size:e,page:0})}});var R=o().createElement(r.Paper,Oe({},C,{style:j}),o().createElement(te,Oe({pydio:i,service:l||"syslog",page:d,size:p,query:h||f,focus:m,contentType:g,darkTheme:b,timeOffset:O,z:y,onLoadingStatusChange:this.handleLoadingStatusChange.bind(this),onTimestampContext:this.handleTimestampContext.bind(this)},e)));return a?R:o().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},o().createElement("div",{className:"vertical-layout",style:{width:"100%"}},o().createElement(AdminComponents.Header,{title:w,icon:c.getMetadata().get("icon_class"),actions:x,reloadAction:this.handleReload.bind(this),loading:this.state.loading}),o().createElement("div",{className:"layout-fill"},R)))}}],n&&Ee(t.prototype,n),s}(o().Component);Pe.propTypes={dataModel:a().instanceOf(s()).isRequired},window.AdminLogs=t})();