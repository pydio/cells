(()=>{"use strict";var e={305:e=>{e.exports=require("lodash.debounce")},455:e=>{e.exports=require("material-ui")},757:e=>{e.exports=require("pydio")},727:e=>{e.exports=require("pydio/model/meta-node-provider")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{ASClient:()=>d,Activity:()=>ye,ActivityList:()=>ke,Callbacks:()=>ot,InfoPanel:()=>He,Listener:()=>tt,OverlayPanel:()=>mt,UserPanel:()=>Xe,WatchSelector:()=>st});const e=require("react");var t=r.n(e),o=r(455);const i=require("prop-types");var a=r.n(i),c=r(757),l=r.n(c);const u=require("pydio/http/api");var s=r.n(u);const f=require("cells-sdk");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===p(o)?o:String(o)),n)}var o}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"loadActivityStreams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USER_ID",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"outbox",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;if(!t)return Promise.resolve([]);var a=new f.ActivityServiceApi(s().getRestClient()),c=new f.ActivityStreamActivitiesRequest;return c.Context=e,c.ContextData=t,c.BoxName=r,o>-1&&(c.Offset=o),i>-1&&(c.Limit=i),c.Language=l().getInstance().user.getPreference("lang")||"",n&&(c.PointOfView=n),a.stream(c)}},{key:"UnreadInbox",value:function(e){var t=new f.ActivityServiceApi(s().getRestClient()),r=new f.ActivityStreamActivitiesRequest;return r.Context="USER_ID",r.ContextData=e,r.BoxName="inbox",r.UnreadCountOnly=!0,t.stream(r).then((function(e){return e.totalItems||0}))}}],null&&y(t.prototype,null),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const b=require("react-markdown");var m=r.n(b);const v=require("material-ui/styles"),h=require("pydio/util/path");var g=r.n(h);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return(t=x(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,x(n.key),n)}}function _(e,t,r){return t&&E(e.prototype,t),r&&E(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===w(t)?t:String(t)}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=M(e);if(t){var o=M(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}var A=r(455),R=A.Paper,D=A.IconButton,L=A.FlatButton,I=A.Divider,H=r(757),q=r(305),B=r(727),N=H.requireLib("boot").PydioContextConsumer,U=(H.requireLib("workspaces").FilePreview,H.requireLib("hoc").ThemedContainers.Popover);function W(e,t){var r=[],n=t.user.getActiveRepository();if(!(e&&e.partOf&&e.partOf.items&&e.partOf.items.length))return r;for(var o=0;o<e.partOf.items.length;o++){var i=e.partOf.items[o],a=i.rel.split("/");a.shift();var c=a.join("/");0!==c.indexOf("/")&&(c="/"+c);var l=new AjxpNode(c,"Document"===e.type);if(l.getMetadata().set("repository_id",i.id),l.getMetadata().set("repository_label",i.name),l.getMetadata().set("filename",c),i.id===n)return[l];r.push(l)}return r}var F=function(e){C(n,e);var r=k(n);function n(e){var t;P(this,n),t=r.call(this,e);var o=W(e.activity.object,e.pydio);return o.length&&!o[0].isLeaf()?t.state={previewLoaded:!0,previewFailed:!1,nodes:o}:t.state={previewLoaded:!1,previewFailed:!1,nodes:o},t}return _(n,[{key:"render",value:function(){var e=this,r=this.props.pydio,n=this.state,o=n.previewLoaded,i=n.nodes,a=n.previewFailed,c=i.length?i[0]:null,l={height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:70};if(c&&c.isLeaf())if(o&&!a);else if(o&&a)S(S({},l),{},{flexDirection:"column"});else{var u=c.getMetadata().get("repository_id"),s=c.getMetadata().get("repository_label"),f=new B;c.observeOnce("error",(function(){e.setState({previewLoaded:!0,previewFailed:!0})})),f.loadLeafNodeSync(c,(function(t){t.getMetadata().set("repository_id",u),t.getMetadata().set("repository_label",s),i[0]=t,e.setState({previewLoaded:!0,nodes:i})}),!0,{tmp_repository_id:u})}for(var p,y=[],d=r.user.getActiveRepository(),b=function(){var e=i[m],n=t().createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},t().createElement("div",{style:{flex:1,fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.33)"}},r.MessageHash["notification_center.16"]," ",e.getMetadata().get("repository_label")),t().createElement(D,{iconClassName:"mdi mdi-open-in-new",tooltip:r.MessageHash["notification_center.6"],tooltipPosition:"top-center",onClick:function(){r.goTo(e)}}));if(e.getMetadata().get("repository_id")===d)return p=t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("span",{style:{flex:1}})," ",t().createElement(L,{label:r.MessageHash["notification_center.6"],iconClassName:"mdi mdi-open-in-new",tooltip:"Open",tooltipPosition:"top-right",onClick:function(){r.goTo(e)}})),"break";y.push(n),m<i.length-1&&y.push(t().createElement(I,null))},m=0;m<i.length&&"break"!==b();m++);return p&&(y=[p]),t().createElement("div",null,!a&&t().createElement("div",{style:{padding:6}},y))}}]),n}(t().Component),z=function(e){C(n,e);var r=k(n);function n(e){var t;return P(this,n),(t=r.call(this,e)).state={showPopover:!1,popoverAnchor:null},t}return _(n,[{key:"render",value:function(){var e=this,r=this.props,n=r.pydio,o=r.activity,i=r.children,a=r.linkStyle;o.object.name||(o.object.name="");var c,l,u,s,f=W(o.object,n),p=o.object.name.replace("doc://","").split("/");p.shift();var y="/"+p.join("/");return f.length>1?(c=function(){n.goTo(f[0])},u=q((function(){e.setState({showPopover:!1})}),350),l=function(t){e.setState({showPopover:!0,popoverAnchor:t.currentTarget}),u.cancel()},s=t().createElement(U,{open:this.state.showPopover,anchorEl:this.state.popoverAnchor,onRequestClose:function(t){"clickAway"!==t&&e.setState({showPopover:!1})},anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},useLayerForClickAway:!1},t().createElement(R,{zDepth:2,style:{width:200,height:"auto",overflowY:"auto"},onMouseOver:function(t){e.setState({showPopover:!0}),u.cancel()},onMouseOut:u},t().createElement(F,{pydio:n,activity:o})))):1===f.length&&(c=function(){n.goTo(f[0])}),t().createElement("span",null,t().createElement("a",{title:y,style:S({cursor:"pointer",color:"rgb(66, 140, 179)"},a),onMouseOver:l,onMouseOut:u,onClick:c},i),s)}}]),n}(t().Component);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G.apply(this,arguments)}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t,r){return(t=Z(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Z(n.key),n)}}function X(e,t,r){return t&&Q(e.prototype,t),r&&Q(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Z(e){var t=function(e,t){if("object"!==V(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===V(t)?t:String(t)}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=oe(e);if(t){var o=oe(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ne(e)}(this,r)}}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}z.PropTypes={activity:a().object,pydio:a().instanceOf(H)},z=N(z);var ie=l().requireLib("components"),ae=(ie.Timeline,ie.UserAvatar),ce=l().requireLib("boot").PydioContextConsumer,le=l().requireLib("workspaces").FilePreview,ue=l().requireLib("boot").moment,se=function(e){ee(n,e);var r=re(n);function n(){return K(this,n),r.apply(this,arguments)}return X(n,[{key:"render",value:function(){return t().createElement("span",null,this.props.children)}}]),n}(t().Component);function fe(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return function(o){ee(a,o);var i=re(a);function a(){return K(this,a),i.apply(this,arguments)}return X(a,[{key:"render",value:function(){var o=this.props,i=o.href,a=o.children,c=J({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},n),l=null;if(i.startsWith("doc://"))return"Delete"===r.type?t().createElement("a",{style:{textDecoration:"line-through"}},a):t().createElement(z,{pydio:e,activity:r,linkStyle:c},a);if(i.startsWith("user://")){var u=i.replace("user://","");return t().createElement(ae,{userId:u,displayAvatar:!1,richOnClick:!0,style:J(J({},c),{},{display:"inline-block"}),pydio:e})}if(i.startsWith("workspaces://")){var s=i.replace("workspaces://","");e.user&&e.user.getRepositoriesList().get(s)&&(l=function(){e.triggerRepositoryChange(s)})}return t().createElement("a",{title:"",style:c,onClick:l},a)}}]),a}(t().Component)}var pe=function(r){ee(o,r);var n=re(o);function o(){return K(this,o),n.apply(this,arguments)}return X(o,[{key:"render",value:function(){var r=this.props,n=r.activity,o=r.listContext,i=r.inlineActor;if(!n.summary)return t().createElement("span",null,n.type," ",n.actor?" - "+n.actor.name:"");var a,c={paragraph:se,link:fe(pydio,n,{color:"inherit"})};return"NODE-LEAF"===o&&(c.link=function(){return null}),i&&n.actor&&(a=t().createElement(ae,{userId:n.actor.id,userLabel:n.actor.name,displayLocalLabel:!0,userType:"user",pydio:l().getInstance(),style:{display:"inline-block"},labelStyle:{display:"inline-block"},displayAvatar:!1,richOnHover:!1})),t().createElement(e.Fragment,null,a,a?" - ":null,t().createElement(m(),{source:n.summary,renderers:c,style:{display:"inline"},containerTagName:i?"span":"div"}))}}]),o}(t().Component),ye=function(e){ee(n,e);var r=re(n);function n(){var e;K(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return $(ne(e=r.call.apply(r,[this].concat(o))),"state",{hover:!1}),e}return X(n,[{key:"computeIcon",value:function(e){var t,r="";switch(e.type){case"Create":r="Document"===e.object.type?"file-plus":"folder-plus",t="Created";break;case"Delete":r="delete",t="Deleted";break;case"Edit":case"Update":r="pencil",t="Modified";break;case"UpdateMeta":r="tag-multiple",t="Modified";break;case"UpdateComment":r="message-outline",t="Commented";break;case"Read":r="eye",t="Accessed";break;case"Move":r="file-send",t="Moved";break;case"Share":r="share-variant","Cell"===e.object.type?r="icomoon-cells":"Workspace"===e.object.type&&(r="folder"),t="Shared"}return-1===r.indexOf("icomoon-")&&(r="mdi mdi-"+r),{title:t,className:r}}},{key:"render",value:function(){var e,r=this,n=this.props,i=n.pydio,a=n.activity,c=n.listContext,l=n.oneLiner,u=n.muiTheme,s=n.onRequestClose,f=void 0===s?function(){}:s,p=this.state.hover,y=this.computeIcon(a).className,d=u.palette.mui3["outline-variant"],b={margin:0,padding:"10px 0"};p&&(b=J(J({},b),{},{backgroundColor:u.hoverBackgroundColor}));var m,v,h,w=W(a.object,i);if(w.length?(m=t().createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},t().createElement(le,G({pydio:i,node:w[0],loadThumbnail:!0},{style:{height:36,width:36,borderRadius:"50%"},mimeFontStyle:{fontSize:20,lineHeight:"36px",textAlign:"center"}})),t().createElement("span",{className:y,style:{position:"absolute",bottom:8,right:12,fontSize:18,color:d}})),v=w[0].getLabel()||g().getBasename(w[0].getPath())):(m=t().createElement("div",{style:{margin:"8px 20px",backgroundColor:"var(--md-sys-color-primary-container)",alignItems:"initial",height:36,width:36,borderRadius:"50%",textAlign:"center"}},t().createElement(o.FontIcon,{className:y,style:{lineHeight:"36px"}})),v=a.object?a.object.name:a.name),e=t().createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},m,t().createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},t().createElement("div",{style:{marginBottom:4,fontSize:14,fontWeight:500,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",color:"var(--md-sys-color-on-surface)"}},v),t().createElement("div",{style:{opacity:1}},t().createElement(pe,{activity:a,listContext:c})))),"Delete"!==a.type&&a.object&&"Folder"===a.object.type||"Document"===a.object.type){var O=W(a.object,i);O.length&&(h=function(){i.goTo(O[0]),f()},b.cursor="pointer")}return t().createElement("div",{style:b,onMouseEnter:function(){return r.setState({hover:!0})},onMouseLeave:function(){return r.setState({hover:!1})},onClick:h},!l&&t().createElement("div",{style:{display:"flex",alignItems:"center"}},a.actor&&t().createElement(ae,{useDefaultAvatar:!0,userId:a.actor.id,userLabel:a.actor.name,displayLocalLabel:!0,userType:"user",pydio:i,style:{display:"flex",alignItems:"center",maxWidth:"60%"},labelStyle:{fontSize:14,fontWeight:500,paddingLeft:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},avatarStyle:{flexShrink:0},avatarSize:28,richOnHover:!0}),t().createElement("span",{style:{fontSize:13,display:"inline-block",flex:1,height:18,color:"rgba(0,0,0,0.23)",fontWeight:500,paddingLeft:8,whiteSpace:"nowrap"}},ue(a.updated).fromNow())),e)}}]),n}(t().Component);function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e,t,r){return(t=Oe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ge(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ge(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Oe(n.key),n)}}function Oe(e){var t=function(e,t){if("object"!==de(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===de(t)?t:String(t)}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}ye.PropTypes={activity:a().object,listContext:a().string,displayContext:a().oneOf(["infoPanel","popover"])},ye=ce(ye=(0,v.muiThemeable)()(ye));var Pe=l().requireLib("boot"),Ee=Pe.PydioContextConsumer,_e=Pe.moment,xe=l().requireLib("components"),Ce=xe.EmptyStateView,Te=xe.Timeline,ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=je(i);if(a){var r=je(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=c.call(this,e),e.items?t.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:t.state={data:[],offset:0,loadMore:!0,loading:!1},t}return r=l,(n=[{key:"mergeMoreFeed",value:function(e,t){var r=e.items.map((function(e){return e.id})),n=t.items.filter((function(e){return-1===r.indexOf(e.id)}));if(!n.length)return this.setState({loadMore:!1}),e;var o=e;return o.items=[].concat(he(e.items),he(n)),o.totalItems=o.items.length,o}},{key:"loadForProps",value:function(e){var t=this,r=e.context,n=e.pointOfView,o=e.contextData,i=e.limit,a=this.state,c=a.offset,l=a.data;void 0===i&&(i=-1),c>0&&(i=100),this.setState({loading:!0,error:null}),d.loadActivityStreams(r,o,"outbox",n,c,i).then((function(e){c>0&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})})).catch((function(e){t.setState({loading:!1,error:e})}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,r=e.contextData;t||r&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},(function(){t.loadForProps(e)}))}},{key:"render",value:function(){var e,r=this,n=[],i=this.props,a=i.listContext,c=i.groupByDate,l=i.displayContext,u=i.pydio,s=i.onRequestClose,f=this.state,p=f.data,y=f.loadMore,d=f.loading,b=f.error,m="mdi mdi-pulse",v=d?u.MessageHash["notification_center.17"]:u.MessageHash["notification_center.18"];b&&(v=b.Detail||b.msg||b,m="mdi mdi-alert-circle-outline");var h=function(){r.setState({offset:p.items.length+1},(function(){r.loadForProps(r.props)}))},g=d?u.MessageHash["notification_center.20"]:u.MessageHash["notification_center.19"];if(!p||!p.items||0===p.items.length){var w,O,S={backgroundColor:"transparent"};return"popover"===l?S=me(me({},S),{},{minHeight:250}):"infoPanel"===l&&(S=me(me({},S),{},{paddingBottom:20,paddingTop:10}),w={fontSize:40},O={fontSize:13}),t().createElement(Ce,{pydio:this.props.pydio,iconClassName:m,primaryTextId:v,style:S,iconStyle:w,legendStyle:O})}if("infoPanel"===l)return t().createElement(Te,{items:p.items,className:"small",useSelection:!1,itemUuid:function(e){return e.id},itemMoment:function(e){return _e(e.updated)},itemDesc:function(e){return t().createElement(pe,{activity:e,listContext:a,inlineActor:!0})},itemActions:function(){return[]},itemAnnotations:function(){return null},color:"#2196f3",loadMoreAction:p.items.length&&y?h:null,loadMoreLabel:g,loadMoreDisabled:d});var j={fontSize:13,color:"var(--md-sys-color-outline)",fontWeight:500};return p.items.forEach((function(r,o){var i=_e(r.updated).fromNow();c&&i!==e&&(n.length?n.push(t().createElement("div",{style:me({padding:"20px 16px 8px"},j)},i)):n.push(t().createElement("div",{style:me({padding:"0 16px 8px"},j)},i))),n.push(t().createElement(ye,{key:r.id,activity:r,listContext:a,oneLiner:c,displayContext:l,onRequestClose:s})),c&&(e=i)})),n.length&&y&&n.push(t().createElement("div",{style:{paddingLeft:16}},t().createElement(o.FlatButton,{primary:!0,label:g,disabled:d,onClick:h}))),t().createElement(o.List,{style:this.props.style},n)}}])&&we(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Me(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Me(o)?o:String(o)),n)}var o}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Re(e,t)}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}ke.PropTypes={context:a().string,contextData:a().string,boxName:a().string,pointOfView:a().oneOf(["GENERIC","ACTOR","SUBJECT"]),displayContext:a().oneOf(["mainList","infoPanel","popover"])},ke=Ee(ke);var Le=Pydio.requireLib("boot").PydioContextConsumer,Ie=Pydio.requireLib("workspaces").InfoPanelCard,He=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=De(o);if(i){var r=De(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.node,n=e.pydio,o=e.popoverPanel;if(!1===n.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES"))return null;var i=r.isLeaf()?"activity.leaf":"activity.folder",a=!r.isLeaf(),c=r.isLeaf()?n.MessageHash["notification_center.11"]:n.MessageHash["notification_center.10"];return t().createElement(Ie,{key:i,identifier:i,defaultOpen:a,title:c,popoverPanel:o},t().createElement(ke,{context:"NODE_ID",contextData:r.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380,padding:"8px 12px"},listContext:"NODE-"+(r.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}])&&Ae(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);He=Le(He);var qe=r(305),Be=r.n(qe);const Ne=require("color");var Ue=r.n(Ne);function We(e){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},We(e)}function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach((function(t){Ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t,r){return(t=Ye(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ye(n.key),n)}}function Ye(e){var t=function(e,t){if("object"!==We(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==We(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===We(t)?t:String(t)}function Je(e,t){return Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Je(e,t)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ke(e){return Ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ke(e)}var Qe=l().requireLib("hoc").ThemedContainers.Popover,Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Je(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ke(i);if(a){var r=Ke(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===We(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $e(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).state={unreadStatus:0,open:!1,data:[]},t.reloadData=Be()(t.reloadData.bind($e(t)),500),t.reloadUnread=Be()(t.reloadUnread.bind($e(t)),500),t}return r=l,(n=[{key:"reloadData",value:function(){var e=this;d.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then((function(t){e.setState({data:t})})).catch((function(t){e.setState({error:t})}))}},{key:"reloadUnread",value:function(){var e=this;d.UnreadInbox(this.props.pydio.user.id).then((function(t){e.setState({unreadStatus:t})})).catch((function(e){}))}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var e=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",(function(t){e.state.open?e.reloadData():e.reloadUnread()}))}},{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.iconStyle,i=e.muiTheme,a=this.state,c=a.open,l=a.anchorEl,u=a.unreadStatus,s={borderRadius:"50%"};return c&&n&&n.color&&(s=ze(ze({},s),{},{backgroundColor:Ue()(n.color).fade(.9).toString()})),t().createElement("span",null,t().createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},t().createElement(o.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(u?u+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:n,style:s}),u>0&&t().createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:i.palette.accent1Color}})),t().createElement(Qe,{open:c,anchorEl:l,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3,panelTitle:r.MessageHash["notification_center.1"],panelIconClassName:"mdi mdi-bell"},this.state.data&&t().createElement(ke,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}])&&Ge(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function et(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ze(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ze(o)?o:String(o)),n)}var o}Xe=(0,v.muiThemeable)()(Xe);var tt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"dynamicBuilder",value:function(e){var t=r.g.pydio,n=t.MessageHash,o=t.getUserSelection().getUniqueNode();if(!o)return[];var i,a=[];return o.getMetadata().get("meta_watched")&&(i=o.getMetadata().get("meta_watched")),a.push({name:n["meta.watch.11"],alt:n["meta.watch."+(o.isLeaf()?"12":"12b")],icon_class:i&&"META_WATCH_CHANGE"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),a.push({name:n["meta.watch.9"],alt:n["meta.watch."+(o.isLeaf()?"10":"10b")],icon_class:i&&"META_WATCH_READ"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),a.push({name:n["meta.watch.13"],alt:n["meta.watch."+(o.isLeaf()?"14":"14b")],icon_class:i&&"META_WATCH_BOTH"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),i&&(a.push({separator:!0}),a.push({name:n["meta.watch.3"],alt:n["meta.watch."+(o.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),a}}],null&&et(t.prototype,null),n&&et(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==rt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===rt(o)?o:String(o)),n)}var o}var ot=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"toggleWatch",value:function(e,t){if(t){var r=pydio.getUserSelection().getUniqueNode(),n=r.getMetadata().get("uuid"),o=pydio.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=n,i.ObjectType=a.NODE;var c=[];"watch_change"!==t&&"watch_both"!==t||c.push("change"),"watch_read"!==t&&"watch_both"!==t||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(e){var n=r.getMetadata().get("overlay_class")||"";if("watch_stop"===t)r.getMetadata().delete("meta_watched"),r.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{r.getMetadata().set("meta_watched","META_"+t.toUpperCase());var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),r.getMetadata().set("overlay_class",o.join(","))}r.notify("node_replaced")}))}}}],null&&nt(t.prototype,null),r&&nt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function at(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==it(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==it(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===it(o)?o:String(o)),n)}var o}function ct(e,t){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ct(e,t)}function lt(e){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lt(e)}var ut=l().requireLib("hoc").ModernSelectField;const st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ct(e,t)}(u,e);var r,n,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=lt(i);if(a){var r=lt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===it(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(t=c.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return r=u,n=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),window.setTimeout((function(){t.setState({saving:!1})}),250)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,r=this.state,n=r.value,i=r.mixed,a=r.saving,c=l().getInstance().MessageHash;return a?t().createElement(ut,{value:"saving",onChange:function(e,t,r){},disabled:!0},t().createElement(o.MenuItem,{value:"saving",primaryText:c["meta.watch.selector.saving"]+"..."})):t().createElement(ut,{value:i?"mixed":n,onChange:function(t,r,n){e.onSelectorChange(n)}},i&&t().createElement(o.MenuItem,{value:"mixed",primaryText:c["meta.watch.selector.mixed"]+"..."}),t().createElement(o.MenuItem,{value:"",primaryText:c["meta.watch.selector.ignore"]}),t().createElement(o.MenuItem,{value:"META_WATCH_READ",primaryText:c["meta.watch.selector.read"]}),t().createElement(o.MenuItem,{value:"META_WATCH_CHANGE",primaryText:c["meta.watch.selector.change"]}),t().createElement(o.MenuItem,{value:"META_WATCH_BOTH",primaryText:c["meta.watch.selector.both"]}))}}],n&&at(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),u}(t().Component);function ft(e){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ft(e)}function pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ft(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ft(o)?o:String(o)),n)}var o}function yt(e,t){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yt(e,t)}function dt(e){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dt(e)}var bt=l().requireLib("workspaces").InfoPanelCard,mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yt(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=dt(o);if(i){var r=dt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ft(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.node,o=e.style,i=e.popoverPanel;return t().createElement(bt,{identifier:"meta-user",style:o,title:r.MessageHash["meta.watch.1-off"],popoverPanel:i},t().createElement("div",{style:{padding:"0 16px 10px"}},t().createElement(st,{pydio:r,nodes:[n]})))}}])&&pt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(e.Component)})(),window.PydioActivityStreams=n})();